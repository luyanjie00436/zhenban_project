USE [sc]
GO
/****** Object:  StoredProcedure [dbo].[Role_Delete]    Script Date: 12/07/2016 16:56:30 ******/
DROP PROCEDURE [dbo].[Role_Delete]
GO
/****** Object:  StoredProcedure [dbo].[Role_Insert]    Script Date: 12/07/2016 16:56:30 ******/
DROP PROCEDURE [dbo].[Role_Insert]
GO
/****** Object:  StoredProcedure [dbo].[Role_Select]    Script Date: 12/07/2016 16:56:30 ******/
DROP PROCEDURE [dbo].[Role_Select]
GO
/****** Object:  StoredProcedure [dbo].[Role_SelectByRoleId]    Script Date: 12/07/2016 16:56:30 ******/
DROP PROCEDURE [dbo].[Role_SelectByRoleId]
GO
/****** Object:  StoredProcedure [dbo].[Role_Update]    Script Date: 12/07/2016 16:56:30 ******/
DROP PROCEDURE [dbo].[Role_Update]
GO
/****** Object:  StoredProcedure [dbo].[UserRole_SelectByUserCardId]    Script Date: 12/07/2016 16:56:31 ******/
DROP PROCEDURE [dbo].[UserRole_SelectByUserCardId]
GO
/****** Object:  StoredProcedure [dbo].[Phone_Insert]    Script Date: 12/07/2016 16:56:29 ******/
DROP PROCEDURE [dbo].[Phone_Insert]
GO
/****** Object:  StoredProcedure [dbo].[Phone_SelectByUserCardId]    Script Date: 12/07/2016 16:56:29 ******/
DROP PROCEDURE [dbo].[Phone_SelectByUserCardId]
GO
/****** Object:  StoredProcedure [dbo].[Phone_Update]    Script Date: 12/07/2016 16:56:29 ******/
DROP PROCEDURE [dbo].[Phone_Update]
GO
/****** Object:  StoredProcedure [dbo].[Nation_Delete]    Script Date: 12/07/2016 16:56:29 ******/
DROP PROCEDURE [dbo].[Nation_Delete]
GO
/****** Object:  StoredProcedure [dbo].[Nation_Insert]    Script Date: 12/07/2016 16:56:29 ******/
DROP PROCEDURE [dbo].[Nation_Insert]
GO
/****** Object:  StoredProcedure [dbo].[Nation_Select]    Script Date: 12/07/2016 16:56:29 ******/
DROP PROCEDURE [dbo].[Nation_Select]
GO
/****** Object:  StoredProcedure [dbo].[Nation_SelectByNationId]    Script Date: 12/07/2016 16:56:29 ******/
DROP PROCEDURE [dbo].[Nation_SelectByNationId]
GO
/****** Object:  StoredProcedure [dbo].[Nation_Update]    Script Date: 12/07/2016 16:56:29 ******/
DROP PROCEDURE [dbo].[Nation_Update]
GO
/****** Object:  StoredProcedure [dbo].[Teaching_SelectByTeachingId]    Script Date: 12/07/2016 16:56:30 ******/
DROP PROCEDURE [dbo].[Teaching_SelectByTeachingId]
GO
/****** Object:  StoredProcedure [dbo].[Paper_SelectByPaperId]    Script Date: 12/07/2016 16:56:29 ******/
DROP PROCEDURE [dbo].[Paper_SelectByPaperId]
GO
/****** Object:  StoredProcedure [dbo].[ApplyYear_Delete]    Script Date: 12/07/2016 16:56:27 ******/
DROP PROCEDURE [dbo].[ApplyYear_Delete]
GO
/****** Object:  StoredProcedure [dbo].[ApplyYear_Insert]    Script Date: 12/07/2016 16:56:27 ******/
DROP PROCEDURE [dbo].[ApplyYear_Insert]
GO
/****** Object:  StoredProcedure [dbo].[ApplyYear_Select]    Script Date: 12/07/2016 16:56:27 ******/
DROP PROCEDURE [dbo].[ApplyYear_Select]
GO
/****** Object:  StoredProcedure [dbo].[ApplyYear_SelectByApplyYearId]    Script Date: 12/07/2016 16:56:27 ******/
DROP PROCEDURE [dbo].[ApplyYear_SelectByApplyYearId]
GO
/****** Object:  StoredProcedure [dbo].[ApplyYear_SelectisApply]    Script Date: 12/07/2016 16:56:27 ******/
DROP PROCEDURE [dbo].[ApplyYear_SelectisApply]
GO
/****** Object:  StoredProcedure [dbo].[ApplyYear_Update]    Script Date: 12/07/2016 16:56:27 ******/
DROP PROCEDURE [dbo].[ApplyYear_Update]
GO
/****** Object:  StoredProcedure [dbo].[ApplyYear_UpdateIsApply]    Script Date: 12/07/2016 16:56:27 ******/
DROP PROCEDURE [dbo].[ApplyYear_UpdateIsApply]
GO
/****** Object:  StoredProcedure [dbo].[Guidance_SelectByGuidanceId]    Script Date: 12/07/2016 16:56:28 ******/
DROP PROCEDURE [dbo].[Guidance_SelectByGuidanceId]
GO
/****** Object:  StoredProcedure [dbo].[WorkLoadProjects_SelectByWorkLoadProjectsId]    Script Date: 12/07/2016 16:56:31 ******/
DROP PROCEDURE [dbo].[WorkLoadProjects_SelectByWorkLoadProjectsId]
GO
/****** Object:  StoredProcedure [dbo].[UserDegree_Save]    Script Date: 12/07/2016 16:56:30 ******/
DROP PROCEDURE [dbo].[UserDegree_Save]
GO
/****** Object:  StoredProcedure [dbo].[UserDegree_SelectByUserCardId]    Script Date: 12/07/2016 16:56:30 ******/
DROP PROCEDURE [dbo].[UserDegree_SelectByUserCardId]
GO
/****** Object:  StoredProcedure [dbo].[Winning_SelectByWinningId]    Script Date: 12/07/2016 16:56:31 ******/
DROP PROCEDURE [dbo].[Winning_SelectByWinningId]
GO
/****** Object:  StoredProcedure [dbo].[Patent_SelectByPatentId]    Script Date: 12/07/2016 16:56:29 ******/
DROP PROCEDURE [dbo].[Patent_SelectByPatentId]
GO
/****** Object:  StoredProcedure [dbo].[Harvest_SelectByHarvestId]    Script Date: 12/07/2016 16:56:28 ******/
DROP PROCEDURE [dbo].[Harvest_SelectByHarvestId]
GO
/****** Object:  StoredProcedure [dbo].[UserInfo_SelectDegreeSum]    Script Date: 12/07/2016 16:56:30 ******/
DROP PROCEDURE [dbo].[UserInfo_SelectDegreeSum]
GO
/****** Object:  StoredProcedure [dbo].[UseRemuneration_Delete]    Script Date: 12/07/2016 16:56:30 ******/
DROP PROCEDURE [dbo].[UseRemuneration_Delete]
GO
/****** Object:  StoredProcedure [dbo].[UseRemuneration_Insert]    Script Date: 12/07/2016 16:56:30 ******/
DROP PROCEDURE [dbo].[UseRemuneration_Insert]
GO
/****** Object:  StoredProcedure [dbo].[UseRemuneration_SelectByUserCardId]    Script Date: 12/07/2016 16:56:30 ******/
DROP PROCEDURE [dbo].[UseRemuneration_SelectByUserCardId]
GO
/****** Object:  StoredProcedure [dbo].[UseRemuneration_SelectByUseRemunerationId]    Script Date: 12/07/2016 16:56:30 ******/
DROP PROCEDURE [dbo].[UseRemuneration_SelectByUseRemunerationId]
GO
/****** Object:  StoredProcedure [dbo].[UseRemuneration_Update]    Script Date: 12/07/2016 16:56:30 ******/
DROP PROCEDURE [dbo].[UseRemuneration_Update]
GO
/****** Object:  StoredProcedure [dbo].[AssessValue_SelectByApplyYearId]    Script Date: 12/07/2016 16:56:27 ******/
DROP PROCEDURE [dbo].[AssessValue_SelectByApplyYearId]
GO
/****** Object:  StoredProcedure [dbo].[AssessValue_SelectByUserCardId]    Script Date: 12/07/2016 16:56:27 ******/
DROP PROCEDURE [dbo].[AssessValue_SelectByUserCardId]
GO
/****** Object:  StoredProcedure [dbo].[AssessValue_SelectCheck]    Script Date: 12/07/2016 16:56:27 ******/
DROP PROCEDURE [dbo].[AssessValue_SelectCheck]
GO
/****** Object:  StoredProcedure [dbo].[AssessValue_SelectDepValue]    Script Date: 12/07/2016 16:56:27 ******/
DROP PROCEDURE [dbo].[AssessValue_SelectDepValue]
GO
/****** Object:  StoredProcedure [dbo].[Guidance_Insert]    Script Date: 12/07/2016 16:56:28 ******/
DROP PROCEDURE [dbo].[Guidance_Insert]
GO
/****** Object:  StoredProcedure [dbo].[Harvest_Insert]    Script Date: 12/07/2016 16:56:28 ******/
DROP PROCEDURE [dbo].[Harvest_Insert]
GO
/****** Object:  StoredProcedure [dbo].[LongProjects_Insert]    Script Date: 12/07/2016 16:56:28 ******/
DROP PROCEDURE [dbo].[LongProjects_Insert]
GO
/****** Object:  StoredProcedure [dbo].[LongProjects_SelectByLongProjectsId]    Script Date: 12/07/2016 16:56:28 ******/
DROP PROCEDURE [dbo].[LongProjects_SelectByLongProjectsId]
GO
/****** Object:  StoredProcedure [dbo].[Paper_Insert]    Script Date: 12/07/2016 16:56:29 ******/
DROP PROCEDURE [dbo].[Paper_Insert]
GO
/****** Object:  StoredProcedure [dbo].[Patent_Insert]    Script Date: 12/07/2016 16:56:29 ******/
DROP PROCEDURE [dbo].[Patent_Insert]
GO
/****** Object:  StoredProcedure [dbo].[ShortProjects_Insert]    Script Date: 12/07/2016 16:56:30 ******/
DROP PROCEDURE [dbo].[ShortProjects_Insert]
GO
/****** Object:  StoredProcedure [dbo].[ShortProjects_SelectByShortProjectsId]    Script Date: 12/07/2016 16:56:30 ******/
DROP PROCEDURE [dbo].[ShortProjects_SelectByShortProjectsId]
GO
/****** Object:  StoredProcedure [dbo].[Teaching_Insert]    Script Date: 12/07/2016 16:56:30 ******/
DROP PROCEDURE [dbo].[Teaching_Insert]
GO
/****** Object:  StoredProcedure [dbo].[Winning_Insert]    Script Date: 12/07/2016 16:56:31 ******/
DROP PROCEDURE [dbo].[Winning_Insert]
GO
/****** Object:  StoredProcedure [dbo].[WorkLoadProjects_Insert]    Script Date: 12/07/2016 16:56:31 ******/
DROP PROCEDURE [dbo].[WorkLoadProjects_Insert]
GO
/****** Object:  StoredProcedure [dbo].[ShortProjects_Update]    Script Date: 12/07/2016 16:56:30 ******/
DROP PROCEDURE [dbo].[ShortProjects_Update]
GO
/****** Object:  StoredProcedure [dbo].[ShortProjectsEnd_Update]    Script Date: 12/07/2016 16:56:30 ******/
DROP PROCEDURE [dbo].[ShortProjectsEnd_Update]
GO
/****** Object:  StoredProcedure [dbo].[Status_Delete]    Script Date: 12/07/2016 16:56:30 ******/
DROP PROCEDURE [dbo].[Status_Delete]
GO
/****** Object:  StoredProcedure [dbo].[Status_Insert]    Script Date: 12/07/2016 16:56:30 ******/
DROP PROCEDURE [dbo].[Status_Insert]
GO
/****** Object:  StoredProcedure [dbo].[Status_Select]    Script Date: 12/07/2016 16:56:30 ******/
DROP PROCEDURE [dbo].[Status_Select]
GO
/****** Object:  StoredProcedure [dbo].[Status_SelectByStatusId]    Script Date: 12/07/2016 16:56:30 ******/
DROP PROCEDURE [dbo].[Status_SelectByStatusId]
GO
/****** Object:  StoredProcedure [dbo].[Status_Update]    Script Date: 12/07/2016 16:56:30 ******/
DROP PROCEDURE [dbo].[Status_Update]
GO
/****** Object:  StoredProcedure [dbo].[Teaching_Update]    Script Date: 12/07/2016 16:56:30 ******/
DROP PROCEDURE [dbo].[Teaching_Update]
GO
/****** Object:  StoredProcedure [dbo].[Winning_Update]    Script Date: 12/07/2016 16:56:31 ******/
DROP PROCEDURE [dbo].[Winning_Update]
GO
/****** Object:  StoredProcedure [dbo].[WorkLoadProjects_Update]    Script Date: 12/07/2016 16:56:31 ******/
DROP PROCEDURE [dbo].[WorkLoadProjects_Update]
GO
/****** Object:  StoredProcedure [dbo].[LongProjects_Update]    Script Date: 12/07/2016 16:56:28 ******/
DROP PROCEDURE [dbo].[LongProjects_Update]
GO
/****** Object:  StoredProcedure [dbo].[Harvest_Update]    Script Date: 12/07/2016 16:56:28 ******/
DROP PROCEDURE [dbo].[Harvest_Update]
GO
/****** Object:  StoredProcedure [dbo].[Guidance_Update]    Script Date: 12/07/2016 16:56:28 ******/
DROP PROCEDURE [dbo].[Guidance_Update]
GO
/****** Object:  StoredProcedure [dbo].[Patent_Update]    Script Date: 12/07/2016 16:56:29 ******/
DROP PROCEDURE [dbo].[Patent_Update]
GO
/****** Object:  StoredProcedure [dbo].[Paper_Update]    Script Date: 12/07/2016 16:56:29 ******/
DROP PROCEDURE [dbo].[Paper_Update]
GO
/****** Object:  StoredProcedure [dbo].[LongProjectsStand_Update]    Script Date: 12/07/2016 16:56:29 ******/
DROP PROCEDURE [dbo].[LongProjectsStand_Update]
GO
/****** Object:  StoredProcedure [dbo].[LongProjectsInspect_Update]    Script Date: 12/07/2016 16:56:29 ******/
DROP PROCEDURE [dbo].[LongProjectsInspect_Update]
GO
/****** Object:  StoredProcedure [dbo].[LongProjectsEnd_Update]    Script Date: 12/07/2016 16:56:29 ******/
DROP PROCEDURE [dbo].[LongProjectsEnd_Update]
GO
/****** Object:  StoredProcedure [dbo].[LongProjectsDeclareAuditProcess_Insert]    Script Date: 12/07/2016 16:56:28 ******/
DROP PROCEDURE [dbo].[LongProjectsDeclareAuditProcess_Insert]
GO
/****** Object:  StoredProcedure [dbo].[LongProjectsEndAuditProcess_Insert]    Script Date: 12/07/2016 16:56:29 ******/
DROP PROCEDURE [dbo].[LongProjectsEndAuditProcess_Insert]
GO
/****** Object:  StoredProcedure [dbo].[LongCapitalPlan_Insert]    Script Date: 12/07/2016 16:56:28 ******/
DROP PROCEDURE [dbo].[LongCapitalPlan_Insert]
GO
/****** Object:  StoredProcedure [dbo].[LongCapitalPlanAuditProcess_Insert]    Script Date: 12/07/2016 16:56:28 ******/
DROP PROCEDURE [dbo].[LongCapitalPlanAuditProcess_Insert]
GO
/****** Object:  StoredProcedure [dbo].[LongProjectsInspectAuditProcess_Insert]    Script Date: 12/07/2016 16:56:29 ******/
DROP PROCEDURE [dbo].[LongProjectsInspectAuditProcess_Insert]
GO
/****** Object:  StoredProcedure [dbo].[LongProjectsStandAuditProcess_Insert]    Script Date: 12/07/2016 16:56:29 ******/
DROP PROCEDURE [dbo].[LongProjectsStandAuditProcess_Insert]
GO
/****** Object:  StoredProcedure [dbo].[PaperAuditProcess_Insert]    Script Date: 12/07/2016 16:56:29 ******/
DROP PROCEDURE [dbo].[PaperAuditProcess_Insert]
GO
/****** Object:  StoredProcedure [dbo].[PatentAuditProcess_Insert]    Script Date: 12/07/2016 16:56:29 ******/
DROP PROCEDURE [dbo].[PatentAuditProcess_Insert]
GO
/****** Object:  StoredProcedure [dbo].[Department_Delete]    Script Date: 12/07/2016 16:56:28 ******/
DROP PROCEDURE [dbo].[Department_Delete]
GO
/****** Object:  StoredProcedure [dbo].[Department_Insert]    Script Date: 12/07/2016 16:56:28 ******/
DROP PROCEDURE [dbo].[Department_Insert]
GO
/****** Object:  StoredProcedure [dbo].[Department_Select]    Script Date: 12/07/2016 16:56:28 ******/
DROP PROCEDURE [dbo].[Department_Select]
GO
/****** Object:  StoredProcedure [dbo].[Department_SelectByDepartmentId]    Script Date: 12/07/2016 16:56:28 ******/
DROP PROCEDURE [dbo].[Department_SelectByDepartmentId]
GO
/****** Object:  StoredProcedure [dbo].[Department_Update]    Script Date: 12/07/2016 16:56:28 ******/
DROP PROCEDURE [dbo].[Department_Update]
GO
/****** Object:  StoredProcedure [dbo].[Education_Delete]    Script Date: 12/07/2016 16:56:28 ******/
DROP PROCEDURE [dbo].[Education_Delete]
GO
/****** Object:  StoredProcedure [dbo].[Education_Insert]    Script Date: 12/07/2016 16:56:28 ******/
DROP PROCEDURE [dbo].[Education_Insert]
GO
/****** Object:  StoredProcedure [dbo].[Education_Select]    Script Date: 12/07/2016 16:56:28 ******/
DROP PROCEDURE [dbo].[Education_Select]
GO
/****** Object:  StoredProcedure [dbo].[GuidanceAuditProcess_Insert]    Script Date: 12/07/2016 16:56:28 ******/
DROP PROCEDURE [dbo].[GuidanceAuditProcess_Insert]
GO
/****** Object:  StoredProcedure [dbo].[HarvestAuditProcess_Insert]    Script Date: 12/07/2016 16:56:28 ******/
DROP PROCEDURE [dbo].[HarvestAuditProcess_Insert]
GO
/****** Object:  StoredProcedure [dbo].[UserInfo_SelectEducationSum]    Script Date: 12/07/2016 16:56:31 ******/
DROP PROCEDURE [dbo].[UserInfo_SelectEducationSum]
GO
/****** Object:  StoredProcedure [dbo].[LongCapitalChange_Insert]    Script Date: 12/07/2016 16:56:28 ******/
DROP PROCEDURE [dbo].[LongCapitalChange_Insert]
GO
/****** Object:  StoredProcedure [dbo].[LongCapitalChangeAuditProcess_Insert]    Script Date: 12/07/2016 16:56:28 ******/
DROP PROCEDURE [dbo].[LongCapitalChangeAuditProcess_Insert]
GO
/****** Object:  StoredProcedure [dbo].[LongCapitalClose_Insert]    Script Date: 12/07/2016 16:56:28 ******/
DROP PROCEDURE [dbo].[LongCapitalClose_Insert]
GO
/****** Object:  StoredProcedure [dbo].[LongCapitalCloseAuditProcess_Insert]    Script Date: 12/07/2016 16:56:28 ******/
DROP PROCEDURE [dbo].[LongCapitalCloseAuditProcess_Insert]
GO
/****** Object:  StoredProcedure [dbo].[WorkLoadProjectsAuditProcess_Insert]    Script Date: 12/07/2016 16:56:31 ******/
DROP PROCEDURE [dbo].[WorkLoadProjectsAuditProcess_Insert]
GO
/****** Object:  StoredProcedure [dbo].[TeachingAuditProcess_Insert]    Script Date: 12/07/2016 16:56:30 ******/
DROP PROCEDURE [dbo].[TeachingAuditProcess_Insert]
GO
/****** Object:  StoredProcedure [dbo].[WinningAuditProcess_Insert]    Script Date: 12/07/2016 16:56:31 ******/
DROP PROCEDURE [dbo].[WinningAuditProcess_Insert]
GO
/****** Object:  StoredProcedure [dbo].[UserEducation_Save]    Script Date: 12/07/2016 16:56:30 ******/
DROP PROCEDURE [dbo].[UserEducation_Save]
GO
/****** Object:  StoredProcedure [dbo].[UserEducation_SelectByUserCardId]    Script Date: 12/07/2016 16:56:30 ******/
DROP PROCEDURE [dbo].[UserEducation_SelectByUserCardId]
GO
/****** Object:  StoredProcedure [dbo].[Education_SelectByEducationId]    Script Date: 12/07/2016 16:56:28 ******/
DROP PROCEDURE [dbo].[Education_SelectByEducationId]
GO
/****** Object:  StoredProcedure [dbo].[Education_Update]    Script Date: 12/07/2016 16:56:28 ******/
DROP PROCEDURE [dbo].[Education_Update]
GO
/****** Object:  StoredProcedure [dbo].[ShortCapitalPlan_Insert]    Script Date: 12/07/2016 16:56:30 ******/
DROP PROCEDURE [dbo].[ShortCapitalPlan_Insert]
GO
/****** Object:  StoredProcedure [dbo].[ShortCapitalPlanAuditProcess_Insert]    Script Date: 12/07/2016 16:56:30 ******/
DROP PROCEDURE [dbo].[ShortCapitalPlanAuditProcess_Insert]
GO
/****** Object:  StoredProcedure [dbo].[ShortProjectsEndAuditProcess_Insert]    Script Date: 12/07/2016 16:56:30 ******/
DROP PROCEDURE [dbo].[ShortProjectsEndAuditProcess_Insert]
GO
/****** Object:  StoredProcedure [dbo].[ShortCapitalClose_Insert]    Script Date: 12/07/2016 16:56:30 ******/
DROP PROCEDURE [dbo].[ShortCapitalClose_Insert]
GO
/****** Object:  StoredProcedure [dbo].[ShortCapitalCloseAuditProcess_Insert]    Script Date: 12/07/2016 16:56:30 ******/
DROP PROCEDURE [dbo].[ShortCapitalCloseAuditProcess_Insert]
GO
/****** Object:  StoredProcedure [dbo].[ShortProjectsStandAuditProcess_Insert]    Script Date: 12/07/2016 16:56:30 ******/
DROP PROCEDURE [dbo].[ShortProjectsStandAuditProcess_Insert]
GO
/****** Object:  StoredProcedure [dbo].[ShortCapitalChange_Insert]    Script Date: 12/07/2016 16:56:30 ******/
DROP PROCEDURE [dbo].[ShortCapitalChange_Insert]
GO
/****** Object:  StoredProcedure [dbo].[ShortCapitalChangeAuditProcess_Insert]    Script Date: 12/07/2016 16:56:30 ******/
DROP PROCEDURE [dbo].[ShortCapitalChangeAuditProcess_Insert]
GO
/****** Object:  StoredProcedure [dbo].[ShortCapitalCloseProcess_Delete]    Script Date: 12/07/2016 16:56:30 ******/
DROP PROCEDURE [dbo].[ShortCapitalCloseProcess_Delete]
GO
/****** Object:  StoredProcedure [dbo].[ShortCapitalCloseProcess_Insert]    Script Date: 12/07/2016 16:56:30 ******/
DROP PROCEDURE [dbo].[ShortCapitalCloseProcess_Insert]
GO
/****** Object:  StoredProcedure [dbo].[ShortProjectsProcess_Delete]    Script Date: 12/07/2016 16:56:30 ******/
DROP PROCEDURE [dbo].[ShortProjectsProcess_Delete]
GO
/****** Object:  StoredProcedure [dbo].[ShortProjectsProcess_Insert]    Script Date: 12/07/2016 16:56:30 ******/
DROP PROCEDURE [dbo].[ShortProjectsProcess_Insert]
GO
/****** Object:  StoredProcedure [dbo].[ShortCapitalChangeProcess_Delete]    Script Date: 12/07/2016 16:56:30 ******/
DROP PROCEDURE [dbo].[ShortCapitalChangeProcess_Delete]
GO
/****** Object:  StoredProcedure [dbo].[ShortCapitalChangeProcess_Insert]    Script Date: 12/07/2016 16:56:30 ******/
DROP PROCEDURE [dbo].[ShortCapitalChangeProcess_Insert]
GO
/****** Object:  StoredProcedure [dbo].[ShortCapitalChangeExamine_Select]    Script Date: 12/07/2016 16:56:30 ******/
DROP PROCEDURE [dbo].[ShortCapitalChangeExamine_Select]
GO
/****** Object:  StoredProcedure [dbo].[ShortCapitalClose_SelectByUserCardId]    Script Date: 12/07/2016 16:56:30 ******/
DROP PROCEDURE [dbo].[ShortCapitalClose_SelectByUserCardId]
GO
/****** Object:  StoredProcedure [dbo].[ShortCapitalCloseExamine_Select]    Script Date: 12/07/2016 16:56:30 ******/
DROP PROCEDURE [dbo].[ShortCapitalCloseExamine_Select]
GO
/****** Object:  StoredProcedure [dbo].[ShortCapitalPlace_SelectByUserCardId]    Script Date: 12/07/2016 16:56:30 ******/
DROP PROCEDURE [dbo].[ShortCapitalPlace_SelectByUserCardId]
GO
/****** Object:  StoredProcedure [dbo].[ShortCapitalPlace_SelectCanUpdate]    Script Date: 12/07/2016 16:56:30 ******/
DROP PROCEDURE [dbo].[ShortCapitalPlace_SelectCanUpdate]
GO
/****** Object:  StoredProcedure [dbo].[ShortCapitalPlan_SelectByUserCardId]    Script Date: 12/07/2016 16:56:30 ******/
DROP PROCEDURE [dbo].[ShortCapitalPlan_SelectByUserCardId]
GO
/****** Object:  StoredProcedure [dbo].[ShortCapitalPlanExamine_Select]    Script Date: 12/07/2016 16:56:30 ******/
DROP PROCEDURE [dbo].[ShortCapitalPlanExamine_Select]
GO
/****** Object:  StoredProcedure [dbo].[ShortProjects_SelectCanEnd]    Script Date: 12/07/2016 16:56:30 ******/
DROP PROCEDURE [dbo].[ShortProjects_SelectCanEnd]
GO
/****** Object:  StoredProcedure [dbo].[ShortProjectsEnd_SelectByUserCardId]    Script Date: 12/07/2016 16:56:30 ******/
DROP PROCEDURE [dbo].[ShortProjectsEnd_SelectByUserCardId]
GO
/****** Object:  StoredProcedure [dbo].[ShortProjectsEndExamine_Select]    Script Date: 12/07/2016 16:56:30 ******/
DROP PROCEDURE [dbo].[ShortProjectsEndExamine_Select]
GO
/****** Object:  StoredProcedure [dbo].[ShortProjectsStand_SelectByUserCardId]    Script Date: 12/07/2016 16:56:30 ******/
DROP PROCEDURE [dbo].[ShortProjectsStand_SelectByUserCardId]
GO
/****** Object:  StoredProcedure [dbo].[ShortProjectsStandExamine_Select]    Script Date: 12/07/2016 16:56:30 ******/
DROP PROCEDURE [dbo].[ShortProjectsStandExamine_Select]
GO
/****** Object:  StoredProcedure [dbo].[Teaching_SelectByMyUserCardId]    Script Date: 12/07/2016 16:56:30 ******/
DROP PROCEDURE [dbo].[Teaching_SelectByMyUserCardId]
GO
/****** Object:  StoredProcedure [dbo].[Teaching_SelectByPartnerUser]    Script Date: 12/07/2016 16:56:30 ******/
DROP PROCEDURE [dbo].[Teaching_SelectByPartnerUser]
GO
/****** Object:  StoredProcedure [dbo].[Teaching_SelectByPartnerUserCardId]    Script Date: 12/07/2016 16:56:30 ******/
DROP PROCEDURE [dbo].[Teaching_SelectByPartnerUserCardId]
GO
/****** Object:  StoredProcedure [dbo].[Teaching_SelectByPartnerUserNo]    Script Date: 12/07/2016 16:56:30 ******/
DROP PROCEDURE [dbo].[Teaching_SelectByPartnerUserNo]
GO
/****** Object:  StoredProcedure [dbo].[Teaching_SelectByTeachingUserCardId]    Script Date: 12/07/2016 16:56:30 ******/
DROP PROCEDURE [dbo].[Teaching_SelectByTeachingUserCardId]
GO
/****** Object:  StoredProcedure [dbo].[Teaching_SelectByUserCardId]    Script Date: 12/07/2016 16:56:30 ******/
DROP PROCEDURE [dbo].[Teaching_SelectByUserCardId]
GO
/****** Object:  StoredProcedure [dbo].[TeachingExamine_Select]    Script Date: 12/07/2016 16:56:30 ******/
DROP PROCEDURE [dbo].[TeachingExamine_Select]
GO
/****** Object:  StoredProcedure [dbo].[UseJobPost_SelectByUserCardId]    Script Date: 12/07/2016 16:56:30 ******/
DROP PROCEDURE [dbo].[UseJobPost_SelectByUserCardId]
GO
/****** Object:  StoredProcedure [dbo].[UserInfo_SelectByUserCardId]    Script Date: 12/07/2016 16:56:30 ******/
DROP PROCEDURE [dbo].[UserInfo_SelectByUserCardId]
GO
/****** Object:  StoredProcedure [dbo].[UserInfo_SelectDepartment]    Script Date: 12/07/2016 16:56:30 ******/
DROP PROCEDURE [dbo].[UserInfo_SelectDepartment]
GO
/****** Object:  StoredProcedure [dbo].[Winning_SelectByMyUserCardId]    Script Date: 12/07/2016 16:56:31 ******/
DROP PROCEDURE [dbo].[Winning_SelectByMyUserCardId]
GO
/****** Object:  StoredProcedure [dbo].[Winning_SelectByPartnerUser]    Script Date: 12/07/2016 16:56:31 ******/
DROP PROCEDURE [dbo].[Winning_SelectByPartnerUser]
GO
/****** Object:  StoredProcedure [dbo].[Winning_SelectByPartnerUserCardId]    Script Date: 12/07/2016 16:56:31 ******/
DROP PROCEDURE [dbo].[Winning_SelectByPartnerUserCardId]
GO
/****** Object:  StoredProcedure [dbo].[Winning_SelectByPartnerUserNo]    Script Date: 12/07/2016 16:56:31 ******/
DROP PROCEDURE [dbo].[Winning_SelectByPartnerUserNo]
GO
/****** Object:  StoredProcedure [dbo].[Winning_SelectByUserCardId]    Script Date: 12/07/2016 16:56:31 ******/
DROP PROCEDURE [dbo].[Winning_SelectByUserCardId]
GO
/****** Object:  StoredProcedure [dbo].[Winning_SelectByWinningUserCardId]    Script Date: 12/07/2016 16:56:31 ******/
DROP PROCEDURE [dbo].[Winning_SelectByWinningUserCardId]
GO
/****** Object:  StoredProcedure [dbo].[WinningExamine_Select]    Script Date: 12/07/2016 16:56:31 ******/
DROP PROCEDURE [dbo].[WinningExamine_Select]
GO
/****** Object:  StoredProcedure [dbo].[WorkLoadProjects_SelectByMyUserCardId]    Script Date: 12/07/2016 16:56:31 ******/
DROP PROCEDURE [dbo].[WorkLoadProjects_SelectByMyUserCardId]
GO
/****** Object:  StoredProcedure [dbo].[WorkLoadProjects_SelectByPartnerUser]    Script Date: 12/07/2016 16:56:31 ******/
DROP PROCEDURE [dbo].[WorkLoadProjects_SelectByPartnerUser]
GO
/****** Object:  StoredProcedure [dbo].[WorkLoadProjects_SelectByPartnerUserCardId]    Script Date: 12/07/2016 16:56:31 ******/
DROP PROCEDURE [dbo].[WorkLoadProjects_SelectByPartnerUserCardId]
GO
/****** Object:  StoredProcedure [dbo].[WorkLoadProjects_SelectByPartnerUserNo]    Script Date: 12/07/2016 16:56:31 ******/
DROP PROCEDURE [dbo].[WorkLoadProjects_SelectByPartnerUserNo]
GO
/****** Object:  StoredProcedure [dbo].[WorkLoadProjects_SelectByUserCardId]    Script Date: 12/07/2016 16:56:31 ******/
DROP PROCEDURE [dbo].[WorkLoadProjects_SelectByUserCardId]
GO
/****** Object:  StoredProcedure [dbo].[WorkLoadProjects_SelectByWorkLoadProjectsUserCardId]    Script Date: 12/07/2016 16:56:31 ******/
DROP PROCEDURE [dbo].[WorkLoadProjects_SelectByWorkLoadProjectsUserCardId]
GO
/****** Object:  StoredProcedure [dbo].[WorkLoadProjectsExamine_Select]    Script Date: 12/07/2016 16:56:31 ******/
DROP PROCEDURE [dbo].[WorkLoadProjectsExamine_Select]
GO
/****** Object:  StoredProcedure [dbo].[ProjectsSubject_Delete]    Script Date: 12/07/2016 16:56:29 ******/
DROP PROCEDURE [dbo].[ProjectsSubject_Delete]
GO
/****** Object:  StoredProcedure [dbo].[ProjectsSubject_Insert]    Script Date: 12/07/2016 16:56:29 ******/
DROP PROCEDURE [dbo].[ProjectsSubject_Insert]
GO
/****** Object:  StoredProcedure [dbo].[ProjectsSubject_Update]    Script Date: 12/07/2016 16:56:29 ******/
DROP PROCEDURE [dbo].[ProjectsSubject_Update]
GO
/****** Object:  StoredProcedure [dbo].[LongCapitalCloseProcess_Delete]    Script Date: 12/07/2016 16:56:28 ******/
DROP PROCEDURE [dbo].[LongCapitalCloseProcess_Delete]
GO
/****** Object:  StoredProcedure [dbo].[LongCapitalCloseProcess_Insert]    Script Date: 12/07/2016 16:56:28 ******/
DROP PROCEDURE [dbo].[LongCapitalCloseProcess_Insert]
GO
/****** Object:  StoredProcedure [dbo].[PatentPartner_Delete]    Script Date: 12/07/2016 16:56:29 ******/
DROP PROCEDURE [dbo].[PatentPartner_Delete]
GO
/****** Object:  StoredProcedure [dbo].[PatentPartner_Insert]    Script Date: 12/07/2016 16:56:29 ******/
DROP PROCEDURE [dbo].[PatentPartner_Insert]
GO
/****** Object:  StoredProcedure [dbo].[ProjectsTemplate_Delete]    Script Date: 12/07/2016 16:56:29 ******/
DROP PROCEDURE [dbo].[ProjectsTemplate_Delete]
GO
/****** Object:  StoredProcedure [dbo].[ProjectsTemplate_Insert]    Script Date: 12/07/2016 16:56:30 ******/
DROP PROCEDURE [dbo].[ProjectsTemplate_Insert]
GO
/****** Object:  StoredProcedure [dbo].[ShortCapitalPlan_Delete]    Script Date: 12/07/2016 16:56:30 ******/
DROP PROCEDURE [dbo].[ShortCapitalPlan_Delete]
GO
/****** Object:  StoredProcedure [dbo].[ShortProjects_Delete]    Script Date: 12/07/2016 16:56:30 ******/
DROP PROCEDURE [dbo].[ShortProjects_Delete]
GO
/****** Object:  StoredProcedure [dbo].[Teaching_Delete]    Script Date: 12/07/2016 16:56:30 ******/
DROP PROCEDURE [dbo].[Teaching_Delete]
GO
/****** Object:  StoredProcedure [dbo].[TeachingPartner_Update]    Script Date: 12/07/2016 16:56:30 ******/
DROP PROCEDURE [dbo].[TeachingPartner_Update]
GO
/****** Object:  StoredProcedure [dbo].[UseOffice_Delete]    Script Date: 12/07/2016 16:56:30 ******/
DROP PROCEDURE [dbo].[UseOffice_Delete]
GO
/****** Object:  StoredProcedure [dbo].[UseOffice_Insert]    Script Date: 12/07/2016 16:56:30 ******/
DROP PROCEDURE [dbo].[UseOffice_Insert]
GO
/****** Object:  StoredProcedure [dbo].[UseOffice_SelectByUseOfficeId]    Script Date: 12/07/2016 16:56:30 ******/
DROP PROCEDURE [dbo].[UseOffice_SelectByUseOfficeId]
GO
/****** Object:  StoredProcedure [dbo].[UseOffice_SelectByUserCardId]    Script Date: 12/07/2016 16:56:30 ******/
DROP PROCEDURE [dbo].[UseOffice_SelectByUserCardId]
GO
/****** Object:  StoredProcedure [dbo].[Winning_Delete]    Script Date: 12/07/2016 16:56:31 ******/
DROP PROCEDURE [dbo].[Winning_Delete]
GO
/****** Object:  StoredProcedure [dbo].[WinningPartner_Update]    Script Date: 12/07/2016 16:56:31 ******/
DROP PROCEDURE [dbo].[WinningPartner_Update]
GO
/****** Object:  StoredProcedure [dbo].[WinningProcess_Delete]    Script Date: 12/07/2016 16:56:31 ******/
DROP PROCEDURE [dbo].[WinningProcess_Delete]
GO
/****** Object:  StoredProcedure [dbo].[WinningProcess_Insert]    Script Date: 12/07/2016 16:56:31 ******/
DROP PROCEDURE [dbo].[WinningProcess_Insert]
GO
/****** Object:  StoredProcedure [dbo].[TeachingProcess_Delete]    Script Date: 12/07/2016 16:56:30 ******/
DROP PROCEDURE [dbo].[TeachingProcess_Delete]
GO
/****** Object:  StoredProcedure [dbo].[TeachingProcess_Insert]    Script Date: 12/07/2016 16:56:30 ******/
DROP PROCEDURE [dbo].[TeachingProcess_Insert]
GO
/****** Object:  StoredProcedure [dbo].[TeachingPartner_Delete]    Script Date: 12/07/2016 16:56:30 ******/
DROP PROCEDURE [dbo].[TeachingPartner_Delete]
GO
/****** Object:  StoredProcedure [dbo].[TeachingPartner_Insert]    Script Date: 12/07/2016 16:56:30 ******/
DROP PROCEDURE [dbo].[TeachingPartner_Insert]
GO
/****** Object:  StoredProcedure [dbo].[CapitalItem_Update]    Script Date: 12/07/2016 16:56:27 ******/
DROP PROCEDURE [dbo].[CapitalItem_Update]
GO
/****** Object:  StoredProcedure [dbo].[Guidance_SelectByGuidanceUserCardId]    Script Date: 12/07/2016 16:56:28 ******/
DROP PROCEDURE [dbo].[Guidance_SelectByGuidanceUserCardId]
GO
/****** Object:  StoredProcedure [dbo].[Guidance_SelectByMyUserCardId]    Script Date: 12/07/2016 16:56:28 ******/
DROP PROCEDURE [dbo].[Guidance_SelectByMyUserCardId]
GO
/****** Object:  StoredProcedure [dbo].[Guidance_SelectByPartnerUser]    Script Date: 12/07/2016 16:56:28 ******/
DROP PROCEDURE [dbo].[Guidance_SelectByPartnerUser]
GO
/****** Object:  StoredProcedure [dbo].[Guidance_SelectByPartnerUserCardId]    Script Date: 12/07/2016 16:56:28 ******/
DROP PROCEDURE [dbo].[Guidance_SelectByPartnerUserCardId]
GO
/****** Object:  StoredProcedure [dbo].[Guidance_SelectByPartnerUserNo]    Script Date: 12/07/2016 16:56:28 ******/
DROP PROCEDURE [dbo].[Guidance_SelectByPartnerUserNo]
GO
/****** Object:  StoredProcedure [dbo].[Guidance_SelectByUserCardId]    Script Date: 12/07/2016 16:56:28 ******/
DROP PROCEDURE [dbo].[Guidance_SelectByUserCardId]
GO
/****** Object:  StoredProcedure [dbo].[GuidanceExamine_Select]    Script Date: 12/07/2016 16:56:28 ******/
DROP PROCEDURE [dbo].[GuidanceExamine_Select]
GO
/****** Object:  StoredProcedure [dbo].[Harvest_SelectByHarvestUserCardId]    Script Date: 12/07/2016 16:56:28 ******/
DROP PROCEDURE [dbo].[Harvest_SelectByHarvestUserCardId]
GO
/****** Object:  StoredProcedure [dbo].[Harvest_SelectByMyUserCardId]    Script Date: 12/07/2016 16:56:28 ******/
DROP PROCEDURE [dbo].[Harvest_SelectByMyUserCardId]
GO
/****** Object:  StoredProcedure [dbo].[Harvest_SelectByPartnerUser]    Script Date: 12/07/2016 16:56:28 ******/
DROP PROCEDURE [dbo].[Harvest_SelectByPartnerUser]
GO
/****** Object:  StoredProcedure [dbo].[UserRole_SelectByUserRoleId]    Script Date: 12/07/2016 16:56:31 ******/
DROP PROCEDURE [dbo].[UserRole_SelectByUserRoleId]
GO
/****** Object:  StoredProcedure [dbo].[UserRole_Delete]    Script Date: 12/07/2016 16:56:31 ******/
DROP PROCEDURE [dbo].[UserRole_Delete]
GO
/****** Object:  StoredProcedure [dbo].[WorkLoadProjects_Delete]    Script Date: 12/07/2016 16:56:31 ******/
DROP PROCEDURE [dbo].[WorkLoadProjects_Delete]
GO
/****** Object:  StoredProcedure [dbo].[WinningPartner_Delete]    Script Date: 12/07/2016 16:56:31 ******/
DROP PROCEDURE [dbo].[WinningPartner_Delete]
GO
/****** Object:  StoredProcedure [dbo].[WinningPartner_Insert]    Script Date: 12/07/2016 16:56:31 ******/
DROP PROCEDURE [dbo].[WinningPartner_Insert]
GO
/****** Object:  StoredProcedure [dbo].[WorkLoadProjectsPartner_Delete]    Script Date: 12/07/2016 16:56:31 ******/
DROP PROCEDURE [dbo].[WorkLoadProjectsPartner_Delete]
GO
/****** Object:  StoredProcedure [dbo].[WorkLoadProjectsPartner_Insert]    Script Date: 12/07/2016 16:56:31 ******/
DROP PROCEDURE [dbo].[WorkLoadProjectsPartner_Insert]
GO
/****** Object:  StoredProcedure [dbo].[WorkLoadProjectsPartner_Update]    Script Date: 12/07/2016 16:56:31 ******/
DROP PROCEDURE [dbo].[WorkLoadProjectsPartner_Update]
GO
/****** Object:  StoredProcedure [dbo].[Model_Delete]    Script Date: 12/07/2016 16:56:29 ******/
DROP PROCEDURE [dbo].[Model_Delete]
GO
/****** Object:  StoredProcedure [dbo].[Model_Insert]    Script Date: 12/07/2016 16:56:29 ******/
DROP PROCEDURE [dbo].[Model_Insert]
GO
/****** Object:  StoredProcedure [dbo].[WorkLoadProjectsProcess_Delete]    Script Date: 12/07/2016 16:56:31 ******/
DROP PROCEDURE [dbo].[WorkLoadProjectsProcess_Delete]
GO
/****** Object:  StoredProcedure [dbo].[WorkLoadProjectsProcess_Insert]    Script Date: 12/07/2016 16:56:31 ******/
DROP PROCEDURE [dbo].[WorkLoadProjectsProcess_Insert]
GO
/****** Object:  StoredProcedure [dbo].[Model_Update]    Script Date: 12/07/2016 16:56:29 ******/
DROP PROCEDURE [dbo].[Model_Update]
GO
/****** Object:  StoredProcedure [dbo].[LongCapitalPlan_Delete]    Script Date: 12/07/2016 16:56:28 ******/
DROP PROCEDURE [dbo].[LongCapitalPlan_Delete]
GO
/****** Object:  StoredProcedure [dbo].[Paper_Delete]    Script Date: 12/07/2016 16:56:29 ******/
DROP PROCEDURE [dbo].[Paper_Delete]
GO
/****** Object:  StoredProcedure [dbo].[PatentPartner_Update]    Script Date: 12/07/2016 16:56:29 ******/
DROP PROCEDURE [dbo].[PatentPartner_Update]
GO
/****** Object:  StoredProcedure [dbo].[LongProjectsEndProcess_Delete]    Script Date: 12/07/2016 16:56:29 ******/
DROP PROCEDURE [dbo].[LongProjectsEndProcess_Delete]
GO
/****** Object:  StoredProcedure [dbo].[LongProjectsEndProcess_Insert]    Script Date: 12/07/2016 16:56:29 ******/
DROP PROCEDURE [dbo].[LongProjectsEndProcess_Insert]
GO
/****** Object:  StoredProcedure [dbo].[PatentProcess_Delete]    Script Date: 12/07/2016 16:56:29 ******/
DROP PROCEDURE [dbo].[PatentProcess_Delete]
GO
/****** Object:  StoredProcedure [dbo].[PatentProcess_Insert]    Script Date: 12/07/2016 16:56:29 ******/
DROP PROCEDURE [dbo].[PatentProcess_Insert]
GO
/****** Object:  StoredProcedure [dbo].[Guidance_Delete]    Script Date: 12/07/2016 16:56:28 ******/
DROP PROCEDURE [dbo].[Guidance_Delete]
GO
/****** Object:  StoredProcedure [dbo].[AdminSeries_Update]    Script Date: 12/07/2016 16:56:27 ******/
DROP PROCEDURE [dbo].[AdminSeries_Update]
GO
/****** Object:  StoredProcedure [dbo].[AdminSeries_Delete]    Script Date: 12/07/2016 16:56:27 ******/
DROP PROCEDURE [dbo].[AdminSeries_Delete]
GO
/****** Object:  StoredProcedure [dbo].[AdminSeries_Insert]    Script Date: 12/07/2016 16:56:27 ******/
DROP PROCEDURE [dbo].[AdminSeries_Insert]
GO
/****** Object:  StoredProcedure [dbo].[HarvestPartner_Update]    Script Date: 12/07/2016 16:56:28 ******/
DROP PROCEDURE [dbo].[HarvestPartner_Update]
GO
/****** Object:  StoredProcedure [dbo].[HarvestProcess_Delete]    Script Date: 12/07/2016 16:56:28 ******/
DROP PROCEDURE [dbo].[HarvestProcess_Delete]
GO
/****** Object:  StoredProcedure [dbo].[HarvestProcess_Insert]    Script Date: 12/07/2016 16:56:28 ******/
DROP PROCEDURE [dbo].[HarvestProcess_Insert]
GO
/****** Object:  StoredProcedure [dbo].[AssessRank_Update]    Script Date: 12/07/2016 16:56:27 ******/
DROP PROCEDURE [dbo].[AssessRank_Update]
GO
/****** Object:  StoredProcedure [dbo].[UseOffice_Update]    Script Date: 12/07/2016 16:56:30 ******/
DROP PROCEDURE [dbo].[UseOffice_Update]
GO
/****** Object:  StoredProcedure [dbo].[Authority_SelectByUser]    Script Date: 12/07/2016 16:56:27 ******/
DROP PROCEDURE [dbo].[Authority_SelectByUser]
GO
/****** Object:  StoredProcedure [dbo].[Authority_SelectByUserCardId]    Script Date: 12/07/2016 16:56:27 ******/
DROP PROCEDURE [dbo].[Authority_SelectByUserCardId]
GO
/****** Object:  StoredProcedure [dbo].[AuthorityView_Select]    Script Date: 12/07/2016 16:56:27 ******/
DROP PROCEDURE [dbo].[AuthorityView_Select]
GO
/****** Object:  StoredProcedure [dbo].[GuidanceProcess_Delete]    Script Date: 12/07/2016 16:56:28 ******/
DROP PROCEDURE [dbo].[GuidanceProcess_Delete]
GO
/****** Object:  StoredProcedure [dbo].[GuidanceProcess_Insert]    Script Date: 12/07/2016 16:56:28 ******/
DROP PROCEDURE [dbo].[GuidanceProcess_Insert]
GO
/****** Object:  StoredProcedure [dbo].[AssessRank_Delete]    Script Date: 12/07/2016 16:56:27 ******/
DROP PROCEDURE [dbo].[AssessRank_Delete]
GO
/****** Object:  StoredProcedure [dbo].[AssessRank_Insert]    Script Date: 12/07/2016 16:56:27 ******/
DROP PROCEDURE [dbo].[AssessRank_Insert]
GO
/****** Object:  StoredProcedure [dbo].[LongProjectsStandProcess_Delete]    Script Date: 12/07/2016 16:56:29 ******/
DROP PROCEDURE [dbo].[LongProjectsStandProcess_Delete]
GO
/****** Object:  StoredProcedure [dbo].[LongProjectsStandProcess_Insert]    Script Date: 12/07/2016 16:56:29 ******/
DROP PROCEDURE [dbo].[LongProjectsStandProcess_Insert]
GO
/****** Object:  StoredProcedure [dbo].[ShortCapitalPlanProcess_Delete]    Script Date: 12/07/2016 16:56:30 ******/
DROP PROCEDURE [dbo].[ShortCapitalPlanProcess_Delete]
GO
/****** Object:  StoredProcedure [dbo].[ShortCapitalPlanProcess_Insert]    Script Date: 12/07/2016 16:56:30 ******/
DROP PROCEDURE [dbo].[ShortCapitalPlanProcess_Insert]
GO
/****** Object:  StoredProcedure [dbo].[UserInfo_SelectRoleSum]    Script Date: 12/07/2016 16:56:31 ******/
DROP PROCEDURE [dbo].[UserInfo_SelectRoleSum]
GO
/****** Object:  StoredProcedure [dbo].[UserRank_Insert]    Script Date: 12/07/2016 16:56:31 ******/
DROP PROCEDURE [dbo].[UserRank_Insert]
GO
/****** Object:  StoredProcedure [dbo].[Authority_Delete]    Script Date: 12/07/2016 16:56:27 ******/
DROP PROCEDURE [dbo].[Authority_Delete]
GO
/****** Object:  StoredProcedure [dbo].[CapitalItem_Delete]    Script Date: 12/07/2016 16:56:27 ******/
DROP PROCEDURE [dbo].[CapitalItem_Delete]
GO
/****** Object:  StoredProcedure [dbo].[CapitalItem_Insert]    Script Date: 12/07/2016 16:56:27 ******/
DROP PROCEDURE [dbo].[CapitalItem_Insert]
GO
/****** Object:  StoredProcedure [dbo].[LongCapitalChangeProcess_Delete]    Script Date: 12/07/2016 16:56:28 ******/
DROP PROCEDURE [dbo].[LongCapitalChangeProcess_Delete]
GO
/****** Object:  StoredProcedure [dbo].[LongCapitalChangeProcess_Insert]    Script Date: 12/07/2016 16:56:28 ******/
DROP PROCEDURE [dbo].[LongCapitalChangeProcess_Insert]
GO
/****** Object:  StoredProcedure [dbo].[HarvestPartner_Delete]    Script Date: 12/07/2016 16:56:28 ******/
DROP PROCEDURE [dbo].[HarvestPartner_Delete]
GO
/****** Object:  StoredProcedure [dbo].[HarvestPartner_Insert]    Script Date: 12/07/2016 16:56:28 ******/
DROP PROCEDURE [dbo].[HarvestPartner_Insert]
GO
/****** Object:  StoredProcedure [dbo].[GuidancePartner_Delete]    Script Date: 12/07/2016 16:56:28 ******/
DROP PROCEDURE [dbo].[GuidancePartner_Delete]
GO
/****** Object:  StoredProcedure [dbo].[GuidancePartner_Insert]    Script Date: 12/07/2016 16:56:28 ******/
DROP PROCEDURE [dbo].[GuidancePartner_Insert]
GO
/****** Object:  StoredProcedure [dbo].[Harvest_SelectByPartnerUserCardId]    Script Date: 12/07/2016 16:56:28 ******/
DROP PROCEDURE [dbo].[Harvest_SelectByPartnerUserCardId]
GO
/****** Object:  StoredProcedure [dbo].[Harvest_SelectByPartnerUserNo]    Script Date: 12/07/2016 16:56:28 ******/
DROP PROCEDURE [dbo].[Harvest_SelectByPartnerUserNo]
GO
/****** Object:  StoredProcedure [dbo].[Harvest_SelectByUserCardId]    Script Date: 12/07/2016 16:56:28 ******/
DROP PROCEDURE [dbo].[Harvest_SelectByUserCardId]
GO
/****** Object:  StoredProcedure [dbo].[HarvestExamine_Select]    Script Date: 12/07/2016 16:56:28 ******/
DROP PROCEDURE [dbo].[HarvestExamine_Select]
GO
/****** Object:  StoredProcedure [dbo].[LongCapitalBasic_SelectCanUpdate]    Script Date: 12/07/2016 16:56:28 ******/
DROP PROCEDURE [dbo].[LongCapitalBasic_SelectCanUpdate]
GO
/****** Object:  StoredProcedure [dbo].[LongCapitalChange_SelectByUserCardId]    Script Date: 12/07/2016 16:56:28 ******/
DROP PROCEDURE [dbo].[LongCapitalChange_SelectByUserCardId]
GO
/****** Object:  StoredProcedure [dbo].[LongCapitalChangeExamine_Select]    Script Date: 12/07/2016 16:56:28 ******/
DROP PROCEDURE [dbo].[LongCapitalChangeExamine_Select]
GO
/****** Object:  StoredProcedure [dbo].[LongCapitalClose_SelectByUserCardId]    Script Date: 12/07/2016 16:56:28 ******/
DROP PROCEDURE [dbo].[LongCapitalClose_SelectByUserCardId]
GO
/****** Object:  StoredProcedure [dbo].[LongCapitalCloseExamine_Select]    Script Date: 12/07/2016 16:56:28 ******/
DROP PROCEDURE [dbo].[LongCapitalCloseExamine_Select]
GO
/****** Object:  StoredProcedure [dbo].[LongCapitalPlace_SelectByUserCardId]    Script Date: 12/07/2016 16:56:28 ******/
DROP PROCEDURE [dbo].[LongCapitalPlace_SelectByUserCardId]
GO
/****** Object:  StoredProcedure [dbo].[LongCapitalPlace_SelectCanUpdate]    Script Date: 12/07/2016 16:56:28 ******/
DROP PROCEDURE [dbo].[LongCapitalPlace_SelectCanUpdate]
GO
/****** Object:  StoredProcedure [dbo].[LongCapitalPlan_SelectByUserCardId]    Script Date: 12/07/2016 16:56:28 ******/
DROP PROCEDURE [dbo].[LongCapitalPlan_SelectByUserCardId]
GO
/****** Object:  StoredProcedure [dbo].[LongCapitalPlanExamine_Select]    Script Date: 12/07/2016 16:56:28 ******/
DROP PROCEDURE [dbo].[LongCapitalPlanExamine_Select]
GO
/****** Object:  StoredProcedure [dbo].[LongProjects_SelectCanEnd]    Script Date: 12/07/2016 16:56:28 ******/
DROP PROCEDURE [dbo].[LongProjects_SelectCanEnd]
GO
/****** Object:  StoredProcedure [dbo].[LongProjects_SelectCanInspect]    Script Date: 12/07/2016 16:56:28 ******/
DROP PROCEDURE [dbo].[LongProjects_SelectCanInspect]
GO
/****** Object:  StoredProcedure [dbo].[LongProjects_SelectCanStand]    Script Date: 12/07/2016 16:56:28 ******/
DROP PROCEDURE [dbo].[LongProjects_SelectCanStand]
GO
/****** Object:  StoredProcedure [dbo].[LongProjects_SelectMyCanStand]    Script Date: 12/07/2016 16:56:28 ******/
DROP PROCEDURE [dbo].[LongProjects_SelectMyCanStand]
GO
/****** Object:  StoredProcedure [dbo].[LongProjectsDeclare_SelectByUserCardId]    Script Date: 12/07/2016 16:56:28 ******/
DROP PROCEDURE [dbo].[LongProjectsDeclare_SelectByUserCardId]
GO
/****** Object:  StoredProcedure [dbo].[LongProjectsDeclareExamine_Select]    Script Date: 12/07/2016 16:56:28 ******/
DROP PROCEDURE [dbo].[LongProjectsDeclareExamine_Select]
GO
/****** Object:  StoredProcedure [dbo].[LongProjectsEnd_SelectByUserCardId]    Script Date: 12/07/2016 16:56:29 ******/
DROP PROCEDURE [dbo].[LongProjectsEnd_SelectByUserCardId]
GO
/****** Object:  StoredProcedure [dbo].[LongProjectsEndCanBranch_Select]    Script Date: 12/07/2016 16:56:29 ******/
DROP PROCEDURE [dbo].[LongProjectsEndCanBranch_Select]
GO
/****** Object:  StoredProcedure [dbo].[LongProjectsEndExamine_Select]    Script Date: 12/07/2016 16:56:29 ******/
DROP PROCEDURE [dbo].[LongProjectsEndExamine_Select]
GO
/****** Object:  StoredProcedure [dbo].[LongProjectsInspect_SelectByUserCardId]    Script Date: 12/07/2016 16:56:29 ******/
DROP PROCEDURE [dbo].[LongProjectsInspect_SelectByUserCardId]
GO
/****** Object:  StoredProcedure [dbo].[LongProjectsInspectExamine_Select]    Script Date: 12/07/2016 16:56:29 ******/
DROP PROCEDURE [dbo].[LongProjectsInspectExamine_Select]
GO
/****** Object:  StoredProcedure [dbo].[LongProjectsStand_SelectByUserCardId]    Script Date: 12/07/2016 16:56:29 ******/
DROP PROCEDURE [dbo].[LongProjectsStand_SelectByUserCardId]
GO
/****** Object:  StoredProcedure [dbo].[LongProjectsStandCanBranch_Select]    Script Date: 12/07/2016 16:56:29 ******/
DROP PROCEDURE [dbo].[LongProjectsStandCanBranch_Select]
GO
/****** Object:  StoredProcedure [dbo].[LongProjectsStandExamine_Select]    Script Date: 12/07/2016 16:56:29 ******/
DROP PROCEDURE [dbo].[LongProjectsStandExamine_Select]
GO
/****** Object:  StoredProcedure [dbo].[Paper_SelectByMyUserCardId]    Script Date: 12/07/2016 16:56:29 ******/
DROP PROCEDURE [dbo].[Paper_SelectByMyUserCardId]
GO
/****** Object:  StoredProcedure [dbo].[Paper_SelectByPaperUserCardId]    Script Date: 12/07/2016 16:56:29 ******/
DROP PROCEDURE [dbo].[Paper_SelectByPaperUserCardId]
GO
/****** Object:  StoredProcedure [dbo].[Paper_SelectByPartnerUser]    Script Date: 12/07/2016 16:56:29 ******/
DROP PROCEDURE [dbo].[Paper_SelectByPartnerUser]
GO
/****** Object:  StoredProcedure [dbo].[Paper_SelectByPartnerUserCardId]    Script Date: 12/07/2016 16:56:29 ******/
DROP PROCEDURE [dbo].[Paper_SelectByPartnerUserCardId]
GO
/****** Object:  StoredProcedure [dbo].[Paper_SelectByPartnerUserNo]    Script Date: 12/07/2016 16:56:29 ******/
DROP PROCEDURE [dbo].[Paper_SelectByPartnerUserNo]
GO
/****** Object:  StoredProcedure [dbo].[Paper_SelectByUserCardId]    Script Date: 12/07/2016 16:56:29 ******/
DROP PROCEDURE [dbo].[Paper_SelectByUserCardId]
GO
/****** Object:  StoredProcedure [dbo].[PaperExamine_Select]    Script Date: 12/07/2016 16:56:29 ******/
DROP PROCEDURE [dbo].[PaperExamine_Select]
GO
/****** Object:  StoredProcedure [dbo].[Patent_SelectByMyUserCardId]    Script Date: 12/07/2016 16:56:29 ******/
DROP PROCEDURE [dbo].[Patent_SelectByMyUserCardId]
GO
/****** Object:  StoredProcedure [dbo].[Patent_SelectByPartnerUser]    Script Date: 12/07/2016 16:56:29 ******/
DROP PROCEDURE [dbo].[Patent_SelectByPartnerUser]
GO
/****** Object:  StoredProcedure [dbo].[Patent_SelectByPartnerUserCardId]    Script Date: 12/07/2016 16:56:29 ******/
DROP PROCEDURE [dbo].[Patent_SelectByPartnerUserCardId]
GO
/****** Object:  StoredProcedure [dbo].[Patent_SelectByPartnerUserNo]    Script Date: 12/07/2016 16:56:29 ******/
DROP PROCEDURE [dbo].[Patent_SelectByPartnerUserNo]
GO
/****** Object:  StoredProcedure [dbo].[Patent_SelectByPatentUserCardId]    Script Date: 12/07/2016 16:56:29 ******/
DROP PROCEDURE [dbo].[Patent_SelectByPatentUserCardId]
GO
/****** Object:  StoredProcedure [dbo].[Patent_SelectByUserCardId]    Script Date: 12/07/2016 16:56:29 ******/
DROP PROCEDURE [dbo].[Patent_SelectByUserCardId]
GO
/****** Object:  StoredProcedure [dbo].[PatentExamine_Select]    Script Date: 12/07/2016 16:56:29 ******/
DROP PROCEDURE [dbo].[PatentExamine_Select]
GO
/****** Object:  StoredProcedure [dbo].[ShortCapitalBasic_SelectCanUpdate]    Script Date: 12/07/2016 16:56:30 ******/
DROP PROCEDURE [dbo].[ShortCapitalBasic_SelectCanUpdate]
GO
/****** Object:  StoredProcedure [dbo].[ShortCapitalChange_SelectByUserCardId]    Script Date: 12/07/2016 16:56:30 ******/
DROP PROCEDURE [dbo].[ShortCapitalChange_SelectByUserCardId]
GO
/****** Object:  StoredProcedure [dbo].[ProjectsLevel_Update]    Script Date: 12/07/2016 16:56:29 ******/
DROP PROCEDURE [dbo].[ProjectsLevel_Update]
GO
/****** Object:  StoredProcedure [dbo].[Harvest_Delete]    Script Date: 12/07/2016 16:56:28 ******/
DROP PROCEDURE [dbo].[Harvest_Delete]
GO
/****** Object:  StoredProcedure [dbo].[GuidancePartner_Update]    Script Date: 12/07/2016 16:56:28 ******/
DROP PROCEDURE [dbo].[GuidancePartner_Update]
GO
/****** Object:  StoredProcedure [dbo].[PaperPartner_Delete]    Script Date: 12/07/2016 16:56:29 ******/
DROP PROCEDURE [dbo].[PaperPartner_Delete]
GO
/****** Object:  StoredProcedure [dbo].[PaperPartner_Insert]    Script Date: 12/07/2016 16:56:29 ******/
DROP PROCEDURE [dbo].[PaperPartner_Insert]
GO
/****** Object:  StoredProcedure [dbo].[PaperPartner_Update]    Script Date: 12/07/2016 16:56:29 ******/
DROP PROCEDURE [dbo].[PaperPartner_Update]
GO
/****** Object:  StoredProcedure [dbo].[Rank_Update]    Script Date: 12/07/2016 16:56:30 ******/
DROP PROCEDURE [dbo].[Rank_Update]
GO
/****** Object:  StoredProcedure [dbo].[Patent_Delete]    Script Date: 12/07/2016 16:56:29 ******/
DROP PROCEDURE [dbo].[Patent_Delete]
GO
/****** Object:  StoredProcedure [dbo].[Rank_Delete]    Script Date: 12/07/2016 16:56:30 ******/
DROP PROCEDURE [dbo].[Rank_Delete]
GO
/****** Object:  StoredProcedure [dbo].[Rank_Insert]    Script Date: 12/07/2016 16:56:30 ******/
DROP PROCEDURE [dbo].[Rank_Insert]
GO
/****** Object:  StoredProcedure [dbo].[LongProjectsInspectProcess_Delete]    Script Date: 12/07/2016 16:56:29 ******/
DROP PROCEDURE [dbo].[LongProjectsInspectProcess_Delete]
GO
/****** Object:  StoredProcedure [dbo].[LongProjectsInspectProcess_Insert]    Script Date: 12/07/2016 16:56:29 ******/
DROP PROCEDURE [dbo].[LongProjectsInspectProcess_Insert]
GO
/****** Object:  StoredProcedure [dbo].[PaperProcess_Delete]    Script Date: 12/07/2016 16:56:29 ******/
DROP PROCEDURE [dbo].[PaperProcess_Delete]
GO
/****** Object:  StoredProcedure [dbo].[PaperProcess_Insert]    Script Date: 12/07/2016 16:56:29 ******/
DROP PROCEDURE [dbo].[PaperProcess_Insert]
GO
/****** Object:  StoredProcedure [dbo].[LongCapitalPlanProcess_Delete]    Script Date: 12/07/2016 16:56:28 ******/
DROP PROCEDURE [dbo].[LongCapitalPlanProcess_Delete]
GO
/****** Object:  StoredProcedure [dbo].[LongCapitalPlanProcess_Insert]    Script Date: 12/07/2016 16:56:28 ******/
DROP PROCEDURE [dbo].[LongCapitalPlanProcess_Insert]
GO
/****** Object:  StoredProcedure [dbo].[LongProjects_Delete]    Script Date: 12/07/2016 16:56:28 ******/
DROP PROCEDURE [dbo].[LongProjects_Delete]
GO
/****** Object:  StoredProcedure [dbo].[LongProjectsDeclareProcess_Delete]    Script Date: 12/07/2016 16:56:28 ******/
DROP PROCEDURE [dbo].[LongProjectsDeclareProcess_Delete]
GO
/****** Object:  StoredProcedure [dbo].[LongProjectsDeclareProcess_Insert]    Script Date: 12/07/2016 16:56:28 ******/
DROP PROCEDURE [dbo].[LongProjectsDeclareProcess_Insert]
GO
/****** Object:  StoredProcedure [dbo].[ProjectsFrom_Delete]    Script Date: 12/07/2016 16:56:29 ******/
DROP PROCEDURE [dbo].[ProjectsFrom_Delete]
GO
/****** Object:  StoredProcedure [dbo].[ProjectsFrom_Insert]    Script Date: 12/07/2016 16:56:29 ******/
DROP PROCEDURE [dbo].[ProjectsFrom_Insert]
GO
/****** Object:  StoredProcedure [dbo].[ProjectsLevel_Delete]    Script Date: 12/07/2016 16:56:29 ******/
DROP PROCEDURE [dbo].[ProjectsLevel_Delete]
GO
/****** Object:  StoredProcedure [dbo].[ProjectsLevel_Insert]    Script Date: 12/07/2016 16:56:29 ******/
DROP PROCEDURE [dbo].[ProjectsLevel_Insert]
GO
/****** Object:  StoredProcedure [dbo].[ProjectsFrom_Update]    Script Date: 12/07/2016 16:56:29 ******/
DROP PROCEDURE [dbo].[ProjectsFrom_Update]
GO
/****** Object:  StoredProcedure [dbo].[ProjectsFrom_Select]    Script Date: 12/07/2016 16:56:29 ******/
DROP PROCEDURE [dbo].[ProjectsFrom_Select]
GO
/****** Object:  StoredProcedure [dbo].[ProjectsFrom_SelectByProjectsFromId]    Script Date: 12/07/2016 16:56:29 ******/
DROP PROCEDURE [dbo].[ProjectsFrom_SelectByProjectsFromId]
GO
/****** Object:  StoredProcedure [dbo].[LongProjectsDeclareProcess_Select]    Script Date: 12/07/2016 16:56:28 ******/
DROP PROCEDURE [dbo].[LongProjectsDeclareProcess_Select]
GO
/****** Object:  StoredProcedure [dbo].[LongCapitalChangeExamine_Insert]    Script Date: 12/07/2016 16:56:28 ******/
DROP PROCEDURE [dbo].[LongCapitalChangeExamine_Insert]
GO
/****** Object:  StoredProcedure [dbo].[LongCapitalChange_UpdateStatus]    Script Date: 12/07/2016 16:56:28 ******/
DROP PROCEDURE [dbo].[LongCapitalChange_UpdateStatus]
GO
/****** Object:  StoredProcedure [dbo].[LongProjects_SelectStandUserCardId]    Script Date: 12/07/2016 16:56:28 ******/
DROP PROCEDURE [dbo].[LongProjects_SelectStandUserCardId]
GO
/****** Object:  StoredProcedure [dbo].[LongCapitalChange_SelectByMyUserCardId]    Script Date: 12/07/2016 16:56:28 ******/
DROP PROCEDURE [dbo].[LongCapitalChange_SelectByMyUserCardId]
GO
/****** Object:  StoredProcedure [dbo].[LongCapitalCanPlan_SelectByUserCardId]    Script Date: 12/07/2016 16:56:28 ******/
DROP PROCEDURE [dbo].[LongCapitalCanPlan_SelectByUserCardId]
GO
/****** Object:  StoredProcedure [dbo].[LongCapitalPlanProcess_Select]    Script Date: 12/07/2016 16:56:28 ******/
DROP PROCEDURE [dbo].[LongCapitalPlanProcess_Select]
GO
/****** Object:  StoredProcedure [dbo].[LongCapitalBasic_Insert]    Script Date: 12/07/2016 16:56:28 ******/
DROP PROCEDURE [dbo].[LongCapitalBasic_Insert]
GO
/****** Object:  StoredProcedure [dbo].[LongCapitalBasic_SelectByLongProjectsId]    Script Date: 12/07/2016 16:56:28 ******/
DROP PROCEDURE [dbo].[LongCapitalBasic_SelectByLongProjectsId]
GO
/****** Object:  StoredProcedure [dbo].[LongCapitalBasic_SelectByMyUserCardId]    Script Date: 12/07/2016 16:56:28 ******/
DROP PROCEDURE [dbo].[LongCapitalBasic_SelectByMyUserCardId]
GO
/****** Object:  StoredProcedure [dbo].[PaperProcess_Select]    Script Date: 12/07/2016 16:56:29 ******/
DROP PROCEDURE [dbo].[PaperProcess_Select]
GO
/****** Object:  StoredProcedure [dbo].[LongProjectsInspectProcess_Select]    Script Date: 12/07/2016 16:56:29 ******/
DROP PROCEDURE [dbo].[LongProjectsInspectProcess_Select]
GO
/****** Object:  StoredProcedure [dbo].[Rank_Select]    Script Date: 12/07/2016 16:56:30 ******/
DROP PROCEDURE [dbo].[Rank_Select]
GO
/****** Object:  StoredProcedure [dbo].[Rank_SelectByRankId]    Script Date: 12/07/2016 16:56:30 ******/
DROP PROCEDURE [dbo].[Rank_SelectByRankId]
GO
/****** Object:  StoredProcedure [dbo].[PaperPartner_UpdatePaperId]    Script Date: 12/07/2016 16:56:29 ******/
DROP PROCEDURE [dbo].[PaperPartner_UpdatePaperId]
GO
/****** Object:  StoredProcedure [dbo].[PaperExamine_Insert]    Script Date: 12/07/2016 16:56:29 ******/
DROP PROCEDURE [dbo].[PaperExamine_Insert]
GO
/****** Object:  StoredProcedure [dbo].[Paper_UpdateStatus]    Script Date: 12/07/2016 16:56:29 ******/
DROP PROCEDURE [dbo].[Paper_UpdateStatus]
GO
/****** Object:  StoredProcedure [dbo].[Right_SelectByUserCardId]    Script Date: 12/07/2016 16:56:30 ******/
DROP PROCEDURE [dbo].[Right_SelectByUserCardId]
GO
/****** Object:  StoredProcedure [dbo].[PatentExamine_Insert]    Script Date: 12/07/2016 16:56:29 ******/
DROP PROCEDURE [dbo].[PatentExamine_Insert]
GO
/****** Object:  StoredProcedure [dbo].[Patent_UpdateStatus]    Script Date: 12/07/2016 16:56:29 ******/
DROP PROCEDURE [dbo].[Patent_UpdateStatus]
GO
/****** Object:  StoredProcedure [dbo].[GuidanceExamine_Insert]    Script Date: 12/07/2016 16:56:28 ******/
DROP PROCEDURE [dbo].[GuidanceExamine_Insert]
GO
/****** Object:  StoredProcedure [dbo].[Guidance_UpdateStatus]    Script Date: 12/07/2016 16:56:28 ******/
DROP PROCEDURE [dbo].[Guidance_UpdateStatus]
GO
/****** Object:  StoredProcedure [dbo].[GuidancePartner_UpdateGuidanceId]    Script Date: 12/07/2016 16:56:28 ******/
DROP PROCEDURE [dbo].[GuidancePartner_UpdateGuidanceId]
GO
/****** Object:  StoredProcedure [dbo].[ProjectsLevel_Select]    Script Date: 12/07/2016 16:56:29 ******/
DROP PROCEDURE [dbo].[ProjectsLevel_Select]
GO
/****** Object:  StoredProcedure [dbo].[ProjectsLevel_SelectByProjectsLevelId]    Script Date: 12/07/2016 16:56:29 ******/
DROP PROCEDURE [dbo].[ProjectsLevel_SelectByProjectsLevelId]
GO
/****** Object:  StoredProcedure [dbo].[HarvestExamine_Insert]    Script Date: 12/07/2016 16:56:28 ******/
DROP PROCEDURE [dbo].[HarvestExamine_Insert]
GO
/****** Object:  StoredProcedure [dbo].[Harvest_UpdateStatus]    Script Date: 12/07/2016 16:56:28 ******/
DROP PROCEDURE [dbo].[Harvest_UpdateStatus]
GO
/****** Object:  StoredProcedure [dbo].[LongProjects_SelectEndUserCardId]    Script Date: 12/07/2016 16:56:28 ******/
DROP PROCEDURE [dbo].[LongProjects_SelectEndUserCardId]
GO
/****** Object:  StoredProcedure [dbo].[LongProjects_SelectInspectUserCardId]    Script Date: 12/07/2016 16:56:28 ******/
DROP PROCEDURE [dbo].[LongProjects_SelectInspectUserCardId]
GO
/****** Object:  StoredProcedure [dbo].[LongProjectsDeclareExamine_Insert]    Script Date: 12/07/2016 16:56:28 ******/
DROP PROCEDURE [dbo].[LongProjectsDeclareExamine_Insert]
GO
/****** Object:  StoredProcedure [dbo].[LongProjects_UpdateDeclareStatus]    Script Date: 12/07/2016 16:56:28 ******/
DROP PROCEDURE [dbo].[LongProjects_UpdateDeclareStatus]
GO
/****** Object:  StoredProcedure [dbo].[LongProjectsEndExamine_Insert]    Script Date: 12/07/2016 16:56:29 ******/
DROP PROCEDURE [dbo].[LongProjectsEndExamine_Insert]
GO
/****** Object:  StoredProcedure [dbo].[LongProjects_UpdateEndStatus]    Script Date: 12/07/2016 16:56:28 ******/
DROP PROCEDURE [dbo].[LongProjects_UpdateEndStatus]
GO
/****** Object:  StoredProcedure [dbo].[LongProjectsInspectExamine_Insert]    Script Date: 12/07/2016 16:56:29 ******/
DROP PROCEDURE [dbo].[LongProjectsInspectExamine_Insert]
GO
/****** Object:  StoredProcedure [dbo].[LongProjects_UpdateInspectStatus]    Script Date: 12/07/2016 16:56:28 ******/
DROP PROCEDURE [dbo].[LongProjects_UpdateInspectStatus]
GO
/****** Object:  StoredProcedure [dbo].[LongProjectsStandExamine_Insert]    Script Date: 12/07/2016 16:56:29 ******/
DROP PROCEDURE [dbo].[LongProjectsStandExamine_Insert]
GO
/****** Object:  StoredProcedure [dbo].[LongProjects_UpdateStandStatus]    Script Date: 12/07/2016 16:56:28 ******/
DROP PROCEDURE [dbo].[LongProjects_UpdateStandStatus]
GO
/****** Object:  StoredProcedure [dbo].[UserInfo_SelectRankSum]    Script Date: 12/07/2016 16:56:31 ******/
DROP PROCEDURE [dbo].[UserInfo_SelectRankSum]
GO
/****** Object:  StoredProcedure [dbo].[Degree_Delete]    Script Date: 12/07/2016 16:56:27 ******/
DROP PROCEDURE [dbo].[Degree_Delete]
GO
/****** Object:  StoredProcedure [dbo].[Degree_Insert]    Script Date: 12/07/2016 16:56:27 ******/
DROP PROCEDURE [dbo].[Degree_Insert]
GO
/****** Object:  StoredProcedure [dbo].[Degree_Update]    Script Date: 12/07/2016 16:56:28 ******/
DROP PROCEDURE [dbo].[Degree_Update]
GO
/****** Object:  StoredProcedure [dbo].[Email_Update]    Script Date: 12/07/2016 16:56:28 ******/
DROP PROCEDURE [dbo].[Email_Update]
GO
/****** Object:  StoredProcedure [dbo].[Job_Delete]    Script Date: 12/07/2016 16:56:28 ******/
DROP PROCEDURE [dbo].[Job_Delete]
GO
/****** Object:  StoredProcedure [dbo].[Job_Insert]    Script Date: 12/07/2016 16:56:28 ******/
DROP PROCEDURE [dbo].[Job_Insert]
GO
/****** Object:  StoredProcedure [dbo].[Job_Update]    Script Date: 12/07/2016 16:56:28 ******/
DROP PROCEDURE [dbo].[Job_Update]
GO
/****** Object:  StoredProcedure [dbo].[LongProjects_SelectByMyUserCardId]    Script Date: 12/07/2016 16:56:28 ******/
DROP PROCEDURE [dbo].[LongProjects_SelectByMyUserCardId]
GO
/****** Object:  StoredProcedure [dbo].[LongCapitalChangeProcess_Select]    Script Date: 12/07/2016 16:56:28 ******/
DROP PROCEDURE [dbo].[LongCapitalChangeProcess_Select]
GO
/****** Object:  StoredProcedure [dbo].[LongCapitalClose_SelectByMyUserCardId]    Script Date: 12/07/2016 16:56:28 ******/
DROP PROCEDURE [dbo].[LongCapitalClose_SelectByMyUserCardId]
GO
/****** Object:  StoredProcedure [dbo].[LongCapitalCloseExamine_Insert]    Script Date: 12/07/2016 16:56:28 ******/
DROP PROCEDURE [dbo].[LongCapitalCloseExamine_Insert]
GO
/****** Object:  StoredProcedure [dbo].[LongCapitalClose_UpdateStatus]    Script Date: 12/07/2016 16:56:28 ******/
DROP PROCEDURE [dbo].[LongCapitalClose_UpdateStatus]
GO
/****** Object:  StoredProcedure [dbo].[LongCapitalPlace_Delete]    Script Date: 12/07/2016 16:56:28 ******/
DROP PROCEDURE [dbo].[LongCapitalPlace_Delete]
GO
/****** Object:  StoredProcedure [dbo].[LongCapitalPlace_DeleteByLongProjectsId]    Script Date: 12/07/2016 16:56:28 ******/
DROP PROCEDURE [dbo].[LongCapitalPlace_DeleteByLongProjectsId]
GO
/****** Object:  StoredProcedure [dbo].[LongCapitalPlace_Insert]    Script Date: 12/07/2016 16:56:28 ******/
DROP PROCEDURE [dbo].[LongCapitalPlace_Insert]
GO
/****** Object:  StoredProcedure [dbo].[CapitalItem_Select]    Script Date: 12/07/2016 16:56:27 ******/
DROP PROCEDURE [dbo].[CapitalItem_Select]
GO
/****** Object:  StoredProcedure [dbo].[LongCapitalPlanExamine_Insert]    Script Date: 12/07/2016 16:56:28 ******/
DROP PROCEDURE [dbo].[LongCapitalPlanExamine_Insert]
GO
/****** Object:  StoredProcedure [dbo].[Political_Delete]    Script Date: 12/07/2016 16:56:29 ******/
DROP PROCEDURE [dbo].[Political_Delete]
GO
/****** Object:  StoredProcedure [dbo].[Authority_Insert]    Script Date: 12/07/2016 16:56:27 ******/
DROP PROCEDURE [dbo].[Authority_Insert]
GO
/****** Object:  StoredProcedure [dbo].[Authority_InsertModelFatherId]    Script Date: 12/07/2016 16:56:27 ******/
DROP PROCEDURE [dbo].[Authority_InsertModelFatherId]
GO
/****** Object:  StoredProcedure [dbo].[Authority_Select]    Script Date: 12/07/2016 16:56:27 ******/
DROP PROCEDURE [dbo].[Authority_Select]
GO
/****** Object:  StoredProcedure [dbo].[Authority_SelectByRankId]    Script Date: 12/07/2016 16:56:27 ******/
DROP PROCEDURE [dbo].[Authority_SelectByRankId]
GO
/****** Object:  StoredProcedure [dbo].[Authority_SelectByRoleId]    Script Date: 12/07/2016 16:56:27 ******/
DROP PROCEDURE [dbo].[Authority_SelectByRoleId]
GO
/****** Object:  StoredProcedure [dbo].[UserRank_Delete]    Script Date: 12/07/2016 16:56:31 ******/
DROP PROCEDURE [dbo].[UserRank_Delete]
GO
/****** Object:  StoredProcedure [dbo].[WorkLoadProjectsExamine_Insert]    Script Date: 12/07/2016 16:56:31 ******/
DROP PROCEDURE [dbo].[WorkLoadProjectsExamine_Insert]
GO
/****** Object:  StoredProcedure [dbo].[WorkLoadProjects_UpdateStatus]    Script Date: 12/07/2016 16:56:31 ******/
DROP PROCEDURE [dbo].[WorkLoadProjects_UpdateStatus]
GO
/****** Object:  StoredProcedure [dbo].[ShortCapitalChange_SelectByMyUserCardId]    Script Date: 12/07/2016 16:56:30 ******/
DROP PROCEDURE [dbo].[ShortCapitalChange_SelectByMyUserCardId]
GO
/****** Object:  StoredProcedure [dbo].[UserInfo_UpdatePwd]    Script Date: 12/07/2016 16:56:31 ******/
DROP PROCEDURE [dbo].[UserInfo_UpdatePwd]
GO
/****** Object:  StoredProcedure [dbo].[UserInfo_Login]    Script Date: 12/07/2016 16:56:30 ******/
DROP PROCEDURE [dbo].[UserInfo_Login]
GO
/****** Object:  StoredProcedure [dbo].[UserLogin_Insert]    Script Date: 12/07/2016 16:56:31 ******/
DROP PROCEDURE [dbo].[UserLogin_Insert]
GO
/****** Object:  StoredProcedure [dbo].[ShortCapitalPlanProcess_Select]    Script Date: 12/07/2016 16:56:30 ******/
DROP PROCEDURE [dbo].[ShortCapitalPlanProcess_Select]
GO
/****** Object:  StoredProcedure [dbo].[TeachingExamine_Insert]    Script Date: 12/07/2016 16:56:30 ******/
DROP PROCEDURE [dbo].[TeachingExamine_Insert]
GO
/****** Object:  StoredProcedure [dbo].[Teaching_UpdateStatus]    Script Date: 12/07/2016 16:56:30 ******/
DROP PROCEDURE [dbo].[Teaching_UpdateStatus]
GO
/****** Object:  StoredProcedure [dbo].[LongProjectsStandProcess_Select]    Script Date: 12/07/2016 16:56:29 ******/
DROP PROCEDURE [dbo].[LongProjectsStandProcess_Select]
GO
/****** Object:  StoredProcedure [dbo].[WinningExamine_Insert]    Script Date: 12/07/2016 16:56:31 ******/
DROP PROCEDURE [dbo].[WinningExamine_Insert]
GO
/****** Object:  StoredProcedure [dbo].[Winning_UpdateStatus]    Script Date: 12/07/2016 16:56:31 ******/
DROP PROCEDURE [dbo].[Winning_UpdateStatus]
GO
/****** Object:  StoredProcedure [dbo].[AssessRank_Select]    Script Date: 12/07/2016 16:56:27 ******/
DROP PROCEDURE [dbo].[AssessRank_Select]
GO
/****** Object:  StoredProcedure [dbo].[AssessRank_SelectByAssessRankId]    Script Date: 12/07/2016 16:56:27 ******/
DROP PROCEDURE [dbo].[AssessRank_SelectByAssessRankId]
GO
/****** Object:  StoredProcedure [dbo].[LongProjectsStandBranch_Insert]    Script Date: 12/07/2016 16:56:29 ******/
DROP PROCEDURE [dbo].[LongProjectsStandBranch_Insert]
GO
/****** Object:  StoredProcedure [dbo].[LongProjectsStandBranch_SelectByLongProjectsId]    Script Date: 12/07/2016 16:56:29 ******/
DROP PROCEDURE [dbo].[LongProjectsStandBranch_SelectByLongProjectsId]
GO
/****** Object:  StoredProcedure [dbo].[LongProjectsStandBranch_SelectByUserCardId]    Script Date: 12/07/2016 16:56:29 ******/
DROP PROCEDURE [dbo].[LongProjectsStandBranch_SelectByUserCardId]
GO
/****** Object:  StoredProcedure [dbo].[GuidanceProcess_Select]    Script Date: 12/07/2016 16:56:28 ******/
DROP PROCEDURE [dbo].[GuidanceProcess_Select]
GO
/****** Object:  StoredProcedure [dbo].[AssessValue_SelectByAssessValueId]    Script Date: 12/07/2016 16:56:27 ******/
DROP PROCEDURE [dbo].[AssessValue_SelectByAssessValueId]
GO
/****** Object:  StoredProcedure [dbo].[UserAdminSeries_Delete]    Script Date: 12/07/2016 16:56:30 ******/
DROP PROCEDURE [dbo].[UserAdminSeries_Delete]
GO
/****** Object:  StoredProcedure [dbo].[UserAdminSeries_Insert]    Script Date: 12/07/2016 16:56:30 ******/
DROP PROCEDURE [dbo].[UserAdminSeries_Insert]
GO
/****** Object:  StoredProcedure [dbo].[UserAdminSeries_SelectByUserCardId]    Script Date: 12/07/2016 16:56:30 ******/
DROP PROCEDURE [dbo].[UserAdminSeries_SelectByUserCardId]
GO
/****** Object:  StoredProcedure [dbo].[HarvestProcess_Select]    Script Date: 12/07/2016 16:56:28 ******/
DROP PROCEDURE [dbo].[HarvestProcess_Select]
GO
/****** Object:  StoredProcedure [dbo].[HarvestPartner_UpdateHarvestId]    Script Date: 12/07/2016 16:56:28 ******/
DROP PROCEDURE [dbo].[HarvestPartner_UpdateHarvestId]
GO
/****** Object:  StoredProcedure [dbo].[AdminSeries_Select]    Script Date: 12/07/2016 16:56:27 ******/
DROP PROCEDURE [dbo].[AdminSeries_Select]
GO
/****** Object:  StoredProcedure [dbo].[AdminSeries_SelectByAdminSeriesId]    Script Date: 12/07/2016 16:56:27 ******/
DROP PROCEDURE [dbo].[AdminSeries_SelectByAdminSeriesId]
GO
/****** Object:  StoredProcedure [dbo].[LongCapitalPlace_SelectByLongCapitalPlaceId]    Script Date: 12/07/2016 16:56:28 ******/
DROP PROCEDURE [dbo].[LongCapitalPlace_SelectByLongCapitalPlaceId]
GO
/****** Object:  StoredProcedure [dbo].[LongCapitalPlace_SelectByLongProjectsId]    Script Date: 12/07/2016 16:56:28 ******/
DROP PROCEDURE [dbo].[LongCapitalPlace_SelectByLongProjectsId]
GO
/****** Object:  StoredProcedure [dbo].[LongCapitalPlace_Update]    Script Date: 12/07/2016 16:56:28 ******/
DROP PROCEDURE [dbo].[LongCapitalPlace_Update]
GO
/****** Object:  StoredProcedure [dbo].[LongCapitalPlan_UpdateStatus]    Script Date: 12/07/2016 16:56:28 ******/
DROP PROCEDURE [dbo].[LongCapitalPlan_UpdateStatus]
GO
/****** Object:  StoredProcedure [dbo].[PatentProcess_Select]    Script Date: 12/07/2016 16:56:29 ******/
DROP PROCEDURE [dbo].[PatentProcess_Select]
GO
/****** Object:  StoredProcedure [dbo].[ShortCapitalChangeExamine_Insert]    Script Date: 12/07/2016 16:56:30 ******/
DROP PROCEDURE [dbo].[ShortCapitalChangeExamine_Insert]
GO
/****** Object:  StoredProcedure [dbo].[ShortCapitalChange_UpdateStatus]    Script Date: 12/07/2016 16:56:30 ******/
DROP PROCEDURE [dbo].[ShortCapitalChange_UpdateStatus]
GO
/****** Object:  StoredProcedure [dbo].[ShortCapitalCanPlan_SelectByUserCardId]    Script Date: 12/07/2016 16:56:30 ******/
DROP PROCEDURE [dbo].[ShortCapitalCanPlan_SelectByUserCardId]
GO
/****** Object:  StoredProcedure [dbo].[ShortCapitalPlanExamine_Insert]    Script Date: 12/07/2016 16:56:30 ******/
DROP PROCEDURE [dbo].[ShortCapitalPlanExamine_Insert]
GO
/****** Object:  StoredProcedure [dbo].[ShortCapitalPlan_UpdateStatus]    Script Date: 12/07/2016 16:56:30 ******/
DROP PROCEDURE [dbo].[ShortCapitalPlan_UpdateStatus]
GO
/****** Object:  StoredProcedure [dbo].[ShortCapitalBasic_Insert]    Script Date: 12/07/2016 16:56:30 ******/
DROP PROCEDURE [dbo].[ShortCapitalBasic_Insert]
GO
/****** Object:  StoredProcedure [dbo].[ShortCapitalBasic_SelectByMyUserCardId]    Script Date: 12/07/2016 16:56:30 ******/
DROP PROCEDURE [dbo].[ShortCapitalBasic_SelectByMyUserCardId]
GO
/****** Object:  StoredProcedure [dbo].[ShortCapitalBasic_SelectByShortProjectsId]    Script Date: 12/07/2016 16:56:30 ******/
DROP PROCEDURE [dbo].[ShortCapitalBasic_SelectByShortProjectsId]
GO
/****** Object:  StoredProcedure [dbo].[LongProjectsEndProcess_Select]    Script Date: 12/07/2016 16:56:29 ******/
DROP PROCEDURE [dbo].[LongProjectsEndProcess_Select]
GO
/****** Object:  StoredProcedure [dbo].[PatentPartner_UpdatePatentId]    Script Date: 12/07/2016 16:56:29 ******/
DROP PROCEDURE [dbo].[PatentPartner_UpdatePatentId]
GO
/****** Object:  StoredProcedure [dbo].[LongCapitalPlan_SelectByMyUserCardId]    Script Date: 12/07/2016 16:56:28 ******/
DROP PROCEDURE [dbo].[LongCapitalPlan_SelectByMyUserCardId]
GO
/****** Object:  StoredProcedure [dbo].[LongProjectsEndBranch_Insert]    Script Date: 12/07/2016 16:56:29 ******/
DROP PROCEDURE [dbo].[LongProjectsEndBranch_Insert]
GO
/****** Object:  StoredProcedure [dbo].[LongProjectsEndBranch_SelectByLongProjectsId]    Script Date: 12/07/2016 16:56:29 ******/
DROP PROCEDURE [dbo].[LongProjectsEndBranch_SelectByLongProjectsId]
GO
/****** Object:  StoredProcedure [dbo].[LongProjectsEndBranch_SelectByUserCardId]    Script Date: 12/07/2016 16:56:29 ******/
DROP PROCEDURE [dbo].[LongProjectsEndBranch_SelectByUserCardId]
GO
/****** Object:  StoredProcedure [dbo].[ModelFather_Select]    Script Date: 12/07/2016 16:56:29 ******/
DROP PROCEDURE [dbo].[ModelFather_Select]
GO
/****** Object:  StoredProcedure [dbo].[WorkLoadProjectsProcess_Select]    Script Date: 12/07/2016 16:56:31 ******/
DROP PROCEDURE [dbo].[WorkLoadProjectsProcess_Select]
GO
/****** Object:  StoredProcedure [dbo].[Model_Select]    Script Date: 12/07/2016 16:56:29 ******/
DROP PROCEDURE [dbo].[Model_Select]
GO
/****** Object:  StoredProcedure [dbo].[Model_SelectByModelFatherId]    Script Date: 12/07/2016 16:56:29 ******/
DROP PROCEDURE [dbo].[Model_SelectByModelFatherId]
GO
/****** Object:  StoredProcedure [dbo].[Model_SelectByModelId]    Script Date: 12/07/2016 16:56:29 ******/
DROP PROCEDURE [dbo].[Model_SelectByModelId]
GO
/****** Object:  StoredProcedure [dbo].[Model_SelectModelSum]    Script Date: 12/07/2016 16:56:29 ******/
DROP PROCEDURE [dbo].[Model_SelectModelSum]
GO
/****** Object:  StoredProcedure [dbo].[WorkLoadProjectsPartner_UpdateWorkLoadProjectsId]    Script Date: 12/07/2016 16:56:31 ******/
DROP PROCEDURE [dbo].[WorkLoadProjectsPartner_UpdateWorkLoadProjectsId]
GO
/****** Object:  StoredProcedure [dbo].[TeachingProcess_Select]    Script Date: 12/07/2016 16:56:30 ******/
DROP PROCEDURE [dbo].[TeachingProcess_Select]
GO
/****** Object:  StoredProcedure [dbo].[WinningProcess_Select]    Script Date: 12/07/2016 16:56:31 ******/
DROP PROCEDURE [dbo].[WinningProcess_Select]
GO
/****** Object:  StoredProcedure [dbo].[WinningPartner_UpdateWinningId]    Script Date: 12/07/2016 16:56:31 ******/
DROP PROCEDURE [dbo].[WinningPartner_UpdateWinningId]
GO
/****** Object:  StoredProcedure [dbo].[CapitalItem_SelectByCapitalItemId]    Script Date: 12/07/2016 16:56:27 ******/
DROP PROCEDURE [dbo].[CapitalItem_SelectByCapitalItemId]
GO
/****** Object:  StoredProcedure [dbo].[TeachingPartner_UpdateTeachingId]    Script Date: 12/07/2016 16:56:30 ******/
DROP PROCEDURE [dbo].[TeachingPartner_UpdateTeachingId]
GO
/****** Object:  StoredProcedure [dbo].[ShortCapitalPlan_SelectByMyUserCardId]    Script Date: 12/07/2016 16:56:30 ******/
DROP PROCEDURE [dbo].[ShortCapitalPlan_SelectByMyUserCardId]
GO
/****** Object:  StoredProcedure [dbo].[ShortCapitalClose_SelectByMyUserCardId]    Script Date: 12/07/2016 16:56:30 ******/
DROP PROCEDURE [dbo].[ShortCapitalClose_SelectByMyUserCardId]
GO
/****** Object:  StoredProcedure [dbo].[ShortCapitalPlace_Update]    Script Date: 12/07/2016 16:56:30 ******/
DROP PROCEDURE [dbo].[ShortCapitalPlace_Update]
GO
/****** Object:  StoredProcedure [dbo].[ShortProjects_SelectByMyUserCardId]    Script Date: 12/07/2016 16:56:30 ******/
DROP PROCEDURE [dbo].[ShortProjects_SelectByMyUserCardId]
GO
/****** Object:  StoredProcedure [dbo].[ShortProjects_SelectEndUserCardId]    Script Date: 12/07/2016 16:56:30 ******/
DROP PROCEDURE [dbo].[ShortProjects_SelectEndUserCardId]
GO
/****** Object:  StoredProcedure [dbo].[ShortProjectsEndExamine_Insert]    Script Date: 12/07/2016 16:56:30 ******/
DROP PROCEDURE [dbo].[ShortProjectsEndExamine_Insert]
GO
/****** Object:  StoredProcedure [dbo].[ShortProjects_UpdateEndStatus]    Script Date: 12/07/2016 16:56:30 ******/
DROP PROCEDURE [dbo].[ShortProjects_UpdateEndStatus]
GO
/****** Object:  StoredProcedure [dbo].[ShortProjectsStandExamine_Insert]    Script Date: 12/07/2016 16:56:30 ******/
DROP PROCEDURE [dbo].[ShortProjectsStandExamine_Insert]
GO
/****** Object:  StoredProcedure [dbo].[ShortProjects_UpdateStandStatus]    Script Date: 12/07/2016 16:56:30 ******/
DROP PROCEDURE [dbo].[ShortProjects_UpdateStandStatus]
GO
/****** Object:  StoredProcedure [dbo].[ProjectsTemplate_Select]    Script Date: 12/07/2016 16:56:30 ******/
DROP PROCEDURE [dbo].[ProjectsTemplate_Select]
GO
/****** Object:  StoredProcedure [dbo].[ProjectsTemplate_SelectByCategory]    Script Date: 12/07/2016 16:56:30 ******/
DROP PROCEDURE [dbo].[ProjectsTemplate_SelectByCategory]
GO
/****** Object:  StoredProcedure [dbo].[ProjectsTemplate_SelectByTemplateId]    Script Date: 12/07/2016 16:56:30 ******/
DROP PROCEDURE [dbo].[ProjectsTemplate_SelectByTemplateId]
GO
/****** Object:  StoredProcedure [dbo].[ProjectsTemplate_Update]    Script Date: 12/07/2016 16:56:30 ******/
DROP PROCEDURE [dbo].[ProjectsTemplate_Update]
GO
/****** Object:  StoredProcedure [dbo].[Political_Insert]    Script Date: 12/07/2016 16:56:29 ******/
DROP PROCEDURE [dbo].[Political_Insert]
GO
/****** Object:  StoredProcedure [dbo].[Political_Update]    Script Date: 12/07/2016 16:56:29 ******/
DROP PROCEDURE [dbo].[Political_Update]
GO
/****** Object:  StoredProcedure [dbo].[Post_Delete]    Script Date: 12/07/2016 16:56:29 ******/
DROP PROCEDURE [dbo].[Post_Delete]
GO
/****** Object:  StoredProcedure [dbo].[Post_Insert]    Script Date: 12/07/2016 16:56:29 ******/
DROP PROCEDURE [dbo].[Post_Insert]
GO
/****** Object:  StoredProcedure [dbo].[Post_Update]    Script Date: 12/07/2016 16:56:29 ******/
DROP PROCEDURE [dbo].[Post_Update]
GO
/****** Object:  StoredProcedure [dbo].[ShortCapitalCloseExamine_Insert]    Script Date: 12/07/2016 16:56:30 ******/
DROP PROCEDURE [dbo].[ShortCapitalCloseExamine_Insert]
GO
/****** Object:  StoredProcedure [dbo].[UserInfo_Insert]    Script Date: 12/07/2016 16:56:30 ******/
DROP PROCEDURE [dbo].[UserInfo_Insert]
GO
/****** Object:  StoredProcedure [dbo].[Journal_Insert]    Script Date: 12/07/2016 16:56:28 ******/
DROP PROCEDURE [dbo].[Journal_Insert]
GO
/****** Object:  StoredProcedure [dbo].[LongCapitalCloseProcess_Select]    Script Date: 12/07/2016 16:56:28 ******/
DROP PROCEDURE [dbo].[LongCapitalCloseProcess_Select]
GO
/****** Object:  StoredProcedure [dbo].[ProjectsSubject_Select]    Script Date: 12/07/2016 16:56:29 ******/
DROP PROCEDURE [dbo].[ProjectsSubject_Select]
GO
/****** Object:  StoredProcedure [dbo].[ProjectsSubject_SelectByProjectsSubjectId]    Script Date: 12/07/2016 16:56:29 ******/
DROP PROCEDURE [dbo].[ProjectsSubject_SelectByProjectsSubjectId]
GO
/****** Object:  StoredProcedure [dbo].[ShortCapitalClose_UpdateStatus]    Script Date: 12/07/2016 16:56:30 ******/
DROP PROCEDURE [dbo].[ShortCapitalClose_UpdateStatus]
GO
/****** Object:  StoredProcedure [dbo].[ShortCapitalChangeProcess_Select]    Script Date: 12/07/2016 16:56:30 ******/
DROP PROCEDURE [dbo].[ShortCapitalChangeProcess_Select]
GO
/****** Object:  StoredProcedure [dbo].[ShortProjectsProcess_Select]    Script Date: 12/07/2016 16:56:30 ******/
DROP PROCEDURE [dbo].[ShortProjectsProcess_Select]
GO
/****** Object:  StoredProcedure [dbo].[ShortCapitalCloseProcess_Select]    Script Date: 12/07/2016 16:56:30 ******/
DROP PROCEDURE [dbo].[ShortCapitalCloseProcess_Select]
GO
/****** Object:  StoredProcedure [dbo].[ShortCapitalPlace_Delete]    Script Date: 12/07/2016 16:56:30 ******/
DROP PROCEDURE [dbo].[ShortCapitalPlace_Delete]
GO
/****** Object:  StoredProcedure [dbo].[ShortCapitalPlace_DeleteByShortProjectsId]    Script Date: 12/07/2016 16:56:30 ******/
DROP PROCEDURE [dbo].[ShortCapitalPlace_DeleteByShortProjectsId]
GO
/****** Object:  StoredProcedure [dbo].[ShortCapitalPlace_Insert]    Script Date: 12/07/2016 16:56:30 ******/
DROP PROCEDURE [dbo].[ShortCapitalPlace_Insert]
GO
/****** Object:  StoredProcedure [dbo].[ShortCapitalPlace_SelectByShortCapitalPlaceId]    Script Date: 12/07/2016 16:56:30 ******/
DROP PROCEDURE [dbo].[ShortCapitalPlace_SelectByShortCapitalPlaceId]
GO
/****** Object:  StoredProcedure [dbo].[ShortCapitalPlace_SelectByShortProjectsId]    Script Date: 12/07/2016 16:56:30 ******/
DROP PROCEDURE [dbo].[ShortCapitalPlace_SelectByShortProjectsId]
GO
/****** Object:  StoredProcedure [dbo].[Right_SelectByRankUserCardId]    Script Date: 12/07/2016 16:56:30 ******/
DROP PROCEDURE [dbo].[Right_SelectByRankUserCardId]
GO
/****** Object:  StoredProcedure [dbo].[ShortCapitalClose_SelectByShortProjectsId]    Script Date: 12/07/2016 16:56:30 ******/
DROP PROCEDURE [dbo].[ShortCapitalClose_SelectByShortProjectsId]
GO
/****** Object:  StoredProcedure [dbo].[PatentPartner_AddValue]    Script Date: 12/07/2016 16:56:29 ******/
DROP PROCEDURE [dbo].[PatentPartner_AddValue]
GO
/****** Object:  StoredProcedure [dbo].[PatentPartner_SelectByPatentId]    Script Date: 12/07/2016 16:56:29 ******/
DROP PROCEDURE [dbo].[PatentPartner_SelectByPatentId]
GO
/****** Object:  StoredProcedure [dbo].[PatentPartner_SelectByPatentPartnerId]    Script Date: 12/07/2016 16:56:29 ******/
DROP PROCEDURE [dbo].[PatentPartner_SelectByPatentPartnerId]
GO
/****** Object:  StoredProcedure [dbo].[LongCapitalChange_SelectByLongProjectsId]    Script Date: 12/07/2016 16:56:28 ******/
DROP PROCEDURE [dbo].[LongCapitalChange_SelectByLongProjectsId]
GO
/****** Object:  StoredProcedure [dbo].[LongCapitalClose_SelectByLongProjectsId]    Script Date: 12/07/2016 16:56:28 ******/
DROP PROCEDURE [dbo].[LongCapitalClose_SelectByLongProjectsId]
GO
/****** Object:  StoredProcedure [dbo].[LongCapitalPlan_SelectByLongProjectsId]    Script Date: 12/07/2016 16:56:28 ******/
DROP PROCEDURE [dbo].[LongCapitalPlan_SelectByLongProjectsId]
GO
/****** Object:  StoredProcedure [dbo].[UserRank_SelectByUserCardId]    Script Date: 12/07/2016 16:56:31 ******/
DROP PROCEDURE [dbo].[UserRank_SelectByUserCardId]
GO
/****** Object:  StoredProcedure [dbo].[Patent_Selects]    Script Date: 12/07/2016 16:56:29 ******/
DROP PROCEDURE [dbo].[Patent_Selects]
GO
/****** Object:  StoredProcedure [dbo].[ShortProjectsView_Selects]    Script Date: 12/07/2016 16:56:30 ******/
DROP PROCEDURE [dbo].[ShortProjectsView_Selects]
GO
/****** Object:  StoredProcedure [dbo].[ShortCapitalPlan_SelectByShortProjectsId]    Script Date: 12/07/2016 16:56:30 ******/
DROP PROCEDURE [dbo].[ShortCapitalPlan_SelectByShortProjectsId]
GO
/****** Object:  StoredProcedure [dbo].[Teaching_Select]    Script Date: 12/07/2016 16:56:30 ******/
DROP PROCEDURE [dbo].[Teaching_Select]
GO
/****** Object:  StoredProcedure [dbo].[TeachingPartner_AddValue]    Script Date: 12/07/2016 16:56:30 ******/
DROP PROCEDURE [dbo].[TeachingPartner_AddValue]
GO
/****** Object:  StoredProcedure [dbo].[TeachingPartner_SelectByTeachingId]    Script Date: 12/07/2016 16:56:30 ******/
DROP PROCEDURE [dbo].[TeachingPartner_SelectByTeachingId]
GO
/****** Object:  StoredProcedure [dbo].[TeachingPartner_SelectByTeachingPartnerId]    Script Date: 12/07/2016 16:56:30 ******/
DROP PROCEDURE [dbo].[TeachingPartner_SelectByTeachingPartnerId]
GO
/****** Object:  StoredProcedure [dbo].[Teaching_Selects]    Script Date: 12/07/2016 16:56:30 ******/
DROP PROCEDURE [dbo].[Teaching_Selects]
GO
/****** Object:  StoredProcedure [dbo].[WinningPartner_AddValue]    Script Date: 12/07/2016 16:56:31 ******/
DROP PROCEDURE [dbo].[WinningPartner_AddValue]
GO
/****** Object:  StoredProcedure [dbo].[WinningPartner_SelectByWinningId]    Script Date: 12/07/2016 16:56:31 ******/
DROP PROCEDURE [dbo].[WinningPartner_SelectByWinningId]
GO
/****** Object:  StoredProcedure [dbo].[WinningPartner_SelectByWinningPartnerId]    Script Date: 12/07/2016 16:56:31 ******/
DROP PROCEDURE [dbo].[WinningPartner_SelectByWinningPartnerId]
GO
/****** Object:  StoredProcedure [dbo].[WorkLoadProjectsPartner_AddValue]    Script Date: 12/07/2016 16:56:31 ******/
DROP PROCEDURE [dbo].[WorkLoadProjectsPartner_AddValue]
GO
/****** Object:  StoredProcedure [dbo].[WorkLoadProjectsPartner_SelectByWorkLoadProjectsId]    Script Date: 12/07/2016 16:56:31 ******/
DROP PROCEDURE [dbo].[WorkLoadProjectsPartner_SelectByWorkLoadProjectsId]
GO
/****** Object:  StoredProcedure [dbo].[WorkLoadProjectsPartner_SelectByWorkLoadProjectsPartnerId]    Script Date: 12/07/2016 16:56:31 ******/
DROP PROCEDURE [dbo].[WorkLoadProjectsPartner_SelectByWorkLoadProjectsPartnerId]
GO
/****** Object:  StoredProcedure [dbo].[WorkLoadProjects_Select]    Script Date: 12/07/2016 16:56:31 ******/
DROP PROCEDURE [dbo].[WorkLoadProjects_Select]
GO
/****** Object:  StoredProcedure [dbo].[LongProjectsView_Selects]    Script Date: 12/07/2016 16:56:29 ******/
DROP PROCEDURE [dbo].[LongProjectsView_Selects]
GO
/****** Object:  StoredProcedure [dbo].[Old2014_Selects]    Script Date: 12/07/2016 16:56:29 ******/
DROP PROCEDURE [dbo].[Old2014_Selects]
GO
/****** Object:  StoredProcedure [dbo].[Old2015_Selects]    Script Date: 12/07/2016 16:56:29 ******/
DROP PROCEDURE [dbo].[Old2015_Selects]
GO
/****** Object:  StoredProcedure [dbo].[UserView_Selects]    Script Date: 12/07/2016 16:56:31 ******/
DROP PROCEDURE [dbo].[UserView_Selects]
GO
/****** Object:  StoredProcedure [dbo].[Winning_Select]    Script Date: 12/07/2016 16:56:31 ******/
DROP PROCEDURE [dbo].[Winning_Select]
GO
/****** Object:  StoredProcedure [dbo].[Old20151_Selects]    Script Date: 12/07/2016 16:56:29 ******/
DROP PROCEDURE [dbo].[Old20151_Selects]
GO
/****** Object:  StoredProcedure [dbo].[Old20152_Selects]    Script Date: 12/07/2016 16:56:29 ******/
DROP PROCEDURE [dbo].[Old20152_Selects]
GO
/****** Object:  StoredProcedure [dbo].[Oldlishi_Selects]    Script Date: 12/07/2016 16:56:29 ******/
DROP PROCEDURE [dbo].[Oldlishi_Selects]
GO
/****** Object:  StoredProcedure [dbo].[OldPatent_Selects]    Script Date: 12/07/2016 16:56:29 ******/
DROP PROCEDURE [dbo].[OldPatent_Selects]
GO
/****** Object:  StoredProcedure [dbo].[OldPatentView_Selects]    Script Date: 12/07/2016 16:56:29 ******/
DROP PROCEDURE [dbo].[OldPatentView_Selects]
GO
/****** Object:  StoredProcedure [dbo].[OldProject_Selects]    Script Date: 12/07/2016 16:56:29 ******/
DROP PROCEDURE [dbo].[OldProject_Selects]
GO
/****** Object:  StoredProcedure [dbo].[OldShort_Selects]    Script Date: 12/07/2016 16:56:29 ******/
DROP PROCEDURE [dbo].[OldShort_Selects]
GO
/****** Object:  StoredProcedure [dbo].[OldShort2014_Selects]    Script Date: 12/07/2016 16:56:29 ******/
DROP PROCEDURE [dbo].[OldShort2014_Selects]
GO
/****** Object:  StoredProcedure [dbo].[OldShort2015_Selects]    Script Date: 12/07/2016 16:56:29 ******/
DROP PROCEDURE [dbo].[OldShort2015_Selects]
GO
/****** Object:  StoredProcedure [dbo].[Paper_Select]    Script Date: 12/07/2016 16:56:29 ******/
DROP PROCEDURE [dbo].[Paper_Select]
GO
/****** Object:  StoredProcedure [dbo].[PaperPartner_AddValue]    Script Date: 12/07/2016 16:56:29 ******/
DROP PROCEDURE [dbo].[PaperPartner_AddValue]
GO
/****** Object:  StoredProcedure [dbo].[PaperPartner_SelectByPaperId]    Script Date: 12/07/2016 16:56:29 ******/
DROP PROCEDURE [dbo].[PaperPartner_SelectByPaperId]
GO
/****** Object:  StoredProcedure [dbo].[PaperPartner_SelectByPaperPartnerId]    Script Date: 12/07/2016 16:56:29 ******/
DROP PROCEDURE [dbo].[PaperPartner_SelectByPaperPartnerId]
GO
/****** Object:  StoredProcedure [dbo].[PhoneEmail_Select]    Script Date: 12/07/2016 16:56:29 ******/
DROP PROCEDURE [dbo].[PhoneEmail_Select]
GO
/****** Object:  StoredProcedure [dbo].[ShortCapitalChange_SelectByShortProjectsId]    Script Date: 12/07/2016 16:56:30 ******/
DROP PROCEDURE [dbo].[ShortCapitalChange_SelectByShortProjectsId]
GO
/****** Object:  StoredProcedure [dbo].[ShortCapitalPlan_Selects]    Script Date: 12/07/2016 16:56:30 ******/
DROP PROCEDURE [dbo].[ShortCapitalPlan_Selects]
GO
/****** Object:  StoredProcedure [dbo].[LongCapitalPlan_Selects]    Script Date: 12/07/2016 16:56:28 ******/
DROP PROCEDURE [dbo].[LongCapitalPlan_Selects]
GO
/****** Object:  StoredProcedure [dbo].[ShortCapitalBasic_Selects]    Script Date: 12/07/2016 16:56:30 ******/
DROP PROCEDURE [dbo].[ShortCapitalBasic_Selects]
GO
/****** Object:  StoredProcedure [dbo].[Guidance_Select]    Script Date: 12/07/2016 16:56:28 ******/
DROP PROCEDURE [dbo].[Guidance_Select]
GO
/****** Object:  StoredProcedure [dbo].[GuidancePartner_AddValue]    Script Date: 12/07/2016 16:56:28 ******/
DROP PROCEDURE [dbo].[GuidancePartner_AddValue]
GO
/****** Object:  StoredProcedure [dbo].[GuidancePartner_SelectByGuidanceId]    Script Date: 12/07/2016 16:56:28 ******/
DROP PROCEDURE [dbo].[GuidancePartner_SelectByGuidanceId]
GO
/****** Object:  StoredProcedure [dbo].[GuidancePartner_SelectByGuidancePartnerId]    Script Date: 12/07/2016 16:56:28 ******/
DROP PROCEDURE [dbo].[GuidancePartner_SelectByGuidancePartnerId]
GO
/****** Object:  StoredProcedure [dbo].[AssessValue_SelectDepartmentApply]    Script Date: 12/07/2016 16:56:27 ******/
DROP PROCEDURE [dbo].[AssessValue_SelectDepartmentApply]
GO
/****** Object:  StoredProcedure [dbo].[Harvest_Select]    Script Date: 12/07/2016 16:56:28 ******/
DROP PROCEDURE [dbo].[Harvest_Select]
GO
/****** Object:  StoredProcedure [dbo].[HarvestPartner_AddValue]    Script Date: 12/07/2016 16:56:28 ******/
DROP PROCEDURE [dbo].[HarvestPartner_AddValue]
GO
/****** Object:  StoredProcedure [dbo].[AssessValue_Update]    Script Date: 12/07/2016 16:56:27 ******/
DROP PROCEDURE [dbo].[AssessValue_Update]
GO
/****** Object:  StoredProcedure [dbo].[HarvestPartner_SelectByHarvestId]    Script Date: 12/07/2016 16:56:28 ******/
DROP PROCEDURE [dbo].[HarvestPartner_SelectByHarvestId]
GO
/****** Object:  StoredProcedure [dbo].[HarvestPartner_SelectByHarvestPartnerId]    Script Date: 12/07/2016 16:56:28 ******/
DROP PROCEDURE [dbo].[HarvestPartner_SelectByHarvestPartnerId]
GO
/****** Object:  StoredProcedure [dbo].[UserMailList_Select]    Script Date: 12/07/2016 16:56:31 ******/
DROP PROCEDURE [dbo].[UserMailList_Select]
GO
/****** Object:  StoredProcedure [dbo].[UserOfficeView_Selects]    Script Date: 12/07/2016 16:56:31 ******/
DROP PROCEDURE [dbo].[UserOfficeView_Selects]
GO
/****** Object:  StoredProcedure [dbo].[UserEnable_Update]    Script Date: 12/07/2016 16:56:30 ******/
DROP PROCEDURE [dbo].[UserEnable_Update]
GO
/****** Object:  StoredProcedure [dbo].[UserValue_Update]    Script Date: 12/07/2016 16:56:31 ******/
DROP PROCEDURE [dbo].[UserValue_Update]
GO
/****** Object:  StoredProcedure [dbo].[AssessValue_Insert]    Script Date: 12/07/2016 16:56:27 ******/
DROP PROCEDURE [dbo].[AssessValue_Insert]
GO
/****** Object:  StoredProcedure [dbo].[AssessValue_UpdateByUser]    Script Date: 12/07/2016 16:56:27 ******/
DROP PROCEDURE [dbo].[AssessValue_UpdateByUser]
GO
/****** Object:  StoredProcedure [dbo].[UserJobPostView_Selects]    Script Date: 12/07/2016 16:56:31 ******/
DROP PROCEDURE [dbo].[UserJobPostView_Selects]
GO
/****** Object:  StoredProcedure [dbo].[UserRemunerationView_Selects]    Script Date: 12/07/2016 16:56:31 ******/
DROP PROCEDURE [dbo].[UserRemunerationView_Selects]
GO
/****** Object:  StoredProcedure [dbo].[AssessValueView_Selects]    Script Date: 12/07/2016 16:56:27 ******/
DROP PROCEDURE [dbo].[AssessValueView_Selects]
GO
/****** Object:  StoredProcedure [dbo].[Guidance_Selects]    Script Date: 12/07/2016 16:56:28 ******/
DROP PROCEDURE [dbo].[Guidance_Selects]
GO
/****** Object:  StoredProcedure [dbo].[Harvest_Selects]    Script Date: 12/07/2016 16:56:28 ******/
DROP PROCEDURE [dbo].[Harvest_Selects]
GO
/****** Object:  StoredProcedure [dbo].[WorkLoadProjects_Selects]    Script Date: 12/07/2016 16:56:31 ******/
DROP PROCEDURE [dbo].[WorkLoadProjects_Selects]
GO
/****** Object:  StoredProcedure [dbo].[Winning_Selects]    Script Date: 12/07/2016 16:56:31 ******/
DROP PROCEDURE [dbo].[Winning_Selects]
GO
/****** Object:  StoredProcedure [dbo].[Paper_Selects]    Script Date: 12/07/2016 16:56:29 ******/
DROP PROCEDURE [dbo].[Paper_Selects]
GO
/****** Object:  StoredProcedure [dbo].[Patent_Select]    Script Date: 12/07/2016 16:56:29 ******/
DROP PROCEDURE [dbo].[Patent_Select]
GO
/****** Object:  StoredProcedure [dbo].[ShortCapital_Selects]    Script Date: 12/07/2016 16:56:30 ******/
DROP PROCEDURE [dbo].[ShortCapital_Selects]
GO
/****** Object:  StoredProcedure [dbo].[Journal_Selects]    Script Date: 12/07/2016 16:56:28 ******/
DROP PROCEDURE [dbo].[Journal_Selects]
GO
/****** Object:  StoredProcedure [dbo].[LongCapital_Selects]    Script Date: 12/07/2016 16:56:28 ******/
DROP PROCEDURE [dbo].[LongCapital_Selects]
GO
/****** Object:  StoredProcedure [dbo].[LongCapitalBasic_Selects]    Script Date: 12/07/2016 16:56:28 ******/
DROP PROCEDURE [dbo].[LongCapitalBasic_Selects]
GO
/****** Object:  StoredProcedure [dbo].[UserInfo_Select]    Script Date: 12/07/2016 16:56:30 ******/
DROP PROCEDURE [dbo].[UserInfo_Select]
GO
/****** Object:  StoredProcedure [dbo].[UserInfo_SelectJobSum]    Script Date: 12/07/2016 16:56:31 ******/
DROP PROCEDURE [dbo].[UserInfo_SelectJobSum]
GO
/****** Object:  StoredProcedure [dbo].[UserInfo_SelectNationSum]    Script Date: 12/07/2016 16:56:31 ******/
DROP PROCEDURE [dbo].[UserInfo_SelectNationSum]
GO
/****** Object:  StoredProcedure [dbo].[UserInfo_SelectPoliticalSum]    Script Date: 12/07/2016 16:56:31 ******/
DROP PROCEDURE [dbo].[UserInfo_SelectPoliticalSum]
GO
/****** Object:  StoredProcedure [dbo].[UserInfo_SelectDepartmentSum]    Script Date: 12/07/2016 16:56:31 ******/
DROP PROCEDURE [dbo].[UserInfo_SelectDepartmentSum]
GO
/****** Object:  StoredProcedure [dbo].[UserInfo_SelectStatusSum]    Script Date: 12/07/2016 16:56:31 ******/
DROP PROCEDURE [dbo].[UserInfo_SelectStatusSum]
GO
/****** Object:  StoredProcedure [dbo].[UserInfo_SelectUserSum]    Script Date: 12/07/2016 16:56:31 ******/
DROP PROCEDURE [dbo].[UserInfo_SelectUserSum]
GO
/****** Object:  StoredProcedure [dbo].[UserInfo_Update]    Script Date: 12/07/2016 16:56:31 ******/
DROP PROCEDURE [dbo].[UserInfo_Update]
GO
/****** Object:  StoredProcedure [dbo].[Email_Insert]    Script Date: 12/07/2016 16:56:28 ******/
DROP PROCEDURE [dbo].[Email_Insert]
GO
/****** Object:  StoredProcedure [dbo].[Email_SelectByUserCardId]    Script Date: 12/07/2016 16:56:28 ******/
DROP PROCEDURE [dbo].[Email_SelectByUserCardId]
GO
/****** Object:  StoredProcedure [dbo].[Job_Select]    Script Date: 12/07/2016 16:56:28 ******/
DROP PROCEDURE [dbo].[Job_Select]
GO
/****** Object:  StoredProcedure [dbo].[Job_SelectByJobId]    Script Date: 12/07/2016 16:56:28 ******/
DROP PROCEDURE [dbo].[Job_SelectByJobId]
GO
/****** Object:  StoredProcedure [dbo].[Political_Select]    Script Date: 12/07/2016 16:56:29 ******/
DROP PROCEDURE [dbo].[Political_Select]
GO
/****** Object:  StoredProcedure [dbo].[Political_SelectByPoliticalId]    Script Date: 12/07/2016 16:56:29 ******/
DROP PROCEDURE [dbo].[Political_SelectByPoliticalId]
GO
/****** Object:  StoredProcedure [dbo].[Post_Select]    Script Date: 12/07/2016 16:56:29 ******/
DROP PROCEDURE [dbo].[Post_Select]
GO
/****** Object:  StoredProcedure [dbo].[Post_SelectByPostId]    Script Date: 12/07/2016 16:56:29 ******/
DROP PROCEDURE [dbo].[Post_SelectByPostId]
GO
/****** Object:  StoredProcedure [dbo].[UserView_SelectByUserCardId]    Script Date: 12/07/2016 16:56:31 ******/
DROP PROCEDURE [dbo].[UserView_SelectByUserCardId]
GO
/****** Object:  StoredProcedure [dbo].[Degree_Select]    Script Date: 12/07/2016 16:56:27 ******/
DROP PROCEDURE [dbo].[Degree_Select]
GO
/****** Object:  StoredProcedure [dbo].[Degree_SelectByDegreeId]    Script Date: 12/07/2016 16:56:27 ******/
DROP PROCEDURE [dbo].[Degree_SelectByDegreeId]
GO
/****** Object:  StoredProcedure [dbo].[UseJobPost_Delete]    Script Date: 12/07/2016 16:56:30 ******/
DROP PROCEDURE [dbo].[UseJobPost_Delete]
GO
/****** Object:  StoredProcedure [dbo].[UseJobPost_Insert]    Script Date: 12/07/2016 16:56:30 ******/
DROP PROCEDURE [dbo].[UseJobPost_Insert]
GO
/****** Object:  StoredProcedure [dbo].[UseJobPost_SelectByUseJobPostId]    Script Date: 12/07/2016 16:56:30 ******/
DROP PROCEDURE [dbo].[UseJobPost_SelectByUseJobPostId]
GO
/****** Object:  StoredProcedure [dbo].[UseJobPost_Update]    Script Date: 12/07/2016 16:56:30 ******/
DROP PROCEDURE [dbo].[UseJobPost_Update]
GO
/****** Object:  StoredProcedure [dbo].[UseJobPostView_SelectByUserCardIdCurrent]    Script Date: 12/07/2016 16:56:30 ******/
DROP PROCEDURE [dbo].[UseJobPostView_SelectByUserCardIdCurrent]
GO
/****** Object:  StoredProcedure [dbo].[UseJobPostView_SelectByUserCardIdCurrent]    Script Date: 12/07/2016 16:56:30 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
/******
--: UserJobPost_SelectByUserCardId
--: UseJobPost, 
--: 
UserCardId
--: 
	
--:
	0 - 
	-1 -  
******/
CREATE PROCEDURE [dbo].[UseJobPostView_SelectByUserCardIdCurrent]
@UserCardId varchar(50)
AS
begin

		select distinct  ,,,,
		from   UseJobPostView
		where =@UserCardId
		and =''
		

end
GO
/****** Object:  StoredProcedure [dbo].[UseJobPost_Update]    Script Date: 12/07/2016 16:56:30 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
/*******
--: UseJobPost_Update
--: Department, 
--: 

--: 
	
--:
	0 - 
	-1 -  
*********/
CREATE PROCEDURE [dbo].[UseJobPost_Update]
@UseJobPostId int,
@UserCardId varchar(50),
@DepartmentId varchar(50),
@JobId varchar(50),
@PostId varchar(50),
@JobDate varchar(50),
@EndDate varchar(50),
@JobSeries varchar(50),
@WorkLevel varchar(50),
@IsCurrent varchar(50)
AS
begin
	begin tran

		update UseJobPost 
		set UserCardId=@UserCardId,
		IsCurrent=@IsCurrent,	
		DepartmentId=@DepartmentId,
		JobId=@JobId,
		PostId=@PostId,
		JobDate=@JobDate,
		EndDate=@EndDate,
		JobSeries=@JobSeries,
		WorkLevel=@WorkLevel
		where UseJobPostId=@UseJobPostId

		if(@@ERROR<>0)
			begin
				rollback
				return -1
			end
	commit tran
	return 0
end
GO
/****** Object:  StoredProcedure [dbo].[UseJobPost_SelectByUseJobPostId]    Script Date: 12/07/2016 16:56:30 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
/******
--: UseJobPost_SelectByUseJobPostId
--: UseJobPost, 
--: 
UseJobPostId
--: 
	
--:
	0 - 
	-1 -  
******/
CREATE PROCEDURE [dbo].[UseJobPost_SelectByUseJobPostId]
@UseJobPostId int
AS
begin

		select * from   UseJobPost where UseJobPostId=@UseJobPostId

end
GO
/****** Object:  StoredProcedure [dbo].[UseJobPost_Insert]    Script Date: 12/07/2016 16:56:30 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
/*********************
--: UseJobPost_Insert
--: UseJobPost, 
--: 
   UseJobPostName
--: 
	
--:
	0 - 
	-1 -  
**************/
CREATE PROCEDURE [dbo].[UseJobPost_Insert]
@UserCardId varchar(50),
@DepartmentId varchar(50),
@JobId varchar(50),
@PostId varchar(50),
@JobDate varchar(50),
@EndDate varchar(50),
@JobSeries varchar(50),
@WorkLevel varchar(50),
@IsCurrent varchar(50)
AS
begin
	begin tran
	insert into UseJobPost(
	UserCardId,DepartmentId,JobId,PostId,JobDate,EndDate,JobSeries,WorkLevel,IsCurrent
	)values(
	@UserCardId,@DepartmentId,@JobId,@PostId,@JobDate,@EndDate,@JobSeries,@WorkLevel,@IsCurrent
	)
		if(@@ERROR<>0)
			begin
				rollback
				return -1
			end
	commit tran
	return 0
end
GO
/****** Object:  StoredProcedure [dbo].[UseJobPost_Delete]    Script Date: 12/07/2016 16:56:30 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
/*******
--: UseJobPost_Delete
--: UseJobPost, 
--: 
UsexJobPostId
--: 
	
--:
	0 - 
	-1 -  
*********/
CREATE PROCEDURE [dbo].[UseJobPost_Delete]
@UseJobPostId int
AS
begin
	begin tran
		delete UseJobPost where UseJobPostId=@UseJobPostId
		if(@@ERROR<>0)
			begin
				rollback
				return -1
			end
	commit tran
	return 0
end
GO
/****** Object:  StoredProcedure [dbo].[Degree_SelectByDegreeId]    Script Date: 12/07/2016 16:56:27 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
/******
--: Degree_SelectByDegreeId
--: Degree, 
--: 
DegreeId
--: 
	
--:
	0 - 
	-1 -  
******/
CREATE PROCEDURE [dbo].[Degree_SelectByDegreeId]
@DegreeId int
AS
begin

		select * from   Degree where DegreeId=@DegreeId

end
GO
/****** Object:  StoredProcedure [dbo].[Degree_Select]    Script Date: 12/07/2016 16:56:27 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
/******
--: Degree_Select
--: Degree, 
--: 
--: 
	
--:
	0 - 
	-1 -  
******/
CREATE PROCEDURE [dbo].[Degree_Select]

AS
begin

		select * from Degree

end
GO
/****** Object:  StoredProcedure [dbo].[UserView_SelectByUserCardId]    Script Date: 12/07/2016 16:56:31 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
/******
--:UserView_SelectByUserCardId
--: UserInfo, 
--: 
--UserCardId
--: 
	
--:
	0 - 
	-1 -  
******/
CREATE PROCEDURE [dbo].[UserView_SelectByUserCardId]
	@UserCardId varchar(50)
AS
begin
select  distinct * from UserView 
where =@UserCardId

end
GO
/****** Object:  StoredProcedure [dbo].[Post_SelectByPostId]    Script Date: 12/07/2016 16:56:29 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
/******
--: Post_SelectByPostId
--: Post, 
--: 
PostId
--: 
	
--:
	0 - 
	-1 -  
******/
CREATE PROCEDURE [dbo].[Post_SelectByPostId]
@PostId int
AS
begin

		select * from   Post where PostId=@PostId

end
GO
/****** Object:  StoredProcedure [dbo].[Post_Select]    Script Date: 12/07/2016 16:56:29 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
/******
--: Post_Select
--: Post, 
--: 
--: 
	
--:
	0 - 
	-1 -  
******/
CREATE PROCEDURE [dbo].[Post_Select]

AS
begin

	select * from Post 

end
GO
/****** Object:  StoredProcedure [dbo].[Political_SelectByPoliticalId]    Script Date: 12/07/2016 16:56:29 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
/******
--: Political_SelectByPoliticalId
--: Political, 
--: 
PoliticalId
--: 
	
--:
	0 - 
	-1 -  
******/
CREATE PROCEDURE [dbo].[Political_SelectByPoliticalId]
@PoliticalId int
AS
begin

		select * from   Political where PoliticalId=@PoliticalId

end
GO
/****** Object:  StoredProcedure [dbo].[Political_Select]    Script Date: 12/07/2016 16:56:29 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
/******
--: Political_Select
--: Political, 
--: 
--: 
	
--:
	0 - 
	-1 -  
******/
CREATE PROCEDURE [dbo].[Political_Select]

AS
begin

		select * from Political

end
GO
/****** Object:  StoredProcedure [dbo].[Job_SelectByJobId]    Script Date: 12/07/2016 16:56:28 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
/******
--: Job_SelectByJobId
--: Job, 
--: 
JobId
--: 
	
--:
	0 - 
	-1 -  
******/
CREATE PROCEDURE [dbo].[Job_SelectByJobId]
@JobId int
AS
begin

		select * from   Job where JobId=@JobId

end
GO
/****** Object:  StoredProcedure [dbo].[Job_Select]    Script Date: 12/07/2016 16:56:28 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
/******
--: Job_Select
--: Job, 
--: 
--: 
	
--:
	0 - 
	-1 -  
******/
CREATE PROCEDURE [dbo].[Job_Select]

AS
begin

		select * from   Job

end
GO
/****** Object:  StoredProcedure [dbo].[Email_SelectByUserCardId]    Script Date: 12/07/2016 16:56:28 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
/******
--: Email_SelectByUserCardId
--: Email, 
--: 
EmailId
--: 
	
--:
	0 - 
	-1 -  
******/
CREATE PROCEDURE [dbo].[Email_SelectByUserCardId]
@UserCardId varchar(50)
AS
begin

		select * from   Email where UserCardId=@UserCardId

end
GO
/****** Object:  StoredProcedure [dbo].[Email_Insert]    Script Date: 12/07/2016 16:56:28 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
/*********************
--: Email_Insert
--: Email, 
--: 
 IndividualNumber,HomeNumber,WorkNumber
--: 
	
--:
	0 - 
	-1 -  
**************/
CREATE PROCEDURE [dbo].[Email_Insert]
@UserCardId varchar(50),
@IndividualNumber varchar(50),
@HomeNumber varchar(50)=null,
@WorkNumber varchar(50)=null
AS
begin
	begin tran
		insert into Email (
		UserCardId,IndividuaNumber,HomeNumber,WorkNumber
		) values(
		@UserCardId,@IndividualNumber,@HomeNumber,@WorkNumber
		)
		if(@@ERROR<>0)
			begin
				rollback
				return -1
			end
	commit tran
	return 0
end
GO
/****** Object:  StoredProcedure [dbo].[UserInfo_Update]    Script Date: 12/07/2016 16:56:31 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
/********
-: UserInfo_Update
--: UserInfo, 
--: 
UserCardId ,UserDegreeId ,UserPolitacalId ,UserEducationId ,UserIntroDucation ,Origin ,Address ,Marriage 
--: 
	
--:
	0 - 
	-1 -  

********/
CREATE PROCEDURE [dbo].[UserInfo_Update]
@UserCardId varchar(50),
@UserName varchar(50),
@UserGender varchar(50),
@NationId int,
@PoliticalId int,
@PartyDate varchar(50),
@TakeWorkDate varchar(50),
@ArmyDate varchar(50),
@Marriage varchar(50),
@IdCardNo varchar(50),
@Origin varchar(100),
@AppointmentDate varchar(50),
@TeachersSeries varchar(10),
@Management varchar(10),
@Address varchar(200),
@IntroDucation Text,
@StatusId int,
@SchoolDate varchar(50),
@RetirementDate varchar(50),
@UserDepartmentId int,
@TeachersDepartmentId int,
@Identity varchar(50),
@AdminSeriesId int,
@Reserve1 nvarchar(50),
@Reserve2 nvarchar(50),
@Reserve3 nvarchar(50),
@Reserve4 nvarchar(50),
@Reserve5 nvarchar(50),
@myimage image=null

AS
begin
	begin tran
	declare @Birthday varchar(50)
		if(LEN(@IdCardNo)=18)
		begin
	set @Birthday	= substring(@IdCardNo,7,4)+'-'+substring(@IdCardNo,11,2)+'-'+substring(@IdCardNo,13,2)
	end
		update UserInfo set 
UserName=@UserName,
UserGender=@UserGender,
NationId=@NationId,
PoliticalId=@PoliticalId,
PartyDate=@PartyDate,
TakeWorkDate=@TakeWorkDate,
ArmyDate=@ArmyDate,
Marriage=@Marriage,
IdCardNo=@IdCardNo,
BirthDay=@BirthDay,
Origin=@Origin,
AppointmentDate=@AppointmentDate,
TeachersSeries=@TeachersSeries,
Management=@Management,
Address=@Address,
IntroDucation=@IntroDucation,
StatusId=@StatusId,
SchoolDate=@SchoolDate,
RetirementDate=@RetirementDate,
UserDepartmentId=@UserDepartmentId,
TeachersDepartmentId=@TeachersDepartmentId,
Identitys=@Identity,
AdminSeriesId=@AdminSeriesId,
Reserve1=@Reserve1,
Reserve2=@Reserve2,
Reserve3=@Reserve3,
Reserve4=@Reserve4,
Reserve5=@Reserve5,
myimage=@myimage


		 where UserCardId=@UserCardId
		
		if(@@ERROR<>0)
			begin
				rollback
				return -1
			end
	commit tran
	return 0
end
GO
/****** Object:  StoredProcedure [dbo].[UserInfo_SelectUserSum]    Script Date: 12/07/2016 16:56:31 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
/******
--:UserInfo_SelectUserSum
--: UserInfo, 
--: 
--UserCardId
--: 
	
--:
	0 - 
	-1 -  
******/
CREATE PROCEDURE [dbo].[UserInfo_SelectUserSum]
	@UserCardId varchar(50),
	@UserName varchar(50)
AS
begin
select * from UserInfo
where UserCardId=@UserCardId and UserName=@UserName

end
GO
/****** Object:  StoredProcedure [dbo].[UserInfo_SelectStatusSum]    Script Date: 12/07/2016 16:56:31 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
/******
--  UserInfo_SelectStatusSum
--UserInfo, 
-- 
-- StatusId     
-- 
--    @StatusSum

******/
CREATE PROCEDURE [dbo].[UserInfo_SelectStatusSum]
   @StatusId int,
   @StatusSum    int output
AS
begin
 if exists(select * from userInfo where StatusId=@StatusId)
   begin 
    set @StatusSum=(select count(StatusId) from UserInfo where StatusId=@StatusId)
    end
    else
    begin
      set @StatusSum=0
    end

end
GO
/****** Object:  StoredProcedure [dbo].[UserInfo_SelectDepartmentSum]    Script Date: 12/07/2016 16:56:31 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
/******
--  UserInfo_SelectDepartmentSum
-- 
-- 
-- DepartmentId     
-- 
--    @DepartmentSum

******/
CREATE PROCEDURE [dbo].[UserInfo_SelectDepartmentSum]
   @DepartmentId int,
   @DepartmentSum    int output
AS
begin
 if exists(select * from userInfo where UserDepartmentId=@DepartmentId or TeachersDepartmentId=@DepartmentId)
   begin 
    set @DepartmentSum=(select count(*) from UserInfo where UserDepartmentId=@DepartmentId or TeachersDepartmentId=@DepartmentId)
    end
    else
    begin
      set @DepartmentSum=0
    end

end
GO
/****** Object:  StoredProcedure [dbo].[UserInfo_SelectPoliticalSum]    Script Date: 12/07/2016 16:56:31 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
/******
--  UserInfo_SelectPoliticalSum
--UserInfo, 
-- 
-- PoliticalId     
-- 
--    @UserPoliticalSum

******/
CREATE PROCEDURE [dbo].[UserInfo_SelectPoliticalSum]
   @PoliticalId int,
   @PoliticalSum    int output
AS
begin
 if exists(select * from userInfo where PoliticalId=@PoliticalId)
   begin 
    set @PoliticalSum=(select count(PoliticalId) from UserInfo where PoliticalId=@PoliticalId)
    end
    else
    begin
      set @PoliticalSum=0
    end

end
GO
/****** Object:  StoredProcedure [dbo].[UserInfo_SelectNationSum]    Script Date: 12/07/2016 16:56:31 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
/******
--  UserInfo_SelectNationSum
--UserInfo, 
-- 
-- NationId     
-- 
--    @UserNationSum

******/
CREATE PROCEDURE [dbo].[UserInfo_SelectNationSum]
   @NationId int,
   @NationSum    int output
AS
begin
 if exists(select * from userInfo where NationId=@NationId)
   begin 
    set @NationSum=(select count(NationId) from UserInfo where NationId=@NationId)
    end
    else
    begin
      set @NationSum=0
    end

end
GO
/****** Object:  StoredProcedure [dbo].[UserInfo_SelectJobSum]    Script Date: 12/07/2016 16:56:31 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
/******
--  UserInfo_SelectJobSum
-- 
-- 
-- JobId     
-- 
--    @JobSum
--     0
--     1
--     2
--     3

******/
CREATE PROCEDURE [dbo].[UserInfo_SelectJobSum]
   @JobId int,
   @JobSum    int output
AS
begin
 if exists(select * from UseJobPost where JobId=@JobId)
   begin 
    set @JobSum=(select count(JobId) from UseJobPost where JobId=@JobId)
    end
    else
    begin
      set @JobSum=0
    end

end
GO
/****** Object:  StoredProcedure [dbo].[UserInfo_Select]    Script Date: 12/07/2016 16:56:30 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
/******
--: UserInfo_Select
--: UserInfo, 
--: 
--UserName,UserDepartmentId,UserCardId
--: 
	
--:
	0 - 
	-1 -  
******/
CREATE PROCEDURE [dbo].[UserInfo_Select]
	@UserName varchar(50)=null,
	@UserCardId varchar(50)=null,
	@UserDepartmentId int=null
AS
begin
if(@UserName<>null)
begin
if(@UserCardId<>null)
begin
if(@UserDepartmentId<>null)
begin
select * from UserInfo where UserName like '%'+@UserName+'%' and UserCardId like '%'+@UserCardId+'%' and UserDepartmentId=@UserDepartmentId 
end
else
begin
select * from UserInfo where UserName like '%'+@UserName+'%' and UserCardId like '%'+@UserCardId+'%'
end
end
else
begin
if(@UserDepartmentId<>null)
begin
select * from UserInfo where UserName like '%'+@UserName+'%'  and UserDepartmentId=@UserDepartmentId 
end
else
begin
select * from UserInfo where UserName like '%'+@UserName+'%' 
end
end
end
else
begin
if(@UserCardId<>null)
begin
if(@UserDepartmentId<>null)
begin
select * from UserInfo where  UserCardId like '%'+@UserCardId+'%' and UserDepartmentId=@UserDepartmentId 
end
else
begin
select * from UserInfo where  UserCardId = @UserCardId 
end
end
else
begin
if(@UserDepartmentId<>null)
begin
select * from UserInfo where UserDepartmentId=@UserDepartmentId 
end
begin
select * from UserInfo
end
end
end
  

end
GO
/****** Object:  StoredProcedure [dbo].[LongCapitalBasic_Selects]    Script Date: 12/07/2016 16:56:28 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
/*********************
--: LongCapitalBasic_Selects
--: LongCapitalBasic, 
--: 
UserName,DepartmentId,Year,Month,Status
--: 
	
--:
	0 - 
	-1 -  
**************/
CREATE PROCEDURE [dbo].[LongCapitalBasic_Selects]
@UserName varchar(50),
@DepartmentId varchar(10),
@ProjectsName varchar(50),
@ProjectsId varchar(50)
AS
begin
	declare
	@sql varchar(2000)
	set @sql='select * from LongCapitalBasicView  where 1=1  '
	if(@UserName is not null)
	begin
	if(LEN(@UserName)>0)
	set @sql=@sql+'and  like''%'+@UserName+'%''' 
	end
	if(@DepartmentId <>'()')
	begin
    set @sql=@sql+' and [()] like ''%'+@DepartmentId+'%'''
	end
	
	if(@ProjectsId is not null)
		if(len(@ProjectsId)>0)
	begin
	set @sql=@sql+'and  like''%'+@ProjectsId+'%'''
	end

	if(@ProjectsName is not null)
		if(len(@ProjectsName)>0)
	begin
	set @sql=@sql+'and  like''%'+@ProjectsName+'%'''
	end
	exec(@sql)
end
GO
/****** Object:  StoredProcedure [dbo].[LongCapital_Selects]    Script Date: 12/07/2016 16:56:28 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
/*********************
--: LongCapitalPlan_Selects
--: LongCapitalBasic, 
--: 
UserName,DepartmentId,Year,Month,Status
--: 
	
--:
	0 - 
	-1 -  
**************/
CREATE PROCEDURE [dbo].[LongCapital_Selects]
@ProjectsName varchar(50),
@ProjectsId varchar(50),
@Company varchar(50),
@Money1 varchar(50),
@Money2 varchar(50)

AS
begin
	declare
	@sql varchar(2000)
	set @sql='select * from LongCapitalView  where 1=1  '
	if(@ProjectsName is not null)
	begin
	if(LEN(@ProjectsName)>0)
	set @sql=@sql+'and  like''%'+@ProjectsName+'%''' 
	end
	if(@ProjectsId is not null)
	begin
	if(LEN(@ProjectsId)>0)
	set @sql=@sql+'and  like''%'+@ProjectsId+'%''' 
	end
		if(@Company is not null)
	begin
	if(LEN(@Company)>0)
	set @sql=@sql+'and  like''%'+@Company+'%''' 
	end
		if(@Money1 is not null)
	begin
	if(LEN(@Money1)>0)
	set @sql=@sql+'and  >='+@Money1 
	end
		if(@Money2 is not null)
	begin
	if(LEN(@Money2)>0)
	set @sql=@sql+'and  <='+@Money2 
	end
	exec(@sql)
end
GO
/****** Object:  StoredProcedure [dbo].[Journal_Selects]    Script Date: 12/07/2016 16:56:28 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
/*********************
--: Harvest_Selects
--: Harvest, 
--: 
UserName,DepartmentId,Year,Month,Status
--: 
	
--:
	0 - 
	-1 -  
**************/
CREATE PROCEDURE [dbo].[Journal_Selects]
@UserName varchar(50),
@Year varchar(4),
@Month varchar(2),
@Day varchar(2),
@Position varchar(50),
@Events varchar(50)
AS
begin
	declare
	@sql varchar(2000)
	set @sql='select b.UserName,a.* from Journal a,UserInfo b where a.UserCardId=b.UserCardId '
		if(@UserName is not null)
	begin
	if(LEN(@UserName)>0)
	set @sql=@sql+' and b.UserName like''%'+@UserName+'%''' 
	end

	if(@Year >0)
	begin
	set @sql=@sql+'and datepart(yy, a.FollDate)='+@Year
	end
	if(@Month >0)
	begin
	set @sql=@sql+'and datepart(MM,a.FollDate)='+@Month
	end
	if(@Day >0)
	begin
	set @sql=@sql+' and datepart(dd,a.FollDate)= ' +@Day
	end
	if(@Position is not null)
	begin
	if(LEN(@Position)>0)
	begin
	set @sql=@sql+' and a.Position like''%'+@Position+'%'''
	end
	end
		if(@Events is not null)
	begin
	if(LEN(@Events)>0)
	begin
	set @sql=@sql+' and a.Events like''%'+@Events+'%'''
	end
	end
	
	exec(@sql)
end
GO
/****** Object:  StoredProcedure [dbo].[ShortCapital_Selects]    Script Date: 12/07/2016 16:56:30 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
/*********************
--: LongCapitalPlan_Selects
--: LongCapitalBasic, 
--: 
UserName,DepartmentId,Year,Month,Status
--: 
	
--:
	0 - 
	-1 -  
**************/
CREATE PROCEDURE [dbo].[ShortCapital_Selects]
@ContractName varchar(50),
@ContractId varchar(50),
@Company varchar(50),
@Money1 varchar(50),
@Money2 varchar(50)

AS
begin
	declare
	@sql varchar(2000)
	set @sql='select * from ShortCapitalView  where 1=1  '
	if(@ContractName is not null)
	begin
	if(LEN(@ContractName)>0)
	set @sql=@sql+'and  like''%'+@ContractName+'%''' 
	end
	if(@ContractId is not null)
	begin
	if(LEN(@ContractId)>0)
	set @sql=@sql+'and  like''%'+@ContractId+'%''' 
	end
		if(@Company is not null)
	begin
	if(LEN(@Company)>0)
	set @sql=@sql+'and  like''%'+@Company+'%''' 
	end
		if(@Money1 is not null)
	begin
	if(LEN(@Money1)>0)
	set @sql=@sql+'and  >='+@Money1 
	end
		if(@Money2 is not null)
	begin
	if(LEN(@Money2)>0)
	set @sql=@sql+'and  <='+@Money2 
	end
	exec(@sql)
end
GO
/****** Object:  StoredProcedure [dbo].[Patent_Select]    Script Date: 12/07/2016 16:56:29 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
/*********************
--: Patent_Select
--: Patent, 
--: 
  UserCardId UserNameTransferStatus
--: 
	
--:
	0 - 
	-1 -  
**************/
CREATE PROCEDURE [dbo].[Patent_Select]
	@UserCardId varchar(50),
	@UserName varchar(50),
	@TransferStatus varchar(50)
	AS
BEGIN
select b.UserName ,a.* 
	from Patent a,UserInfo b 
	where a.UserCardId=b.UserCardId and 
	a.UserCardId like '%'+@UserCardId+'%' and 
	b.UserName like '%'+@UserName+'%' and
	a.TransferStatus like '%'+ @TransferStatus+'%'

END
GO
/****** Object:  StoredProcedure [dbo].[Paper_Selects]    Script Date: 12/07/2016 16:56:29 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
/*********************
--: Paper_Selects
--: Paper, 
--: 
UserName,DepartmentId,Year,Month,Status
--: 
	
--:
	0 - 
	-1 -  
**************/
CREATE PROCEDURE [dbo].[Paper_Selects]
@UserName varchar(50),
@DepartmentId varchar(50),
@Year varchar(4),
@Month varchar(2),
@Status varchar(10),
@PaperName varchar(50),
@PaperSubject varchar(50),
@WinningYear varchar(50)
AS
begin
	declare
	@sql varchar(2000)
	set @sql='select * from PaperView where 1=1  '
	if(@UserName is not null)
	begin
	if(LEN(@UserName)>0)
	set @sql=@sql+'and  like''%'+@UserName+'%''' 
	end
	if(@WinningYear is not null)
		if(len(@WinningYear)>0)
	begin
	set @sql=@sql+'and  ='''+@WinningYear+''''
	end
	if(@DepartmentId <>'')
	begin
    set @sql=@sql+' and  like ''%'+@DepartmentId+'%'''
	end
	if(@Year >0)
	begin
	set @sql=@sql+'and datepart(yy,)='+@Year
	end
		if(@Month >0)
	begin
	set @sql=@sql+'and datepart(mm,)='+@Month
	end
	if(@Status is not null)
		if(len(@Status)>0)
	begin
	set @sql=@sql+'and  like''%'+@Status+'%'''
	end
if(@PaperName is not null)
		if(len(@PaperName)>0)
	begin
	set @sql=@sql+'and  like''%'+@PaperName+'%'''
	end
	if(@PaperSubject is not null)
		if(len(@PaperSubject)>0)
	begin
	set @sql=@sql+'and  like''%'+@PaperSubject+'%'''
	end
	exec(@sql)
end
GO
/****** Object:  StoredProcedure [dbo].[Winning_Selects]    Script Date: 12/07/2016 16:56:31 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
/*********************
--: Winning_Selects
--: Winning, 
--: 
UserName,DepartmentId,Year,Month,Status
--: 
	
--:
	0 - 
	-1 -  
**************/
CREATE PROCEDURE [dbo].[Winning_Selects]
@UserName varchar(50),
@DepartmentId varchar(50),
@Year varchar(4),
@Month varchar(2),
@Status varchar(10),
@WinningName varchar(50),
@WinningForm varchar(50),
@WinningYear varchar(50)
AS
begin
	declare
	@sql varchar(2000)
	set @sql='select * from WinningView where 1=1  '
	if(@UserName is not null)
	begin
	if(LEN(@UserName)>0)
	set @sql=@sql+'and  like''%'+@UserName+'%''' 
	end
	if(@DepartmentId <>'')
	begin
    set @sql=@sql+' and  like ''%'+@DepartmentId+'%'''
	end
	if(@Year >0)
	begin
	set @sql=@sql+'and datepart(yy,)='+@Year
	end
		if(@Month >0)
	begin
	set @sql=@sql+'and datepart(mm,)='+@Month
	end
	if(@Status is not null)
		if(len(@Status)>0)
	begin
	set @sql=@sql+'and  like''%'+@Status+'%'''
	end

	if(@WinningName is not null)
		if(len(@WinningName)>0)
	begin
	set @sql=@sql+'and  like''%'+@WinningName+'%'''
	end

	if(@WinningYear is not null)
		if(len(@WinningYear)>0)
	begin
	set @sql=@sql+'and  ='''+@WinningYear+''''
	end

	if(@WinningForm is not null)
		if(len(@WinningForm)>0)
	begin
	set @sql=@sql+'and  like''%'+@WinningForm+'%'''
	end
	exec(@sql)
end
GO
/****** Object:  StoredProcedure [dbo].[WorkLoadProjects_Selects]    Script Date: 12/07/2016 16:56:31 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
/*********************
--: WorkLoadProjects_Selects
--: WorkLoadProjects, 
--: 
UserName,DepartmentId,Year,Month,Status
--: 
	
--:
	0 - 
	-1 -  
**************/
CREATE PROCEDURE [dbo].[WorkLoadProjects_Selects]
@UserName varchar(50),
@DepartmentId varchar(50),
@Year varchar(4),
@Month varchar(2),
@Status varchar(10),
@ProjectsName varchar(50),
@ProjectsForm varchar(50),
@WinningYear varchar(50)
AS
begin
	declare
	@sql varchar(2000)
	set @sql='select * from WorkLoadProjectsView where 1=1  '
	if(@UserName is not null)
	begin
	if(LEN(@UserName)>0)
	set @sql=@sql+'and  like''%'+@UserName+'%''' 
	end
	if(@DepartmentId<>'')
	begin
    set @sql=@sql+' and  like ''%'+@DepartmentId+'%'''
	end

	if(@Year >0)
	begin
	set @sql=@sql+'and datepart(yy,)='+@Year
	end
		if(@Month >0)
	begin
	set @sql=@sql+'and datepart(mm,)='+@Month
	end
	if(@Status is not null)
		if(len(@Status)>0)
	begin
	set @sql=@sql+'and  like''%'+@Status+'%'''
	end
	if(@ProjectsName is not null)
		if(len(@ProjectsName)>0)
	begin
	set @sql=@sql+'and  like''%'+@ProjectsName+'%'''
	end
	if(@WinningYear is not null)
		if(len(@WinningYear)>0)
	begin
	set @sql=@sql+'and  ='''+@WinningYear+''''
	end
	if(@ProjectsForm is not null)
		if(len(@ProjectsForm)>0)
	begin
	set @sql=@sql+'and  like''%'+@ProjectsForm+'%'''
	end
	exec(@sql)
end
GO
/****** Object:  StoredProcedure [dbo].[Harvest_Selects]    Script Date: 12/07/2016 16:56:28 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
/*********************
--: Harvest_Selects
--: Harvest, 
--: 
UserName,DepartmentId,Year,Month,Status
--: 
	
--:
	0 - 
	-1 -  
**************/
CREATE PROCEDURE [dbo].[Harvest_Selects]
@UserName varchar(50),
@DepartmentId varchar(50),
@Year varchar(4),
@Month varchar(2),
@Status varchar(10),
@HarvestName varchar(50),
@AppraisalCompany varchar(50),
@WinningYear varchar(50)
AS
begin
	declare
	@sql varchar(2000)
	set @sql='select * from HarvestView where 1=1 '
	if(@UserName is not null)
	begin
	if(LEN(@UserName)>0)
	set @sql=@sql+'and  like''%'+@UserName+'%''' 
	end
	if(@WinningYear is not null)
		if(len(@WinningYear)>0)
	begin
	set @sql=@sql+'and  ='''+@WinningYear+''''
	end
	if(@DepartmentId <>'')
	begin
    set @sql=@sql+' and  like ''%'+@DepartmentId+'%'''
	end
	if(@Year >0)
	begin
	set @sql=@sql+'and datepart(yy,)='+@Year
	end
		if(@Month >0)
	begin
	set @sql=@sql+'and datepart(mm,)='+@Month
	end
	if(@Status is not null)
		if(len(@Status)>0)
	begin
	set @sql=@sql+'and  like''%'+@Status+'%'''
	end

	if(@HarvestName is not null)
		if(len(@HarvestName)>0)
	begin
	set @sql=@sql+'and  like''%'+@HarvestName+'%'''
	end
	if(@AppraisalCompany is not null)
		if(len(@AppraisalCompany)>0)
	begin
	set @sql=@sql+'and  like''%'+@AppraisalCompany+'%'''
	end
	exec(@sql)
end
GO
/****** Object:  StoredProcedure [dbo].[Guidance_Selects]    Script Date: 12/07/2016 16:56:28 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
/*********************
--: Guidance_Selects
--: Guidance, 
--: 
UserName,DepartmentId,Year,Month,Status
--: 
	
--:
	0 - 
	-1 -  
**************/
CREATE PROCEDURE [dbo].[Guidance_Selects]
@UserName varchar(50),
@DepartmentId varchar(10),
@Year varchar(4),
@Month varchar(2),
@Status varchar(10),
@GuidanceName varchar(50),
@GuidanceLevel varchar(50),
@WinningYear varchar(50)
AS
begin
	declare
	@sql varchar(2000)
	set @sql='select * from GuidanceView  where 1=1  '
	if(@UserName is not null)
	begin
	if(LEN(@UserName)>0)
	set @sql=@sql+'and  like''%'+@UserName+'%''' 
	end
	if(@DepartmentId <>'')
	begin
    set @sql=@sql+' and  like ''%'+@DepartmentId+'%'''
	end
	if(@WinningYear is not null)
		if(len(@WinningYear)>0)
	begin
	set @sql=@sql+'and  ='''+@WinningYear+''''
	end
	if(@Year >0)
	begin
	set @sql=@sql+'and datepart(yy,)='+@Year
	end
		if(@Month >0)
	begin
	set @sql=@sql+'and datepart(mm,)='+@Month
	end
	if(@Status is not null)
		if(len(@Status)>0)
	begin
	set @sql=@sql+'and  like''%'+@Status+'%'''
	end

	if(@GuidanceName is not null)
		if(len(@GuidanceName)>0)
	begin
	set @sql=@sql+'and  like''%'+@GuidanceName+'%'''
	end
	if(@GuidanceLevel is not null)
		if(len(@GuidanceLevel)>0)
	begin
	set @sql=@sql+'and  like''%'+@GuidanceLevel+'%'''
	end
	exec(@sql)
end
GO
/****** Object:  StoredProcedure [dbo].[AssessValueView_Selects]    Script Date: 12/07/2016 16:56:27 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
/*********************
--: Guidance_Selects
--: Guidance, 
--: 
UserName,DepartmentId,Year,Month,Status
--: 
	
--:
	0 - 
	-1 -  
**************/
CREATE PROCEDURE [dbo].[AssessValueView_Selects]
@UserName varchar(50),
@DepartmentId varchar(10),
@AssessYear varchar(50)
AS
begin
	declare
	@sql varchar(2000)
	set @sql='select * from AssessValueView  where 1=1  '
	if(@UserName is not null)
	begin
	if(LEN(@UserName)>0)
	set @sql=@sql+'and  like''%'+@UserName+'%''' 
	end
	if(@DepartmentId <>'')
	begin
    set @sql=@sql+' and  like ''%'+@DepartmentId+'%'''
	end
	if(@AssessYear <>'')
	begin
    set @sql=@sql+' and  like ''%'+@AssessYear+'%'''
	end
	exec(@sql)
end
GO
/****** Object:  StoredProcedure [dbo].[UserRemunerationView_Selects]    Script Date: 12/07/2016 16:56:31 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
/******
--: UserRemunerationView_Selects
--: UserInfo, 
--: 
--UserCardId
--: 
	
--:
	0 - 
	-1 -  
******/
CREATE PROCEDURE [dbo].[UserRemunerationView_Selects]
@SelectText varchar(5000),
@WhereText varchar(5000)
AS
begin
declare 
@sql varchar(8000)
set @sql='select distinct '+@SelectText+' from UseRemunerationView '
if(@WhereText is not null)
begin
if(len(@WhereText)>0)
begin
set @sql=@sql +' where '+@WhereText
end
end

	exec(@sql)



end
GO
/****** Object:  StoredProcedure [dbo].[UserJobPostView_Selects]    Script Date: 12/07/2016 16:56:31 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
/******
--: UserJobPostView_Selects
--: UserInfo, 
--: 
--UserCardId
--: 
	
--:
	0 - 
	-1 -  
******/
CREATE PROCEDURE [dbo].[UserJobPostView_Selects]
@SelectText varchar(5000),
@WhereText varchar(5000)
AS
begin
declare 
@sql varchar(8000)
set @sql='select distinct '+@SelectText+' from UseJobPostView '
if(@WhereText is not null)
begin
if(len(@WhereText)>0)
begin
set @sql=@sql +' where '+@WhereText
end
end

	exec(@sql)



end
GO
/****** Object:  StoredProcedure [dbo].[AssessValue_UpdateByUser]    Script Date: 12/07/2016 16:56:27 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
/*******
--: Job_Update
--: Job, 
--: 
JobId,JobNameJobValue
--: 
	
--:
	0 - 
	-1 -  
*********/
CREATE PROCEDURE [dbo].[AssessValue_UpdateByUser]
@UserCardId varchar(50)
AS
begin
	begin tran
	
	update AssessValue 
set ShouldValue=UserValue
from UserInfo ,ApplyYear,AssessValue
where 
 UserInfo.UserCardId=AssessValue.UserCardId and ApplyYear.IsApply=1
and ApplyYear.ApplyYearId=AssessValue.ApplyYearId and UserInfo.UserCardId=@UserCardId
		if(@@ERROR<>0)
			begin
				rollback
				return -1
			end
	commit tran
	return 0
end
GO
/****** Object:  StoredProcedure [dbo].[AssessValue_Insert]    Script Date: 12/07/2016 16:56:27 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
/*********************
--: AssessValue_Insert
--: AssessValue, 
--: 
   AssessValueName
--: 
	
--:
	0 - 
	-1 -  
**************/
CREATE PROCEDURE [dbo].[AssessValue_Insert]
@UserCardId varchar(50)
AS
begin
	begin tran
	declare
	@ApplyYearId int,
	@ShouldValue float
	set @ApplyYearId=(select ApplyYearId From ApplyYear where IsApply=1)
	set @ShouldValue=(select UserValue from UserInfo where UserCardId=@UserCardId)
	if not exists ( select * from AssessValue where UserCardId=@UserCardId and ApplyYearId=@ApplyYearId)
	begin
	insert into AssessValue(
    UserCardId,ApplyYearId,ShouldValue,NowValue,AssessResult
	)values(
 @UserCardId,@ApplyYearId,@ShouldValue,0,''
	)
	end
	else begin
	update  AssessValue
	set ShouldValue=@ShouldValue
	where UserCardId=@UserCardId and ApplyYearId=@ApplyYearId
	exec AssessValue_Update @UserCardId,@ApplyYearId,0
	end
	
		if(@@ERROR<>0)
			begin
				rollback
				return -1
			end
	commit tran
	return 0
end
GO
/****** Object:  StoredProcedure [dbo].[UserValue_Update]    Script Date: 12/07/2016 16:56:31 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
/*******
--: Rank_Update
--: Department, 
--: 
RankId,RankName
--: 
	
--:
	0 - 
	-1 -  
*********/
CREATE PROCEDURE [dbo].[UserValue_Update]
@UserCardId varchar(50),
@UserValue float
AS
begin
	begin tran
	 if exists (select * from UserInfo2 where UserCardId=@UserCardId)
	 begin
	 	update UserInfo 
	set UserValue=@UserValue
	where UserCardId=@UserCardId
	 end
	 else 
	 begin
	insert into UserInfo2
	(UserCardId,UserValue) values(@UserCardId,@UserValue)
	 end
	 exec AssessValue_Insert @UserCardId
	exec AssessValue_UpdateByUser @UserCardId
		if(@@ERROR<>0)
			begin
				rollback
				return -1
			end
	commit tran
	return 0
end
GO
/****** Object:  StoredProcedure [dbo].[UserEnable_Update]    Script Date: 12/07/2016 16:56:30 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
/*******
--: Rank_Update
--: Department, 
--: 
RankId,RankName
--: 
	
--:
	0 - 
	-1 -  
*********/
CREATE PROCEDURE [dbo].[UserEnable_Update]
@UserCardId varchar(50),
@UserEnable varchar(50)
AS
begin
	begin tran
	 if exists(select * from UserInfo2 where UserCardId=@UserCardId)
	 begin
	 update UserInfo 
	set UserEnable=@UserEnable
	where UserCardId=@UserCardId
	 end
	else
	begin
	insert into UserInfo2
	(UserCardId,UserEnable) values(@UserCardId,@UserEnable)
	end
		if(@@ERROR<>0)
			begin
				rollback
				return -1
			end
	commit tran
	return 0
end
GO
/****** Object:  StoredProcedure [dbo].[UserOfficeView_Selects]    Script Date: 12/07/2016 16:56:31 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
/******
--: UserOfficeView_Select
--: UserInfo, 
--: 
--UserCardId
--: 
	
--:
	0 - 
	-1 -  
******/
CREATE PROCEDURE [dbo].[UserOfficeView_Selects]
@SelectText varchar(5000),
@WhereText varchar(5000)
AS
begin
declare 
@sql varchar(8000)
set @sql='select distinct '+@SelectText+' from UseOfficeView '
if(@WhereText is not null)
begin
if(len(@WhereText)>0)
begin
set @sql=@sql +' where '+@WhereText
end
end

	exec(@sql)



end
GO
/****** Object:  StoredProcedure [dbo].[UserMailList_Select]    Script Date: 12/07/2016 16:56:31 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
/******
--: UserMailList_Select
--: UserView, 
--: 
--UserName,UserDepartmentId,UserCardId
--: 
	
--:
	0 - 
	-1 -  
******/
CREATE PROCEDURE [dbo].[UserMailList_Select]
	@UserName varchar(50),
	@DepartmentId varchar(50),
	@StatusId varchar(50),
	@StartYear varchar(50),
	@EndYear varchar(50),
	@Gender varchar(4),
	@PoliticalId varchar(50)
	
AS
begin
declare 
@sql varchar(1500)
set @sql='select distinct ,,,,,,,,,, from UserView where 1=1 '
if (@UserName is not null)
begin
if(LEN(@UserName)>0)
set @sql=@Sql+'and  like ''%'+@UserName+'%'''
end
if (@DepartmentId  is not null)
begin
if(LEN(@DepartmentId )>0)
 set @sql=@sql+' and  ='''+@DepartmentId+''''
end
 if (@StatusId is not null)
begin
if(LEN(@StatusId )>0)
  set @sql=@sql+' and  ='''+@StatusId +''''
end
    
     
       if (@StartYear is not null)
    begin
        if (LEN(@StartYear)>0)
        begin
            set @sql=@sql+' and  >= '+@StartYear
    end
    end
       if (@EndYear is not null)
    begin
        if (LEN(@EndYear)>0) begin
            set @sql=@sql+' and  <='+@EndYear
      end
    end
       if (@Gender is not null)
    begin
        if (LEN(@Gender)>0)
            set @sql=@sql+' and  = '''+@Gender+''''
    end

	 if (@PoliticalId is not null)
    begin
        if (LEN(@PoliticalId)>0)
             set @sql=@sql+' and  ='''+@PoliticalId +''''
    end

  
exec(@sql)
    RETURN
end
GO
/****** Object:  StoredProcedure [dbo].[HarvestPartner_SelectByHarvestPartnerId]    Script Date: 12/07/2016 16:56:28 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
/*********************
--: HarvestPartner_SelectByHarvestId
--: Harvest, 
--: 
--: 
	
--:
	0 - 
	-1 -  
**************/
CREATE PROCEDURE [dbo].[HarvestPartner_SelectByHarvestPartnerId]
	@HarvestPartnerId int
	AS
BEGIN
select c.UserName,b.*
from Harvest a,HarvestPartner b,UserInfo c
where a.HarvestId=b.HarvestId and b.HarvestPartnerId=@HarvestPartnerId
and b.PartnerUserCardId=c.UserCardId


END
GO
/****** Object:  StoredProcedure [dbo].[HarvestPartner_SelectByHarvestId]    Script Date: 12/07/2016 16:56:28 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
/*********************
--: HarvestPartner_SelectByHarvestId
--: Harvest, 
--: 
--: 
	
--:
	0 - 
	-1 -  
**************/
CREATE PROCEDURE [dbo].[HarvestPartner_SelectByHarvestId]
	@HarvestId int
	AS
BEGIN
select c.UserName,b.*
from Harvest a,HarvestPartner b,UserInfo c
where a.HarvestId=b.HarvestId and a.HarvestId=@HarvestId
and b.PartnerUserCardId=c.UserCardId


END
GO
/****** Object:  StoredProcedure [dbo].[AssessValue_Update]    Script Date: 12/07/2016 16:56:27 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
/*******
--: AssessValue_Update
--: , 
--: 
AssessValueId,AssessValueName
--: 
	
--:
	0 - 
	-1 -  
*********/
CREATE PROCEDURE [dbo].[AssessValue_Update]
@UserCardId varchar(50),
@ApplyYearId int,
@NowValue float
AS
begin
	begin tran
	declare
	@ShouldValue float,
	@AssessResult varchar(50),
	@RankValue float,
	@RankName varchar(50),
	@i int=1,
	@MaxId int
	
	if not exists (select * from AssessValue where UserCardId=@UserCardId and ApplyYearId=@ApplyYearId)
	begin
	exec [dbo].[AssessValue_Insert] @UsercardId
	end
	set @ShouldValue=(select ShouldValue from AssessValue where UserCardId=@UserCardId and ApplyYearId=@ApplyYearId )
	set @NowValue=(select NowValue from AssessValue where UserCardId=@UserCardId and ApplyYearId=@ApplyYearId)+@NowValue
	set @RankValue=@NowValue*100/@ShouldValue
	set @MaxId=(select MAX(AssessRankId) from AssessRank)
	while (@i<=@MaxId)
	begin
	if exists(select * from AssessRank where AssessRankId=@i)
	begin
	declare
	@RankMinValue float,
	@RankMaxValue float
	set @RankMinValue=(select RankMinValue from AssessRank where AssessRankId=@i)
	set @RankMaxValue=(select RankMaxValue from AssessRank where AssessRankId=@i)
	if(@RankMinValue=0)
	begin
	if(@RankMaxValue>@RankValue)
	begin
	set @RankName=(select RankName from AssessRank where AssessRankId=@i)
	break
	end
	else
	begin
	set @i=@i+1
	continue
	end
	end
	else
	begin
	if (@RankMaxValue=0)
	begin
	if(@RankMinValue<=@RankValue)
	begin
	set @RankName=(select RankName from AssessRank where AssessRankId=@i)
	break
	end
	else
	begin
	set @i=@i+1
	continue
	end
	end
	else
	begin
	if(@RankMinValue<=@RankValue and @RankMaxValue>@RankValue)
	begin
	set @RankName=(select RankName from AssessRank where AssessRankId=@i)
	break
	end
	else
	begin
	set @i=@i+1
	continue
	end
	end
	
	end
	
	
	end
	set @i=@i+1
	end
		
		update AssessValue 
		set NowValue=@NowValue,
		 AssessResult=@RankName
		where UserCardId=@UserCardId and ApplyYearId=@ApplyYearId
		if(@@ERROR<>0)
			begin
				rollback
				return -1
			end
	commit tran
	return 0
end
GO
/****** Object:  StoredProcedure [dbo].[HarvestPartner_AddValue]    Script Date: 12/07/2016 16:56:28 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
/*******
--: HarvestPartner_AddValue
--: Harvest, 
--: 
HarvestId
--: 
	
--:
	0 - 
	-1 -  
*********/
CREATE PROCEDURE [dbo].[HarvestPartner_AddValue]
@HarvestId int
AS
begin
	begin tran	
		declare
		@ApplyYearId int,
		@i int,
		@MaxId int
		set @MaxId=(select MAX(HarvestPartnerId) from HarvestPartner where HarvestId=@HarvestId)
		set @i=(select MIN(HarvestPartnerId) from HarvestPartner where HarvestId=@HarvestId)
		set @ApplyYearId=(select ApplyYearId from Harvest where HarvestId=@HarvestId)
		while(@i<=@MaxId)
		begin
		if exists(select * from HarvestPartner where HarvestPartnerId=@i and HarvestId=@HarvestId)
		begin
		declare
		@UserCardId varchar(50),
		@PartnerValue float
		set @UserCardId=(select PartnerUserCardId from HarvestPartner where HarvestPartnerId=@i)
		set @PartnerValue=(select PartnerValue from HarvestPartner where HarvestPartnerId=@i)
		exec [dbo].[assessvalue_Update] @UserCardId,@ApplyYearId,@PartnerValue
		end
		set @i=@i+1
		end
		
	   
		if(@@ERROR<>0)
			begin
				rollback
				return -1
			end
	commit tran
	return 0
end
GO
/****** Object:  StoredProcedure [dbo].[Harvest_Select]    Script Date: 12/07/2016 16:56:28 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
/*********************
--: Harvest_Select
--: Harvest, 
--: 
  UserCardId UserNameTransferStatus
--: 
	
--:
	0 - 
	-1 -  
**************/
CREATE PROCEDURE [dbo].[Harvest_Select]
	@UserCardId varchar(50),
	@UserName varchar(50),
	@TransferStatus varchar(50)
	AS
BEGIN
select b.UserName ,a.* 
	from Harvest a,UserInfo b 
	where a.UserCardId=b.UserCardId and 
	a.UserCardId like '%'+@UserCardId+'%' and 
	b.UserName like '%'+@UserName+'%' and
	a.TransferStatus like '%'+ @TransferStatus+'%'

END
GO
/****** Object:  StoredProcedure [dbo].[AssessValue_SelectDepartmentApply]    Script Date: 12/07/2016 16:56:27 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
/******
--: AssessValue_Select
--: AssessValue, 
--: 
--: 
	
--:
	0 - 
	-1 -  
******/
CREATE PROCEDURE [dbo].[AssessValue_SelectDepartmentApply]
@DepartmentId varchar(50),
@ApplyId varchar(50)
AS
begin
  declare @sql varchar(2000)
set @sql= 'select a.AssessValueId,a.AssessResult,a.NowValue,a.ShouldValue,b.ReportDate,c.UserName,d.DepartmentName from AssessValue a,ApplyYear b,UserInfo c,Department d where a.UserCardId=c.UserCardId and a.ApplyYearId=b.ApplyYearId and c.UserDepartmentId=d.DepartmentId '
if(@DepartmentId >0)
	begin
    set @sql=@sql+' and d.DepartmentId ='+@DepartmentId
	end
	if(@ApplyId >0)
	begin
    set @sql=@sql+' and b.ApplyYearId ='+@ApplyId
	end
		exec(@sql)
end
GO
/****** Object:  StoredProcedure [dbo].[GuidancePartner_SelectByGuidancePartnerId]    Script Date: 12/07/2016 16:56:28 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
/*********************
--: GuidancePartner_SelectByGuidanceId
--: Guidance, 
--: 
--: 
	
--:
	0 - 
	-1 -  
**************/
CREATE PROCEDURE [dbo].[GuidancePartner_SelectByGuidancePartnerId]
	@GuidancePartnerId int
	AS
BEGIN
select c.UserName,b.*
from Guidance a,GuidancePartner b,UserInfo c
where a.GuidanceId=b.GuidanceId and b.GuidancePartnerId=@GuidancePartnerId
and b.PartnerUserCardId=c.UserCardId


END
GO
/****** Object:  StoredProcedure [dbo].[GuidancePartner_SelectByGuidanceId]    Script Date: 12/07/2016 16:56:28 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
/*********************
--: GuidancePartner_SelectByGuidanceId
--: Guidance, 
--: 
--: 
	
--:
	0 - 
	-1 -  
**************/
CREATE PROCEDURE [dbo].[GuidancePartner_SelectByGuidanceId]
	@GuidanceId int
	AS
BEGIN
select c.UserName,b.*
from Guidance a,GuidancePartner b,UserInfo c
where a.GuidanceId=b.GuidanceId and a.GuidanceId=@GuidanceId
and b.PartnerUserCardId=c.UserCardId


END
GO
/****** Object:  StoredProcedure [dbo].[GuidancePartner_AddValue]    Script Date: 12/07/2016 16:56:28 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
/*******
--: GuidancePartner_AddValue
--: Guidance, 
--: 
GuidanceId
--: 
	
--:
	0 - 
	-1 -  
*********/
CREATE PROCEDURE [dbo].[GuidancePartner_AddValue]
@GuidanceId int
AS
begin
	begin tran	
		declare
		@ApplyYearId int,
		@i int,
		@MaxId int
		set @MaxId=(select MAX(GuidancePartnerId) from GuidancePartner where GuidanceId=@GuidanceId)
		set @i=(select MIN(GuidancePartnerId) from GuidancePartner where GuidanceId=@GuidanceId)
		set @ApplyYearId=(select ApplyYearId from Guidance where GuidanceId=@GuidanceId)
		while(@i<=@MaxId)
		begin
		if exists(select * from GuidancePartner where GuidancePartnerId=@i and GuidanceId=@GuidanceId)
		begin
		declare
		@UserCardId varchar(50),
		@PartnerValue float
		set @UserCardId=(select PartnerUserCardId from GuidancePartner where GuidancePartnerId=@i)
		set @PartnerValue=(select PartnerValue from GuidancePartner where GuidancePartnerId=@i)
		exec [dbo].[assessvalue_Update] @UserCardId,@ApplyYearId,@PartnerValue
		end
		set @i=@i+1
		end
		
	   
		if(@@ERROR<>0)
			begin
				rollback
				return -1
			end
	commit tran
	return 0
end
GO
/****** Object:  StoredProcedure [dbo].[Guidance_Select]    Script Date: 12/07/2016 16:56:28 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
/*********************
--: Guidance_Select
--: Guidance, 
--: 
  UserCardId UserNameTransferStatus
--: 
	
--:
	0 - 
	-1 -  
**************/
CREATE PROCEDURE [dbo].[Guidance_Select]
	@UserCardId varchar(50),
	@UserName varchar(50),
	@TransferStatus varchar(50)
	AS
BEGIN
select b.UserName ,a.* 
	from Guidance a,UserInfo b 
	where a.UserCardId=b.UserCardId and 
	a.UserCardId like '%'+@UserCardId+'%' and 
	b.UserName like '%'+@UserName+'%' and
	a.TransferStatus like '%'+ @TransferStatus+'%'

END
GO
/****** Object:  StoredProcedure [dbo].[ShortCapitalBasic_Selects]    Script Date: 12/07/2016 16:56:30 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
/*********************
--: ShortCapitalBasic_Selects
--: ShortCapitalBasic, 
--: 
UserName,DepartmentId,Year,Month,Status
--: 
	
--:
	0 - 
	-1 -  
**************/
CREATE PROCEDURE [dbo].[ShortCapitalBasic_Selects]
@UserName varchar(50),
@DepartmentId varchar(10),
@ProjectsName varchar(50),
@ProjectsId varchar(50)
AS
begin
	declare
	@sql varchar(2000)
	set @sql='select * from ShortCapitalBasicView  where 1=1  '
	if(@UserName is not null)
	begin
	if(LEN(@UserName)>0)
	set @sql=@sql+'and  like''%'+@UserName+'%''' 
	end
	if(@DepartmentId <>'()')
	begin
    set @sql=@sql+' and [()] like ''%'+@DepartmentId+'%'''
	end
	
	if(@ProjectsId is not null)
		if(len(@ProjectsId)>0)
	begin
	set @sql=@sql+'and  like''%'+@ProjectsId+'%'''
	end

	if(@ProjectsName is not null)
		if(len(@ProjectsName)>0)
	begin
	set @sql=@sql+'and  like''%'+@ProjectsName+'%'''
	end
	exec(@sql)
end
GO
/****** Object:  StoredProcedure [dbo].[LongCapitalPlan_Selects]    Script Date: 12/07/2016 16:56:28 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
/*********************
--: LongCapitalPlan_Selects
--: LongCapitalBasic, 
--: 
UserName,DepartmentId,Year,Month,Status
--: 
	
--:
	0 - 
	-1 -  
**************/
CREATE PROCEDURE [dbo].[LongCapitalPlan_Selects]
@UserName varchar(50),
@DepartmentId varchar(10),
@ProjectsName varchar(50),
@ProjectsId varchar(50),
@Status varchar(10)
AS
begin
	declare
	@sql varchar(2000)
	set @sql='select * from LongCapitalPlanView  where 1=1  '
	if(@UserName is not null)
	begin
	if(LEN(@UserName)>0)
	set @sql=@sql+'and  like''%'+@UserName+'%''' 
	end
	if(@DepartmentId <>'()')
	begin
    set @sql=@sql+' and [()] like ''%'+@DepartmentId+'%'''
	end
	
	if(@ProjectsId is not null)
		if(len(@ProjectsId)>0)
	begin
	set @sql=@sql+'and  like''%'+@ProjectsId+'%'''
	end

	if(@ProjectsName is not null)
		if(len(@ProjectsName)>0)
	begin
	set @sql=@sql+'and  like''%'+@ProjectsName+'%'''
	end
	if(@Status is not null)
		if(len(@Status)>0)
	begin
	set @sql=@sql+'and  like''%'+@Status+'%'''
	end
	exec(@sql)
end
GO
/****** Object:  StoredProcedure [dbo].[ShortCapitalPlan_Selects]    Script Date: 12/07/2016 16:56:30 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
/*********************
--: ShortCapitalPlan_Selects
--: ShortCapitalBasic, 
--: 
UserName,DepartmentId,Year,Month,Status
--: 
	
--:
	0 - 
	-1 -  
**************/
CREATE PROCEDURE [dbo].[ShortCapitalPlan_Selects]
@UserName varchar(50),
@DepartmentId varchar(10),
@ProjectsName varchar(50),
@ProjectsId varchar(50),
@Status varchar(10)
AS
begin
	declare
	@sql varchar(2000)
	set @sql='select * from ShortCapitalPlanView  where 1=1  '
	if(@UserName is not null)
	begin
	if(LEN(@UserName)>0)
	set @sql=@sql+'and  like''%'+@UserName+'%''' 
	end
	if(@DepartmentId <>'()')
	begin
    set @sql=@sql+' and [()] like ''%'+@DepartmentId+'%'''
	end
	
	if(@ProjectsId is not null)
		if(len(@ProjectsId)>0)
	begin
	set @sql=@sql+'and  like''%'+@ProjectsId+'%'''
	end

	if(@ProjectsName is not null)
		if(len(@ProjectsName)>0)
	begin
	set @sql=@sql+'and  like''%'+@ProjectsName+'%'''
	end
	if(@Status is not null)
		if(len(@Status)>0)
	begin
	set @sql=@sql+'and  like''%'+@Status+'%'''
	end
	exec(@sql)
end
GO
/****** Object:  StoredProcedure [dbo].[ShortCapitalChange_SelectByShortProjectsId]    Script Date: 12/07/2016 16:56:30 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
/******
--: AdminSeries_Select
--: AdminSeries, 
--: 
--: 
	
--:
	0 - 
	-1 -  
******/
CREATE PROCEDURE [dbo].[ShortCapitalChange_SelectByShortProjectsId]
@ShortProjectsId varchar(50)
AS
begin

		select a.*,b.Company,b.ContractId,b.ContractMoney,b.ContractName,c.UserName
		from ShortCapitalChange a,ShortProjects b,UserInfo c
		where a.ShortProjectsId=@ShortProjectsId and a.ShortProjectsId=b.ShortProjectsId
		and b.UserCardId=c.UserCardId

end
GO
/****** Object:  StoredProcedure [dbo].[PhoneEmail_Select]    Script Date: 12/07/2016 16:56:29 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
/******
--: PhoneEmail_Select
--: PhoneEmail, 
--: 
--UserName,UserDepartmentId,PhoneNumber,EmailNumber
--: 
	
--:
	0 - 
	-1 -  
******/
CREATE PROCEDURE [dbo].[PhoneEmail_Select]
	@UserName varchar(50)=null,
	@DepartmentId varchar(50)=0,
    @PhoneNumber varchar(50)=null,
    @EmailNumber varchar(50)=null,
    @StatusId varchar(50)=0,
    @Gender varchar(4)=null
	
AS
begin
declare 
@sql varchar(1000)
set @sql='select * from PhoneEmailView where 1=1'
if(@UserName is not null)
begin
if(LEN(@UserName)>0)
begin
set @sql=@sql+'and UserName like''%'+@UserName+'%'''
end
end
if(@DepartmentId>0)
begin
set @sql=@sql+' and DepartmentId ='+@DepartmentId+''
end
if(@PhoneNumber is not null)
begin
if(LEN(@PhoneNumber)>0)
begin
set @sql=@sql+' and TelephoneNumber like''%'+@PhoneNumber+'%'''
set @sql=@sql+' or HomeNumber like''%'+@PhoneNumber+'%'''
set @sql=@sql+' or WorkNumber like''%'+@PhoneNumber+'%'''
end
end
if(@EmailNumber is not null)
begin
if(LEN(@EmailNumber)>0)
begin
set @sql=@sql+'and IndividuaNumber like''%'+@EmailNumber+'%'''
set @sql=@sql+'or Email2 like''%'+@EmailNumber+'%'''
set @sql=@sql+'or Email3 like''%'+@EmailNumber+'%'''
end
end
if(@Gender is not null)
begin
if(LEN(@Gender)>0)
begin
set @sql=@sql+' and UserGender like ''%'+@Gender+'%'''
end
end
if(@StatusId>0)
begin
set @sql=@sql+' and StatusId = '+@StatusId+''
end
exec(@sql)
    RETURN
end
GO
/****** Object:  StoredProcedure [dbo].[PaperPartner_SelectByPaperPartnerId]    Script Date: 12/07/2016 16:56:29 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
/*********************
--: PaperPartner_SelectByPaperId
--: Paper, 
--: 
--: 
	
--:
	0 - 
	-1 -  
**************/
CREATE PROCEDURE [dbo].[PaperPartner_SelectByPaperPartnerId]
	@PaperPartnerId int
	AS
BEGIN
select c.UserName,b.*
from Paper a,PaperPartner b,UserInfo c
where a.PaperId=b.PaperId and b.PaperPartnerId=@PaperPartnerId
and b.PartnerUserCardId=c.UserCardId


END
GO
/****** Object:  StoredProcedure [dbo].[PaperPartner_SelectByPaperId]    Script Date: 12/07/2016 16:56:29 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
/*********************
--: PaperPartner_SelectByPaperId
--: Paper, 
--: 
--: 
	
--:
	0 - 
	-1 -  
**************/
CREATE PROCEDURE [dbo].[PaperPartner_SelectByPaperId]
	@PaperId int
	AS
BEGIN
select c.UserName,b.*
from Paper a,PaperPartner b,UserInfo c
where a.PaperId=b.PaperId and a.PaperId=@PaperId
and b.PartnerUserCardId=c.UserCardId


END
GO
/****** Object:  StoredProcedure [dbo].[PaperPartner_AddValue]    Script Date: 12/07/2016 16:56:29 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
/*******
--: PaperPartner_AddValue
--: Paper, 
--: 
PaperId
--: 
	
--:
	0 - 
	-1 -  
*********/
CREATE PROCEDURE [dbo].[PaperPartner_AddValue]
@PaperId int
AS
begin
	begin tran	
		declare
		@ApplyYearId int,
		@i int,
		@MaxId int
		set @MaxId=(select MAX(PaperPartnerId) from PaperPartner where PaperId=@PaperId)
		set @i=(select MIN(PaperPartnerId) from PaperPartner where PaperId=@PaperId)
		set @ApplyYearId=(select ApplyYearId from Paper where PaperId=@PaperId)
		while(@i<=@MaxId)
		begin
		if exists(select * from PaperPartner where PaperPartnerId=@i and PaperId=@PaperId)
		begin
		declare
		@UserCardId varchar(50),
		@PartnerValue float
		set @UserCardId=(select PartnerUserCardId from PaperPartner where PaperPartnerId=@i)
		set @PartnerValue=(select PartnerValue from PaperPartner where PaperPartnerId=@i)
		exec [dbo].[assessvalue_Update] @UserCardId,@ApplyYearId,@PartnerValue
		end
		set @i=@i+1
		end
		
	   
		if(@@ERROR<>0)
			begin
				rollback
				return -1
			end
	commit tran
	return 0
end
GO
/****** Object:  StoredProcedure [dbo].[Paper_Select]    Script Date: 12/07/2016 16:56:29 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
/*********************
--: Paper_Select
--: Paper, 
--: 
  UserCardId UserNameTransferStatus
--: 
	
--:
	0 - 
	-1 -  
**************/
CREATE PROCEDURE [dbo].[Paper_Select]
	@UserCardId varchar(50),
	@UserName varchar(50),
	@TransferStatus varchar(50)
	AS
BEGIN
select b.UserName ,a.* 
	from Paper a,UserInfo b 
	where a.UserCardId=b.UserCardId and 
	a.UserCardId like '%'+@UserCardId+'%' and 
	b.UserName like '%'+@UserName+'%' and
	a.TransferStatus like '%'+ @TransferStatus+'%'

END
GO
/****** Object:  StoredProcedure [dbo].[OldShort2015_Selects]    Script Date: 12/07/2016 16:56:29 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
/******
--: Old2014_Select
--: Old2014, 
--: 
--: 
	
--:
	0 - 
	-1 -  
******/
CREATE PROCEDURE [dbo].[OldShort2015_Selects]
@SelectText varchar(5000)='*',
@WhereText varchar(5000)
AS
begin
declare 
@sql varchar(8000)
set @sql='select distinct '+@SelectText+' from OldShort2015 '
if(@WhereText is not null)
begin
if(len(@WhereText)>0)
begin
set @sql=@sql +' where '+@WhereText
end
end

	exec(@sql)



end
GO
/****** Object:  StoredProcedure [dbo].[OldShort2014_Selects]    Script Date: 12/07/2016 16:56:29 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
/******
--: Old2014_Select
--: Old2014, 
--: 
--: 
	
--:
	0 - 
	-1 -  
******/
CREATE PROCEDURE [dbo].[OldShort2014_Selects]
@SelectText varchar(5000)='*',
@WhereText varchar(5000)
AS
begin
declare 
@sql varchar(8000)
set @sql='select distinct '+@SelectText+' from OldShort2014 '
if(@WhereText is not null)
begin
if(len(@WhereText)>0)
begin
set @sql=@sql +' where '+@WhereText
end
end

	exec(@sql)



end
GO
/****** Object:  StoredProcedure [dbo].[OldShort_Selects]    Script Date: 12/07/2016 16:56:29 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
/******
--: Old2014_Select
--: Old2014, 
--: 
--: 
	
--:
	0 - 
	-1 -  
******/
CREATE PROCEDURE [dbo].[OldShort_Selects]
@SelectText varchar(5000)='*',
@WhereText varchar(5000)
AS
begin
declare 
@sql varchar(8000)
set @sql='select distinct '+@SelectText+' from OldShort '
if(@WhereText is not null)
begin
if(len(@WhereText)>0)
begin
set @sql=@sql +' where '+@WhereText
end
end

	exec(@sql)



end
GO
/****** Object:  StoredProcedure [dbo].[OldProject_Selects]    Script Date: 12/07/2016 16:56:29 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
/******
--: OldProject_Select
--: OldProject, 
--: 
--: 
	
--:
	0 - 
	-1 -  
******/
CREATE PROCEDURE [dbo].[OldProject_Selects]
@SelectText varchar(5000)='*',
@WhereText varchar(5000)
AS
begin
declare 
@sql varchar(8000)
set @sql='select distinct '+@SelectText+' from OldProjects '
if(@WhereText is not null)
begin
if(len(@WhereText)>0)
begin
set @sql=@sql +' where '+@WhereText
end
end

	exec(@sql)



end
GO
/****** Object:  StoredProcedure [dbo].[OldPatentView_Selects]    Script Date: 12/07/2016 16:56:29 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
/******
--: Old2014_Select
--: Old2014, 
--: 
--: 
	
--:
	0 - 
	-1 -  
******/
CREATE PROCEDURE [dbo].[OldPatentView_Selects]
@SelectText varchar(5000)='*',
@WhereText varchar(5000)
AS
begin
declare 
@sql varchar(8000)
set @sql='select distinct '+@SelectText+' from OldPatentView '
if(@WhereText is not null)
begin
if(len(@WhereText)>0)
begin
set @sql=@sql +' where '+@WhereText
end
end

	exec(@sql)



end
GO
/****** Object:  StoredProcedure [dbo].[OldPatent_Selects]    Script Date: 12/07/2016 16:56:29 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
/******
--: Old2014_Select
--: Old2014, 
--: 
--: 
	
--:
	0 - 
	-1 -  
******/
CREATE PROCEDURE [dbo].[OldPatent_Selects]
@SelectText varchar(5000)='*',
@WhereText varchar(5000)
AS
begin
declare 
@sql varchar(8000)
set @sql='select distinct '+@SelectText+' from OldPatent '
if(@WhereText is not null)
begin
if(len(@WhereText)>0)
begin
set @sql=@sql +' where '+@WhereText
end
end

	exec(@sql)



end
GO
/****** Object:  StoredProcedure [dbo].[Oldlishi_Selects]    Script Date: 12/07/2016 16:56:29 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
/******
--: Oldlishi_Select
--: Oldlishi, 
--: 
--: 
	
--:
	0 - 
	-1 -  
******/
CREATE PROCEDURE [dbo].[Oldlishi_Selects]
@SelectText varchar(5000)='*',
@WhereText varchar(5000)
AS
begin
declare 
@sql varchar(8000)
set @sql='select distinct '+@SelectText+' from Oldlishi '
if(@WhereText is not null)
begin
if(len(@WhereText)>0)
begin
set @sql=@sql +' where '+@WhereText
end
end

	exec(@sql)



end
GO
/****** Object:  StoredProcedure [dbo].[Old20152_Selects]    Script Date: 12/07/2016 16:56:29 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
/******
--: Old20152_Select
--: Old20152, 
--: 
--: 
	
--:
	0 - 
	-1 -  
******/
CREATE PROCEDURE [dbo].[Old20152_Selects]
@SelectText varchar(5000)='*',
@WhereText varchar(5000)
AS
begin
declare 
@sql varchar(8000)
set @sql='select distinct '+@SelectText+' from Old20152 '
if(@WhereText is not null)
begin
if(len(@WhereText)>0)
begin
set @sql=@sql +' where '+@WhereText
end
end

	exec(@sql)



end
GO
/****** Object:  StoredProcedure [dbo].[Old20151_Selects]    Script Date: 12/07/2016 16:56:29 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
/******
--: Old20151_Select
--: Old20151, 
--: 
--: 
	
--:
	0 - 
	-1 -  
******/
CREATE PROCEDURE [dbo].[Old20151_Selects]
@SelectText varchar(5000)='*',
@WhereText varchar(5000)
AS
begin
declare 
@sql varchar(8000)
set @sql='select distinct '+@SelectText+' from Old20151 '
if(@WhereText is not null)
begin
if(len(@WhereText)>0)
begin
set @sql=@sql +' where '+@WhereText
end
end

	exec(@sql)



end
GO
/****** Object:  StoredProcedure [dbo].[Winning_Select]    Script Date: 12/07/2016 16:56:31 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
/*********************
--: Winning_Select
--: Winning, 
--: 
  UserCardId UserNameTransferStatus
--: 
	
--:
	0 - 
	-1 -  
**************/
CREATE PROCEDURE [dbo].[Winning_Select]
	@UserCardId varchar(50),
	@UserName varchar(50),
	@TransferStatus varchar(50)
	AS
BEGIN
select b.UserName ,a.* 
	from Winning a,UserInfo b 
	where a.UserCardId=b.UserCardId and 
	a.UserCardId like '%'+@UserCardId+'%' and 
	b.UserName like '%'+@UserName+'%' and
	a.TransferStatus like '%'+ @TransferStatus+'%'

END
GO
/****** Object:  StoredProcedure [dbo].[UserView_Selects]    Script Date: 12/07/2016 16:56:31 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
/******
--: UserView_Select
--: UserInfo, 
--: 
--UserCardId
--: 
	
--:
	0 - 
	-1 -  
******/
CREATE PROCEDURE [dbo].[UserView_Selects]
@SelectText varchar(5000)='*',
@WhereText varchar(5000)
AS
begin
declare 
@sql varchar(8000)
set @sql='select distinct '+@SelectText+' from UserView '
if(@WhereText is not null)
begin
if(len(@WhereText)>0)
begin
set @sql=@sql +' where '+@WhereText
end
end

	exec(@sql)



end
GO
/****** Object:  StoredProcedure [dbo].[Old2015_Selects]    Script Date: 12/07/2016 16:56:29 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
/******
--: Old2015_Select
--: Old2015, 
--: 
--: 
	
--:
	0 - 
	-1 -  
******/
CREATE PROCEDURE [dbo].[Old2015_Selects]
@SelectText varchar(5000)='*',
@WhereText varchar(5000)
AS
begin
declare 
@sql varchar(8000)
set @sql='select distinct '+@SelectText+' from Old2015 '
if(@WhereText is not null)
begin
if(len(@WhereText)>0)
begin
set @sql=@sql +' where '+@WhereText
end
end

	exec(@sql)



end
GO
/****** Object:  StoredProcedure [dbo].[Old2014_Selects]    Script Date: 12/07/2016 16:56:29 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
/******
--: Old2014_Select
--: Old2014, 
--: 
--: 
	
--:
	0 - 
	-1 -  
******/
CREATE PROCEDURE [dbo].[Old2014_Selects]
@SelectText varchar(5000)='*',
@WhereText varchar(5000)
AS
begin
declare 
@sql varchar(8000)
set @sql='select distinct '+@SelectText+' from Old2014 '
if(@WhereText is not null)
begin
if(len(@WhereText)>0)
begin
set @sql=@sql +' where '+@WhereText
end
end

	exec(@sql)



end
GO
/****** Object:  StoredProcedure [dbo].[LongProjectsView_Selects]    Script Date: 12/07/2016 16:56:29 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
/*********************
--: LongProjects_Selects
--: LongProjects, 
--: 
UserName,DepartmentId,Year,Month,Status
--: 
	
--:
	0 - 
	-1 -  
**************/
CREATE PROCEDURE [dbo].[LongProjectsView_Selects]
@UserName varchar(50),
@DepartmentName varchar(10),
@ProjectsId varchar(50),
@ProjectsName varchar(50),
@ApplyYear varchar(50),
@Subject varchar(50),
@Level varchar(50),
@From varchar(50),
@Declare varchar(50),
@Stand varchar(50),
@Inspect varchar(50),
@Ends varchar(50)
AS
begin
	declare
	@sql varchar(2000)
	set @sql='select * from LongProjectsView where 1=1  '
	if(@UserName is not null)
	begin
	if(LEN(@UserName)>0)
	set @sql=@sql+'and  like''%'+@UserName+'%''' 
	end

	if(@DepartmentName is not null)
	begin
	if(LEN(@DepartmentName)>0)
    set @sql=@sql+' and   like ''%'+@DepartmentName+'%'''
	end
		if(@ProjectsId is not null)
	begin
	if(LEN(@ProjectsId)>0)
	set @sql=@sql+'and  like''%'+@ProjectsId+'%''' 
	end
		if(@ProjectsName is not null)
	begin
	if(LEN(@ProjectsName)>0)
	set @sql=@sql+'and  like''%'+@ProjectsName+'%''' 
	end
		if(@ApplyYear is not null)
	begin
	if(LEN(@ApplyYear)>0)
	set @sql=@sql+'and  like''%'+@ApplyYear+'%''' 
	end
		if(@Subject is not null)
	begin
	if(LEN(@Subject)>0)
	set @sql=@sql+'and  like''%'+@Subject+'%''' 
	end
		if(@Level is not null)
	begin
	if(LEN(@Level)>0)
	set @sql=@sql+'and   like''%'+@Level+'%''' 
	end
		if(@From is not null)
	begin
	if(LEN(@From)>0)
	set @sql=@sql+'and  like''%'+@From+'%''' 
	end
		if(@Declare is not null)
	begin
	if(LEN(@Declare)>0)
	set @sql=@sql+'and  like''%'+@Declare+'%''' 
	end
		if(@Stand is not null)
	begin
	if(LEN(@Stand)>0)
	set @sql=@sql+'and  like''%'+@Stand+'%''' 
	end
		if(@Inspect is not null)
	begin
	if(LEN(@Inspect)>0)
	set @sql=@sql+'and  like''%'+@Inspect+'%''' 
	end
		if(@Ends is not null)
	begin
	if(LEN(@Ends)>0)
	set @sql=@sql+'and  like''%'+@Ends+'%''' 
	end
	
	exec(@sql)
end
GO
/****** Object:  StoredProcedure [dbo].[WorkLoadProjects_Select]    Script Date: 12/07/2016 16:56:31 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
/*********************
--: WorkLoadProjects_Select
--: WorkLoadProjects, 
--: 
  UserCardId UserNameTransferStatus
--: 
	
--:
	0 - 
	-1 -  
**************/
CREATE PROCEDURE [dbo].[WorkLoadProjects_Select]
	@UserCardId varchar(50),
	@UserName varchar(50),
	@TransferStatus varchar(50)
	AS
BEGIN
select b.UserName ,a.* 
	from WorkLoadProjects a,UserInfo b 
	where a.UserCardId=b.UserCardId and 
	a.UserCardId like '%'+@UserCardId+'%' and 
	b.UserName like '%'+@UserName+'%' and
	a.TransferStatus like '%'+ @TransferStatus+'%'

END
GO
/****** Object:  StoredProcedure [dbo].[WorkLoadProjectsPartner_SelectByWorkLoadProjectsPartnerId]    Script Date: 12/07/2016 16:56:31 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
/*********************
--: WorkLoadProjectsPartner_SelectByWorkLoadProjectsId
--: WorkLoadProjects, 
--: 
--: 
	
--:
	0 - 
	-1 -  
**************/
CREATE PROCEDURE [dbo].[WorkLoadProjectsPartner_SelectByWorkLoadProjectsPartnerId]
	@WorkLoadProjectsPartnerId int
	AS
BEGIN
select c.UserName,b.*
from WorkLoadProjects a,WorkLoadProjectsPartner b,UserInfo c
where a.WorkLoadProjectsId=b.WorkLoadProjectsId and b.WorkLoadProjectsPartnerId=@WorkLoadProjectsPartnerId
and b.PartnerUserCardId=c.UserCardId


END
GO
/****** Object:  StoredProcedure [dbo].[WorkLoadProjectsPartner_SelectByWorkLoadProjectsId]    Script Date: 12/07/2016 16:56:31 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
/*********************
--: WorkLoadProjectsPartner_SelectByWorkLoadProjectsId
--: WorkLoadProjects, 
--: 
--: 
	
--:
	0 - 
	-1 -  
**************/
CREATE PROCEDURE [dbo].[WorkLoadProjectsPartner_SelectByWorkLoadProjectsId]
	@WorkLoadProjectsId int
	AS
BEGIN
select c.UserName,b.*
from WorkLoadProjects a,WorkLoadProjectsPartner b,UserInfo c
where a.WorkLoadProjectsId=b.WorkLoadProjectsId and a.WorkLoadProjectsId=@WorkLoadProjectsId
and b.PartnerUserCardId=c.UserCardId


END
GO
/****** Object:  StoredProcedure [dbo].[WorkLoadProjectsPartner_AddValue]    Script Date: 12/07/2016 16:56:31 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
/*******
--: WorkLoadProjectsPartner_AddValue
--: WorkLoadProjectsPartner, 
--: 
WorkLoadProjectsId
--: 
	
--:
	0 - 
	-1 -  
*********/
CREATE PROCEDURE [dbo].[WorkLoadProjectsPartner_AddValue]
@WorkLoadProjectsId int
AS
begin
	begin tran	
		declare
		@ApplyYearId int,
		@i int,
		@MaxId int
		set @MaxId=(select MAX(WorkLoadProjectsPartnerId) from WorkLoadProjectsPartner where WorkLoadProjectsId=@WorkLoadProjectsId)
		set @i=(select MIN(WorkLoadProjectsPartnerId) from WorkLoadProjectsPartner where WorkLoadProjectsId=@WorkLoadProjectsId)
		set @ApplyYearId=(select ApplyYearId from WorkLoadProjects where WorkLoadProjectsId=@WorkLoadProjectsId)
		while(@i<=@MaxId)
		begin
		if exists(select * from WorkLoadProjectsPartner where WorkLoadProjectsPartnerId=@i and WorkLoadProjectsId=@WorkLoadProjectsId)
		begin
		declare
		@UserCardId varchar(50),
		@PartnerValue float
		set @UserCardId=(select PartnerUserCardId from WorkLoadProjectsPartner where WorkLoadProjectsPartnerId=@i)
		set @PartnerValue=(select PartnerValue from WorkLoadProjectsPartner where WorkLoadProjectsPartnerId=@i)
		exec [dbo].[assessvalue_Update] @UserCardId,@ApplyYearId,@PartnerValue
		end
		set @i=@i+1
		end
		
	   
		if(@@ERROR<>0)
			begin
				rollback
				return -1
			end
	commit tran
	return 0
end
GO
/****** Object:  StoredProcedure [dbo].[WinningPartner_SelectByWinningPartnerId]    Script Date: 12/07/2016 16:56:31 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
/*********************
--: WinningPartner_SelectByWinningPartnerId
--: WinningPartner, 
--: 
--: 
	
--:
	0 - 
	-1 -  
**************/
CREATE PROCEDURE [dbo].[WinningPartner_SelectByWinningPartnerId]
	@WinningPartnerId int
	AS
BEGIN
select c.UserName,b.*
from Winning a,WinningPartner b,UserInfo c
where a.WinningId=b.WinningId and b.WinningPartnerId=@WinningPartnerId
and b.PartnerUserCardId=c.UserCardId


END
GO
/****** Object:  StoredProcedure [dbo].[WinningPartner_SelectByWinningId]    Script Date: 12/07/2016 16:56:31 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
/*********************
--: WinningPartner_SelectByWinningId
--: Winning, 
--: 
--: 
	
--:
	0 - 
	-1 -  
**************/
CREATE PROCEDURE [dbo].[WinningPartner_SelectByWinningId]
	@WinningId int
	AS
BEGIN
select c.UserName,b.*
from Winning a,WinningPartner b,UserInfo c
where a.WinningId=b.WinningId and a.WinningId=@WinningId
and b.PartnerUserCardId=c.UserCardId


END
GO
/****** Object:  StoredProcedure [dbo].[WinningPartner_AddValue]    Script Date: 12/07/2016 16:56:31 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
/*******
--: WinningPartner_AddValue
--: Winning, 
--: 
WinningId
--: 
	
--:
	0 - 
	-1 -  
*********/
CREATE PROCEDURE [dbo].[WinningPartner_AddValue]
@WinningId int
AS
begin
	begin tran	
		declare
		@ApplyYearId int,
		@i int,
		@MaxId int
		set @MaxId=(select MAX(WinningPartnerId) from WinningPartner where WinningId=@WinningId)
		set @i=(select MIN(WinningPartnerId) from WinningPartner where WinningId=@WinningId)
		set @ApplyYearId=(select ApplyYearId from Winning where WinningId=@WinningId)
		while(@i<=@MaxId)
		begin
		if exists(select * from WinningPartner where WinningPartnerId=@i and WinningId=@WinningId)
		begin
		declare
		@UserCardId varchar(50),
		@PartnerValue float
		set @UserCardId=(select PartnerUserCardId from WinningPartner where WinningPartnerId=@i)
		set @PartnerValue=(select PartnerValue from WinningPartner where WinningPartnerId=@i)
		exec [dbo].[assessvalue_Update] @UserCardId,@ApplyYearId,@PartnerValue
		end
		set @i=@i+1
		end
		
	   
		if(@@ERROR<>0)
			begin
				rollback
				return -1
			end
	commit tran
	return 0
end
GO
/****** Object:  StoredProcedure [dbo].[Teaching_Selects]    Script Date: 12/07/2016 16:56:30 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
/*********************
--: Teaching_Selects
--: Teaching, 
--: 
UserName,DepartmentId,Year,Month,Status
--: 
	
--:
	0 - 
	-1 -  
**************/
CREATE PROCEDURE [dbo].[Teaching_Selects]
@UserName varchar(50),
@DepartmentId varchar(50),
@Year varchar(4),
@Month varchar(2),
@Status varchar(10),
@BookName varchar(50),
@PressName varchar(50),
@WinningYear varchar(50)
AS
begin
	declare
	@sql varchar(2000)
	set @sql='select * from TeachingView where 1=1  '
	if(@UserName is not null)
	begin
	if(LEN(@UserName)>0)
	set @sql=@sql+'and  like''%'+@UserName+'%''' 
	end
	if(@DepartmentId <>'')
	begin
    set @sql=@sql+' and  like ''%'+@DepartmentId+'%'''
	end
	if(@Year >0)
	begin
	set @sql=@sql+'and datepart(yy,)='+@Year
	end
		if(@Month >0)
	begin
	set @sql=@sql+'and datepart(mm,)='+@Month
	end
	if(@Status is not null)
		if(len(@Status)>0)
	begin
	set @sql=@sql+'and  like''%'+@Status+'%'''
	end
	if(@WinningYear is not null)
		if(len(@WinningYear)>0)
	begin
	set @sql=@sql+'and  ='''+@WinningYear+''''
	end
	if(@BookName is not null)
		if(len(@BookName)>0)
	begin
	set @sql=@sql+'and  like''%'+@BookName+'%'''
	end
	if(@PressName is not null)
		if(len(@PressName)>0)
	begin
	set @sql=@sql+'and  like''%'+@PressName+'%'''
	end
	exec(@sql)
end
GO
/****** Object:  StoredProcedure [dbo].[TeachingPartner_SelectByTeachingPartnerId]    Script Date: 12/07/2016 16:56:30 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
/*********************
--: TeachingPartner_SelectByTeachingId
--: Teaching, 
--: 
--: 
	
--:
	0 - 
	-1 -  
**************/
CREATE PROCEDURE [dbo].[TeachingPartner_SelectByTeachingPartnerId]
	@TeachingPartnerId int
	AS
BEGIN
select c.UserName,b.*
from Teaching a,TeachingPartner b,UserInfo c
where a.TeachingId=b.TeachingId and b.TeachingPartnerId=@TeachingPartnerId
and b.PartnerUserCardId=c.UserCardId


END
GO
/****** Object:  StoredProcedure [dbo].[TeachingPartner_SelectByTeachingId]    Script Date: 12/07/2016 16:56:30 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
/*********************
--: TeachingPartner_SelectByTeachingId
--: Teaching, 
--: 
--: 
	
--:
	0 - 
	-1 -  
**************/
CREATE PROCEDURE [dbo].[TeachingPartner_SelectByTeachingId]
	@TeachingId int
	AS
BEGIN
select c.UserName,b.*
from Teaching a,TeachingPartner b,UserInfo c
where a.TeachingId=b.TeachingId and a.TeachingId=@TeachingId
and b.PartnerUserCardId=c.UserCardId


END
GO
/****** Object:  StoredProcedure [dbo].[TeachingPartner_AddValue]    Script Date: 12/07/2016 16:56:30 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
/*******
--: TeachingPartner_AddValue
--: Teaching, 
--: 
TeachingId
--: 
	
--:
	0 - 
	-1 -  
*********/
CREATE PROCEDURE [dbo].[TeachingPartner_AddValue]
@TeachingId int
AS
begin
	begin tran	
		declare
		@ApplyYearId int,
		@i int,
		@MaxId int
		set @MaxId=(select MAX(TeachingPartnerId) from TeachingPartner where TeachingId=@TeachingId)
		set @i=(select MIN(TeachingPartnerId) from TeachingPartner where TeachingId=@TeachingId)
		set @ApplyYearId=(select ApplyYearId from Teaching where TeachingId=@TeachingId)
		while(@i<=@MaxId)
		begin
		if exists(select * from TeachingPartner where TeachingPartnerId=@i and TeachingId=@TeachingId)
		begin
		declare
		@UserCardId varchar(50),
		@PartnerValue float
		set @UserCardId=(select PartnerUserCardId from TeachingPartner where TeachingPartnerId=@i)
		set @PartnerValue=(select PartnerValue from TeachingPartner where TeachingPartnerId=@i)
		exec [dbo].[assessvalue_Update] @UserCardId,@ApplyYearId,@PartnerValue
		end
		set @i=@i+1
		end
		
	   
		if(@@ERROR<>0)
			begin
				rollback
				return -1
			end
	commit tran
	return 0
end
GO
/****** Object:  StoredProcedure [dbo].[Teaching_Select]    Script Date: 12/07/2016 16:56:30 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
/*********************
--: Teaching_Select
--: Teaching, 
--: 
  UserCardId UserNameTransferStatus
--: 
	
--:
	0 - 
	-1 -  
**************/
CREATE PROCEDURE [dbo].[Teaching_Select]
	@UserCardId varchar(50),
	@UserName varchar(50),
	@TransferStatus varchar(50)
	AS
BEGIN
select b.UserName ,a.* 
	from Teaching a,UserInfo b 
	where a.UserCardId=b.UserCardId and 
	a.UserCardId like '%'+@UserCardId+'%' and 
	b.UserName like '%'+@UserName+'%' and
	a.TransferStatus like '%'+ @TransferStatus+'%'

END
GO
/****** Object:  StoredProcedure [dbo].[ShortCapitalPlan_SelectByShortProjectsId]    Script Date: 12/07/2016 16:56:30 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
/******
--: AdminSeries_Select
--: AdminSeries, 
--: 
--: 
	
--:
	0 - 
	-1 -  
******/
CREATE PROCEDURE [dbo].[ShortCapitalPlan_SelectByShortProjectsId]
@ShortProjectsId varchar(50)
AS
begin

		select a.*,b.Company,b.ContractId,b.ContractMoney,b.ContractName,c.UserName
		from ShortCapitalPlan a,ShortProjects b,UserInfo c
		where a.ShortProjectsId=@ShortProjectsId and a.ShortProjectsId=b.ShortProjectsId
		and b.UserCardId=c.UserCardId

end
GO
/****** Object:  StoredProcedure [dbo].[ShortProjectsView_Selects]    Script Date: 12/07/2016 16:56:30 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
/*********************
--: LongProjects_Selects
--: LongProjects, 
--: 
UserName,DepartmentId,Year,Month,Status
--: 
	
--:
	0 - 
	-1 -  
**************/
CREATE PROCEDURE [dbo].[ShortProjectsView_Selects]
@UserName varchar(50),
@DepartmentName varchar(10),
@ContractId varchar(50),
@ContractName varchar(50),
@ApplyYear varchar(50),
@Company varchar(50),
@Money1 varchar(50),
@Money2 varchar(50),
@Stand varchar(50),
@Ends varchar(50)
AS
begin
	declare
	@sql varchar(2000)
	set @sql='select * from ShortProjectsView where 1=1  '
	if(@UserName is not null)
	begin
	if(LEN(@UserName)>0)
	set @sql=@sql+'and  like''%'+@UserName+'%''' 
	end

	if(@DepartmentName is not null)
	begin
	if(LEN(@DepartmentName)>0)
    set @sql=@sql+' and   like ''%'+@DepartmentName+'%'''
	end
		if(@ContractId is not null)
	begin
	if(LEN(@ContractId)>0)
	set @sql=@sql+'and  like''%'+@ContractId+'%''' 
	end
		if(@ContractName is not null)
	begin
	if(LEN(@ContractName)>0)
	set @sql=@sql+'and  like''%'+@ContractName+'%''' 
	end
		if(@ApplyYear is not null)
	begin
	if(LEN(@ApplyYear)>0)
	set @sql=@sql+'and  like''%'+@ApplyYear+'%''' 
	end
		if(@Money1 is not null)
	begin
	if(LEN(@Money1)>0)
	set @sql=@sql+'and  >= '+@Money1
	end
		if(@Money2 is not null)
	begin
	if(LEN(@Money2)>0)
	set @sql=@sql+'and  <= '+@Money2
	end
		if(@Company is not null)
	begin
	if(LEN(@Company)>0)
	set @sql=@sql+'and   like''%'+@Company+'%''' 
	end
	
		if(@Stand is not null)
	begin
	if(LEN(@Stand)>0)
	set @sql=@sql+'and  like''%'+@Stand+'%''' 
	end
		if(@Ends is not null)
	begin
	if(LEN(@Ends)>0)
	set @sql=@sql+'and  = '''+@Ends+'''' 
	end
	
	exec(@sql)
end
GO
/****** Object:  StoredProcedure [dbo].[Patent_Selects]    Script Date: 12/07/2016 16:56:29 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
/*********************
--: Patent_Selects
--: Patent, 
--: 
UserName,DepartmentId,Year,Month,Status
--: 
	
--:
	0 - 
	-1 -  
**************/
CREATE PROCEDURE [dbo].[Patent_Selects]
@UserName varchar(50),
@DepartmentId varchar(50),
@Year varchar(4),
@Month varchar(2),
@Status varchar(10),
@PatentName varchar(50),
@PatentCateGory varchar(50),
@WinningYear varchar(50)
AS
begin
	declare
	@sql varchar(2000)
	set @sql='select * from PatentView where 1=1  '
	if(@UserName is not null)
	begin
	if(LEN(@UserName)>0)
	set @sql=@sql+'and  like''%'+@UserName+'%''' 
	end
	if(@DepartmentId <>'')
	begin
    set @sql=@sql+' and  like''%'+@DepartmentId+'%'''
	end
	if(@WinningYear is not null)
		if(len(@WinningYear)>0)
	begin
	set @sql=@sql+'and  ='''+@WinningYear+''''
	end
	if(@Year >0)
	begin
	set @sql=@sql+'and datepart(yy,)='+@Year
	end
		if(@Month >0)
	begin
	set @sql=@sql+'and datepart(mm,)='+@Month
	end
	if(@Status is not null)
		if(len(@Status)>0)
	begin
	set @sql=@sql+'and  like''%'+@Status+'%'''
	end
	if(@PatentName is not null)
		if(len(@PatentName)>0)
	begin
	set @sql=@sql+'and  like''%'+@PatentName+'%'''
	end
	if(@PatentCateGory is not null)
		if(len(@PatentCateGory)>0)
	begin
	set @sql=@sql+'and  like''%'+@PatentCateGory+'%'''
	end
	exec(@sql)
end
GO
/****** Object:  StoredProcedure [dbo].[UserRank_SelectByUserCardId]    Script Date: 12/07/2016 16:56:31 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
/******
--: UserRank_SelectByUserCardId
--: UserRank, 
--: 
UserCardId
--: 
	
--:
	0 - 
	-1 -  
******/
CREATE PROCEDURE [dbo].[UserRank_SelectByUserCardId]
@UserCardId varchar(50)
AS
begin

		select a.UserRankId,b.UserName,c.RankName,a.UserCardId,c.RankId
		from  UserRank a,UserInfo b,Rank c
		where  a.RankId=c.RankId and a.UserCardId=b.UserCardId and a.UserCardId=@UserCardId

end
GO
/****** Object:  StoredProcedure [dbo].[LongCapitalPlan_SelectByLongProjectsId]    Script Date: 12/07/2016 16:56:28 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
/******
--: AdminSeries_Select
--: AdminSeries, 
--: 
--: 
	
--:
	0 - 
	-1 -  
******/
CREATE PROCEDURE [dbo].[LongCapitalPlan_SelectByLongProjectsId]
@LongProjectsId varchar(50)
AS
begin

		select a.*,b.ProjectsName,c.UserName
		from LongCapitalPlan a,LongProjects b,UserInfo c
		where a.LongProjectsId=@LongProjectsId and a.LongProjectsId=b.LongProjectsId
		and b.UserCardId=c.UserCardId

end
GO
/****** Object:  StoredProcedure [dbo].[LongCapitalClose_SelectByLongProjectsId]    Script Date: 12/07/2016 16:56:28 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
/******
--: AdminSeries_Select
--: AdminSeries, 
--: 
--: 
	
--:
	0 - 
	-1 -  
******/
CREATE PROCEDURE [dbo].[LongCapitalClose_SelectByLongProjectsId]
@LongProjectsId varchar(50)
AS
begin

		select a.*,b.ProjectsName,c.UserName
		from LongCapitalClose a,LongProjects b,UserInfo c
		where a.LongProjectsId=@LongProjectsId and a.LongProjectsId=b.LongProjectsId
		and b.UserCardId=c.UserCardId

end
GO
/****** Object:  StoredProcedure [dbo].[LongCapitalChange_SelectByLongProjectsId]    Script Date: 12/07/2016 16:56:28 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
/******
--: AdminSeries_Select
--: AdminSeries, 
--: 
--: 
	
--:
	0 - 
	-1 -  
******/
CREATE PROCEDURE [dbo].[LongCapitalChange_SelectByLongProjectsId]
@LongProjectsId varchar(50)
AS
begin

		select a.*,b.ProjectsName,c.UserName
		from LongCapitalChange a,LongProjects b,UserInfo c
		where a.LongProjectsId=@LongProjectsId and a.LongProjectsId=b.LongProjectsId
		and b.UserCardId=c.UserCardId

end
GO
/****** Object:  StoredProcedure [dbo].[PatentPartner_SelectByPatentPartnerId]    Script Date: 12/07/2016 16:56:29 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
/*********************
--: PatentPartner_SelectByPatentId
--: Patent, 
--: 
--: 
	
--:
	0 - 
	-1 -  
**************/
CREATE PROCEDURE [dbo].[PatentPartner_SelectByPatentPartnerId]
	@PatentPartnerId int
	AS
BEGIN
select c.UserName,b.*
from Patent a,PatentPartner b,UserInfo c
where a.PatentId=b.PatentId and b.PatentPartnerId=@PatentPartnerId
and b.PartnerUserCardId=c.UserCardId


END
GO
/****** Object:  StoredProcedure [dbo].[PatentPartner_SelectByPatentId]    Script Date: 12/07/2016 16:56:29 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
/*********************
--: PatentPartner_SelectByPatentId
--: Patent, 
--: 
--: 
	
--:
	0 - 
	-1 -  
**************/
CREATE PROCEDURE [dbo].[PatentPartner_SelectByPatentId]
	@PatentId int
	AS
BEGIN
select c.UserName,b.*
from Patent a,PatentPartner b,UserInfo c
where a.PatentId=b.PatentId and a.PatentId=@PatentId
and b.PartnerUserCardId=c.UserCardId


END
GO
/****** Object:  StoredProcedure [dbo].[PatentPartner_AddValue]    Script Date: 12/07/2016 16:56:29 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
/*******
--: PatentPartner_AddValue
--: Patent, 
--: 
PatentId
--: 
	
--:
	0 - 
	-1 -  
*********/
CREATE PROCEDURE [dbo].[PatentPartner_AddValue]
@PatentId int
AS
begin
	begin tran	
		declare
		@ApplyYearId int,
		@i int,
		@MaxId int
		set @MaxId=(select MAX(PatentPartnerId) from PatentPartner where PatentId=@PatentId)
		set @i=(select MIN(PatentPartnerId) from PatentPartner where PatentId=@PatentId)
		set @ApplyYearId=(select ApplyYearId from Patent where PatentId=@PatentId)
		while(@i<=@MaxId)
		begin
		if exists(select * from PatentPartner where PatentPartnerId=@i and PatentId=@PatentId)
		begin
		declare
		@UserCardId varchar(50),
		@PartnerValue float
		set @UserCardId=(select PartnerUserCardId from PatentPartner where PatentPartnerId=@i)
		set @PartnerValue=(select PartnerValue from PatentPartner where PatentPartnerId=@i)
		exec [dbo].[assessvalue_Update] @UserCardId,@ApplyYearId,@PartnerValue
		end
		set @i=@i+1
		end
		
	   
		if(@@ERROR<>0)
			begin
				rollback
				return -1
			end
	commit tran
	return 0
end
GO
/****** Object:  StoredProcedure [dbo].[ShortCapitalClose_SelectByShortProjectsId]    Script Date: 12/07/2016 16:56:30 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
/******
--: AdminSeries_Select
--: AdminSeries, 
--: 
--: 
	
--:
	0 - 
	-1 -  
******/
CREATE PROCEDURE [dbo].[ShortCapitalClose_SelectByShortProjectsId]
@ShortProjectsId varchar(50)
AS
begin

		select a.*,b.Company,b.ContractId,b.ContractMoney,b.ContractName,c.UserName
		from ShortCapitalClose a,ShortProjects b,UserInfo c
		where a.ShortProjectsId=@ShortProjectsId and a.ShortProjectsId=b.ShortProjectsId
		and b.UserCardId=c.UserCardId

end
GO
/****** Object:  StoredProcedure [dbo].[Right_SelectByRankUserCardId]    Script Date: 12/07/2016 16:56:30 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
/*********************
--: Paper_SelectByUserCardId
--: Paper, 
--: 
  UserCardId
--: 
	
--:
	0 - 
	-1 -  
**************/
CREATE PROCEDURE [dbo].[Right_SelectByRankUserCardId]
	@UserCardId varchar(50),
	@RankId int
	AS
begin
   declare
   @DepartmentId int,
      @TeachersDepartmentId int
   set @DepartmentId=(select UserDepartmentId from UserInfo where UserCardId=@UserCardId)
   set @TeachersDepartmentId=(select TeachersDepartmentId from UserInfo where UserCardId=@UserCardId)
   select(

      select count(*)   from Teaching a 
      where (   a.ProcessDepartmentId=@DepartmentId
   and a.ProcessRoleId= convert( varchar(50),@RankId))
   or (
   a.ProcessDepartmentId=@TeachersDepartmentId
   and a.ProcessRoleId= convert( varchar(50),@RankId))
   ) as TeachingNum,(
      select count(*)   from Winning a 
      where (   a.ProcessDepartmentId=@DepartmentId
   and a.ProcessRoleId= convert( varchar(50),@RankId))
   or (
   a.ProcessDepartmentId=@TeachersDepartmentId
   and a.ProcessRoleId= convert( varchar(50),@RankId))
   ) as WinningNum,(
      select count(*)   from Patent a 
      where (   a.ProcessDepartmentId=@DepartmentId
   and a.ProcessRoleId= convert( varchar(50),@RankId))
   or (
   a.ProcessDepartmentId=@TeachersDepartmentId
   and a.ProcessRoleId= convert( varchar(50),@RankId))
   ) as PatentNum,(
   select count(*)   from Paper a 
      where (   a.ProcessDepartmentId=@DepartmentId
   and a.ProcessRoleId= convert( varchar(50),@RankId))
   or (
   a.ProcessDepartmentId=@TeachersDepartmentId
   and a.ProcessRoleId= convert( varchar(50),@RankId))
   ) as PaperNum,(
      select count(*)   from Guidance a 
      where (   a.ProcessDepartmentId=@DepartmentId
   and a.ProcessRoleId= convert( varchar(50),@RankId))
   or (
   a.ProcessDepartmentId=@TeachersDepartmentId
   and a.ProcessRoleId= convert( varchar(50),@RankId))
   ) as GuidanceNum,(
      select count(*)   from WorkLoadProjects a 
      where (   a.ProcessDepartmentId=@DepartmentId
   and a.ProcessRankId= convert( varchar(50),@RankId))
   or (
   a.ProcessDepartmentId=@TeachersDepartmentId
   and a.ProcessRankId= convert( varchar(50),@RankId))
   ) as WorkLoadProjectsNum,(
      select count(*)   from Harvest a 
      where (   a.ProcessDepartmentId=@DepartmentId
   and a.ProcessRoleId= convert( varchar(50),@RankId))
   or (
   a.ProcessDepartmentId=@TeachersDepartmentId
   and a.ProcessRoleId= convert( varchar(50),@RankId))
   ) as HarvestNum,(

    select count(*)   from  LongProjectsDeclareWaitExamine d  
   where  (  d.ProcessDepartmentId=@DepartmentId
   and d.ProcessRankId=  convert( varchar(50),@RankId)) or (  d.ProcessDepartmentId=@TeachersDepartmentId
   and d.ProcessRankId=  convert( varchar(50),@RankId))
   ) as LongDeclareNum,(
      select count(*)   from  LongProjectsStandWaitExamine d  
   where  (  d.ProcessDepartmentId=@DepartmentId
   and d.ProcessRankId=  convert( varchar(50),@RankId)) or (  d.ProcessDepartmentId=@TeachersDepartmentId
   and d.ProcessRankId=  convert( varchar(50),@RankId))
      ) as LongStandNum,(
      select count(*)   from  LongProjectsInspectWaitExamine d  
   where  (  d.ProcessDepartmentId=@DepartmentId
   and d.ProcessRankId=  convert( varchar(50),@RankId)) or (  d.ProcessDepartmentId=@TeachersDepartmentId
   and d.ProcessRankId=  convert( varchar(50),@RankId))
      ) as LongInspectNum,(
      select count(*)   from  LongProjectsEndWaitExamine d  
   where  (  d.ProcessDepartmentId=@DepartmentId
   and d.ProcessRankId=  convert( varchar(50),@RankId)) or (  d.ProcessDepartmentId=@TeachersDepartmentId
   and d.ProcessRankId=  convert( varchar(50),@RankId))
      ) as LongEndNum,(
   select count(*)   from  ShortProjectsStandWaitExamine d  
   where  (  d.ProcessDepartmentId=@DepartmentId
   and d.ProcessRankId=  convert( varchar(50),@RankId)) or (  d.ProcessDepartmentId=@TeachersDepartmentId
   and d.ProcessRankId=  convert( varchar(50),@RankId))
      ) as ShortStandNum,(
    select count(*)   from  ShortProjectsEndWaitExamine d  
   where  (  d.ProcessDepartmentId=@DepartmentId
   and d.ProcessRankId=  convert( varchar(50),@RankId)) or (  d.ProcessDepartmentId=@TeachersDepartmentId
   and d.ProcessRankId=  convert( varchar(50),@RankId))
      ) as ShortEndNum,(

      select count(*)    from LongCapitalPlanWaitExamine e 
   where   (e.ProcessDepartmentId=@DepartmentId 
   and e.ProcessRankId=convert( varchar(50),@RankId) ) or( e.ProcessDepartmentId=@TeachersDepartmentId 
   and e.ProcessRankId=convert( varchar(50),@RankId) )
      ) as LongPlanNum,(
         select count(*)    from LongCapitalChangeWaitExamine e 
   where   (e.ProcessDepartmentId=@DepartmentId 
   and e.ProcessRankId=convert( varchar(50),@RankId) ) or( e.ProcessDepartmentId=@TeachersDepartmentId 
   and e.ProcessRankId=convert( varchar(50),@RankId) )
     ) as LongChangeNum,(
         select count(*)    from LongCapitalCloseWaitExamine e 
   where   (e.ProcessDepartmentId=@DepartmentId 
   and e.ProcessRankId=convert( varchar(50),@RankId) ) or( e.ProcessDepartmentId=@TeachersDepartmentId 
   and e.ProcessRankId=convert( varchar(50),@RankId) )
     ) as LongCloseNum,(
         select count(*)    from ShortCapitalPlanWaitExamine e 
   where   (e.ProcessDepartmentId=@DepartmentId 
   and e.ProcessRankId=convert( varchar(50),@RankId) ) or( e.ProcessDepartmentId=@TeachersDepartmentId 
   and e.ProcessRankId=convert( varchar(50),@RankId) )
     ) as ShortPlanNum,(
         select count(*)    from ShortCapitalChangeWaitExamine e 
   where   (e.ProcessDepartmentId=@DepartmentId 
   and e.ProcessRankId=convert( varchar(50),@RankId) ) or( e.ProcessDepartmentId=@TeachersDepartmentId 
   and e.ProcessRankId=convert( varchar(50),@RankId) )
     ) as ShortChangeNum,(
         select count(*)    from ShortCapitalCloseWaitExamine e 
   where   (e.ProcessDepartmentId=@DepartmentId 
   and e.ProcessRankId=convert( varchar(50),@RankId) ) or( e.ProcessDepartmentId=@TeachersDepartmentId 
   and e.ProcessRankId=convert( varchar(50),@RankId) )
     ) as ShortCloseNum





    
end
GO
/****** Object:  StoredProcedure [dbo].[ShortCapitalPlace_SelectByShortProjectsId]    Script Date: 12/07/2016 16:56:30 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
/*********************
--: CapitalPlace_SelectByProjectsId
--: CapitalPlace, 
--: 

--: 
	
--:
	0 - 
	-1 -  
**************/
CREATE PROCEDURE [dbo].[ShortCapitalPlace_SelectByShortProjectsId]
@ShortProjectsId varchar(50)
	AS
BEGIN
	select a.*,SUM(b.PlaceMoney) as SumMoney	
	from ShortCapitalPlace a ,ShortCapitalPlace b
	where a.ShortProjectsId= @ShortProjectsId and b.ShortProjectsId=@ShortProjectsId
	group by a.ShortCapitalPlaceId,a.PlaceDate,a.PlaceMoney,a.ShortProjectsId,a.PlaceExplain

END
GO
/****** Object:  StoredProcedure [dbo].[ShortCapitalPlace_SelectByShortCapitalPlaceId]    Script Date: 12/07/2016 16:56:30 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
/*********************
--: CapitalPlace_SelectByCapitalPlaceId
--: CapitalPlace, 
--: 

--: 
	
--:
	0 - 
	-1 -  
**************/
CREATE PROCEDURE [dbo].[ShortCapitalPlace_SelectByShortCapitalPlaceId]
@ShortCapitalPlaceId int
	AS
BEGIN
select * 
	from ShortCapitalPlace 
	where ShortCapitalPlaceId=@ShortCapitalPlaceId


END
GO
/****** Object:  StoredProcedure [dbo].[ShortCapitalPlace_Insert]    Script Date: 12/07/2016 16:56:30 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
/*********************
--: CapitalPlace_Insert
--: CapitalPlace, 
--: 

--: 
	
--:
	0 - 
	-1 -  
**************/
CREATE PROCEDURE [dbo].[ShortCapitalPlace_Insert]
@ShortProjectsId varchar(50),
@PlaceMoney float,
@PlaceDate varchar(50),
@PlaceExplain varchar(100)
AS
begin
	begin tran
	insert into ShortCapitalPlace(
	ShortProjectsId,PlaceMoney,PlaceDate,PlaceExplain)
	values
	(
	@ShortProjectsId,@PlaceMoney,@PlaceDate,@PlaceExplain
	)	
	
	
		if(@@ERROR<>0)
			begin
				rollback
				return -1
			end
	commit tran
	return 0
end
GO
/****** Object:  StoredProcedure [dbo].[ShortCapitalPlace_DeleteByShortProjectsId]    Script Date: 12/07/2016 16:56:30 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
/*********************
--: CapitalPlace_DeleteByProjectsId
--: CapitalPlace, 
--: 
Projects
--: 
	
--:
	0 - 
	-1 -  
**************/
CREATE PROCEDURE [dbo].[ShortCapitalPlace_DeleteByShortProjectsId]
@ShortProjectsId varchar(50)
AS
begin
	begin tran
delete ShortCapitalPlace
where ShortProjectsId=@ShortProjectsId
	
	
		if(@@ERROR<>0)
			begin
				rollback
				return -1
			end
	commit tran
	return 0
end
GO
/****** Object:  StoredProcedure [dbo].[ShortCapitalPlace_Delete]    Script Date: 12/07/2016 16:56:30 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
/*********************
--: CapitalPlace_Delete
--: CapitalPlace, 
--: 
Projects
--: 
	
--:
	0 - 
	-1 -  
**************/
CREATE PROCEDURE [dbo].[ShortCapitalPlace_Delete]
@ShortCapitalPlaceId int
AS
begin
	begin tran
delete ShortCapitalPlace
where ShortCapitalPlaceId=@ShortCapitalPlaceId
	
	
		if(@@ERROR<>0)
			begin
				rollback
				return -1
			end
	commit tran
	return 0
end
GO
/****** Object:  StoredProcedure [dbo].[ShortCapitalCloseProcess_Select]    Script Date: 12/07/2016 16:56:30 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
/*********************
--: ShortCapitalCloseProcess_Select
--: ShortCapitalCloseProcess, 
--: 
--ShortCapitalCloseRoleId
--: 
	
--:
	0 - 
	-1 -  
**************/
CREATE PROCEDURE [dbo].[ShortCapitalCloseProcess_Select]
AS
begin
	 select a.*,b.RankName as ProcessRoleName
  from ShortCapitalCloseProcess a,Rank b
  where   a.ProcessRankId=b.RankId

end
GO
/****** Object:  StoredProcedure [dbo].[ShortProjectsProcess_Select]    Script Date: 12/07/2016 16:56:30 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
/*********************
--: ShortProjectsProcess_Select
--: ShortProjectsProcess, 
--: 
--ShortProjectsRoleId
--: 
	
--:
	0 - 
	-1 -  
**************/
CREATE PROCEDURE [dbo].[ShortProjectsProcess_Select]
AS
begin
	 select a.*,b.RankName as ProcessRoleName
  from ShortProjectsProcess a,Rank b
  where   a.ProcessRankId=b.RankId

end
GO
/****** Object:  StoredProcedure [dbo].[ShortCapitalChangeProcess_Select]    Script Date: 12/07/2016 16:56:30 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
/*********************
--: ShortCapitalChangeProcess_Select
--: ShortCapitalChangeProcess, 
--: 
--ShortCapitalChangeRoleId
--: 
	
--:
	0 - 
	-1 -  
**************/
CREATE PROCEDURE [dbo].[ShortCapitalChangeProcess_Select]
AS
begin
	 select a.*,b.RankName as ProcessRoleName
  from ShortCapitalChangeProcess a,Rank b
  where   a.ProcessRankId=b.RankId

end
GO
/****** Object:  StoredProcedure [dbo].[ShortCapitalClose_UpdateStatus]    Script Date: 12/07/2016 16:56:30 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
/*********************
--: ShortCapitalClose_UpdateStatus
--: ShortCapitalClose, 
--: 
  ShortCapitalCloseId,TransferStatus,ProcessRoleId
--: 
	
--:
	0 - 
	-1 -  
**************/
CREATE PROCEDURE [dbo].[ShortCapitalClose_UpdateStatus]
@ShortProjectsId varchar(50),
@TransferStatus varchar(20),
@ProcessRankId varchar(20),
@ProcessDepartmentId int
AS
begin
	begin tran
	
	update ShortCapitalClose set 
TransferStatus=@TransferStatus
	where ShortProjectsId=@ShortProjectsId 
	if not exists(  select * from ShortCapitalCloseWaitExamine where ShortProjectsId=@ShortProjectsId)
	begin
	insert into ShortCapitalCloseWaitExamine 
	(ShortProjectsId,ProcessDepartmentId,ProcessRankId)
	values
	(@ShortProjectsId,@ProcessDepartmentId,@ProcessRankId)
	end
	else
	begin
	update ShortCapitalClosewaitExamine
	set ProcessDepartmentId=@ProcessDepartmentId,
	ProcessRankId=@ProcessRankId
	where ShortProjectsId=@ShortProjectsId
	end
		if(@@ERROR<>0)
			begin
				rollback
				return -1
			end
	commit tran
	return 0
end
GO
/****** Object:  StoredProcedure [dbo].[ProjectsSubject_SelectByProjectsSubjectId]    Script Date: 12/07/2016 16:56:29 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
/******
--: ProjectsFrom_SelectByProjectsFromId
--: ProjectsFrom, 
--: 
ProjectsFromId
--: 
	
--:
	0 - 
	-1 -  
******/
CREATE PROCEDURE [dbo].[ProjectsSubject_SelectByProjectsSubjectId]
@ProjectsSubjectId int
AS
begin

		select * from   ProjectsSubject where ProjectsSubjectId=@ProjectsSubjectId

end
GO
/****** Object:  StoredProcedure [dbo].[ProjectsSubject_Select]    Script Date: 12/07/2016 16:56:29 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
/******
--: ProjectsFrom_Select
--: ProjectsFromProjectsFrom 
--: 
--: 
	
--:
	0 - 
	-1 -  
******/
CREATE PROCEDURE [dbo].[ProjectsSubject_Select]

AS
begin

		select * from ProjectsSubject
		order by ProjectsSubjectId  
end
GO
/****** Object:  StoredProcedure [dbo].[LongCapitalCloseProcess_Select]    Script Date: 12/07/2016 16:56:28 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
/*********************
--: LongCapitalCloseProcess_Select
--: LongCapitalCloseProcess, 
--: 
--LongCapitalCloseRoleId
--: 
	
--:
	0 - 
	-1 -  
**************/
CREATE PROCEDURE [dbo].[LongCapitalCloseProcess_Select]
AS
begin
	 select a.*,b.RankName as ProcessRoleName
  from LongCapitalCloseProcess a,Rank b
  where   a.ProcessRankId=b.RankId

end
GO
/****** Object:  StoredProcedure [dbo].[Journal_Insert]    Script Date: 12/07/2016 16:56:28 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
/*********************
--: Journal_Insert
--: Journal, 
--: 

--: 
	
--:
	0 - 
	-1 -  
**************/
CREATE PROCEDURE [dbo].[Journal_Insert]
@UserCardId varchar(50),
@Position varchar(50),
@Events varchar(50)
AS
begin
	begin tran
	 insert into Journal (
		UserCardId,FollDate,Position,Events
	 )
	 values(
	 @UserCardId,GETDATE(),@Position,@Events
	 )
		if(@@ERROR<>0)
			begin
				rollback
				return -1
			end
	commit tran
	return 0
end
GO
/****** Object:  StoredProcedure [dbo].[UserInfo_Insert]    Script Date: 12/07/2016 16:56:30 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
/*********
--: UserInfo_Insert
--: UserInfo, 
--: 
--UserCardId,UserPwd,UserName,UserJobId,UserRoleId,UserDepartment,PhoneId,EmailId,UserPostId,UserDegreeId,UserIdCard
--UserPolitacalId,UserNationId,UserStatusId,UserEducation,UserIntroDucation,UserGender,StartWorkDate,BirthDay
--Origin,Address,MarriageResumeId
--: 
	
--:
	0 - 
	-1 -  
**********/
CREATE PROCEDURE [dbo].[UserInfo_Insert]
@UserCardId varchar(50),
@UserPwd varchar(160),
@UserName varchar(50),
@UserDepartmentId int,
@UserCardId2 varchar(50)
AS
begin
	begin tran
	insert into UserInfo(
UserCardId ,
UserPwd ,
UserName ,
UserDepartmentId
	)values(
@UserCardId ,
@UserPwd ,
@UserName ,
@UserDepartmentId

	)

	exec [dbo].[Journal_Insert] @UserCardId2,'',@UserCardId
		if(@@ERROR<>0)
			begin
				rollback
				return -1
			end
	commit tran
	return 0
end
GO
/****** Object:  StoredProcedure [dbo].[ShortCapitalCloseExamine_Insert]    Script Date: 12/07/2016 16:56:30 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
/*********************
--: ShortCapitalCloseExamine_Insert
--: QuitExamine, 
--: 
ShortProjectsId,ExamineOpinion,ExamineUserCardId,ExamineResult
--: 
	
--:
	0 - 
	-1 -  
**************/
CREATE PROCEDURE [dbo].[ShortCapitalCloseExamine_Insert]
@ShortProjectsId varchar(50),
@ExamineOpinion varchar(400),
@ExamineUserCardId varchar(50),
@ExamineResult varchar(50),
@RankId int
AS
begin
	begin tran
	declare
	@DepartmentId int,
	@TeachersDepartmentId int,
	@ProcessOrder int,
	@UserCardId varchar(50),
	@OrderRoleId int,
	@OrderDepartmentId int
	set @DepartmentId=(select UserDepartmentId from UserInfo where UserCardId=@ExamineUserCardId)
	set @TeachersDepartmentId=(select TeachersDepartmentId from UserInfo where UserCardId=@ExamineUserCardId)
	set @UserCardId =(select UserCardId from ShortCapitalClose where ShortProjectsId=@ShortProjectsId)
    if exists(select * from ShortCapitalCloseExamine where ShortProjectsId=@ShortProjectsId)
 begin
  set @ProcessOrder=(select MAX(ExamineNumber) from ShortCapitalCloseExamine where ShortProjectsId=@ShortProjectsId)+1  --
 end
 else
 begin
 set @ProcessOrder=1
 end
   	if exists(select * from ShortCapitalCloseWaitExamine where (ProcessDepartmentId=@DepartmentId and ProcessRankId=@RankId and ShortProjectsId=@ShortProjectsId) or (ProcessDepartmentId=@TeachersDepartmentId and ProcessRankId=@RankId and ShortProjectsId=@ShortProjectsId))
	begin

insert into ShortCapitalCloseExamine
(ShortProjectsId,ExamineOpinion,ExamineUserCardId,ExamineDate,ExamineNumber,ExamineResult)values
(@ShortProjectsId,@ExamineOpinion,@ExamineUserCardId,GETDATE(),@ProcessOrder,@ExamineResult)
	exec [dbo].[Journal_Insert] @ExamineUserCardId,'',''
if(@ExamineResult='')
begin
if exists(select * from ShortCapitalCloseAuditProcess where ShortProjectsId=@ShortProjectsId and ProcessOrder=@ProcessOrder+1)
begin
set @OrderRoleId =(select ProcessRankId from ShortCapitalCloseAuditProcess where ShortProjectsId=@ShortProjectsId and ProcessOrder=@ProcessOrder+1)
set @OrderDepartmentId= (select ProcessDepartmentId from ShortCapitalCloseAuditProcess where ShortProjectsId=@ShortProjectsId and ProcessOrder=@ProcessOrder+1)
exec [dbo].[ShortCapitalClose_UpdateStatus] @ShortProjectsId,'',@OrderRoleId,@OrderDepartmentId
end 
else
begin
exec[dbo].[ShortCapitalClose_UpdateStatus] @ShortProjectsId,@ExamineResult,0,0
delete ShortCapitalCloseWaitExamine
where ShortProjectsId=@ShortProjectsId  --
end
end
else
begin
exec[dbo].[ShortCapitalClose_UpdateStatus] @ShortProjectsId,@ExamineResult,0,0
delete ShortCapitalCloseWaitExamine
where ShortProjectsId=@ShortProjectsId  --
end
end
		if(@@ERROR<>0)
			begin
				rollback
				return -1
			end
	commit tran
	return 0
end
GO
/****** Object:  StoredProcedure [dbo].[Post_Update]    Script Date: 12/07/2016 16:56:29 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
/*******
--: Post_Update
--: Post, 
--: 
PostId,PostName,PlanPeople,PostValue
--: 
	
--:
	0 - 
	-1 -  
*********/
CREATE PROCEDURE [dbo].[Post_Update]
@PostId int,
@PostName varchar(50),
@PlanPeople varchar(50),
@UserCardId varchar(50)
AS
begin
	begin tran
		if not exists(select * from Post where PostId<>@PostId and PostName=@PostName)
		begin
		update Post set PostName=@PostName,PlanPeople=@PlanPeople where PostId=@PostId
			exec [dbo].[Journal_Insert] @UserCardId,'',''
		end
		if(@@ERROR<>0)
			begin
				rollback
				return -1
			end
	commit tran
	return 0
end
GO
/****** Object:  StoredProcedure [dbo].[Post_Insert]    Script Date: 12/07/2016 16:56:29 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
/*********************
--: Post_Insert
--: Post, 
--: 
   PostName,PlanPeople,PostValue
--: 
	
--:
	0 - 
	-1 -  
**************/
CREATE PROCEDURE [dbo].[Post_Insert]
@PostName varchar(50),
@PlanPeople varchar(50),
@UserCardId varchar(50)
AS
begin
	begin tran
	insert into Post(
	PostName,PlanPeople
	)values(
	@PostName,@PlanPeople
	)
		exec [dbo].[Journal_Insert] @UserCardId,'',''
		if(@@ERROR<>0)
			begin
				rollback
				return -1
			end
	commit tran
	return 0
end
GO
/****** Object:  StoredProcedure [dbo].[Post_Delete]    Script Date: 12/07/2016 16:56:29 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
/*******
--: Post_Delete
--: Post, 
--: 
PostId
--: 
	
--:
	0 - 
	-1 -  
*********/
CREATE PROCEDURE [dbo].[Post_Delete]
@PostId int,
@UserCardId varchar(50)
AS
begin
	begin tran
		delete Post where PostId=@PostId
		exec [dbo].[Journal_Insert] @UserCardId,'',''
		if(@@ERROR<>0)
			begin
				rollback
				return -1
			end
	commit tran
	return 0
end
GO
/****** Object:  StoredProcedure [dbo].[Political_Update]    Script Date: 12/07/2016 16:56:29 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
/*******
--: Political_Update
--: Political, 
--: 
PoliticalId,PoliticalName
--: 
	
--:
	0 - 
	-1 -  
*********/
CREATE PROCEDURE [dbo].[Political_Update]
@PoliticalId int,
@PoliticalName varchar(50),
@UserCardId varchar(50)
AS
begin
	begin tran
	if not exists(select * from Political where PoliticalId<>@PoliticalId and PoliticalName=@PoliticalName)
	begin
		update Political set PoliticalName=@PoliticalName where PoliticalId=@PoliticalId
		exec [dbo].[Journal_Insert] @UserCardId,'',''
		end
		if(@@ERROR<>0)
			begin
				rollback
				return -1
			end
	commit tran
	return 0
end
GO
/****** Object:  StoredProcedure [dbo].[Political_Insert]    Script Date: 12/07/2016 16:56:29 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
/*********************
--: Political_Insert
--: Political, 
--: 
   PoliticalName
--: 
	
--:
	0 - 
	-1 -  
**************/
CREATE PROCEDURE [dbo].[Political_Insert]
@PoliticalName varchar(50),
@UserCardId varchar(50)
AS
begin
	begin tran
	insert into Political(
	PoliticalName
	)values(
	@PoliticalName
	)
	exec [dbo].[Journal_Insert] @UserCardId,'',''
		if(@@ERROR<>0)
			begin
				rollback
				return -1
			end
	commit tran
	return 0
end
GO
/****** Object:  StoredProcedure [dbo].[ProjectsTemplate_Update]    Script Date: 12/07/2016 16:56:30 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
-- =============================================
-- Author:		<Author,,Name>
-- Create date: <Create Date,,>
-- Description:	<Description,,>
-- =============================================
CREATE PROCEDURE [dbo].[ProjectsTemplate_Update]
@TemplateId int,
@Category varchar(50),
@TemplateName varchar(50),
@FileUrl text
AS
begin
	update ProjectsTemplate
	set  Category=@Category,
	TemplateName=@TemplateName,
	FileUrl=@FileUrl
	where TemplateId=@TemplateId
	if(@@ERROR<>0)
	begin
	  rollback 
	  return -1
	end
	else
	begin
	 return 0
	end
  end
GO
/****** Object:  StoredProcedure [dbo].[ProjectsTemplate_SelectByTemplateId]    Script Date: 12/07/2016 16:56:30 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
-- =============================================
-- Author:		<Author,,Name>
-- Create date: <Create Date,,>
-- Description:	<Description,,>
-- =============================================
CREATE PROCEDURE [dbo].[ProjectsTemplate_SelectByTemplateId]
@TemplateId int
AS
begin

select *
from ProjectsTemplate
where TemplateId=@TemplateId


  end
GO
/****** Object:  StoredProcedure [dbo].[ProjectsTemplate_SelectByCategory]    Script Date: 12/07/2016 16:56:30 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
-- =============================================
-- Author:		<Author,,Name>
-- Create date: <Create Date,,>
-- Description:	<Description,,>
-- =============================================
CREATE PROCEDURE [dbo].[ProjectsTemplate_SelectByCategory]
@Category varchar(50)
AS
begin

select *
from ProjectsTemplate
where Category=@Category


  end
GO
/****** Object:  StoredProcedure [dbo].[ProjectsTemplate_Select]    Script Date: 12/07/2016 16:56:30 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
-- =============================================
-- Author:		<Author,,Name>
-- Create date: <Create Date,,>
-- Description:	<Description,,>
-- =============================================
CREATE PROCEDURE [dbo].[ProjectsTemplate_Select]
AS
begin

select *
from ProjectsTemplate


  end
GO
/****** Object:  StoredProcedure [dbo].[ShortProjects_UpdateStandStatus]    Script Date: 12/07/2016 16:56:30 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
/*********************
--: ShortProjects_UpdateStatus
--: ShortProjects, 
--
--: 
  ShortProjectsId,TransferStatus,ProcessRoleId
--: 
	
--:
	0 - 
	-1 -  
**************/
CREATE PROCEDURE [dbo].[ShortProjects_UpdateStandStatus]
@ShortProjectsId varchar(50),
@TransferStatus varchar(20),
@ProcessRankId varchar(20),
@ProcessDepartmentId int
AS
begin
	begin tran
	
	update ShortProjects set 
	StandStatus=@TransferStatus 
	where ShortProjectsId=@ShortProjectsId  --
	if exists( select * from ShortProjectsStandWaitExamine where ShortProjectsId=@ShortProjectsId)
	begin
	update ShortProjectsStandWaitExamine
	set ProcessRankId=@ProcessRankId,
	ProcessDepartmentId=@ProcessDepartmentId
	where ShortProjectsId=@ShortProjectsId --
	end
	else
	begin
	insert into ShortProjectsStandWaitExamine
	(ShortProjectsId,ProcessRankId,ProcessDepartmentId)
	values
	(@ShortProjectsId,@ProcessRankId,@ProcessDepartmentId)
	end
	
		if(@@ERROR<>0)
			begin
				rollback
				return -1
			end
	commit tran
	return 0
end
GO
/****** Object:  StoredProcedure [dbo].[ShortProjectsStandExamine_Insert]    Script Date: 12/07/2016 16:56:30 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
/*********************
--: ShortProjectsStandExamine_Insert
--:  ShortProjectsStandExamine, 
--
--: 
ShortProjectsId,ExamineOpinion,ExamineUserCardId,ExamineResult
--: 
	
--:
	0 - 
	-1 -  
**************/
CREATE PROCEDURE [dbo].[ShortProjectsStandExamine_Insert]
@ShortProjectsId varchar(50),
@ExamineOpinion varchar(400),
@ExamineUserCardId varchar(50),
@ExamineResult varchar(50),
@RankId int
AS
begin
	begin tran
	declare
	@DepartmentId int,--
	@TeachersDepartmentId int,
	@ProcessOrder int,--
	@UserCardId varchar(50),--
	@OrderRoleId int,--
	@OrderDepartmentId int--
	set @DepartmentId=(select UserDepartmentId from UserInfo where UserCardId=@ExamineUserCardId) --
	set @TeachersDepartmentId=(select TeachersDepartmentId from UserInfo where UserCardId=@ExamineUserCardId)
	set @UserCardId =(select UserCardId from ShortProjects where ShortProjectsId=@ShortProjectsId)--
    if exists(select * from ShortProjectsStandExamine where ShortProjectsId=@ShortProjectsId)--
 begin
 --+1
  set @ProcessOrder=(select MAX(ExamineNumber) from ShortProjectsStandExamine where ShortProjectsId=@ShortProjectsId)+1  --
 end
 else
 begin
 --1
 set @ProcessOrder=1
 end
 --
 	if exists(select * from ShortProjects a,ShortProjectsStandWaitExamine b where (b.ProcessDepartmentId=@DepartmentId and b.ProcessRankId=@RankId and a.ShortProjectsId=@ShortProjectsId and a.ShortProjectsId=b.ShortProjectsId) or (b.ProcessDepartmentId=@TeachersDepartmentId and b.ProcessRankId=@RankId and a.ShortProjectsId=@ShortProjectsId and a.ShortProjectsId=b.ShortProjectsId))
	begin
	--
insert into ShortProjectsStandExamine
(ShortProjectsId,ExamineOpinion,ExamineUserCardId,ExamineDate,ExamineNumber,ExamineResult)values
(@ShortProjectsId,@ExamineOpinion,@ExamineUserCardId,GETDATE(),@ProcessOrder,@ExamineResult)

	exec [dbo].[Journal_Insert] @ExamineUserCardId,'',''--
if(@ExamineResult='')--
begin

if exists(select * from ShortProjectsStandAuditProcess where ShortProjectsId=@ShortProjectsId and ProcessOrder=@ProcessOrder+1)--
begin
set @OrderRoleId =(select ProcessRankId from ShortProjectsStandAuditProcess where ShortProjectsId=@ShortProjectsId and ProcessOrder=@ProcessOrder+1) --
set @OrderDepartmentId= (select ProcessDepartmentId from ShortProjectsStandAuditProcess where ShortProjectsId=@ShortProjectsId and ProcessOrder=@ProcessOrder+1)--
exec [dbo].[ShortProjects_UpdateStandStatus] @ShortProjectsId,'',@OrderRoleId,@OrderDepartmentId--
end 
else
begin
exec[dbo].[ShortProjects_UpdateStandStatus] @ShortProjectsId,@ExamineResult,'0',0--
delete ShortProjectsStandWaitExamine
where ShortProjectsId=@ShortProjectsId  --
end
end
else
begin
exec[dbo].[ShortProjects_UpdateStandStatus] @ShortProjectsId,@ExamineResult,'0',0--
delete ShortProjectsStandWaitExamine
where ShortProjectsId=@ShortProjectsId  --
end
end
		if(@@ERROR<>0)
			begin
				rollback
				return -1
			end
	commit tran
	return 0
end
GO
/****** Object:  StoredProcedure [dbo].[ShortProjects_UpdateEndStatus]    Script Date: 12/07/2016 16:56:30 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
/*********************
--: ShortProjects_UpdateStatus
--: ShortProjects, 
--
--: 
  ShortProjectsId,TransferStatus,ProcessRoleId
--: 
	
--:
	0 - 
	-1 -  
**************/
CREATE PROCEDURE [dbo].[ShortProjects_UpdateEndStatus]
@ShortProjectsId varchar(50),
@TransferStatus varchar(20),
@ProcessRankId varchar(20),
@ProcessDepartmentId int
AS
begin
	begin tran
	
	update ShortProjects set 
	EndStatus=@TransferStatus 
	where ShortProjectsId=@ShortProjectsId  --
		if exists( select * from ShortProjectsEndWaitExamine where ShortProjectsId=@ShortProjectsId)
	begin
	update ShortProjectsEndWaitExamine
	set ProcessRankId=@ProcessRankId,
	ProcessDepartmentId=@ProcessDepartmentId
	where ShortProjectsId=@ShortProjectsId --
	end
	else
	begin
	insert into ShortProjectsEndWaitExamine
	(ShortProjectsId,ProcessRankId,ProcessDepartmentId)
	values
	(@ShortProjectsId,@ProcessRankId,@ProcessDepartmentId)
	end
	
		if(@@ERROR<>0)
			begin
				rollback
				return -1
			end
	commit tran
	return 0
end
GO
/****** Object:  StoredProcedure [dbo].[ShortProjectsEndExamine_Insert]    Script Date: 12/07/2016 16:56:30 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
/*********************
--: ShortProjectsEndExamine_Insert
--:  ShortProjectsEndExamine, 
--
--: 
ShortProjectsId,ExamineOpinion,ExamineUserCardId,ExamineResult
--: 
	
--:
	0 - 
	-1 -  
**************/
CREATE PROCEDURE [dbo].[ShortProjectsEndExamine_Insert]
@ShortProjectsId varchar(50),
@ExamineOpinion varchar(400),
@ExamineUserCardId varchar(50),
@ExamineResult varchar(50),
@RankId int
AS
begin
	begin tran
	declare
	@DepartmentId int,--
	@TeachersDepartmentId int,
	@ProcessOrder int,--
	@UserCardId varchar(50),--
	@OrderRoleId int,--
	@OrderDepartmentId int--
	set @DepartmentId=(select UserDepartmentId from UserInfo where UserCardId=@ExamineUserCardId) --
	set @TeachersDepartmentId=(select TeachersDepartmentId from UserInfo where UserCardId=@ExamineUserCardId)
	set @UserCardId =(select UserCardId from ShortProjects where ShortProjectsId=@ShortProjectsId)--
    if exists(select * from ShortProjectsEndExamine where ShortProjectsId=@ShortProjectsId)--
 begin
 --+1
  set @ProcessOrder=(select MAX(ExamineNumber) from ShortProjectsEndExamine where ShortProjectsId=@ShortProjectsId)+1  --
 end
 else
 begin
 --1
 set @ProcessOrder=1
 end
 --
  	if exists(select * from ShortProjects a,ShortProjectsEndWaitExamine b where (b.ProcessDepartmentId=@DepartmentId and b.ProcessRankId=@RankId and a.ShortProjectsId=@ShortProjectsId and a.ShortProjectsId=b.ShortProjectsId) or (b.ProcessDepartmentId=@TeachersDepartmentId and b.ProcessRankId=@RankId and a.ShortProjectsId=@ShortProjectsId and a.ShortProjectsId=b.ShortProjectsId))
	begin
	--
insert into ShortProjectsEndExamine
(ShortProjectsId,ExamineOpinion,ExamineUserCardId,ExamineDate,ExamineNumber,ExamineResult)values
(@ShortProjectsId,@ExamineOpinion,@ExamineUserCardId,GETDATE(),@ProcessOrder,@ExamineResult)

	exec [dbo].[Journal_Insert] @ExamineUserCardId,'',''--
if(@ExamineResult='')--
begin

if exists(select * from ShortProjectsEndAuditProcess where ShortProjectsId=@ShortProjectsId and ProcessOrder=@ProcessOrder+1)--
begin
set @OrderRoleId =(select ProcessRankId from ShortProjectsEndAuditProcess where ShortProjectsId=@ShortProjectsId and ProcessOrder=@ProcessOrder+1) --
set @OrderDepartmentId= (select ProcessDepartmentId from ShortProjectsEndAuditProcess where ShortProjectsId=@ShortProjectsId and ProcessOrder=@ProcessOrder+1)--
exec [dbo].[ShortProjects_UpdateEndStatus] @ShortProjectsId,'',@OrderRoleId,@OrderDepartmentId--
end 
else
begin
exec[dbo].[ShortProjects_UpdateEndStatus] @ShortProjectsId,@ExamineResult,0,0--
delete ShortProjectsEndWaitExamine
where ShortProjectsId=@ShortProjectsId  --
end
end
else
begin
exec[dbo].[ShortProjects_UpdateEndStatus] @ShortProjectsId,@ExamineResult,0,0--
delete ShortProjectsEndWaitExamine
where ShortProjectsId=@ShortProjectsId  --
end
end
		if(@@ERROR<>0)
			begin
				rollback
				return -1
			end
	commit tran
	return 0
end
GO
/****** Object:  StoredProcedure [dbo].[ShortProjects_SelectEndUserCardId]    Script Date: 12/07/2016 16:56:30 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
/*********************
--: ShortProjects_SelectByUserCardId
--: ShortProjects, 
--
--: 
  UserCardId
--: 
	
--:
	0 - 
	-1 -  
**************/
CREATE PROCEDURE [dbo].[ShortProjects_SelectEndUserCardId]
@UserCardId varchar(50)
	AS
begin
  
  select *
  from ShortProjects 
  where  EndStatus<>''
  and UserCardId=@UserCardId
    order by ShortprojectsId desc


    
end
GO
/****** Object:  StoredProcedure [dbo].[ShortProjects_SelectByMyUserCardId]    Script Date: 12/07/2016 16:56:30 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
/*********************
--: LongProjects_SelectByUserCardId
--: LongProjects, 
--
--: 
  UserCardId
--: 
	
--:
	0 - 
	-1 -  
**************/
CREATE PROCEDURE [dbo].[ShortProjects_SelectByMyUserCardId]
	@UserCardId varchar(50)
	AS
begin
  
  select a.*
  from ShortProjects a
  where UserCardId=@UserCardId 
    order by a.ShortProjectsId desc
end
GO
/****** Object:  StoredProcedure [dbo].[ShortCapitalPlace_Update]    Script Date: 12/07/2016 16:56:30 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
/*********************
--: CapitalPlace_Update
--: CapitalPlace, 
--: 
 
--: 
	
--:
	0 - 
	-1 -  
**************/
CREATE PROCEDURE [dbo].[ShortCapitalPlace_Update]
@ShortCapitalPlaceId int,
@PlaceMoney float,
@PlaceDate date,
@PlaceExplain varchar(100)

AS
begin
	begin tran
	update ShortCapitalPlace
	set 
	PlaceMoney=@PlaceMoney,
	PlaceDate=@PlaceDate,
	PlaceExplain=@PlaceExplain
	where ShortCapitalPlaceId=@ShortCapitalPlaceId
		if(@@ERROR<>0)
			begin
				rollback
				return -1
			end
	commit tran
	return 0
end
GO
/****** Object:  StoredProcedure [dbo].[ShortCapitalClose_SelectByMyUserCardId]    Script Date: 12/07/2016 16:56:30 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
/*********************
--: ShortCapitalClose_SelectByUserCardId
--: ShortCapitalClose, 
--: 
  UserCardId
--: 
	
--:
	0 - 
	-1 -  
**************/
CREATE PROCEDURE [dbo].[ShortCapitalClose_SelectByMyUserCardId]
	@UserCardId varchar(50)
	AS
begin
   
	select a.Company,a.ContractId,a.ContractMoney,a.ContractName,b.*,d.TransferStatus
	from ShortProjects a ,ShortCapitalBasic b ,ShortCapitalPlan c left join ShortCapitalClose d on c.ShortProjectsId=d.ShortProjectsId
	where a.ShortProjectsId=b.ShortProjectsId
	and b.ShortProjectsId=c.ShortProjectsId
	and c.TransferStatus=''
  and  a.UserCardId=@UserCardId
  order by ShortProjectsId desc
  
    
end
GO
/****** Object:  StoredProcedure [dbo].[ShortCapitalPlan_SelectByMyUserCardId]    Script Date: 12/07/2016 16:56:30 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
/*********************
--: ShortCapitalPlan_SelectByUserCardId
--: ShortCapitalPlan, 
--: 
  UserCardId
--: 
	
--:
	0 - 
	-1 -  
**************/
CREATE PROCEDURE [dbo].[ShortCapitalPlan_SelectByMyUserCardId]
	@UserCardId varchar(50)
	AS
begin
   
select a.Company,a.ContractId,a.ContractMoney,a.ContractName,b.*,c.TransferStatus
from ShortProjects a ,ShortCapitalBasic b left join  ShortCapitalPlan c on b.ShortProjectsId=c.ShortProjectsId
where a.ShortProjectsId=b.ShortProjectsId
  and  a.UserCardId=@UserCardId 
  order by ShortProjectsId desc
  
    
end
GO
/****** Object:  StoredProcedure [dbo].[TeachingPartner_UpdateTeachingId]    Script Date: 12/07/2016 16:56:30 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
/*********************
--: TeachingPartner_UpdateTeachingId
--: TeachingPartnerd, 
--: 


--: 
	
--:
	0 - 
	-1 -  
**************/
CREATE PROCEDURE [dbo].[TeachingPartner_UpdateTeachingId]
	@TeachingId int,
	@UserCardId varchar(50),
	@PartnerRank int,
	@PartnerValue float
AS
begin
	begin tran
 declare @sum float,
    @TeachingValue float,
    @UserValue float
 
    set @UserValue=(select PartnerValue from TeachingPartner where TeachingId=@TeachingId and PartnerUserCardId=@UserCardId)
    set @sum=(select SUM(PartnerValue) from TeachingPartner where TeachingId=@TeachingId)
    set @TeachingValue=(select TeachingValue from Teaching where TeachingId=@TeachingId)
    if(@sum-@UserValue+@PartnerValue<=@TeachingValue)
    begin
		update TeachingPartner set
		PartnerRank=@PartnerRank,
		PartnerValue=@PartnerValue,
		PartnerUserCardId=@UserCardId
		where TeachingId=@TeachingId and 	PartnerUserCardId=@UserCardId
end

		if(@@ERROR<>0)
			begin
				rollback
				return -1
			end
	commit tran
	return 0
end
GO
/****** Object:  StoredProcedure [dbo].[CapitalItem_SelectByCapitalItemId]    Script Date: 12/07/2016 16:56:27 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
/******
--: CapitalItem_SelectByCapitalItemId
--: CapitalItem, 
--: 
CapitalItemId
--: 
	
--:
	0 - 
	-1 -  
******/
CREATE PROCEDURE [dbo].[CapitalItem_SelectByCapitalItemId]
@CapitalItemId int
AS
begin

		select * from   CapitalItem where CapitalItemId=@CapitalItemId

end
GO
/****** Object:  StoredProcedure [dbo].[WinningPartner_UpdateWinningId]    Script Date: 12/07/2016 16:56:31 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
/*********************
--: WinningPartner_UpdateWinningId
--: WinningPartner, 
--: 


--: 
	
--:
	0 - 
	-1 -  
**************/
CREATE PROCEDURE [dbo].[WinningPartner_UpdateWinningId]
	@WinningId int,
	@UserCardId varchar(50),
	@PartnerRank int,
	@PartnerValue float
AS
begin
	begin tran
 declare @sum float,
    @WinningValue float,
    @UserValue float
 
    set @UserValue=(select PartnerValue from WinningPartner where WinningId=@WinningId and PartnerUserCardId=@UserCardId)
    set @sum=(select SUM(PartnerValue) from WinningPartner where WinningId=@WinningId)
    set @WinningValue=(select WinningValue from Winning where WinningId=@WinningId)
    if(@sum-@UserValue+@PartnerValue<=@WinningValue)
    begin
		update WinningPartner set
		PartnerRank=@PartnerRank,
		PartnerValue=@PartnerValue,
		PartnerUserCardId=@UserCardId
		where WinningId=@WinningId and 	PartnerUserCardId=@UserCardId
end

		if(@@ERROR<>0)
			begin
				rollback
				return -1
			end
	commit tran
	return 0
end
GO
/****** Object:  StoredProcedure [dbo].[WinningProcess_Select]    Script Date: 12/07/2016 16:56:31 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
/*********************
--: WinningProcess_Select
--: WinningProcess, 
--: 
--WinningRoleId
--: 
	
--:
	0 - 
	-1 -  
**************/
CREATE PROCEDURE [dbo].[WinningProcess_Select]
AS
begin
	 select a.*,b.RankName as ProcessRoleName
  from WinningProcess a,Rank b
  where   a.ProcessRankId=b.RankId

end
GO
/****** Object:  StoredProcedure [dbo].[TeachingProcess_Select]    Script Date: 12/07/2016 16:56:30 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
/*********************
--: TeachingProcess_Select
--: TeachingProcess, 
--: 
--TeachingRoleId
--: 
	
--:
	0 - 
	-1 -  
**************/
CREATE PROCEDURE [dbo].[TeachingProcess_Select]
AS
begin
	 select a.*,b.RankName as ProcessRoleName
  from TeachingProcess a,Rank b
  where   a.ProcessRankId=b.RankId

end
GO
/****** Object:  StoredProcedure [dbo].[WorkLoadProjectsPartner_UpdateWorkLoadProjectsId]    Script Date: 12/07/2016 16:56:31 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
/*********************
--:WorkLoadProjectsPartner_UpdateWorkLoadProjectsId
--: WorkLoadProjectsPartner, 
--: 


--: 
	
--:
	0 - 
	-1 -  
**************/
CREATE PROCEDURE [dbo].[WorkLoadProjectsPartner_UpdateWorkLoadProjectsId]
	@WorkLoadProjectsId int,
	@UserCardId varchar(50),
	@PartnerRank int,
	@PartnerValue float
AS
begin
	begin tran
 declare @sum float,
    @WorkLoadProjectsValue float,
    @UserValue float
 
    set @UserValue=(select PartnerValue from WorkLoadProjectsPartner where WorkLoadProjectsId=@WorkLoadProjectsId and PartnerUserCardId=@UserCardId)
    set @sum=(select SUM(PartnerValue) from WorkLoadProjectsPartner where WorkLoadProjectsId=@WorkLoadProjectsId)
    set @WorkLoadProjectsValue=(select ProjectsValue from WorkLoadProjects where WorkLoadProjectsId=@WorkLoadProjectsId)
    if(@sum-@UserValue+@PartnerValue<=@WorkLoadProjectsValue)
    begin
		update WorkLoadProjectsPartner set
		PartnerRank=@PartnerRank,
		PartnerValue=@PartnerValue,
		PartnerUserCardId=@UserCardId
		where WorkLoadProjectsId=@WorkLoadProjectsId and 	PartnerUserCardId=@UserCardId
end

		if(@@ERROR<>0)
			begin
				rollback
				return -1
			end
	commit tran
	return 0
end
GO
/****** Object:  StoredProcedure [dbo].[Model_SelectModelSum]    Script Date: 12/07/2016 16:56:29 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
/******
--: Model_SelectByModelSum
--: Model, 
--: 
ModelId
--: 
 @UserNationSum
--:
	0 - 
	-1 -  
******/
CREATE PROCEDURE [dbo].[Model_SelectModelSum]
@ModelId int,
  @ModelSum    int output
AS
begin
 if exists(select * from Model where ModelFatherId=@ModelId)
   begin 
    set @ModelSum=(select count(ModelId) from Model where ModelFatherId=@ModelId)
    end
    else
    begin
      set @ModelSum=0
    end
end
GO
/****** Object:  StoredProcedure [dbo].[Model_SelectByModelId]    Script Date: 12/07/2016 16:56:29 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
/******
--: Model_SelectByModelId
--: Model, 
--: 
ModelId
--: 
	
--:
	0 - 
	-1 -  
******/
CREATE PROCEDURE [dbo].[Model_SelectByModelId]
@ModelId int
AS
begin

		select * from Model where ModelId=@ModelId

end
GO
/****** Object:  StoredProcedure [dbo].[Model_SelectByModelFatherId]    Script Date: 12/07/2016 16:56:29 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
/******
--: Model_SelectByModelId
--: Model, 
--: 
ModelFatherId
--: 
	
--:
	0 - 
	-1 -  
******/
CREATE PROCEDURE [dbo].[Model_SelectByModelFatherId]
@ModelFatherId int
AS
begin

		select * from Model where ModelFatherId=@ModelFatherId
			order by ModelNum
end
GO
/****** Object:  StoredProcedure [dbo].[Model_Select]    Script Date: 12/07/2016 16:56:29 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
/******
--: Model_Select
--: Model, 
--: 
--: 
	
--:
	0 - 
	-1 -  
******/
CREATE PROCEDURE [dbo].[Model_Select]

AS
begin

		select * from Model

end
GO
/****** Object:  StoredProcedure [dbo].[WorkLoadProjectsProcess_Select]    Script Date: 12/07/2016 16:56:31 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
/*********************
--: WorkLoadProjectsProcess_Select
--: WorkLoadProjectsProcess, 
--: 
--WorkLoadProjectsRoleId
--: 
	
--:
	0 - 
	-1 -  
**************/
CREATE PROCEDURE [dbo].[WorkLoadProjectsProcess_Select]
AS
begin
	 select a.*,b.RankName as ProcessRoleName
  from WorkLoadProjectsProcess a,Rank b
  where   a.ProcessRankId=b.RankId

end
GO
/****** Object:  StoredProcedure [dbo].[ModelFather_Select]    Script Date: 12/07/2016 16:56:29 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
/******
--: ModelFather_Select
--: Model, 
--: 
--: 
	
--:
	0 - 
	-1 -  
******/
CREATE PROCEDURE [dbo].[ModelFather_Select]

AS
begin

		select * from Model where ModelUrl=''

end
GO
/****** Object:  StoredProcedure [dbo].[LongProjectsEndBranch_SelectByUserCardId]    Script Date: 12/07/2016 16:56:29 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
/*********************
--: LongProjects_SelectByUserCardId
--: LongProjects, 
--
--: 
  UserCardId
--: 
	
--:
	0 - 
	-1 -  
**************/
CREATE PROCEDURE [dbo].[LongProjectsEndBranch_SelectByUserCardId]
@LongProjectsId varchar(50),
@UserCardId varchar(50)
	AS
begin
  select *
  from LongProjectsEndBranch
  where LongProjectsId=@LongProjectsId
  and UserCardId=@UserCardId 
end
GO
/****** Object:  StoredProcedure [dbo].[LongProjectsEndBranch_SelectByLongProjectsId]    Script Date: 12/07/2016 16:56:29 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
/*********************
--: LongProjects_SelectByUserCardId
--: LongProjects, 
--
--: 
  UserCardId
--: 
	
--:
	0 - 
	-1 -  
**************/
CREATE PROCEDURE [dbo].[LongProjectsEndBranch_SelectByLongProjectsId]
@LongProjectsId varchar(50)
	AS
begin
if exists( select * from LongProjectsEndBranch where LongProjectsId=@LongProjectsId)
begin
   select SUM(Branch) as SUMBranch,AVG(Branch) as AVGBranch,COUNT(*) as COUNTNUM
  from LongProjectsEndBranch
  where LongProjectsId=@LongProjectsId
  group by LongProjectsId
  end
  else
  begin
   select 0 as SUMBranch,0 as AVGBranch ,0 as COUNTNUM
  end
end
GO
/****** Object:  StoredProcedure [dbo].[LongProjectsEndBranch_Insert]    Script Date: 12/07/2016 16:56:29 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
/*********************
--: LongProjectsEndExamine_Insert
--:  LongProjectsEndExamine, 
--
--: 
LongProjectsId,ExamineOpinion,ExamineUserCardId,ExamineResult
--: 
	
--:
	0 - 
	-1 -  
**************/
CREATE PROCEDURE [dbo].[LongProjectsEndBranch_Insert]
@LongProjectsId varchar(50),
@UserCardId varchar(50),
@Branch float
AS
begin
	begin tran
	if not exists(select * from LongProjectsEndBranch where LongProjectsId=@LongProjectsId and UserCardId=@UserCardId)
	 begin
	 insert into LongProjectsEndBranch
	 (LongProjectsId,UserCardId,Branch)
	 values
	 (
	 @LongProjectsId,@UserCardId,@Branch
	 )
	 end
	 else		
	begin
	update LongProjectsEndBranch
	set Branch=@Branch
	where
	LongProjectsId=@LongProjectsId and UserCardId=@UserCardId
	end
		if(@@ERROR<>0)
			begin
				rollback
				return -1
			end
	commit tran
	return 0
end
GO
/****** Object:  StoredProcedure [dbo].[LongCapitalPlan_SelectByMyUserCardId]    Script Date: 12/07/2016 16:56:28 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
/*********************
--: LongCapitalPlan_SelectByUserCardId
--: LongCapitalPlan, 
--: 
  UserCardId
--: 
	
--:
	0 - 
	-1 -  
**************/
CREATE PROCEDURE [dbo].[LongCapitalPlan_SelectByMyUserCardId]
	@UserCardId varchar(50)
	AS
begin
   
select a.ProjectsName,b.*,c.TransferStatus
from LongProjects a ,LongCapitalBasic b left join  LongCapitalPlan c on b.LongProjectsId=c.LongProjectsId
where a.LongProjectsId=b.LongProjectsId
  and  a.UserCardId=@UserCardId 
  order by LongProjectsId desc
  
    
end
GO
/****** Object:  StoredProcedure [dbo].[PatentPartner_UpdatePatentId]    Script Date: 12/07/2016 16:56:29 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
/*********************
--: PatentPartner_Update
--: Patent, 
--: 


--: 
	
--:
	0 - 
	-1 -  
**************/
CREATE PROCEDURE [dbo].[PatentPartner_UpdatePatentId]
	@PatentId int,
	@UserCardId varchar(50),
	@PartnerRank int,
	@PartnerValue float
AS
begin
	begin tran
 declare @sum float,
    @PatentValue float,
    @UserValue float
 
    set @UserValue=(select PartnerValue from PatentPartner where PatentId=@PatentId and PartnerUserCardId=@UserCardId)
    set @sum=(select SUM(PartnerValue) from PatentPartner where PatentId=@PatentId)
    set @PatentValue=(select PatentValue from Patent where PatentId=@PatentId)
    if(@sum-@UserValue+@PartnerValue<=@PatentValue)
    begin
		update PatentPartner set
		PartnerRank=@PartnerRank,
		PartnerValue=@PartnerValue,
		PartnerUserCardId=@UserCardId
		where PatentId=@PatentId and 	PartnerUserCardId=@UserCardId
end

		if(@@ERROR<>0)
			begin
				rollback
				return -1
			end
	commit tran
	return 0
end
GO
/****** Object:  StoredProcedure [dbo].[LongProjectsEndProcess_Select]    Script Date: 12/07/2016 16:56:29 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
/*********************
--: LongProjectsProcess_Select
--: LongProjectsProcess, 
--
--: 
--LongProjectsRoleId
--: 
	
--:
	0 - 
	-1 -  
**************/

CREATE PROCEDURE [dbo].[LongProjectsEndProcess_Select]
AS
begin

	 select a.*,b.RankName as ProcessRankName
  from LongProjectsEndProcess a,Rank b
  where   a.ProcessRankId=b.RankId

end
GO
/****** Object:  StoredProcedure [dbo].[ShortCapitalBasic_SelectByShortProjectsId]    Script Date: 12/07/2016 16:56:30 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
/******
--: AdminSeries_Select
--: AdminSeries, 
--
--: 
--: 
	
--:
	0 - 
	-1 -  
******/
CREATE PROCEDURE [dbo].[ShortCapitalBasic_SelectByShortProjectsId]
@ShortProjectsId varchar(50)
AS
begin

		select * from ShortCapitalBasic
		where ShortProjectsId=@ShortProjectsId

end
GO
/****** Object:  StoredProcedure [dbo].[ShortCapitalBasic_SelectByMyUserCardId]    Script Date: 12/07/2016 16:56:30 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
/******
--: AdminSeries_Select
--: AdminSeries, 
--
--: 
--: 
	
--:
	0 - 
	-1 -  
******/
CREATE PROCEDURE [dbo].[ShortCapitalBasic_SelectByMyUserCardId]
@UserCardId varchar(50)
AS
begin

		select a.ContractId,a.ContractName,b.* from 
		ShortProjects a left join ShortCapitalBasic b on a.ShortProjectsId=b.ShortProjectsId
		where a.StandStatus=''
		and a.EndStatus=''
		and a.UserCardId=@UserCardId

end
GO
/****** Object:  StoredProcedure [dbo].[ShortCapitalBasic_Insert]    Script Date: 12/07/2016 16:56:30 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
/*********************
--: CapitalBasic_Insert
--: CapitalPlace, 
--: 

--: 
	
--:
	0 - 
	-1 -  
**************/
CREATE PROCEDURE [dbo].[ShortCapitalBasic_Insert]
@ShortProjectsId varchar(50),
@BidMoney float,
@SupportMoney float,
@OtherMoney float,
@SuedCompany varchar(50),
@Servicelife date
AS
begin
	begin tran
	declare
	@SumMoney float=@BidMoney+@SupportMoney+@OtherMoney 
	if not exists(select * from ShortCapitalBasic where ShortProjectsId=@ShortProjectsId)
	begin
	Insert into ShortCapitalBasic
	(ShortProjectsId,BidMoney,SupportMoney,OtherMoney,SumMoney,SuedCompany,Servicelife) values
	(@ShortProjectsId,@BidMoney,@SupportMoney,@OtherMoney,@SumMoney,@SuedCompany,@Servicelife)
	end
	else
	begin
	update ShortCapitalBasic set
	BidMoney=@BidMoney,
	SupportMoney=@SupportMoney,
	OtherMoney=@OtherMoney,
	SumMoney=@SumMoney,
	SuedCompany=@SuedCompany,
	@Servicelife=@Servicelife
	where ShortProjectsId=@ShortProjectsId
	end
	
	
		if(@@ERROR<>0)
			begin
				rollback
				return -1
			end
	commit tran
	return 0
end
GO
/****** Object:  StoredProcedure [dbo].[ShortCapitalPlan_UpdateStatus]    Script Date: 12/07/2016 16:56:30 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
/*********************
--: ShortCapitalPlan_UpdateStatus
--: ShortCapitalPlan, 
--: 
  ShortCapitalPlanId,TransferStatus,ProcessRoleId
--: 
	
--:
	0 - 
	-1 -  
**************/
CREATE PROCEDURE [dbo].[ShortCapitalPlan_UpdateStatus]
@ShortProjectsId varchar(50),
@TransferStatus varchar(20),
@ProcessRankId varchar(20),
@ProcessDepartmentId int
AS
begin
	begin tran
	
	update ShortCapitalPlan set 
TransferStatus=@TransferStatus
	where ShortProjectsId=@ShortProjectsId 
	if not exists(  select * from ShortCapitalPlanWaitExamine where ShortProjectsId=@ShortProjectsId)
	begin
	insert into ShortCapitalPlanWaitExamine 
	(ShortProjectsId,ProcessDepartmentId,ProcessRankId)
	values
	(@ShortProjectsId,@ProcessDepartmentId,@ProcessRankId)
	end
	else
	begin
	update ShortCapitalPlanwaitExamine
	set ProcessDepartmentId=@ProcessDepartmentId,
	ProcessRankId=@ProcessRankId
	where ShortProjectsId=@ShortProjectsId
	end
		if(@@ERROR<>0)
			begin
				rollback
				return -1
			end
	commit tran
	return 0
end
GO
/****** Object:  StoredProcedure [dbo].[ShortCapitalPlanExamine_Insert]    Script Date: 12/07/2016 16:56:30 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
/*********************
--: ShortCapitalPlanExamine_Insert
--: QuitExamine, 
--: 
ShortProjectsId,ExamineOpinion,ExamineUserCardId,ExamineResult
--: 
	
--:
	0 - 
	-1 -  
**************/
CREATE PROCEDURE [dbo].[ShortCapitalPlanExamine_Insert]
@ShortProjectsId varchar(50),
@ExamineOpinion varchar(400),
@ExamineUserCardId varchar(50),
@ExamineResult varchar(50),
@RankId int
AS
begin
	begin tran
	declare
	@DepartmentId int,
	@ProcessOrder int,
	@TeachersDepartmentId int,
	@UserCardId varchar(50),
	@OrderRoleId int,
	@OrderDepartmentId int
	set @DepartmentId=(select UserDepartmentId from UserInfo where UserCardId=@ExamineUserCardId)
	set @TeachersDepartmentId=(select TeachersDepartmentId from UserInfo where UserCardId=@ExamineUserCardId)
	set @UserCardId =(select UserCardId from ShortCapitalPlan where ShortProjectsId=@ShortProjectsId)
    if exists(select * from ShortCapitalPlanExamine where ShortProjectsId=@ShortProjectsId)
 begin
  set @ProcessOrder=(select MAX(ExamineNumber) from ShortCapitalPlanExamine where ShortProjectsId=@ShortProjectsId)+1  --
 end
 else
 begin
 set @ProcessOrder=1
 end
   	if exists(select * from ShortCapitalPlanWaitExamine where (ProcessDepartmentId=@DepartmentId and ProcessRankId=@RankId and ShortProjectsId=@ShortProjectsId)or ProcessDepartmentId=@TeachersDepartmentId and ProcessRankId=@RankId and ShortProjectsId=@ShortProjectsId)
	begin

insert into ShortCapitalPlanExamine
(ShortProjectsId,ExamineOpinion,ExamineUserCardId,ExamineDate,ExamineNumber,ExamineResult)values
(@ShortProjectsId,@ExamineOpinion,@ExamineUserCardId,GETDATE(),@ProcessOrder,@ExamineResult)
	exec [dbo].[Journal_Insert] @ExamineUserCardId,'',''
if(@ExamineResult='')
begin
if exists(select * from ShortCapitalPlanAuditProcess where ShortProjectsId=@ShortProjectsId and ProcessOrder=@ProcessOrder+1)
begin
set @OrderRoleId =(select ProcessRankId from ShortCapitalPlanAuditProcess where ShortProjectsId=@ShortProjectsId and ProcessOrder=@ProcessOrder+1)
set @OrderDepartmentId= (select ProcessDepartmentId from ShortCapitalPlanAuditProcess where ShortProjectsId=@ShortProjectsId and ProcessOrder=@ProcessOrder+1)
exec [dbo].[ShortCapitalPlan_UpdateStatus] @ShortProjectsId,'',@OrderRoleId,@OrderDepartmentId
end 
else
begin
exec[dbo].[ShortCapitalPlan_UpdateStatus] @ShortProjectsId,@ExamineResult,0,0
delete ShortCapitalPlanWaitExamine
where ShortProjectsId=@ShortProjectsId  --
end
end
else
begin
exec[dbo].[ShortCapitalPlan_UpdateStatus] @ShortProjectsId,@ExamineResult,0,0
delete ShortCapitalPlanWaitExamine
where ShortProjectsId=@ShortProjectsId  --
end
end
		if(@@ERROR<>0)
			begin
				rollback
				return -1
			end
	commit tran
	return 0
end
GO
/****** Object:  StoredProcedure [dbo].[ShortCapitalCanPlan_SelectByUserCardId]    Script Date: 12/07/2016 16:56:30 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
/******
--: AdminSeries_Select
--: AdminSeries, 
--: 
--: 
	
--:
	0 - 
	-1 -  
******/
CREATE PROCEDURE [dbo].[ShortCapitalCanPlan_SelectByUserCardId]
@UserCardId varchar(50)
AS
begin

select * from 
ShortCapitalBasic a,ShortProjects b left join ShortCapitalPlan c on b.ShortProjectsId=c.ShortProjectsId
where a.ShortProjectsId=b.ShortProjectsId
and b.StandStatus='' and b.UserCardId=@UserCardId
and b.EndStatus=''  and c.ShortCapitalPlanUrl is null
end
GO
/****** Object:  StoredProcedure [dbo].[ShortCapitalChange_UpdateStatus]    Script Date: 12/07/2016 16:56:30 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
/*********************
--: ShortCapitalChange_UpdateStatus
--: ShortCapitalChange, 
--: 
  ShortCapitalChangeId,TransferStatus,ProcessRoleId
--: 
	
--:
	0 - 
	-1 -  
**************/
CREATE PROCEDURE [dbo].[ShortCapitalChange_UpdateStatus]
@ShortProjectsId varchar(50),
@TransferStatus varchar(20),
@ProcessRankId varchar(20),
@ProcessDepartmentId int
AS
begin
	begin tran
	
	update ShortCapitalChange set 
TransferStatus=@TransferStatus
	where ShortProjectsId=@ShortProjectsId 
	if not exists(  select * from ShortCapitalChangeWaitExamine where ShortProjectsId=@ShortProjectsId)
	begin
	insert into ShortCapitalChangeWaitExamine 
	(ShortProjectsId,ProcessDepartmentId,ProcessRankId)
	values
	(@ShortProjectsId,@ProcessDepartmentId,@ProcessRankId)
	end
	else
	begin
	update ShortCapitalChangewaitExamine
	set ProcessDepartmentId=@ProcessDepartmentId,
	ProcessRankId=@ProcessRankId
	where ShortProjectsId=@ShortProjectsId
	end
		if(@@ERROR<>0)
			begin
				rollback
				return -1
			end
	commit tran
	return 0
end
GO
/****** Object:  StoredProcedure [dbo].[ShortCapitalChangeExamine_Insert]    Script Date: 12/07/2016 16:56:30 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
/*********************
--: ShortCapitalChangeExamine_Insert
--: QuitExamine, 
--: 
ShortProjectsId,ExamineOpinion,ExamineUserCardId,ExamineResult
--: 
	
--:
	0 - 
	-1 -  
**************/
CREATE PROCEDURE [dbo].[ShortCapitalChangeExamine_Insert]
@ShortProjectsId varchar(50),
@ExamineOpinion varchar(400),
@ExamineUserCardId varchar(50),
@ExamineResult varchar(50),
@RankId int
AS
begin
	begin tran
	declare
	@DepartmentId int,
	@TeachersDepartmentId int,
	@ProcessOrder int,
	@UserCardId varchar(50),
	@OrderRoleId int,
	@OrderDepartmentId int
	set @DepartmentId=(select UserDepartmentId from UserInfo where UserCardId=@ExamineUserCardId)
	set @TeachersDepartmentId=(select TeachersDepartmentId from UserInfo where UserCardId=@ExamineUserCardId)
	set @UserCardId =(select UserCardId from ShortCapitalChange where ShortProjectsId=@ShortProjectsId)
    if exists(select * from ShortCapitalChangeExamine where ShortProjectsId=@ShortProjectsId)
 begin
  set @ProcessOrder=(select MAX(ExamineNumber) from ShortCapitalChangeExamine where ShortProjectsId=@ShortProjectsId)+1  --
 end
 else
 begin
 set @ProcessOrder=1
 end
   	if exists(select * from ShortCapitalChangeWaitExamine where (ProcessDepartmentId=@DepartmentId and ProcessRankId=@RankId and ShortProjectsId=@ShortProjectsId) or (ProcessDepartmentId=@TeachersDepartmentId and ProcessRankId=@RankId and ShortProjectsId=@ShortProjectsId))
	begin

insert into ShortCapitalChangeExamine
(ShortProjectsId,ExamineOpinion,ExamineUserCardId,ExamineDate,ExamineNumber,ExamineResult)values
(@ShortProjectsId,@ExamineOpinion,@ExamineUserCardId,GETDATE(),@ProcessOrder,@ExamineResult)
	exec [dbo].[Journal_Insert] @ExamineUserCardId,'',''
if(@ExamineResult='')
begin
if exists(select * from ShortCapitalChangeAuditProcess where ShortProjectsId=@ShortProjectsId and ProcessOrder=@ProcessOrder+1)
begin
set @OrderRoleId =(select ProcessRankId from ShortCapitalChangeAuditProcess where ShortProjectsId=@ShortProjectsId and ProcessOrder=@ProcessOrder+1)
set @OrderDepartmentId= (select ProcessDepartmentId from ShortCapitalChangeAuditProcess where ShortProjectsId=@ShortProjectsId and ProcessOrder=@ProcessOrder+1)
exec [dbo].[ShortCapitalChange_UpdateStatus] @ShortProjectsId,'',@OrderRoleId,@OrderDepartmentId
end 
else
begin
exec[dbo].[ShortCapitalChange_UpdateStatus] @ShortProjectsId,@ExamineResult,0,0
delete ShortCapitalChangeWaitExamine
where ShortProjectsId=@ShortProjectsId  --
end
end
else
begin
exec[dbo].[ShortCapitalChange_UpdateStatus] @ShortProjectsId,@ExamineResult,0,0
delete ShortCapitalChangeWaitExamine
where ShortProjectsId=@ShortProjectsId  --
end
end
		if(@@ERROR<>0)
			begin
				rollback
				return -1
			end
	commit tran
	return 0
end
GO
/****** Object:  StoredProcedure [dbo].[PatentProcess_Select]    Script Date: 12/07/2016 16:56:29 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
/*********************
--: PatentProcess_Select
--: PatentProcess, 
--: 
--PatentRoleId
--: 
	
--:
	0 - 
	-1 -  
**************/
CREATE PROCEDURE [dbo].[PatentProcess_Select]
AS
begin
	 select a.*,b.RankName as ProcessRoleName
  from PatentProcess a,Rank b
  where   a.ProcessRankId=b.RankId

end
GO
/****** Object:  StoredProcedure [dbo].[LongCapitalPlan_UpdateStatus]    Script Date: 12/07/2016 16:56:28 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
/*********************
--: LongCapitalPlan_UpdateStatus
--: LongCapitalPlan, 
--: 
  LongCapitalPlanId,TransferStatus,ProcessRoleId
--: 
	
--:
	0 - 
	-1 -  
**************/
CREATE PROCEDURE [dbo].[LongCapitalPlan_UpdateStatus]
@LongProjectsId varchar(50),
@TransferStatus varchar(20),
@ProcessRankId varchar(20),
@ProcessDepartmentId int
AS
begin
	begin tran
	
	update LongCapitalPlan set 
TransferStatus=@TransferStatus
	where LongProjectsId=@LongProjectsId 
	if not exists(  select * from LongCapitalPlanWaitExamine where LongProjectsId=@LongProjectsId)
	begin
	insert into LongCapitalPlanWaitExamine 
	(LongProjectsId,ProcessDepartmentId,ProcessRankId)
	values
	(@LongProjectsId,@ProcessDepartmentId,@ProcessRankId)
	end
	else
	begin
	update LongCapitalPlanwaitExamine
	set ProcessDepartmentId=@ProcessDepartmentId,
	ProcessRankId=@ProcessRankId
	where LongProjectsId=@LongProjectsId
	end
		if(@@ERROR<>0)
			begin
				rollback
				return -1
			end
	commit tran
	return 0
end
GO
/****** Object:  StoredProcedure [dbo].[LongCapitalPlace_Update]    Script Date: 12/07/2016 16:56:28 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
/*********************
--: CapitalPlace_Update
--: CapitalPlace, 
--: 
 
--: 
	
--:
	0 - 
	-1 -  
**************/
CREATE PROCEDURE [dbo].[LongCapitalPlace_Update]
@LongCapitalPlaceId int,
@PlaceMoney float,
@PlaceDate date,
@PlaceExplain varchar(100)

AS
begin
	begin tran
	update LongCapitalPlace
	set 
	PlaceMoney=@PlaceMoney,
	PlaceDate=@PlaceDate,
	PlaceExplain=@PlaceExplain
	where LongCapitalPlaceId=@LongCapitalPlaceId
		if(@@ERROR<>0)
			begin
				rollback
				return -1
			end
	commit tran
	return 0
end
GO
/****** Object:  StoredProcedure [dbo].[LongCapitalPlace_SelectByLongProjectsId]    Script Date: 12/07/2016 16:56:28 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
/*********************
--: CapitalPlace_SelectByProjectsId
--: CapitalPlace, 
--: 

--: 
	
--:
	0 - 
	-1 -  
**************/
CREATE PROCEDURE [dbo].[LongCapitalPlace_SelectByLongProjectsId]
@LongProjectsId varchar(50)
	AS
BEGIN
	select a.*,SUM(b.PlaceMoney) as SumMoney	
	from LongCapitalPlace a ,LongCapitalPlace b
	where a.LongProjectsId= @LongProjectsId and b.LongProjectsId=@LongProjectsId
	group by a.LongCapitalPlaceId,a.PlaceDate,a.PlaceMoney,a.LongProjectsId,a.PlaceExplain

END
GO
/****** Object:  StoredProcedure [dbo].[LongCapitalPlace_SelectByLongCapitalPlaceId]    Script Date: 12/07/2016 16:56:28 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
/*********************
--: CapitalPlace_SelectByCapitalPlaceId
--: CapitalPlace, 
--: 

--: 
	
--:
	0 - 
	-1 -  
**************/
CREATE PROCEDURE [dbo].[LongCapitalPlace_SelectByLongCapitalPlaceId]
@LongProjectsCapitalPlaceId int
	AS
BEGIN
select * 
	from LongCapitalPlace 
	where LongCapitalPlaceId=@LongProjectsCapitalPlaceId


END
GO
/****** Object:  StoredProcedure [dbo].[AdminSeries_SelectByAdminSeriesId]    Script Date: 12/07/2016 16:56:27 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
/******
--: AdminSeries_SelectByAdminSeriesId
--: AdminSeries, 
--: 
AdminSeriesId
--: 
	
--:
	0 - 
	-1 -  
******/
CREATE PROCEDURE [dbo].[AdminSeries_SelectByAdminSeriesId]
@AdminSeriesId int
AS
begin

		select * from AdminSeries where AdminSeriesId=@AdminSeriesId

end
GO
/****** Object:  StoredProcedure [dbo].[AdminSeries_Select]    Script Date: 12/07/2016 16:56:27 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
/******
--: AdminSeries_Select
--: AdminSeries, 
--: 
--: 
	
--:
	0 - 
	-1 -  
******/
CREATE PROCEDURE [dbo].[AdminSeries_Select]

AS
begin

		select * from AdminSeries

end
GO
/****** Object:  StoredProcedure [dbo].[HarvestPartner_UpdateHarvestId]    Script Date: 12/07/2016 16:56:28 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
/*********************
--: HarvestPartner_Update
--: Harvest, 
--: 


--: 
	
--:
	0 - 
	-1 -  
**************/
CREATE PROCEDURE [dbo].[HarvestPartner_UpdateHarvestId]
	@HarvestId int,
	@UserCardId varchar(50),
	@PartnerRank int,
	@PartnerValue float
AS
begin
	begin tran
 declare @sum float,
    @HarvestValue float,
    @UserValue float
 
    set @UserValue=(select PartnerValue from HarvestPartner where HarvestId=@HarvestId and PartnerUserCardId=@UserCardId)
    set @sum=(select SUM(PartnerValue) from HarvestPartner where HarvestId=@HarvestId)
    set @HarvestValue=(select HarvestValue from Harvest where HarvestId=@HarvestId)
    if(@sum-@UserValue+@PartnerValue<=@HarvestValue)
    begin
		update HarvestPartner set
		PartnerRank=@PartnerRank,
		PartnerValue=@PartnerValue,
		PartnerUserCardId=@UserCardId
		where HarvestId=@HarvestId and 	PartnerUserCardId=@UserCardId
end

		if(@@ERROR<>0)
			begin
				rollback
				return -1
			end
	commit tran
	return 0
end
GO
/****** Object:  StoredProcedure [dbo].[HarvestProcess_Select]    Script Date: 12/07/2016 16:56:28 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
/*********************
--: HarvestProcess_Select
--: HarvestProcess, 
--: 
--HarvestRoleId
--: 
	
--:
	0 - 
	-1 -  
**************/
CREATE PROCEDURE [dbo].[HarvestProcess_Select]
AS
begin
	 select a.*,b.RankName as ProcessRoleName
  from HarvestProcess a,Rank b
  where   a.ProcessRankId=b.RankId

end
GO
/****** Object:  StoredProcedure [dbo].[UserAdminSeries_SelectByUserCardId]    Script Date: 12/07/2016 16:56:30 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
/******
--: UserAdminSeries_SelectByUserCardId
--: UserAdminSeries, 
--: 
--: 
	
--:
	0 - 
	-1 -  
******/
CREATE PROCEDURE [dbo].[UserAdminSeries_SelectByUserCardId]
@UserCardId varchar(50)
AS
begin

		select distinct  * from UserAdminSeries where UserCardId=@UserCardId

end
GO
/****** Object:  StoredProcedure [dbo].[UserAdminSeries_Insert]    Script Date: 12/07/2016 16:56:30 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
/*********************
--: UserAdminSeries_Insert
--: UserAdminSeries, 
--: 
 UserCardId,AdminSeriesId
--: 
	
--:
	0 - 
	-1 -  
**************/
CREATE PROCEDURE [dbo].[UserAdminSeries_Insert]
@UserCardId varchar(50),
@AdminSeriesId int
AS
begin
	begin tran
	insert into UserAdminSeries(
   UserCardId,AdminSeriesId
	)values(
	@UserCardId,@AdminSeriesId
	)
		if(@@ERROR<>0)
			begin
				rollback
				return -1
			end
	commit tran
	return 0
end
GO
/****** Object:  StoredProcedure [dbo].[UserAdminSeries_Delete]    Script Date: 12/07/2016 16:56:30 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
/*******
--: UserAdminSeries_Delete
--: UserAdminSeries, 
--: 
RoleId
--: 
	
--:
	0 - 
	-1 -  
*********/
CREATE PROCEDURE [dbo].[UserAdminSeries_Delete]
@UserCardId int
AS
begin
	begin tran
		delete UserAdminSeries where UserCardId=UserCardId
		if(@@ERROR<>0)
			begin
				rollback
				return -1
			end
	commit tran
	return 0
end
GO
/****** Object:  StoredProcedure [dbo].[AssessValue_SelectByAssessValueId]    Script Date: 12/07/2016 16:56:27 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
/******
--: AssessValue_Select
--: AssessValue, 
--: 
--: 
	
--:
	0 - 
	-1 -  
******/
CREATE PROCEDURE [dbo].[AssessValue_SelectByAssessValueId]
@AssessValueId int
AS
begin
  select * from AssessValue
  where AssessValueId=@AssessValueId
end
GO
/****** Object:  StoredProcedure [dbo].[GuidanceProcess_Select]    Script Date: 12/07/2016 16:56:28 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
/*********************
--: GuidanceProcess_Select
--: GuidanceProcess, 
--: 
--GuidanceRoleId
--: 
	
--:
	0 - 
	-1 -  
**************/
CREATE PROCEDURE [dbo].[GuidanceProcess_Select]
AS
begin
	 select a.*,b.RankName as ProcessRoleName
  from GuidanceProcess a,Rank b
  where   a.ProcessRankId=b.RankId

end
GO
/****** Object:  StoredProcedure [dbo].[LongProjectsStandBranch_SelectByUserCardId]    Script Date: 12/07/2016 16:56:29 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
/*********************
--: LongProjects_SelectByUserCardId
--: LongProjects, 
--
--: 
  UserCardId
--: 
	
--:
	0 - 
	-1 -  
**************/
CREATE PROCEDURE [dbo].[LongProjectsStandBranch_SelectByUserCardId]
@LongProjectsId varchar(50),
@UserCardId varchar(50)
	AS
begin
  select *
  from LongProjectsStandBranch
  where LongProjectsId=@LongProjectsId
  and UserCardId=@UserCardId 
end
GO
/****** Object:  StoredProcedure [dbo].[LongProjectsStandBranch_SelectByLongProjectsId]    Script Date: 12/07/2016 16:56:29 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
/*********************
--: LongProjects_SelectByUserCardId
--: LongProjects, 
--
--: 
  UserCardId
--: 
	
--:
	0 - 
	-1 -  
**************/
CREATE PROCEDURE [dbo].[LongProjectsStandBranch_SelectByLongProjectsId]
@LongProjectsId varchar(50)
	AS
begin
if exists( select * from LongProjectsStandBranch where LongProjectsId=@LongProjectsId)
begin
   select isnull( SUM(Branch),0) as SUMBranch,ISNULL( AVG(Branch),0) as AVGBranch,ISNULL( COUNT(*) ,0)as COUNTNUM
  from LongProjectsStandBranch
  where LongProjectsId=@LongProjectsId
  group by LongProjectsId
  end
  else		
  begin
   select 0 as SUMBranch,0 as AVGBranch ,0 as COUNTNUM

  end

end
GO
/****** Object:  StoredProcedure [dbo].[LongProjectsStandBranch_Insert]    Script Date: 12/07/2016 16:56:29 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
/*********************
--: LongProjectsStandExamine_Insert
--:  LongProjectsStandExamine, 
--
--: 
LongProjectsId,ExamineOpinion,ExamineUserCardId,ExamineResult
--: 
	
--:
	0 - 
	-1 -  
**************/
CREATE PROCEDURE [dbo].[LongProjectsStandBranch_Insert]
@LongProjectsId varchar(50),
@UserCardId varchar(50),
@Branch float
AS
begin
	begin tran
	if not exists(select * from LongProjectsStandBranch where LongProjectsId=@LongProjectsId and UserCardId=@UserCardId)
	 begin
	 insert into LongProjectsStandBranch
	 (LongProjectsId,UserCardId,Branch)
	 values
	 (
	 @LongProjectsId,@UserCardId,@Branch
	 )
	 end
	 else		
	begin
	update LongProjectsStandBranch
	set Branch=@Branch
	where
	LongProjectsId=@LongProjectsId and UserCardId=@UserCardId
	end
		if(@@ERROR<>0)
			begin
				rollback
				return -1
			end
	commit tran
	return 0
end
GO
/****** Object:  StoredProcedure [dbo].[AssessRank_SelectByAssessRankId]    Script Date: 12/07/2016 16:56:27 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
/******
--: AssessRank_Select
--: AssessRank, 
--: 
--: 
	
--:
	0 - 
	-1 -  
******/
CREATE PROCEDURE [dbo].[AssessRank_SelectByAssessRankId]
@AssessRankId int
AS
begin

		select * from AssessRank where AssessRankId=@AssessRankId

end
GO
/****** Object:  StoredProcedure [dbo].[AssessRank_Select]    Script Date: 12/07/2016 16:56:27 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
/******
--: AssessRank_Select
--: AssessRank, 
--: 
--: 
	
--:
	0 - 
	-1 -  
******/
CREATE PROCEDURE [dbo].[AssessRank_Select]

AS
begin

		select * from AssessRank

end
GO
/****** Object:  StoredProcedure [dbo].[Winning_UpdateStatus]    Script Date: 12/07/2016 16:56:31 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
/*********************
--: Winning_UpdateStatus
--: Winning, 
--: 
  WinningId,TransferStatus,ProcessRoleId
--: 
	
--:
	0 - 
	-1 -  
**************/
CREATE PROCEDURE [dbo].[Winning_UpdateStatus]
@WinningId int,
@TransferStatus varchar(20),
@ProcessRoleId varchar(20),
@ProcessDepartmentId int
AS
begin
	begin tran
	
	update Winning set 
TransferStatus=@TransferStatus,
ProcessRoleId=@ProcessRoleId,
ProcessDepartmentId=@ProcessDepartmentId
	where WinningId=@WinningId 
	
		if(@@ERROR<>0)
			begin
				rollback
				return -1
			end
	commit tran
	return 0
end
GO
/****** Object:  StoredProcedure [dbo].[WinningExamine_Insert]    Script Date: 12/07/2016 16:56:31 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
/*********************
--: WinningExamine_Insert
--: QuitExamine, 
--: 
WinningId,ExamineOpinion,ExamineUserCardId,ExamineResult
--: 
	
--:
	0 - 
	-1 -  
**************/
CREATE PROCEDURE [dbo].[WinningExamine_Insert]
@WinningId int,
@ExamineOpinion varchar(400),
@ExamineUserCardId varchar(50),
@ExamineResult varchar(50),
@RankId int
AS
begin
	begin tran
	declare
	@DepartmentId int,
	@TeachersDepartmentId int,
	@ProcessOrder int,
	@UserCardId varchar(50),
	@OrderRoleId int,
	@OrderDepartmentId int
	set @DepartmentId=(select UserDepartmentId from UserInfo where UserCardId=@ExamineUserCardId)
		set @TeachersDepartmentId=(select TeachersDepartmentId from UserInfo where UserCardId=@ExamineUserCardId)
	set @UserCardId =(select UserCardId from Winning where WinningId=@WinningId)
    if exists(select * from WinningExamine where WinningId=@WinningId)
 begin
  set @ProcessOrder=(select MAX(ExamineNumber) from WinningExamine where WinningId=@WinningId)+1  --
 end
 else
 begin
 set @ProcessOrder=1
 end
   	if exists(select * from Winning where (ProcessDepartmentId=@DepartmentId and ProcessRoleId=@RankId) or (ProcessDepartmentId=@TeachersDepartmentId and ProcessRoleId=@RankId))
	begin

insert into WinningExamine
(WinningId,ExamineOpinion,ExamineUserCardId,ExamineDate,ExamineNumber,ExamineResult)values
(@WinningId,@ExamineOpinion,@ExamineUserCardId,GETDATE(),@ProcessOrder,@ExamineResult)
 exec [dbo].[Journal_Insert] @ExamineUserCardId,'',''
if(@ExamineResult='')
begin
if exists(select * from WinningAuditProcess where WinningId=@WinningId and ProcessOrder=@ProcessOrder+1)
begin
set @OrderRoleId =(select ProcessRankId from WinningAuditProcess where WinningId=@WinningId and ProcessOrder=@ProcessOrder+1)
set @OrderDepartmentId= (select ProcessDepartmentId from WinningAuditProcess where WinningId=@WinningId and ProcessOrder=@ProcessOrder+1)
exec [dbo].[Winning_UpdateStatus] @WinningId,'',@OrderRoleId,@OrderDepartmentId
end 
else
begin
exec[dbo].[WinningPartner_AddValue] @WinningId
exec[dbo].[Winning_UpdateStatus] @WinningId,@ExamineResult,'',0
end
end
else
begin
exec[dbo].[Winning_UpdateStatus] @WinningId,@ExamineResult,'',0
end
end
		if(@@ERROR<>0)
			begin
				rollback
				return -1
			end
	commit tran
	return 0
end
GO
/****** Object:  StoredProcedure [dbo].[LongProjectsStandProcess_Select]    Script Date: 12/07/2016 16:56:29 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
/*********************
--: LongProjectsProcess_Select
--: LongProjectsProcess, 
--
--: 
--LongProjectsRoleId
--: 
	
--:
	0 - 
	-1 -  
**************/

CREATE PROCEDURE [dbo].[LongProjectsStandProcess_Select]
AS
begin

	 select a.*,b.RankName as ProcessRankName
  from LongProjectsStandProcess a,Rank b
  where   a.ProcessRankId=b.RankId

end
GO
/****** Object:  StoredProcedure [dbo].[Teaching_UpdateStatus]    Script Date: 12/07/2016 16:56:30 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
/*********************
--: Teaching_UpdateStatus
--: Teaching, 
--: 
  TeachingId,TransferStatus,ProcessRoleId
--: 
	
--:
	0 - 
	-1 -  
**************/
CREATE PROCEDURE [dbo].[Teaching_UpdateStatus]
@TeachingId int,
@TransferStatus varchar(20),
@ProcessRoleId varchar(20),
@ProcessDepartmentId int
AS
begin
	begin tran
	
	update Teaching set 
TransferStatus=@TransferStatus,
ProcessRoleId=@ProcessRoleId,
ProcessDepartmentId=@ProcessDepartmentId
	where TeachingId=@TeachingId 
	
		if(@@ERROR<>0)
			begin
				rollback
				return -1
			end
	commit tran
	return 0
end
GO
/****** Object:  StoredProcedure [dbo].[TeachingExamine_Insert]    Script Date: 12/07/2016 16:56:30 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
/*********************
--: TeachingExamine_Insert
--: QuitExamine, 
--: 
TeachingId,ExamineOpinion,ExamineUserCardId,ExamineResult
--: 
	
--:
	0 - 
	-1 -  
**************/
CREATE PROCEDURE [dbo].[TeachingExamine_Insert]
@TeachingId int,
@ExamineOpinion varchar(400),
@ExamineUserCardId varchar(50),
@ExamineResult varchar(50),
@RankId int
AS
begin
	begin tran
	declare
	@DepartmentId int,
	@TeachersDepartmentId int,
	@ProcessOrder int,
	@UserCardId varchar(50),
	@OrderRoleId int,
	@OrderDepartmentId int
	set @DepartmentId=(select UserDepartmentId from UserInfo where UserCardId=@ExamineUserCardId)
	set @TeachersDepartmentId=(select TeachersDepartmentId from UserInfo where UserCardId=@ExamineUserCardId)
	set @UserCardId =(select UserCardId from Teaching where TeachingId=@TeachingId)
    if exists(select * from TeachingExamine where TeachingId=@TeachingId)
 begin
  set @ProcessOrder=(select MAX(ExamineNumber) from TeachingExamine where TeachingId=@TeachingId)+1  --
 end
 else
 begin
 set @ProcessOrder=1
 end
   	if exists(select * from Teaching where (ProcessDepartmentId=@DepartmentId and ProcessRoleId=@RankId) or (ProcessDepartmentId=@TeachersDepartmentId and ProcessRoleId=@RankId))
	begin

insert into TeachingExamine
(TeachingId,ExamineOpinion,ExamineUserCardId,ExamineDate,ExamineNumber,ExamineResult)values
(@TeachingId,@ExamineOpinion,@ExamineUserCardId,GETDATE(),@ProcessOrder,@ExamineResult)
 exec [dbo].[Journal_Insert] @ExamineUserCardId,'',''
if(@ExamineResult='')
begin
if exists(select * from TeachingAuditProcess where TeachingId=@TeachingId and ProcessOrder=@ProcessOrder+1)
begin
set @OrderRoleId =(select ProcessRankId from TeachingAuditProcess where TeachingId=@TeachingId and ProcessOrder=@ProcessOrder+1)
set @OrderDepartmentId= (select ProcessDepartmentId from TeachingAuditProcess where TeachingId=@TeachingId and ProcessOrder=@ProcessOrder+1)
exec [dbo].[Teaching_UpdateStatus] @TeachingId,'',@OrderRoleId,@OrderDepartmentId
end 
else
begin
exec[dbo].[TeachingPartner_AddValue] @TeachingId
exec[dbo].[Teaching_UpdateStatus] @TeachingId,@ExamineResult,'',0
end
end
else
begin
exec[dbo].[Teaching_UpdateStatus] @TeachingId,@ExamineResult,'',0
end
end
		if(@@ERROR<>0)
			begin
				rollback
				return -1
			end
	commit tran
	return 0
end
GO
/****** Object:  StoredProcedure [dbo].[ShortCapitalPlanProcess_Select]    Script Date: 12/07/2016 16:56:30 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
/*********************
--: ShortCapitalPlanProcess_Select
--: ShortCapitalPlanProcess, 
--: 
--ShortCapitalPlanRoleId
--: 
	
--:
	0 - 
	-1 -  
**************/
CREATE PROCEDURE [dbo].[ShortCapitalPlanProcess_Select]
AS
begin
	 select a.*,b.RankName as ProcessRoleName
  from ShortCapitalPlanProcess a,Rank b
  where   a.ProcessRankId=b.RankId

end
GO
/****** Object:  StoredProcedure [dbo].[UserLogin_Insert]    Script Date: 12/07/2016 16:56:31 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
/*********************
--: AdminSeries_Insert
--: AdminSeries, 
--: 
   AdminSeriesName
--: 
	
--:
	0 - 
	-1 -  
**************/
CREATE PROCEDURE [dbo].[UserLogin_Insert]
@UserCardId varchar(50)
AS
begin
	begin tran
	declare @UserDate date=getdate();
	if exists (select * from UserLogin where UserCardId=@UserCardId and UserDate=@UserDate)
	begin
	declare @UserNumber  int= (select UserNumber from UserLogin where UserCardId=@UserCardId and UserDate=@UserDate)+1
	update UserLogin
	set UserNumber= @UserNumber 
	where UserCardId=@UserCardId and UserDate=@UserDate
	end
	else begin
	insert into UserLogin
	(UserCardId,UserDate,UserNumber)
	values
	( @UserCardId,@UserDate,1)
	end
		if(@@ERROR<>0)
			begin
				rollback
				return -1
			end
	commit tran
	return 0
end
GO
/****** Object:  StoredProcedure [dbo].[UserInfo_Login]    Script Date: 12/07/2016 16:56:30 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
/******
--  userInfo_Login
-- 
-- 
--      @userCardId   
-- 
--    @isSuccess int
--     0
--     1
--     2
--     3
--		4:

******/
CREATE PROCEDURE [dbo].[UserInfo_Login]
   @userCardId   varchar(50),
   @userPwd      varchar(100),
   @isSuccess    int output
AS
begin
 if exists(select * from userInfo where userCardId=@userCardId) 
   begin 
   if exists (select * from UserInfo where UserCardId=@userCardId and UserEnable='')
   begin
   declare @UserDate date=getdate()
   if exists (select * from UserLogin where UserCardId=@userCardId and UserDate=@UserDate)
   begin
   declare @UserNumber int=(select UserNumber from UserLogin where UserCardId=@userCardId and UserDate=@UserDate)
   if(@UserNumber>4)
   begin
    set @isSuccess=3
	return
	end
	else
	begin
	  if exists(select * from userInfo where userCardId=@userCardId and userPwd=@userPwd)
     begin
	 exec AssessValue_Insert @UserCardId
     set @isSuccess=0
   end
     else
     begin
	 exec UserLogin_Insert @UserCardId
      set @isSuccess=1
     end
	end
   end
   else
   begin
   if exists(select * from userInfo where userCardId=@userCardId and userPwd=@userPwd)
     begin
	exec AssessValue_Insert @UserCardId
     set @isSuccess=0
   end
     else
     begin
	 	 exec UserLogin_Insert @UserCardId
      set @isSuccess=1
     end
   end
   end
   else
   begin
    set @isSuccess=5
   end
    end
    else
    begin
      set @isSuccess=2
    end
    if(@@ERROR<>0)
      begin
        set @isSuccess=4
       end
end
GO
/****** Object:  StoredProcedure [dbo].[UserInfo_UpdatePwd]    Script Date: 12/07/2016 16:56:31 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
/*******
--: UserInfo_UpdatePwd
--: UserInfo, 
--: 
PostId,PostName,PlanPeople,PostValue
--: 
	
--:
	0 - 
	-1 -  
*********/
CREATE PROCEDURE [dbo].[UserInfo_UpdatePwd]
@UserCardId varchar(50),
@OldUserPwd varchar(160)=null,
@NewUserPwd varchar(160),
@UserIdCard varchar(50)=null
AS
begin
	begin tran
		if( @UserIdCard is not null)
	begin
	if not exists(select * from UserRole where UserCardId=@UserCardId and RoleId=1)
	begin
	update UserInfo 
	set UserPwd=@NewUserPwd 
	where UserCardId=@UserCardId and IdCardNo=@UserIdCard	
	end
	end
	else 
	begin
	update UserInfo set UserPwd=@NewUserPwd where UserCardId=@UserCardId and UserPwd=@OldUserPwd
		
		end
		if(@@ERROR<>0)
			begin
				rollback
				return -1
			end
	commit tran
	return 0
end
GO
/****** Object:  StoredProcedure [dbo].[ShortCapitalChange_SelectByMyUserCardId]    Script Date: 12/07/2016 16:56:30 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
/*********************
--: ShortCapitalChange_SelectByUserCardId
--: ShortCapitalChange, 
--: 
  UserCardId
--: 
	
--:
	0 - 
	-1 -  
**************/
CREATE PROCEDURE [dbo].[ShortCapitalChange_SelectByMyUserCardId]
	@UserCardId varchar(50)
	AS
begin
   
	select a.Company,a.ContractId,a.ContractMoney,a.ContractName,b.*,d.TransferStatus
	from ShortProjects a ,ShortCapitalBasic b ,ShortCapitalPlan c left join ShortCapitalChange d on c.ShortProjectsId=d.ShortProjectsId
	where a.ShortProjectsId=b.ShortProjectsId
	and b.ShortProjectsId=c.ShortProjectsId
	and c.TransferStatus=''
  and  a.UserCardId=@UserCardId
  order by ShortProjectsId desc
    
end
GO
/****** Object:  StoredProcedure [dbo].[WorkLoadProjects_UpdateStatus]    Script Date: 12/07/2016 16:56:31 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
/*********************
--: WorkLoadProjects_UpdateStatus
--: WorkLoadProjects, 
--: 
  WorkLoadProjectsId,TransferStatus,ProcessRoleId
--: 
	
--:
	0 - 
	-1 -  
**************/
CREATE PROCEDURE [dbo].[WorkLoadProjects_UpdateStatus]
@WorkLoadProjectsId int,
@TransferStatus varchar(20),
@ProcessRoleId varchar(20),
@ProcessDepartmentId int
AS
begin
	begin tran
	
	update WorkLoadProjects set 
TransferStatus=@TransferStatus,
ProcessRankId=@ProcessRoleId,
ProcessDepartmentId=@ProcessDepartmentId
	where WorkLoadProjectsId=@WorkLoadProjectsId 
	
		if(@@ERROR<>0)
			begin
				rollback
				return -1
			end
	commit tran
	return 0
end
GO
/****** Object:  StoredProcedure [dbo].[WorkLoadProjectsExamine_Insert]    Script Date: 12/07/2016 16:56:31 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
/*********************
--: WorkLoadProjectsExamine_Insert
--: QuitExamine, 
--: 
WorkLoadProjectsId,ExamineOpinion,ExamineUserCardId,ExamineResult
--: 
	
--:
	0 - 
	-1 -  
**************/
CREATE PROCEDURE [dbo].[WorkLoadProjectsExamine_Insert]
@WorkLoadProjectsId int,
@ExamineOpinion varchar(400),
@ExamineUserCardId varchar(50),
@ExamineResult varchar(50),
@RankId int
AS
begin
	begin tran
	declare
	@DepartmentId int,
	@ProcessOrder int,
	@TeachersDepartmentId int,
	@UserCardId varchar(50),
	@OrderRoleId int,
	@OrderDepartmentId int
	set @DepartmentId=(select UserDepartmentId from UserInfo where UserCardId=@ExamineUserCardId)
	set @TeachersDepartmentId=(select TeachersDepartmentId from UserInfo where UserCardId=@ExamineUserCardId)
	set @UserCardId =(select UserCardId from WorkLoadProjects where WorkLoadProjectsId=@WorkLoadProjectsId)
    if exists(select * from WorkLoadProjectsExamine where WorkLoadProjectsId=@WorkLoadProjectsId)
 begin
  set @ProcessOrder=(select MAX(ExamineNumber) from WorkLoadProjectsExamine where WorkLoadProjectsId=@WorkLoadProjectsId)+1  --
 end
 else
 begin
 set @ProcessOrder=1
 end
   	if exists(select * from WorkLoadProjects where (ProcessDepartmentId=@DepartmentId and ProcessRankId=@RankId) or (ProcessDepartmentId=@TeachersDepartmentId and ProcessRankId=@RankId))
	begin

insert into WorkLoadProjectsExamine
(WorkLoadProjectsId,ExamineOpinion,ExamineUserCardId,ExamineDate,ExamineNumber,ExamineResult)values
(@WorkLoadProjectsId,@ExamineOpinion,@ExamineUserCardId,GETDATE(),@ProcessOrder,@ExamineResult)
 exec [dbo].[Journal_Insert] @ExamineUserCardId,'',''
if(@ExamineResult='')
begin
if exists(select * from WorkLoadProjectsAuditProcess where WorkLoadProjectsId=@WorkLoadProjectsId and ProcessOrder=@ProcessOrder+1)
begin
set @OrderRoleId =(select ProcessRankId from WorkLoadProjectsAuditProcess where WorkLoadProjectsId=@WorkLoadProjectsId and ProcessOrder=@ProcessOrder+1)
set @OrderDepartmentId= (select ProcessDepartmentId from WorkLoadProjectsAuditProcess where WorkLoadProjectsId=@WorkLoadProjectsId and ProcessOrder=@ProcessOrder+1)
exec [dbo].[WorkLoadProjects_UpdateStatus] @WorkLoadProjectsId,'',@OrderRoleId,@OrderDepartmentId
end 
else
begin
exec[dbo].[WorkLoadProjectsPartner_AddValue] @WorkLoadProjectsId
exec[dbo].[WorkLoadProjects_UpdateStatus] @WorkLoadProjectsId,@ExamineResult,'',0
end
end
else
begin
exec[dbo].[WorkLoadProjects_UpdateStatus] @WorkLoadProjectsId,@ExamineResult,'',0
end
end
		if(@@ERROR<>0)
			begin
				rollback
				return -1
			end
	commit tran
	return 0
end
GO
/****** Object:  StoredProcedure [dbo].[UserRank_Delete]    Script Date: 12/07/2016 16:56:31 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
/*******
--: UserRank_Delete
--: UserRank, 
--: 
UserRankId
--: 
	
--:
	0 - 
	-1 -  
*********/
CREATE PROCEDURE [dbo].[UserRank_Delete]
@UserCardId int
AS
begin
	begin tran
		delete UserRank where UserCardId=@UserCardId
		if(@@ERROR<>0)
			begin
				rollback
				return -1
			end
	commit tran
	return 0
end
GO
/****** Object:  StoredProcedure [dbo].[Authority_SelectByRoleId]    Script Date: 12/07/2016 16:56:27 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
/******
--: Authority_SelectByRoleId
--: Authority, 
--: 
RoleId
--: 
	
--:
	0 - 
	-1 -  
******/
CREATE PROCEDURE [dbo].[Authority_SelectByRoleId]
@RoleId int
AS
begin

		select * from Authority where RoleId=@RoleId

end
GO
/****** Object:  StoredProcedure [dbo].[Authority_SelectByRankId]    Script Date: 12/07/2016 16:56:27 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
/******
--: Authority_SelectByRoleId
--: Authority, 
--: 
RoleId
--: 
	
--:
	0 - 
	-1 -  
******/
CREATE PROCEDURE [dbo].[Authority_SelectByRankId]
@RankId int
AS
begin

		select * from Authority where RoleId=@RankId

end
GO
/****** Object:  StoredProcedure [dbo].[Authority_Select]    Script Date: 12/07/2016 16:56:27 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
/******
--: Authority_Select
--: Authority, 
--: 
--: 
	
--:
	0 - 
	-1 -  
******/
CREATE PROCEDURE [dbo].[Authority_Select]

AS
begin

		select distinct * from Authority

end
GO
/****** Object:  StoredProcedure [dbo].[Authority_InsertModelFatherId]    Script Date: 12/07/2016 16:56:27 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
/*********************
--: Authority_InsertModelFatherId
--: Authority, 
--: 
 RoleId,ModelId
--: 
	
--:
	0 - 
	-1 -  
**************/
CREATE PROCEDURE [dbo].[Authority_InsertModelFatherId]
@RoleId int,
@ModelId int
AS
begin
	begin tran
	insert into Authority(
    RoleId,ModelId
	)values(
	@RoleId,@ModelId
	)
		if(@@ERROR<>0)
			begin
				rollback
				return -1
			end
	commit tran
	return 0
end
GO
/****** Object:  StoredProcedure [dbo].[Authority_Insert]    Script Date: 12/07/2016 16:56:27 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
/*********************
--: Authority_Insert
--: Authority, 
--: 
 RoleId,ModelId
--: 
	
--:
	0 - 
	-1 -  
**************/
CREATE PROCEDURE [dbo].[Authority_Insert]
@RoleId int,
@ModelId int
AS
begin
	begin tran
	insert into Authority(
    RoleId,ModelId
	)values(
	@RoleId,@ModelId
	)
	
	declare @FatherId int
	set @FatherId=(select ModelFatherId from Model where ModelId=@ModelId )
    while (@FatherId<>0)
    begin
		if not exists(select * from Authority where RoleID=@RoleId and ModelId=@FatherId)
	begin
	insert into [dbo].[Authority](
	RoleID,ModelID
	)
	values
	(
	@RoleId,@FatherId
	)
	end
	set @FatherId=(select ModelFatherId from Model where ModelId=@FatherId )
    end
		if(@@ERROR<>0)
			begin
				rollback
				return -1
			end
	commit tran
	return 0
end
GO
/****** Object:  StoredProcedure [dbo].[Political_Delete]    Script Date: 12/07/2016 16:56:29 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
/*******
--: Political_Delete
--: Political, 
--: 
PoliticalId
--: 
	
--:
	0 - 
	-1 -  
*********/
CREATE PROCEDURE [dbo].[Political_Delete]
@PoliticalId int,
@UserCardId varchar(50)
AS
begin
	begin tran
		delete Political where PoliticalId=@PoliticalId
			exec [dbo].[Journal_Insert] @UserCardId,'',''
		if(@@ERROR<>0)
			begin
				rollback
				return -1
			end
	commit tran
	return 0
end
GO
/****** Object:  StoredProcedure [dbo].[LongCapitalPlanExamine_Insert]    Script Date: 12/07/2016 16:56:28 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
/*********************
--: LongCapitalPlanExamine_Insert
--: QuitExamine, 
--: 
LongProjectsId,ExamineOpinion,ExamineUserCardId,ExamineResult
--: 
	
--:
	0 - 
	-1 -  
**************/
CREATE PROCEDURE [dbo].[LongCapitalPlanExamine_Insert]
@LongProjectsId varchar(50),
@ExamineOpinion varchar(400),
@ExamineUserCardId varchar(50),
@ExamineResult varchar(50),
@RankId int
AS
begin
	begin tran
	declare
	@DepartmentId int,
	@TeachersDepartmentId int,
	@ProcessOrder int,
	@UserCardId varchar(50),
	@OrderRoleId int,
	@OrderDepartmentId int
	set @DepartmentId=(select UserDepartmentId from UserInfo where UserCardId=@ExamineUserCardId)
		set @TeachersDepartmentId=(select TeachersDepartmentId from UserInfo where UserCardId=@ExamineUserCardId)
	set @UserCardId =(select UserCardId from LongCapitalPlan where LongProjectsId=@LongProjectsId)
    if exists(select * from LongCapitalPlanExamine where LongProjectsId=@LongProjectsId)
 begin
  set @ProcessOrder=(select MAX(ExamineNumber) from LongCapitalPlanExamine where LongProjectsId=@LongProjectsId)+1  --
 end
 else
 begin
 set @ProcessOrder=1
 end
   	if exists(select * from LongCapitalPlanWaitExamine where( ProcessDepartmentId=@DepartmentId and ProcessRankId=@RankId and LongProjectsId=@LongProjectsId) or (ProcessDepartmentId=@TeachersDepartmentId and ProcessRankId=@RankId and LongProjectsId=@LongProjectsId))
	begin

insert into LongCapitalPlanExamine
(LongProjectsId,ExamineOpinion,ExamineUserCardId,ExamineDate,ExamineNumber,ExamineResult)values
(@LongProjectsId,@ExamineOpinion,@ExamineUserCardId,GETDATE(),@ProcessOrder,@ExamineResult)
	exec [dbo].[Journal_Insert] @ExamineUserCardId,'',''
if(@ExamineResult='')
begin
if exists(select * from LongCapitalPlanAuditProcess where LongProjectsId=@LongProjectsId and ProcessOrder=@ProcessOrder+1)
begin
set @OrderRoleId =(select ProcessRankId from LongCapitalPlanAuditProcess where LongProjectsId=@LongProjectsId and ProcessOrder=@ProcessOrder+1)
set @OrderDepartmentId= (select ProcessDepartmentId from LongCapitalPlanAuditProcess where LongProjectsId=@LongProjectsId and ProcessOrder=@ProcessOrder+1)
exec [dbo].[LongCapitalPlan_UpdateStatus] @LongProjectsId,'',@OrderRoleId,@OrderDepartmentId
end 
else
begin
exec[dbo].[LongCapitalPlan_UpdateStatus] @LongProjectsId,@ExamineResult,0,0
delete LongCapitalPlanWaitExamine
where LongProjectsId=@LongProjectsId  --
end
end
else
begin
exec[dbo].[LongCapitalPlan_UpdateStatus] @LongProjectsId,@ExamineResult,0,0
delete LongCapitalPlanWaitExamine
where LongProjectsId=@LongProjectsId  --
end
end
		if(@@ERROR<>0)
			begin
				rollback
				return -1
			end
	commit tran
	return 0
end
GO
/****** Object:  StoredProcedure [dbo].[CapitalItem_Select]    Script Date: 12/07/2016 16:56:27 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
/******
--: CapitalItem_Select
--: CapitalItem, 
--: 
--: 
	
--:
	0 - 
	-1 -  
******/
CREATE PROCEDURE [dbo].[CapitalItem_Select]

AS
begin

		select * from CapitalItem

end
GO
/****** Object:  StoredProcedure [dbo].[LongCapitalPlace_Insert]    Script Date: 12/07/2016 16:56:28 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
/*********************
--: CapitalPlace_Insert
--: CapitalPlace, 
--: 

--: 
	
--:
	0 - 
	-1 -  
**************/
CREATE PROCEDURE [dbo].[LongCapitalPlace_Insert]
@LongProjectsId varchar(50),
@PlaceMoney float,
@PlaceDate varchar(50),
@PlaceExplain varchar(100)
AS
begin
	begin tran
	insert into LongCapitalPlace(
	LongProjectsId,PlaceMoney,PlaceDate,PlaceExplain)
	values
	(
	@LongProjectsId,@PlaceMoney,@PlaceDate,@PlaceExplain
	)	
	
	
		if(@@ERROR<>0)
			begin
				rollback
				return -1
			end
	commit tran
	return 0
end
GO
/****** Object:  StoredProcedure [dbo].[LongCapitalPlace_DeleteByLongProjectsId]    Script Date: 12/07/2016 16:56:28 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
/*********************
--: CapitalPlace_DeleteByProjectsId
--: CapitalPlace, 
--: 
Projects
--: 
	
--:
	0 - 
	-1 -  
**************/
CREATE PROCEDURE [dbo].[LongCapitalPlace_DeleteByLongProjectsId]
@LongProjectsId varchar(50)
AS
begin
	begin tran
delete LongCapitalPlace
where LongProjectsId=@LongProjectsId
	
	
		if(@@ERROR<>0)
			begin
				rollback
				return -1
			end
	commit tran
	return 0
end
GO
/****** Object:  StoredProcedure [dbo].[LongCapitalPlace_Delete]    Script Date: 12/07/2016 16:56:28 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
/*********************
--: CapitalPlace_Delete
--: CapitalPlace, 
--: 
Projects
--: 
	
--:
	0 - 
	-1 -  
**************/
CREATE PROCEDURE [dbo].[LongCapitalPlace_Delete]
@LongCapitalPlaceId int
AS
begin
	begin tran
delete LongCapitalPlace
where LongCapitalPlaceId=@LongCapitalPlaceId
	
	
		if(@@ERROR<>0)
			begin
				rollback
				return -1
			end
	commit tran
	return 0
end
GO
/****** Object:  StoredProcedure [dbo].[LongCapitalClose_UpdateStatus]    Script Date: 12/07/2016 16:56:28 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
/*********************
--: LongCapitalClose_UpdateStatus
--: LongCapitalClose, 
--: 
  LongCapitalCloseId,TransferStatus,ProcessRoleId
--: 
	
--:
	0 - 
	-1 -  
**************/
CREATE PROCEDURE [dbo].[LongCapitalClose_UpdateStatus]
@LongProjectsId varchar(50),
@TransferStatus varchar(20),
@ProcessRankId varchar(20),
@ProcessDepartmentId int
AS
begin
	begin tran
	
	update LongCapitalClose set 
TransferStatus=@TransferStatus
	where LongProjectsId=@LongProjectsId 
	if not exists(  select * from LongCapitalCloseWaitExamine where LongProjectsId=@LongProjectsId)
	begin
	insert into LongCapitalCloseWaitExamine 
	(LongProjectsId,ProcessDepartmentId,ProcessRankId)
	values
	(@LongProjectsId,@ProcessDepartmentId,@ProcessRankId)
	end
	else
	begin
	update LongCapitalClosewaitExamine
	set ProcessDepartmentId=@ProcessDepartmentId,
	ProcessRankId=@ProcessRankId
	where LongProjectsId=@LongProjectsId
	end
		if(@@ERROR<>0)
			begin
				rollback
				return -1
			end
	commit tran
	return 0
end
GO
/****** Object:  StoredProcedure [dbo].[LongCapitalCloseExamine_Insert]    Script Date: 12/07/2016 16:56:28 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
/*********************
--: LongCapitalCloseExamine_Insert
--: QuitExamine, 
--: 
LongProjectsId,ExamineOpinion,ExamineUserCardId,ExamineResult
--: 
	
--:
	0 - 
	-1 -  
**************/
CREATE PROCEDURE [dbo].[LongCapitalCloseExamine_Insert]
@LongProjectsId varchar(50),
@ExamineOpinion varchar(400),
@ExamineUserCardId varchar(50),
@ExamineResult varchar(50),
@RankId int
AS
begin
	begin tran
	declare
	@DepartmentId int,
		@TeachersDepartmentId int,
	@ProcessOrder int,
	@UserCardId varchar(50),
	@OrderRoleId int,
	@OrderDepartmentId int
		set @TeachersDepartmentId=(select TeachersDepartmentId from UserInfo where UserCardId=@ExamineUserCardId)
	set @DepartmentId=(select UserDepartmentId from UserInfo where UserCardId=@ExamineUserCardId)
	set @UserCardId =(select UserCardId from LongCapitalClose where LongProjectsId=@LongProjectsId)
    if exists(select * from LongCapitalCloseExamine where LongProjectsId=@LongProjectsId)
 begin
  set @ProcessOrder=(select MAX(ExamineNumber) from LongCapitalCloseExamine where LongProjectsId=@LongProjectsId)+1  --
 end
 else
 begin
 set @ProcessOrder=1
 end
   	if exists(select * from LongCapitalCloseWaitExamine where( ProcessDepartmentId=@DepartmentId and ProcessRankId=@RankId and LongProjectsId=@LongProjectsId) or (ProcessDepartmentId=@TeachersDepartmentId and ProcessRankId=@RankId and LongProjectsId=@LongProjectsId))
	begin

insert into LongCapitalCloseExamine
(LongProjectsId,ExamineOpinion,ExamineUserCardId,ExamineDate,ExamineNumber,ExamineResult)values
(@LongProjectsId,@ExamineOpinion,@ExamineUserCardId,GETDATE(),@ProcessOrder,@ExamineResult)
	exec [dbo].[Journal_Insert] @ExamineUserCardId,'',''
if(@ExamineResult='')
begin
if exists(select * from LongCapitalCloseAuditProcess where LongProjectsId=@LongProjectsId and ProcessOrder=@ProcessOrder+1)
begin
set @OrderRoleId =(select ProcessRankId from LongCapitalCloseAuditProcess where LongProjectsId=@LongProjectsId and ProcessOrder=@ProcessOrder+1)
set @OrderDepartmentId= (select ProcessDepartmentId from LongCapitalCloseAuditProcess where LongProjectsId=@LongProjectsId and ProcessOrder=@ProcessOrder+1)
exec [dbo].[LongCapitalClose_UpdateStatus] @LongProjectsId,'',@OrderRoleId,@OrderDepartmentId
end 
else
begin
exec[dbo].[LongCapitalClose_UpdateStatus] @LongProjectsId,@ExamineResult,0,0

end
end
else
begin
exec[dbo].[LongCapitalClose_UpdateStatus] @LongProjectsId,@ExamineResult,0,0

end
end
		if(@@ERROR<>0)
			begin
				rollback
				return -1
			end
	commit tran
	return 0
end
GO
/****** Object:  StoredProcedure [dbo].[LongCapitalClose_SelectByMyUserCardId]    Script Date: 12/07/2016 16:56:28 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
/*********************
--: LongCapitalClose_SelectByUserCardId
--: LongCapitalClose, 
--: 
  UserCardId
--: 
	
--:
	0 - 
	-1 -  
**************/
CREATE PROCEDURE [dbo].[LongCapitalClose_SelectByMyUserCardId]
	@UserCardId varchar(50)
	AS
begin
   
	select a.ProjectsName,b.*,d.TransferStatus
	from LongProjects a ,LongCapitalBasic b ,LongCapitalPlan c left join LongCapitalClose d on c.LongProjectsId=d.LongProjectsId
	where a.LongProjectsId=b.LongProjectsId
	and b.LongProjectsId=c.LongProjectsId
	and c.TransferStatus=''
  and  a.UserCardId=@UserCardId
  order by LongProjectsId desc
  
    
end
GO
/****** Object:  StoredProcedure [dbo].[LongCapitalChangeProcess_Select]    Script Date: 12/07/2016 16:56:28 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
/*********************
--: LongCapitalChangeProcess_Select
--: LongCapitalChangeProcess, 
--: 
--LongCapitalChangeRoleId
--: 
	
--:
	0 - 
	-1 -  
**************/
CREATE PROCEDURE [dbo].[LongCapitalChangeProcess_Select]
AS
begin
	 select a.*,b.RankName as ProcessRoleName
  from LongCapitalChangeProcess a,Rank b
  where   a.ProcessRankId=b.RankId

end
GO
/****** Object:  StoredProcedure [dbo].[LongProjects_SelectByMyUserCardId]    Script Date: 12/07/2016 16:56:28 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
/*********************
--: LongProjects_SelectByUserCardId
--: LongProjects, 
--
--: 
  UserCardId
--: 
	
--:
	0 - 
	-1 -  
**************/
CREATE PROCEDURE [dbo].[LongProjects_SelectByMyUserCardId]
	@UserCardId varchar(50)
	AS
begin
  
  select a.*,b.ProjectsFromExplain,c.ProjectsLevelExplain,d.ProjectsSubjectExplain
  from LongProjects a,ProjectsFrom b,ProjectsLevel c,ProjectsSubject d
  where UserCardId=@UserCardId and a.ProjectsFromId=b.ProjectsFromId
  and a.ProjectsLevelId =c.ProjectsLevelId and a.ProjectsSubjectId=d.ProjectsSubjectId
    order by a.LongProjectsId desc
end
GO
/****** Object:  StoredProcedure [dbo].[Job_Update]    Script Date: 12/07/2016 16:56:28 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
/*******
--: Job_Update
--: Job, 
--: 
JobId,JobNameJobValue
--: 
	
--:
	0 - 
	-1 -  
*********/
CREATE PROCEDURE [dbo].[Job_Update]
@JobId int,
@JobName varchar(50),
@UserCardId varchar(50)
AS
begin
	begin tran
		if not exists (select * from Job where JobName=@JobName and JobId<>@JobId)
		begin
		update Job set JobName=@JobName where JobId=@JobId
		exec [dbo].[Journal_Insert] @UserCardId,'',''
		end
		
		if(@@ERROR<>0)
			begin
				rollback
				return -1
			end
	commit tran
	return 0
end
GO
/****** Object:  StoredProcedure [dbo].[Job_Insert]    Script Date: 12/07/2016 16:56:28 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
/*********************
--: Job_Insert
--: Job, 
--: 
   JobName,JobValue
--: 
	
--:
	0 - 
	-1 -  
**************/
CREATE PROCEDURE [dbo].[Job_Insert]
@JobName varchar(50),
@UserCardId varchar(50)
AS
begin
	begin tran
		insert into Job (
		JobName
		) values(
		@JobName
		)
		exec [dbo].[Journal_Insert] @UserCardId,'',''
		if(@@ERROR<>0)
			begin
				rollback
				return -1
			end
	commit tran
	return 0
end
GO
/****** Object:  StoredProcedure [dbo].[Job_Delete]    Script Date: 12/07/2016 16:56:28 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
/*******
--: Job_Delete
--: Job, 
--: 
JobId
--: 
	
--:
	0 - 
	-1 -  
*********/
CREATE PROCEDURE [dbo].[Job_Delete]
@JobId int,
@UserCardId varchar(50)
AS
begin
	begin tran
		delete Job where JobId=@JobId
		exec [dbo].[Journal_Insert] @UserCardId,'',''
		if(@@ERROR<>0)
			begin
				rollback
				return -1
			end
	commit tran
	return 0
end
GO
/****** Object:  StoredProcedure [dbo].[Email_Update]    Script Date: 12/07/2016 16:56:28 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
/*******
--: Email_Update
--: Email, 
--: 
UserCardId,IndividuaNumberHomeNumberWorkNumber
--: 
	
--:
	0 - 
	-1 -  
*********/
CREATE PROCEDURE [dbo].[Email_Update]
@UserCardId varchar(50),
@IndividuaNumber varchar(50),
@HomeNumber varchar(50)=null,
@WorkNumber varchar(50)=null,
@UserCardId2 varchar(50)
AS
begin
	begin tran
	if exists(select * from Email where UserCardId=@UserCardId)
	begin
	if(@HomeNumber is null)
	begin
	set @HomeNumber=(select HomeNumber from Email where UserCardId=@UserCardId)
	end
	if(@WorkNumber is null)
	begin
	set @WorkNumber=(select WorkNumber from Email where UserCardId=@UserCardId)
	end
		update Email 
		set IndividuaNumber=@IndividuaNumber
		,HomeNumber=@HomeNumber
		,WorkNumber=@WorkNumber
		 where UserCardId=@UserCardId
	
	end
		else
		begin
		insert into Email (
		UserCardId,IndividuaNumber,HomeNumber,WorkNumber
		) values(
		@UserCardId,@IndividuaNumber,@HomeNumber,@WorkNumber
		)
		
		end
			set @UserCardId=''+@UserCardId
	exec [dbo].[Journal_Insert] @UserCardId2,'',@UserCardId
		if(@@ERROR<>0)
			begin
				rollback
				return -1
			end
	commit tran
	return 0
end
GO
/****** Object:  StoredProcedure [dbo].[Degree_Update]    Script Date: 12/07/2016 16:56:28 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
/*******
--: Degree_Update
--: Department, 
--: 
DegreeId,DegreeName
--: 
	
--:
	0 - 
	-1 -  
*********/
CREATE PROCEDURE [dbo].[Degree_Update]
@DegreeId int,
@DegreeName varchar(50),
@UserCardId varchar(50)
AS
begin
	begin tran
	if not exists(select * from Degree where DegreeId<>@DegreeId  and DegreeName=@DegreeName )
	begin
		update Degree set DegreeName=@DegreeName where DegreeId=@DegreeId
		exec [dbo].[Journal_Insert] @UserCardId,'',''
		end
		if(@@ERROR<>0)
			begin
				rollback
				return -1
			end
	commit tran
	return 0
end
GO
/****** Object:  StoredProcedure [dbo].[Degree_Insert]    Script Date: 12/07/2016 16:56:27 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
/*********************
--: Degree_Insert
--: Degree, 
--: 
   DegreeName
--: 
	
--:
	0 - 
	-1 -  
**************/
CREATE PROCEDURE [dbo].[Degree_Insert]
@DegreeName varchar(50),
@UserCardId varchar(50)
AS
begin
	begin tran
	insert into Degree(
	DegreeName
	)values(
	@DegreeName
	)
	exec [dbo].[Journal_Insert] @UserCardId,'',''
		if(@@ERROR<>0)
			begin
				rollback
				return -1
			end
	commit tran
	return 0
end
GO
/****** Object:  StoredProcedure [dbo].[Degree_Delete]    Script Date: 12/07/2016 16:56:27 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
/*******
--: Degree_Delete
--: Degree, 
--: 
DegreeId
--: 
	
--:
	0 - 
	-1 -  
*********/
CREATE PROCEDURE [dbo].[Degree_Delete]
@DegreeId int,
@UserCardId varchar(50)
AS
begin
	begin tran
		delete Degree where DegreeId=@DegreeId
		exec [dbo].[Journal_Insert] @UserCardId,'',''
		if(@@ERROR<>0)
			begin
				rollback
				return -1
			end
	commit tran
	return 0
end
GO
/****** Object:  StoredProcedure [dbo].[UserInfo_SelectRankSum]    Script Date: 12/07/2016 16:56:31 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
/******
--  UserInfo_SelectRankSum
--UserInfo, 
-- 
-- RankId     
-- 
--    @RankSum

******/
CREATE PROCEDURE [dbo].[UserInfo_SelectRankSum]
   @RankId int,
   @RankSum    int output
AS
begin
 if exists(select * from UserRank where RankId=@RankId)
   begin 
    set @RankSum=(select count(UserRankId) from UserRank where RankId=@RankId)
    end
    else
    begin
      set @RankSum=0
    end

end
GO
/****** Object:  StoredProcedure [dbo].[LongProjects_UpdateStandStatus]    Script Date: 12/07/2016 16:56:28 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
/*********************
--: LongProjects_UpdateStatus
--: LongProjects, 
--
--: 
  LongProjectsId,TransferStatus,ProcessRoleId
--: 
	
--:
	0 - 
	-1 -  
**************/
CREATE PROCEDURE [dbo].[LongProjects_UpdateStandStatus]
@LongProjectsId varchar(50),
@TransferStatus varchar(20),
@ProcessRankId varchar(20),
@ProcessDepartmentId int
AS
begin
	begin tran
	
	update LongProjects set 
	StandStatus=@TransferStatus 
	where LongProjectsId=@LongProjectsId  --
	if exists( select * from LongProjectsStandWaitExamine where LongProjectsId=@LongProjectsId)
	begin
	update LongProjectsStandWaitExamine
	set ProcessRankId=@ProcessRankId,
	ProcessDepartmentId=@ProcessDepartmentId
	where LongProjectsId=@LongProjectsId --
	end
	else
	begin
	insert into LongProjectsStandWaitExamine
	(LongProjectsId,ProcessRankId,ProcessDepartmentId)
	values
	(@LongProjectsId,@ProcessRankId,@ProcessDepartmentId)
	end
	
		if(@@ERROR<>0)
			begin
				rollback
				return -1
			end
	commit tran
	return 0
end
GO
/****** Object:  StoredProcedure [dbo].[LongProjectsStandExamine_Insert]    Script Date: 12/07/2016 16:56:29 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
/*********************
--: LongProjectsStandExamine_Insert
--:  LongProjectsStandExamine, 
--
--: 
LongProjectsId,ExamineOpinion,ExamineUserCardId,ExamineResult
--: 
	
--:
	0 - 
	-1 -  
**************/
CREATE PROCEDURE [dbo].[LongProjectsStandExamine_Insert]
@LongProjectsId varchar(50),
@ExamineOpinion varchar(400),
@ExamineUserCardId varchar(50),
@ExamineResult varchar(50),
@RankId int
AS
begin
	begin tran
	declare
	@DepartmentId int,--
	@TeachersDepartmentId int,
	@ProcessOrder int,--
	@UserCardId varchar(50),--
	@OrderRoleId int,--
	@OrderDepartmentId int--
	set @DepartmentId=(select UserDepartmentId from UserInfo where UserCardId=@ExamineUserCardId) --
	set @TeachersDepartmentId=(select TeachersDepartmentId from UserInfo where UserCardId=@ExamineUserCardId)
	set @UserCardId =(select UserCardId from LongProjects where LongProjectsId=@LongProjectsId)--
    if exists(select * from LongProjectsStandExamine where LongProjectsId=@LongProjectsId)--
 begin
 --+1
  set @ProcessOrder=(select MAX(ExamineNumber) from LongProjectsStandExamine where LongProjectsId=@LongProjectsId)+1  --
 end
 else
 begin
 --1
 set @ProcessOrder=1
 end
 --
 	if exists(select * from LongProjects a,LongProjectsStandWaitExamine b where (b.ProcessDepartmentId=@DepartmentId and b.ProcessRankId=@RankId and a.LongProjectsId=@LongProjectsId and a.LongProjectsId=b.LongProjectsId)or b.ProcessDepartmentId=@TeachersDepartmentId and b.ProcessRankId=@RankId and a.LongProjectsId=@LongProjectsId and a.LongProjectsId=b.LongProjectsId)
	begin
	--
insert into LongProjectsStandExamine
(LongProjectsId,ExamineOpinion,ExamineUserCardId,ExamineDate,ExamineNumber,ExamineResult)values
(@LongProjectsId,@ExamineOpinion,@ExamineUserCardId,GETDATE(),@ProcessOrder,@ExamineResult)

	exec [dbo].[Journal_Insert] @ExamineUserCardId,'',''--
if(@ExamineResult='')--
begin

if exists(select * from LongProjectsStandAuditProcess where LongProjectsId=@LongProjectsId and ProcessOrder=@ProcessOrder+1)--
begin
set @OrderRoleId =(select ProcessRankId from LongProjectsStandAuditProcess where LongProjectsId=@LongProjectsId and ProcessOrder=@ProcessOrder+1) --
set @OrderDepartmentId= (select ProcessDepartmentId from LongProjectsStandAuditProcess where LongProjectsId=@LongProjectsId and ProcessOrder=@ProcessOrder+1)--
exec [dbo].[LongProjects_UpdateStandStatus] @LongProjectsId,'',@OrderRoleId,@OrderDepartmentId--
end 
else
begin
exec[dbo].[LongProjects_UpdateStandStatus] @LongProjectsId,@ExamineResult,'0',0--
delete LongProjectsStandWaitExamine
where LongProjectsId=@LongProjectsId  --
end
end
else
begin
exec[dbo].[LongProjects_UpdateStandStatus] @LongProjectsId,@ExamineResult,'0',0--
delete LongProjectsStandWaitExamine
where LongProjectsId=@LongProjectsId  --
end
end
		if(@@ERROR<>0)
			begin
				rollback
				return -1
			end
	commit tran
	return 0
end
GO
/****** Object:  StoredProcedure [dbo].[LongProjects_UpdateInspectStatus]    Script Date: 12/07/2016 16:56:28 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
/*********************
--: LongProjects_UpdateStatus
--: LongProjects, 
--
--: 
  LongProjectsId,TransferStatus,ProcessRoleId
--: 
	
--:
	0 - 
	-1 -  
**************/
CREATE PROCEDURE [dbo].[LongProjects_UpdateInspectStatus]
@LongProjectsId varchar(50),
@TransferStatus varchar(20),
@ProcessRankId varchar(20),
@ProcessDepartmentId int
AS
begin
	begin tran
	
	update LongProjects set 
	InspectStatus=@TransferStatus 
	where LongProjectsId=@LongProjectsId  --
	if exists( select * from LongProjectsInspectWaitExamine where LongProjectsId=@LongProjectsId)
	begin
	update LongProjectsInspectWaitExamine
	set ProcessRankId=@ProcessRankId,
	ProcessDepartmentId=@ProcessDepartmentId
	where LongProjectsId=@LongProjectsId --
	end
	else
	begin
	insert into LongProjectsInspectWaitExamine
	(LongProjectsId,ProcessRankId,ProcessDepartmentId)
	values
	(@LongProjectsId,@ProcessRankId,@ProcessDepartmentId)
	end
	
		if(@@ERROR<>0)
			begin
				rollback
				return -1
			end
	commit tran
	return 0
end
GO
/****** Object:  StoredProcedure [dbo].[LongProjectsInspectExamine_Insert]    Script Date: 12/07/2016 16:56:29 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
/*********************
--: LongProjectsInspectExamine_Insert
--:  LongProjectsInspectExamine, 
--
--: 
LongProjectsId,ExamineOpinion,ExamineUserCardId,ExamineResult
--: 
	
--:
	0 - 
	-1 -  
**************/
CREATE PROCEDURE [dbo].[LongProjectsInspectExamine_Insert]
@LongProjectsId varchar(50),
@ExamineOpinion varchar(400),
@ExamineUserCardId varchar(50),
@ExamineResult varchar(50),
@RankId int
AS
begin
	begin tran
	declare
	@DepartmentId int,--
	@TeachersDepartmentId int,
	@ProcessOrder int,--
	@UserCardId varchar(50),--
	@OrderRoleId int,--
	@OrderDepartmentId int--
	set @DepartmentId=(select UserDepartmentId from UserInfo where UserCardId=@ExamineUserCardId) --
	set @TeachersDepartmentId=(select TeachersDepartmentId from UserInfo where UserCardId=@ExamineUserCardId)
	set @UserCardId =(select UserCardId from LongProjects where LongProjectsId=@LongProjectsId)--
  	if exists(select * from LongProjectsInspectExamine where LongProjectsId=@LongProjectsId)
 begin
 --+1
  set @ProcessOrder=(select MAX(ExamineNumber) from LongProjectsInspectExamine where LongProjectsId=@LongProjectsId)+1  --
 end
 else
 begin
 --1
 set @ProcessOrder=1
 end
 --
   if exists(select * from LongProjects a,LongProjectsInspectWaitExamine b where (b.ProcessDepartmentId=@DepartmentId and b.ProcessRankId=@RankId and a.LongProjectsId=@LongProjectsId and a.LongProjectsId=b.LongProjectsId)or (b.ProcessDepartmentId=@TeachersDepartmentId and b.ProcessRankId=@RankId and a.LongProjectsId=@LongProjectsId and a.LongProjectsId=b.LongProjectsId))
	begin
	--
insert into LongProjectsInspectExamine
(LongProjectsId,ExamineOpinion,ExamineUserCardId,ExamineDate,ExamineNumber,ExamineResult)values
(@LongProjectsId,@ExamineOpinion,@ExamineUserCardId,GETDATE(),@ProcessOrder,@ExamineResult)

	exec [dbo].[Journal_Insert] @ExamineUserCardId,'',''--
if(@ExamineResult='')--
begin

if exists(select * from LongProjectsInspectAuditProcess where LongProjectsId=@LongProjectsId and ProcessOrder=@ProcessOrder+1)--
begin
set @OrderRoleId =(select ProcessRankId from LongProjectsInspectAuditProcess where LongProjectsId=@LongProjectsId and ProcessOrder=@ProcessOrder+1) --
set @OrderDepartmentId= (select ProcessDepartmentId from LongProjectsInspectAuditProcess where LongProjectsId=@LongProjectsId and ProcessOrder=@ProcessOrder+1)--
exec [dbo].[LongProjects_UpdateInspectStatus] @LongProjectsId,'',@OrderRoleId,@OrderDepartmentId--
end 
else
begin
exec[dbo].[LongProjects_UpdateInspectStatus] @LongProjectsId,@ExamineResult,0,0--
delete LongProjectsInspectWaitExamine
where LongProjectsId=@LongProjectsId  --
end
end
else
begin
exec[dbo].[LongProjects_UpdateInspectStatus] @LongProjectsId,@ExamineResult,0,0--
delete LongProjectsInspectWaitExamine
where LongProjectsId=@LongProjectsId  --
end
end
		if(@@ERROR<>0)
			begin
				rollback
				return -1
			end
	commit tran
	return 0
end
GO
/****** Object:  StoredProcedure [dbo].[LongProjects_UpdateEndStatus]    Script Date: 12/07/2016 16:56:28 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
/*********************
--: LongProjects_UpdateStatus
--: LongProjects, 
--
--: 
  LongProjectsId,TransferStatus,ProcessRoleId
--: 
	
--:
	0 - 
	-1 -  
**************/
CREATE PROCEDURE [dbo].[LongProjects_UpdateEndStatus]
@LongProjectsId varchar(50),
@TransferStatus varchar(20),
@ProcessRankId varchar(20),
@ProcessDepartmentId int
AS
begin
	begin tran
	
	update LongProjects set 
	EndStatus=@TransferStatus 
	where LongProjectsId=@LongProjectsId  --
		if exists( select * from LongProjectsEndWaitExamine where LongProjectsId=@LongProjectsId)
	begin
	update LongProjectsEndWaitExamine
	set ProcessRankId=@ProcessRankId,
	ProcessDepartmentId=@ProcessDepartmentId
	where LongProjectsId=@LongProjectsId --
	end
	else
	begin
	insert into LongProjectsEndWaitExamine
	(LongProjectsId,ProcessRankId,ProcessDepartmentId)
	values
	(@LongProjectsId,@ProcessRankId,@ProcessDepartmentId)
	end
	
		if(@@ERROR<>0)
			begin
				rollback
				return -1
			end
	commit tran
	return 0
end
GO
/****** Object:  StoredProcedure [dbo].[LongProjectsEndExamine_Insert]    Script Date: 12/07/2016 16:56:29 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
/*********************
--: LongProjectsEndExamine_Insert
--:  LongProjectsEndExamine, 
--
--: 
LongProjectsId,ExamineOpinion,ExamineUserCardId,ExamineResult
--: 
	
--:
	0 - 
	-1 -  
**************/
CREATE PROCEDURE [dbo].[LongProjectsEndExamine_Insert]
@LongProjectsId varchar(50),
@ExamineOpinion varchar(400),
@ExamineUserCardId varchar(50),
@ExamineResult varchar(50),
@RankId int
AS
begin
	begin tran
	declare
	@DepartmentId int,--
	@TeachersDepartmentId int,
	@ProcessOrder int,--
	@UserCardId varchar(50),--
	@OrderRoleId int,--
	@OrderDepartmentId int--
	set @DepartmentId=(select UserDepartmentId from UserInfo where UserCardId=@ExamineUserCardId) --
	set @TeachersDepartmentId=(select TeachersDepartmentId from UserInfo where UserCardId=@ExamineUserCardId)
	set @UserCardId =(select UserCardId from LongProjects where LongProjectsId=@LongProjectsId)--
    if exists(select * from LongProjectsEndExamine where LongProjectsId=@LongProjectsId)--
 begin
 --+1
  set @ProcessOrder=(select MAX(ExamineNumber) from LongProjectsEndExamine where LongProjectsId=@LongProjectsId)+1  --
 end
 else
 begin
 --1
 set @ProcessOrder=1
 end
 --
  	if exists(select * from LongProjects a,LongProjectsEndWaitExamine b where (b.ProcessDepartmentId=@DepartmentId and b.ProcessRankId=@RankId and a.LongProjectsId=@LongProjectsId and a.LongProjectsId=b.LongProjectsId)or (b.ProcessDepartmentId=@TeachersDepartmentId and b.ProcessRankId=@RankId and a.LongProjectsId=@LongProjectsId and a.LongProjectsId=b.LongProjectsId))
	begin
	--
insert into LongProjectsEndExamine
(LongProjectsId,ExamineOpinion,ExamineUserCardId,ExamineDate,ExamineNumber,ExamineResult)values
(@LongProjectsId,@ExamineOpinion,@ExamineUserCardId,GETDATE(),@ProcessOrder,@ExamineResult)

	exec [dbo].[Journal_Insert] @ExamineUserCardId,'',''--
if(@ExamineResult='')--
begin

if exists(select * from LongProjectsEndAuditProcess where LongProjectsId=@LongProjectsId and ProcessOrder=@ProcessOrder+1)--
begin
set @OrderRoleId =(select ProcessRankId from LongProjectsEndAuditProcess where LongProjectsId=@LongProjectsId and ProcessOrder=@ProcessOrder+1) --
set @OrderDepartmentId= (select ProcessDepartmentId from LongProjectsEndAuditProcess where LongProjectsId=@LongProjectsId and ProcessOrder=@ProcessOrder+1)--
exec [dbo].[LongProjects_UpdateEndStatus] @LongProjectsId,'',@OrderRoleId,@OrderDepartmentId--
end 
else
begin
exec[dbo].[LongProjects_UpdateEndStatus] @LongProjectsId,@ExamineResult,0,0--
delete LongProjectsEndWaitExamine
where LongProjectsId=@LongProjectsId  --
end
end
else
begin
exec[dbo].[LongProjects_UpdateEndStatus] @LongProjectsId,@ExamineResult,0,0--
delete LongProjectsEndWaitExamine
where LongProjectsId=@LongProjectsId  --
end
end
		if(@@ERROR<>0)
			begin
				rollback
				return -1
			end
	commit tran
	return 0
end
GO
/****** Object:  StoredProcedure [dbo].[LongProjects_UpdateDeclareStatus]    Script Date: 12/07/2016 16:56:28 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
/*********************
--: LongProjects_UpdateStatus
--: LongProjects, 
--
--: 
  LongProjectsId,TransferStatus,ProcessRoleId
--: 
	
--:
	0 - 
	-1 -  
**************/
CREATE PROCEDURE [dbo].[LongProjects_UpdateDeclareStatus]
@LongProjectsId varchar(50),
@TransferStatus varchar(20),
@ProcessRankId varchar(20),
@ProcessDepartmentId int
AS
begin
	begin tran
	
	update LongProjects set 
	DeclareStatus=@TransferStatus 
	where LongProjectsId=@LongProjectsId  --
	if exists( select * from LongProjectsDeclareWaitExamine where LongProjectsId=@LongProjectsId)
	begin
	update LongProjectsDeclareWaitExamine
	set ProcessRankId=@ProcessRankId,
	ProcessDepartmentId=@ProcessDepartmentId
	where LongProjectsId=@LongProjectsId --
	end
	else
	begin
	insert into LongProjectsDeclareWaitExamine
	(LongProjectsId,ProcessRankId,ProcessDepartmentId)
	values
	(@LongProjectsId,@ProcessRankId,@ProcessDepartmentId)
	end
	
		if(@@ERROR<>0)
			begin
				rollback
				return -1
			end
	commit tran
	return 0
end
GO
/****** Object:  StoredProcedure [dbo].[LongProjectsDeclareExamine_Insert]    Script Date: 12/07/2016 16:56:28 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
/*********************
--: LongProjectsDeclareExamine_Insert
--:  LongProjectsDeclareExamine, 
--
--: 
LongProjectsDeclareId,ExamineOpinion,ExamineUserCardId,ExamineResult
--: 
	
--:
	0 - 
	-1 -  
**************/
CREATE PROCEDURE [dbo].[LongProjectsDeclareExamine_Insert]
@LongProjectsId varchar(50),
@ExamineOpinion varchar(400),
@ExamineUserCardId varchar(50),
@ExamineResult varchar(50),
@RankId int
AS
begin
	begin tran
	declare
	@DepartmentId int,--
		@TeachersDepartmentId int,
	@ProcessOrder int,--
	@UserCardId varchar(50),--
	@OrderRoleId int,--
	@OrderDepartmentId int--
	set @DepartmentId=(select UserDepartmentId from UserInfo where UserCardId=@ExamineUserCardId) --
	
		set @TeachersDepartmentId=(select TeachersDepartmentId from UserInfo where UserCardId=@ExamineUserCardId)
set @UserCardId =(select UserCardId from LongProjects where LongProjectsId=@LongProjectsId)--
    if exists(select * from LongProjectsDeclareExamine where LongProjectsId=@LongProjectsId)--
 begin
 --+1
  set @ProcessOrder=(select MAX(ExamineNumber) from LongProjectsDeclareExamine where LongProjectsId=@LongProjectsId)+1  --
 end
 else
 begin
 --1
 set @ProcessOrder=1
 end
 --
   	if exists(select * from LongProjects a,LongProjectsDeclareWaitExamine b where (b.ProcessDepartmentId=@DepartmentId and b.ProcessRankId=@RankId and a.LongProjectsId=@LongProjectsId and a.LongProjectsId=b.LongProjectsId)or(b.ProcessDepartmentId=@TeachersDepartmentId and b.ProcessRankId=@RankId and a.LongProjectsId=@LongProjectsId and a.LongProjectsId=b.LongProjectsId))
	begin
	--
insert into LongProjectsDeclareExamine
(LongProjectsId,ExamineOpinion,ExamineUserCardId,ExamineDate,ExamineNumber,ExamineResult)values
(@LongProjectsId,@ExamineOpinion,@ExamineUserCardId,GETDATE(),@ProcessOrder,@ExamineResult)

	exec [dbo].[Journal_Insert] @ExamineUserCardId,'',''--
if(@ExamineResult='')--
begin

if exists(select * from LongProjectsDeclareAuditProcess where LongProjectsId=@LongProjectsId and ProcessOrder=@ProcessOrder+1)--
begin
set @OrderRoleId =(select ProcessRankId from LongProjectsDeclareAuditProcess where LongProjectsId=@LongProjectsId and ProcessOrder=@ProcessOrder+1) --
set @OrderDepartmentId= (select ProcessDepartmentId from LongProjectsDeclareAuditProcess where LongProjectsId=@LongProjectsId and ProcessOrder=@ProcessOrder+1)--
exec [dbo].[LongProjects_UpdateDeclareStatus] @LongProjectsId,'',@OrderRoleId,@OrderDepartmentId--
end 
else
begin
exec[dbo].[LongProjects_UpdateDeclareStatus] @LongProjectsId,@ExamineResult,0,0--
delete LongProjectsDeclareWaitExamine
where LongProjectsId=@LongProjectsId  --
end
end
else
begin
exec[dbo].[LongProjects_UpdateDeclareStatus] @LongProjectsId,@ExamineResult,0,0--
delete LongProjectsDeclareWaitExamine
where LongProjectsId=@LongProjectsId  --
end
end
		if(@@ERROR<>0)
			begin
				rollback
				return -1
			end
	commit tran
	return 0
end
GO
/****** Object:  StoredProcedure [dbo].[LongProjects_SelectInspectUserCardId]    Script Date: 12/07/2016 16:56:28 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
/*********************
--: LongProjects_SelectByUserCardId
--: LongProjects, 
--
--: 
  UserCardId
--: 
	
--:
	0 - 
	-1 -  
**************/
CREATE PROCEDURE [dbo].[LongProjects_SelectInspectUserCardId]
@UserCardId varchar(50)
	AS
begin
  
  select a.*,b.ProjectsFromExplain,c.ProjectsLevelExplain,d.ProjectsSubjectExplain
  from LongProjects a,ProjectsFrom b,ProjectsLevel c,ProjectsSubject d
  where a.ProjectsFromId=b.ProjectsFromId
  and a.ProjectsLevelId =c.ProjectsLevelId 
  and a.ProjectsSubjectId=d.ProjectsSubjectId
  and a.InspectStatus<>''
  and UserCardId=@UserCardId
    order by LongprojectsId desc


    
end
GO
/****** Object:  StoredProcedure [dbo].[LongProjects_SelectEndUserCardId]    Script Date: 12/07/2016 16:56:28 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
/*********************
--: LongProjects_SelectByUserCardId
--: LongProjects, 
--
--: 
  UserCardId
--: 
	
--:
	0 - 
	-1 -  
**************/
CREATE PROCEDURE [dbo].[LongProjects_SelectEndUserCardId]
@UserCardId varchar(50)
	AS
begin
  
  select a.*,b.ProjectsFromExplain,c.ProjectsLevelExplain,d.ProjectsSubjectExplain
  from LongProjects a,ProjectsFrom b,ProjectsLevel c,ProjectsSubject d
  where a.ProjectsFromId=b.ProjectsFromId
  and a.ProjectsLevelId =c.ProjectsLevelId 
  and a.ProjectsSubjectId=d.ProjectsSubjectId
  and a.EndStatus<>''
  and UserCardId=@UserCardId
    order by LongprojectsId desc


    
end
GO
/****** Object:  StoredProcedure [dbo].[Harvest_UpdateStatus]    Script Date: 12/07/2016 16:56:28 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
/*********************
--: Harvest_UpdateStatus
--: Harvest, 
--: 
  HarvestId,TransferStatus,ProcessRoleId
--: 
	
--:
	0 - 
	-1 -  
**************/
CREATE PROCEDURE [dbo].[Harvest_UpdateStatus]
@HarvestId int,
@TransferStatus varchar(20),
@ProcessRoleId varchar(20),
@ProcessDepartmentId int
AS
begin
	begin tran
	
	update Harvest set 
TransferStatus=@TransferStatus,
ProcessRoleId=@ProcessRoleId,
ProcessDepartmentId=@ProcessDepartmentId
	where HarvestId=@HarvestId 
	
		if(@@ERROR<>0)
			begin
				rollback
				return -1
			end
	commit tran
	return 0
end
GO
/****** Object:  StoredProcedure [dbo].[HarvestExamine_Insert]    Script Date: 12/07/2016 16:56:28 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
/*********************
--: HarvestExamine_Insert
--: QuitExamine, 
--: 
HarvestId,ExamineOpinion,ExamineUserCardId,ExamineResult
--: 
	
--:
	0 - 
	-1 -  
**************/
CREATE PROCEDURE [dbo].[HarvestExamine_Insert]
@HarvestId int,
@ExamineOpinion varchar(400),
@ExamineUserCardId varchar(50),
@ExamineResult varchar(50),
@RankId int
AS
begin
	begin tran
	declare
	@DepartmentId int,
	@TeachersDepartmentId int,
	@ProcessOrder int,
	@UserCardId varchar(50),
	@OrderRoleId int,
	@OrderDepartmentId int
	set @DepartmentId=(select UserDepartmentId from UserInfo where UserCardId=@ExamineUserCardId)
	set @TeachersDepartmentId=(select TeachersDepartmentId from UserInfo where UserCardId=@ExamineUserCardId)
	set @UserCardId =(select UserCardId from Harvest where HarvestId=@HarvestId)
    if exists(select * from HarvestExamine where HarvestId=@HarvestId)
 begin
  set @ProcessOrder=(select MAX(ExamineNumber) from HarvestExamine where HarvestId=@HarvestId)+1  --
 end
 else
 begin
 set @ProcessOrder=1
 end
   	if exists(select * from Harvest where (ProcessDepartmentId=@DepartmentId and ProcessRoleId=@RankId) or (ProcessDepartmentId=@TeachersDepartmentId and ProcessRoleId=@RankId))
	begin

insert into HarvestExamine
(HarvestId,ExamineOpinion,ExamineUserCardId,ExamineDate,ExamineNumber,ExamineResult)values
(@HarvestId,@ExamineOpinion,@ExamineUserCardId,GETDATE(),@ProcessOrder,@ExamineResult)
 exec [dbo].[Journal_Insert] @ExamineUserCardId,'',''
if(@ExamineResult='')
begin
if exists(select * from HarvestAuditProcess where HarvestId=@HarvestId and ProcessOrder=@ProcessOrder+1)
begin
set @OrderRoleId =(select ProcessRankId from HarvestAuditProcess where HarvestId=@HarvestId and ProcessOrder=@ProcessOrder+1)
set @OrderDepartmentId= (select ProcessDepartmentId from HarvestAuditProcess where HarvestId=@HarvestId and ProcessOrder=@ProcessOrder+1)
exec [dbo].[Harvest_UpdateStatus] @HarvestId,'',@OrderRoleId,@OrderDepartmentId
end 
else
begin
exec[dbo].[HarvestPartner_AddValue] @HarvestId
exec[dbo].[Harvest_UpdateStatus] @HarvestId,@ExamineResult,'',0
end
end
else
begin
exec[dbo].[Harvest_UpdateStatus] @HarvestId,@ExamineResult,'',0
end
end
		if(@@ERROR<>0)
			begin
				rollback
				return -1
			end
	commit tran
	return 0
end
GO
/****** Object:  StoredProcedure [dbo].[ProjectsLevel_SelectByProjectsLevelId]    Script Date: 12/07/2016 16:56:29 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
/******
--: ProjectsFrom_SelectByProjectsFromId
--: ProjectsFrom, 
--: 
ProjectsFromId
--: 
	
--:
	0 - 
	-1 -  
******/
CREATE PROCEDURE [dbo].[ProjectsLevel_SelectByProjectsLevelId]
@ProjectsLevelId int
AS
begin

		select * from   ProjectsLevel where ProjectsLevelId=@ProjectsLevelId

end
GO
/****** Object:  StoredProcedure [dbo].[ProjectsLevel_Select]    Script Date: 12/07/2016 16:56:29 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
/******
--: ProjectsFrom_Select
--: ProjectsFromProjectsFrom 
--: 
--: 
	
--:
	0 - 
	-1 -  
******/
CREATE PROCEDURE [dbo].[ProjectsLevel_Select]

AS
begin

		select * from ProjectsLevel

end
GO
/****** Object:  StoredProcedure [dbo].[GuidancePartner_UpdateGuidanceId]    Script Date: 12/07/2016 16:56:28 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
/*********************
--: GuidancePartner_Update
--: Guidance, 
--: 


--: 
	
--:
	0 - 
	-1 -  
**************/
CREATE PROCEDURE [dbo].[GuidancePartner_UpdateGuidanceId]
	@GuidanceId int,
	@UserCardId varchar(50),
	@PartnerRank int,
	@PartnerValue float
AS
begin
	begin tran
 declare @sum float,
    @GuidanceValue float,
    @UserValue float
 
    set @UserValue=(select PartnerValue from GuidancePartner where GuidanceId=@GuidanceId and PartnerUserCardId=@UserCardId)
    set @sum=(select SUM(PartnerValue) from GuidancePartner where GuidanceId=@GuidanceId)
    set @GuidanceValue=(select GuidanceValue from Guidance where GuidanceId=@GuidanceId)
    if(@sum-@UserValue+@PartnerValue<=@GuidanceValue)
    begin
		update GuidancePartner set
		PartnerRank=@PartnerRank,
		PartnerValue=@PartnerValue,
		PartnerUserCardId=@UserCardId
		where GuidanceId=@GuidanceId and 	PartnerUserCardId=@UserCardId
end

		if(@@ERROR<>0)
			begin
				rollback
				return -1
			end
	commit tran
	return 0
end
GO
/****** Object:  StoredProcedure [dbo].[Guidance_UpdateStatus]    Script Date: 12/07/2016 16:56:28 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
/*********************
--: Guidance_UpdateStatus
--: Guidance, 
--: 
  GuidanceId,TransferStatus,ProcessRoleId
--: 
	
--:
	0 - 
	-1 -  
**************/
CREATE PROCEDURE [dbo].[Guidance_UpdateStatus]
@GuidanceId int,
@TransferStatus varchar(20),
@ProcessRoleId varchar(20),
@ProcessDepartmentId int
AS
begin
	begin tran
	
	update Guidance set 
TransferStatus=@TransferStatus,
ProcessRoleId=@ProcessRoleId,
ProcessDepartmentId=@ProcessDepartmentId
	where GuidanceId=@GuidanceId 
	
		if(@@ERROR<>0)
			begin
				rollback
				return -1
			end
	commit tran
	return 0
end
GO
/****** Object:  StoredProcedure [dbo].[GuidanceExamine_Insert]    Script Date: 12/07/2016 16:56:28 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
/*********************
--: GuidanceExamine_Insert
--: QuitExamine, 
--: 
GuidanceId,ExamineOpinion,ExamineUserCardId,ExamineResult
--: 
	
--:
	0 - 
	-1 -  
**************/
CREATE PROCEDURE [dbo].[GuidanceExamine_Insert]
@GuidanceId int,
@ExamineOpinion varchar(400),
@ExamineUserCardId varchar(50),
@ExamineResult varchar(50),
@RankId int
AS
begin
	begin tran
	declare
	@DepartmentId int,
	@TeachersDepartmentId int,
	@ProcessOrder int,
	@UserCardId varchar(50),
	@OrderRoleId int,
	@OrderDepartmentId int
	set @DepartmentId=(select UserDepartmentId from UserInfo where UserCardId=@ExamineUserCardId)	
	set @TeachersDepartmentId=(select TeachersDepartmentId from UserInfo where UserCardId=@ExamineUserCardId)
	set @UserCardId =(select UserCardId from Guidance where GuidanceId=@GuidanceId)
    if exists(select * from GuidanceExamine where GuidanceId=@GuidanceId)
 begin
  set @ProcessOrder=(select MAX(ExamineNumber) from GuidanceExamine where GuidanceId=@GuidanceId)+1  --
 end
 else
 begin
 set @ProcessOrder=1
 end
   	if exists(select * from Guidance where (ProcessDepartmentId=@DepartmentId and ProcessRoleId=@RankId) or (ProcessDepartmentId=@TeachersDepartmentId and ProcessRoleId=@RankId))
	begin

insert into GuidanceExamine
(GuidanceId,ExamineOpinion,ExamineUserCardId,ExamineDate,ExamineNumber,ExamineResult)values
(@GuidanceId,@ExamineOpinion,@ExamineUserCardId,GETDATE(),@ProcessOrder,@ExamineResult)
	exec [dbo].[Journal_Insert] @ExamineUserCardId,'',''
if(@ExamineResult='')
begin
if exists(select * from GuidanceAuditProcess where GuidanceId=@GuidanceId and ProcessOrder=@ProcessOrder+1)
begin
set @OrderRoleId =(select ProcessRankId from GuidanceAuditProcess where GuidanceId=@GuidanceId and ProcessOrder=@ProcessOrder+1)
set @OrderDepartmentId= (select ProcessDepartmentId from GuidanceAuditProcess where GuidanceId=@GuidanceId and ProcessOrder=@ProcessOrder+1)
exec [dbo].[Guidance_UpdateStatus] @GuidanceId,'',@OrderRoleId,@OrderDepartmentId
end 
else
begin
exec[dbo].[GuidancePartner_AddValue] @GuidanceId
exec[dbo].[Guidance_UpdateStatus] @GuidanceId,@ExamineResult,'',0
end
end
else
begin
exec[dbo].[Guidance_UpdateStatus] @GuidanceId,@ExamineResult,'',0
end
end
		if(@@ERROR<>0)
			begin
				rollback
				return -1
			end
	commit tran
	return 0
end
GO
/****** Object:  StoredProcedure [dbo].[Patent_UpdateStatus]    Script Date: 12/07/2016 16:56:29 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
/*********************
--: Patent_UpdateStatus
--: Patent, 
--: 
  PatentId,TransferStatus,ProcessRoleId
--: 
	
--:
	0 - 
	-1 -  
**************/
CREATE PROCEDURE [dbo].[Patent_UpdateStatus]
@PatentId int,
@TransferStatus varchar(20),
@ProcessRoleId varchar(20),
@ProcessDepartmentId int
AS
begin
	begin tran
	
	update Patent set 
TransferStatus=@TransferStatus,
ProcessRoleId=@ProcessRoleId,
ProcessDepartmentId=@ProcessDepartmentId
	where PatentId=@PatentId 
	
		if(@@ERROR<>0)
			begin
				rollback
				return -1
			end
	commit tran
	return 0
end
GO
/****** Object:  StoredProcedure [dbo].[PatentExamine_Insert]    Script Date: 12/07/2016 16:56:29 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
/*********************
--: PatentExamine_Insert
--: QuitExamine, 
--: 
PatentId,ExamineOpinion,ExamineUserCardId,ExamineResult
--: 
	
--:
	0 - 
	-1 -  
**************/
CREATE PROCEDURE [dbo].[PatentExamine_Insert]
@PatentId int,
@ExamineOpinion varchar(400),
@ExamineUserCardId varchar(50),
@ExamineResult varchar(50),
@RankId int
AS
begin
	begin tran
	declare
	@DepartmentId int,
		@TeachersDepartmentId int,
	@ProcessOrder int,
	@UserCardId varchar(50),
	@OrderRoleId int,
	@OrderDepartmentId int
	set @DepartmentId=(select UserDepartmentId from UserInfo where UserCardId=@ExamineUserCardId)
	set @TeachersDepartmentId=(select TeachersDepartmentId from UserInfo where UserCardId=@ExamineUserCardId)
	set @UserCardId =(select UserCardId from Patent where PatentId=@PatentId)
    if exists(select * from PatentExamine where PatentId=@PatentId)
 begin
  set @ProcessOrder=(select MAX(ExamineNumber) from PatentExamine where PatentId=@PatentId)+1  --
 end
 else
 begin
 set @ProcessOrder=1
 end
   	if exists(select * from Patent where (ProcessDepartmentId=@DepartmentId and ProcessRoleId=@RankId) or (ProcessDepartmentId=@TeachersDepartmentId and ProcessRoleId=@RankId))
	begin

insert into PatentExamine
(PatentId,ExamineOpinion,ExamineUserCardId,ExamineDate,ExamineNumber,ExamineResult)values
(@PatentId,@ExamineOpinion,@ExamineUserCardId,GETDATE(),@ProcessOrder,@ExamineResult)
	exec [dbo].[Journal_Insert] @ExamineUserCardId,'',''
if(@ExamineResult='')
begin
if exists(select * from PatentAuditProcess where PatentId=@PatentId and ProcessOrder=@ProcessOrder+1)
begin
set @OrderRoleId =(select ProcessRankId from PatentAuditProcess where PatentId=@PatentId and ProcessOrder=@ProcessOrder+1)
set @OrderDepartmentId= (select ProcessDepartmentId from PatentAuditProcess where PatentId=@PatentId and ProcessOrder=@ProcessOrder+1)
exec [dbo].[Patent_UpdateStatus] @PatentId,'',@OrderRoleId,@OrderDepartmentId
end 
else
begin
exec[dbo].[PatentPartner_AddValue] @PatentId
exec[dbo].[Patent_UpdateStatus] @PatentId,@ExamineResult,'',0
end
end
else
begin
exec[dbo].[Patent_UpdateStatus] @PatentId,@ExamineResult,'',0
end
end
		if(@@ERROR<>0)
			begin
				rollback
				return -1
			end
	commit tran
	return 0
end
GO
/****** Object:  StoredProcedure [dbo].[Right_SelectByUserCardId]    Script Date: 12/07/2016 16:56:30 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
/*********************
--: Teaching_SelectByTeachingUserCardId
--: Teaching, 
--: 
  UserCardId
--: 
	
--:
	0 - 
	-1 -  
**************/
CREATE PROCEDURE [dbo].[Right_SelectByUserCardId]
	@UserCardId varchar(50)
	AS
begin
select (
	select count(*) as countNum	from Teaching a,TeachingPartner d
	where   a.TeachingId=d.TeachingId and d.PartnerUserCardId=@UserCardId
	and a.TransferStatus<>'' and a.TransferStatus<>'' 
	  ) as TeachingNum,(
		select count(*) as countNum	from Winning a,WinningPartner d
	where   a.WinningId=d.WinningId and d.PartnerUserCardId=@UserCardId
	and a.TransferStatus<>'' and a.TransferStatus<>'' 
	  ) as WinningNum,(
		select count(*) as countNum	from Patent a,PatentPartner d
	where   a.PatentId=d.PatentId and d.PartnerUserCardId=@UserCardId
	and a.TransferStatus<>'' and a.TransferStatus<>'' 
	  ) as PatentNum,(
		select count(*) as countNum	from Paper a,PaperPartner d
	where   a.PaperId=d.PaperId and d.PartnerUserCardId=@UserCardId
	and a.TransferStatus<>'' and a.TransferStatus<>'' 
	  ) as PaperNum,(
		select count(*) as countNum	from Guidance a,GuidancePartner d
	where   a.GuidanceId=d.GuidanceId and d.PartnerUserCardId=@UserCardId
	and a.TransferStatus<>'' and a.TransferStatus<>'' 
	  ) as GuidanceNum,(
		select count(*) as countNum	from WorkLoadProjects a,WorkLoadProjectsPartner d
	where   a.WorkLoadProjectsId=d.WorkLoadProjectsId and d.PartnerUserCardId=@UserCardId
	and a.TransferStatus<>'' and a.TransferStatus<>'' 
	  ) as WorkLoadProjectsNum,(
		select count(*) as countNum	from Harvest a,HarvestPartner d
	where   a.HarvestId=d.HarvestId and d.PartnerUserCardId=@UserCardId
	and a.TransferStatus<>'' and a.TransferStatus<>'' 
	  ) as HarvestNum,(
	select count(*) as countNum from LongProjects a
	where a.UserCardId=@UserCardId  and a.DeclareStatus<>'' and a.DeclareStatus<>''
	  ) as LongDeclareNum,(
	select count(*) as countNum from LongProjects a
	where a.UserCardId=@UserCardId  and a.StandStatus<>'' and a.StandStatus<>''
	and StandStatus<>''
	  ) as LongStandNum,(
	select count(*) as countNum from LongProjects a
	where a.UserCardId=@UserCardId  and a.InspectStatus<>'' and a.InspectStatus<>''
	and InspectStatus<>''
	  ) as LongInspectNum,(
		select count(*) as countNum from LongProjects a
	where a.UserCardId=@UserCardId  and a.EndStatus<>'' and a.EndStatus<>''
	and EndStatus<>''
	  ) as LongEndNum,(
	select count(*) as countNum from ShortProjects a
	where a.UserCardId=@UserCardId  and a.StandStatus<>'' and a.StandStatus<>''
	  ) as ShortStandNum,(
		select count(*) as countNum from ShortProjects a
	where a.UserCardId=@UserCardId  and a.EndStatus<>'' and a.EndStatus<>''
	and EndStatus<>''
	  ) as ShortEndNum,(
	select count(*) as countNum from LongCapitalPlan a
	where a.UserCardId=@UserCardId and TransferStatus<>''
	  ) as LongPlanNum,(
		select count(*) as countNum from LongCapitalChange a
	where a.UserCardId=@UserCardId and TransferStatus<>''
	  ) as LongChangeNum,(
		select count(*) as countNum from LongCapitalClose a
	where a.UserCardId=@UserCardId and TransferStatus<>''
	  ) as LongCloseNum,(
	select count(*) as countNum from ShortCapitalPlan a
	where a.UserCardId=@UserCardId and TransferStatus<>''
	  ) as ShortPlanNum,(
		select count(*) as countNum from ShortCapitalChange a
	where a.UserCardId=@UserCardId and TransferStatus<>''
	  ) as ShortChangeNum,(
		select count(*) as countNum from ShortCapitalClose a
	where a.UserCardId=@UserCardId and TransferStatus<>''
	  ) as ShortCloseNum







end
GO
/****** Object:  StoredProcedure [dbo].[Paper_UpdateStatus]    Script Date: 12/07/2016 16:56:29 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
/*********************
--: Paper_UpdateStatus
--: Paper, 
--: 
  PaperId,TransferStatus,ProcessRoleId
--: 
	
--:
	0 - 
	-1 -  
**************/
CREATE PROCEDURE [dbo].[Paper_UpdateStatus]
@PaperId int,
@TransferStatus varchar(20),
@ProcessRoleId varchar(20),
@ProcessDepartmentId int
AS
begin
	begin tran
	
	update Paper set 
TransferStatus=@TransferStatus,
ProcessRoleId=@ProcessRoleId,
ProcessDepartmentId=@ProcessDepartmentId
	where PaperId=@PaperId 
	
		if(@@ERROR<>0)
			begin
				rollback
				return -1
			end
	commit tran
	return 0
end
GO
/****** Object:  StoredProcedure [dbo].[PaperExamine_Insert]    Script Date: 12/07/2016 16:56:29 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
/*********************
--: PaperExamine_Insert
--: QuitExamine, 
--: 
PaperId,ExamineOpinion,ExamineUserCardId,ExamineResult
--: 
	
--:
	0 - 
	-1 -  
**************/
CREATE PROCEDURE [dbo].[PaperExamine_Insert]
@PaperId int,
@ExamineOpinion varchar(400),
@ExamineUserCardId varchar(50),
@ExamineResult varchar(50),
@RankId int
AS
begin
	begin tran
	declare
	@DepartmentId int,
		@TeachersDepartmentId int,
	@ProcessOrder int,
	@UserCardId varchar(50),
	@OrderRoleId int,
	@OrderDepartmentId int
	set @DepartmentId=(select UserDepartmentId from UserInfo where UserCardId=@ExamineUserCardId)
		set @TeachersDepartmentId=(select TeachersDepartmentId from UserInfo where UserCardId=@ExamineUserCardId)
	set @UserCardId =(select UserCardId from Paper where PaperId=@PaperId)
    if exists(select * from PaperExamine where PaperId=@PaperId)
 begin
  set @ProcessOrder=(select MAX(ExamineNumber) from PaperExamine where PaperId=@PaperId)+1  --
 end
 else
 begin
 set @ProcessOrder=1
 end
   	if exists(select * from Paper where (ProcessDepartmentId=@DepartmentId and ProcessRoleId=@RankId) or (ProcessDepartmentId=@TeachersDepartmentId and ProcessRoleId=@RankId))
	begin

insert into PaperExamine
(PaperId,ExamineOpinion,ExamineUserCardId,ExamineDate,ExamineNumber,ExamineResult)values
(@PaperId,@ExamineOpinion,@ExamineUserCardId,GETDATE(),@ProcessOrder,@ExamineResult)
	exec [dbo].[Journal_Insert] @ExamineUserCardId,'',''
if(@ExamineResult='')
begin
if exists(select * from PaperAuditProcess where PaperId=@PaperId and ProcessOrder=@ProcessOrder+1)
begin
set @OrderRoleId =(select ProcessRankId from PaperAuditProcess where PaperId=@PaperId and ProcessOrder=@ProcessOrder+1)
set @OrderDepartmentId= (select ProcessDepartmentId from PaperAuditProcess where PaperId=@PaperId and ProcessOrder=@ProcessOrder+1)
exec [dbo].[Paper_UpdateStatus] @PaperId,'',@OrderRoleId,@OrderDepartmentId
end 
else
begin
exec[dbo].[PaperPartner_AddValue] @PaperId
exec[dbo].[Paper_UpdateStatus] @PaperId,@ExamineResult,'',0
end
end
else
begin
exec[dbo].[Paper_UpdateStatus] @PaperId,@ExamineResult,'',0
end
end
		if(@@ERROR<>0)
			begin
				rollback
				return -1
			end
	commit tran
	return 0
end
GO
/****** Object:  StoredProcedure [dbo].[PaperPartner_UpdatePaperId]    Script Date: 12/07/2016 16:56:29 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
/*********************
--:PaperPartner_UpdatePaperId
--: PaperPartner, 
--: 


--: 
	
--:
	0 - 
	-1 -  
**************/
CREATE PROCEDURE [dbo].[PaperPartner_UpdatePaperId]
	@PaperId int,
	@UserCardId varchar(50),
	@PartnerRank int,
	@PartnerValue float
AS
begin
	begin tran
 declare @sum float,
    @PaperValue float,
    @UserValue float
 
    set @UserValue=(select PartnerValue from PaperPartner where PaperId=@PaperId and PartnerUserCardId=@UserCardId)
    set @sum=(select SUM(PartnerValue) from PaperPartner where PaperId=@PaperId)
    set @PaperValue=(select PaperValue from Paper where PaperId=@PaperId)
    if(@sum-@UserValue+@PartnerValue<=@PaperValue)
    begin
		update PaperPartner set
		PartnerRank=@PartnerRank,
		PartnerValue=@PartnerValue,
		PartnerUserCardId=@UserCardId
		where PaperId=@PaperId and 	PartnerUserCardId=@UserCardId
end

		if(@@ERROR<>0)
			begin
				rollback
				return -1
			end
	commit tran
	return 0
end
GO
/****** Object:  StoredProcedure [dbo].[Rank_SelectByRankId]    Script Date: 12/07/2016 16:56:30 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
/******
--: Rank_SelectByRankId
--: Rank, 
--: 
RankId
--: 
	
--:
	0 - 
	-1 -  
******/
CREATE PROCEDURE [dbo].[Rank_SelectByRankId]
@RankId int
AS
begin

		select * from   Rank where RankId=@RankId

end
GO
/****** Object:  StoredProcedure [dbo].[Rank_Select]    Script Date: 12/07/2016 16:56:30 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
/******
--: Rank_Select
--: Rank, 
--: 
--: 
	
--:
	0 - 
	-1 -  
******/
CREATE PROCEDURE [dbo].[Rank_Select]

AS
begin

		select * from Rank

end
GO
/****** Object:  StoredProcedure [dbo].[LongProjectsInspectProcess_Select]    Script Date: 12/07/2016 16:56:29 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
/*********************
--: LongProjectsProcess_Select
--: LongProjectsProcess, 
--
--: 
--LongProjectsRoleId
--: 
	
--:
	0 - 
	-1 -  
**************/

CREATE PROCEDURE [dbo].[LongProjectsInspectProcess_Select]
AS
begin

	 select a.*,b.RankName as ProcessRankName
  from LongProjectsInspectProcess a,Rank b
  where   a.ProcessRankId=b.RankId

end
GO
/****** Object:  StoredProcedure [dbo].[PaperProcess_Select]    Script Date: 12/07/2016 16:56:29 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
/*********************
--: PaperProcess_Select
--: PaperProcess, 
--: 
--PaperRoleId
--: 
	
--:
	0 - 
	-1 -  
**************/
CREATE PROCEDURE [dbo].[PaperProcess_Select]
AS
begin
	 select a.*,b.RankName as ProcessRoleName
  from PaperProcess a,Rank b
  where   a.ProcessRankId=b.RankId

end
GO
/****** Object:  StoredProcedure [dbo].[LongCapitalBasic_SelectByMyUserCardId]    Script Date: 12/07/2016 16:56:28 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
/******
--: AdminSeries_Select
--: AdminSeries, 
--
--: 
--: 
	
--:
	0 - 
	-1 -  
******/
CREATE PROCEDURE [dbo].[LongCapitalBasic_SelectByMyUserCardId]
@UserCardId varchar(50)
AS
begin

		select a.*,b.* from 
		LongProjects a left join LongCapitalBasic b on a.LongProjectsId=b.LongProjectsId
		where a.StandStatus=''
		and a.EndStatus=''
		and a.UserCardId=@UserCardId

end
GO
/****** Object:  StoredProcedure [dbo].[LongCapitalBasic_SelectByLongProjectsId]    Script Date: 12/07/2016 16:56:28 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
/******
--: AdminSeries_Select
--: AdminSeries, 
--
--: 
--: 
	
--:
	0 - 
	-1 -  
******/
CREATE PROCEDURE [dbo].[LongCapitalBasic_SelectByLongProjectsId]
@LongProjectsId varchar(50)
AS
begin

		select * from LongCapitalBasic
		where LongProjectsId=@LongProjectsId

end
GO
/****** Object:  StoredProcedure [dbo].[LongCapitalBasic_Insert]    Script Date: 12/07/2016 16:56:28 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
/*********************
--: CapitalBasic_Insert
--: CapitalPlace, 
--: 

--: 
	
--:
	0 - 
	-1 -  
**************/
CREATE PROCEDURE [dbo].[LongCapitalBasic_Insert]
@LongProjectsId varchar(50),
@BidMoney float,
@SupportMoney float,
@OtherMoney float,
@SuedCompany varchar(50),
@Servicelife date
AS
begin
	begin tran
	declare
	@SumMoney float=@BidMoney+@SupportMoney+@OtherMoney 
	if not exists(select * from LongCapitalBasic where LongProjectsId=@LongProjectsId)
	begin
	Insert into LongCapitalBasic
	(LongProjectsId,BidMoney,SupportMoney,OtherMoney,SumMoney,SuedCompany,Servicelife) values
	(@LongProjectsId,@BidMoney,@SupportMoney,@OtherMoney,@SumMoney,@SuedCompany,@Servicelife)
	end
	else
	begin
	update LongCapitalBasic set
	BidMoney=@BidMoney,
	SupportMoney=@SupportMoney,
	OtherMoney=@OtherMoney,
	SumMoney=@SumMoney,
	SuedCompany=@SuedCompany,
	@Servicelife=@Servicelife
	where LongProjectsId=@LongProjectsId
	end
	
	
		if(@@ERROR<>0)
			begin
				rollback
				return -1
			end
	commit tran
	return 0
end
GO
/****** Object:  StoredProcedure [dbo].[LongCapitalPlanProcess_Select]    Script Date: 12/07/2016 16:56:28 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
/*********************
--: LongCapitalPlanProcess_Select
--: LongCapitalPlanProcess, 
--: 
--LongCapitalPlanRoleId
--: 
	
--:
	0 - 
	-1 -  
**************/
CREATE PROCEDURE [dbo].[LongCapitalPlanProcess_Select]
AS
begin
	 select a.*,b.RankName as ProcessRoleName
  from LongCapitalPlanProcess a,Rank b
  where   a.ProcessRankId=b.RankId

end
GO
/****** Object:  StoredProcedure [dbo].[LongCapitalCanPlan_SelectByUserCardId]    Script Date: 12/07/2016 16:56:28 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
/******
--: AdminSeries_Select
--: AdminSeries, 
--: 
--: 
	
--:
	0 - 
	-1 -  
******/
CREATE PROCEDURE [dbo].[LongCapitalCanPlan_SelectByUserCardId]
@UserCardId varchar(50)
AS
begin

select * from 
LongCapitalBasic a,LongProjects b left join LongCapitalPlan c on b.LongProjectsId=c.LongProjectsId
where a.LongProjectsId=b.LongProjectsId
and b.StandStatus='' and b.UserCardId=@UserCardId
and b.EndStatus=''  and c.LongCapitalPlanUrl is null
end
GO
/****** Object:  StoredProcedure [dbo].[LongCapitalChange_SelectByMyUserCardId]    Script Date: 12/07/2016 16:56:28 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
/*********************
--: LongCapitalChange_SelectByUserCardId
--: LongCapitalChange, 
--: 
  UserCardId
--: 
	
--:
	0 - 
	-1 -  
**************/
CREATE PROCEDURE [dbo].[LongCapitalChange_SelectByMyUserCardId]
	@UserCardId varchar(50)
	AS
begin
   
	select a.ProjectsName,b.*,d.TransferStatus
	from LongProjects a ,LongCapitalBasic b ,LongCapitalPlan c left join LongCapitalChange d on c.LongProjectsId=d.LongProjectsId
	where a.LongProjectsId=b.LongProjectsId
	and b.LongProjectsId=c.LongProjectsId
	and c.TransferStatus=''
  and  a.UserCardId=@UserCardId
  order by LongProjectsId desc
    
end
GO
/****** Object:  StoredProcedure [dbo].[LongProjects_SelectStandUserCardId]    Script Date: 12/07/2016 16:56:28 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
/*********************
--: LongProjects_SelectByUserCardId
--: LongProjects, 
--
--: 
  UserCardId
--: 
	
--:
	0 - 
	-1 -  
**************/
CREATE PROCEDURE [dbo].[LongProjects_SelectStandUserCardId]
@UserCardId varchar(50)
	AS
begin
  
  select a.*,b.ProjectsFromExplain,c.ProjectsLevelExplain,d.ProjectsSubjectExplain
  from LongProjects a,ProjectsFrom b,ProjectsLevel c,ProjectsSubject d
  where a.ProjectsFromId=b.ProjectsFromId
  and a.ProjectsLevelId =c.ProjectsLevelId 
  and a.ProjectsSubjectId=d.ProjectsSubjectId
  and a.StandStatus<>''
  and UserCardId=@UserCardId
  order by LongprojectsId desc

    
end
GO
/****** Object:  StoredProcedure [dbo].[LongCapitalChange_UpdateStatus]    Script Date: 12/07/2016 16:56:28 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
/*********************
--: LongCapitalChange_UpdateStatus
--: LongCapitalChange, 
--: 
  LongCapitalChangeId,TransferStatus,ProcessRoleId
--: 
	
--:
	0 - 
	-1 -  
**************/
CREATE PROCEDURE [dbo].[LongCapitalChange_UpdateStatus]
@LongProjectsId varchar(50),
@TransferStatus varchar(20),
@ProcessRankId varchar(20),
@ProcessDepartmentId int
AS
begin
	begin tran
	
	update LongCapitalChange set 
TransferStatus=@TransferStatus
	where LongProjectsId=@LongProjectsId 
	if not exists(  select * from LongCapitalChangeWaitExamine where LongProjectsId=@LongProjectsId)
	begin
	insert into LongCapitalChangeWaitExamine 
	(LongProjectsId,ProcessDepartmentId,ProcessRankId)
	values
	(@LongProjectsId,@ProcessDepartmentId,@ProcessRankId)
	end
	else
	begin
	update LongCapitalChangewaitExamine
	set ProcessDepartmentId=@ProcessDepartmentId,
	ProcessRankId=@ProcessRankId
	where LongProjectsId=@LongProjectsId
	end
		if(@@ERROR<>0)
			begin
				rollback
				return -1
			end
	commit tran
	return 0
end
GO
/****** Object:  StoredProcedure [dbo].[LongCapitalChangeExamine_Insert]    Script Date: 12/07/2016 16:56:28 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
/*********************
--: LongCapitalChangeExamine_Insert
--: QuitExamine, 
--: 
LongProjectsId,ExamineOpinion,ExamineUserCardId,ExamineResult
--: 
	
--:
	0 - 
	-1 -  
**************/
CREATE PROCEDURE [dbo].[LongCapitalChangeExamine_Insert]
@LongProjectsId varchar(50),
@ExamineOpinion varchar(400),
@ExamineUserCardId varchar(50),
@ExamineResult varchar(50),
@RankId int
AS
begin
	begin tran
	declare
	@DepartmentId int,
	@TeachersDepartmentId int,
	@ProcessOrder int,
	@UserCardId varchar(50),
	@OrderRoleId int,
	@OrderDepartmentId int
	set @DepartmentId=(select UserDepartmentId from UserInfo where UserCardId=@ExamineUserCardId)
		set @TeachersDepartmentId=(select TeachersDepartmentId from UserInfo where UserCardId=@ExamineUserCardId)
	set @UserCardId =(select UserCardId from LongCapitalChange where LongProjectsId=@LongProjectsId)
    if exists(select * from LongCapitalChangeExamine where LongProjectsId=@LongProjectsId)
 begin
  set @ProcessOrder=(select MAX(ExamineNumber) from LongCapitalChangeExamine where LongProjectsId=@LongProjectsId)+1  --
 end
 else
 begin
 set @ProcessOrder=1
 end
   	if exists(select * from LongCapitalChangeWaitExamine where( ProcessDepartmentId=@DepartmentId and ProcessRankId=@RankId and LongProjectsId=@LongProjectsId) or (ProcessDepartmentId=@TeachersDepartmentId and ProcessRankId=@RankId and LongProjectsId=@LongProjectsId))
	begin

insert into LongCapitalChangeExamine
(LongProjectsId,ExamineOpinion,ExamineUserCardId,ExamineDate,ExamineNumber,ExamineResult)values
(@LongProjectsId,@ExamineOpinion,@ExamineUserCardId,GETDATE(),@ProcessOrder,@ExamineResult)
	exec [dbo].[Journal_Insert] @ExamineUserCardId,'',''
if(@ExamineResult='')
begin
if exists(select * from LongCapitalChangeAuditProcess where LongProjectsId=@LongProjectsId and ProcessOrder=@ProcessOrder+1)
begin
set @OrderRoleId =(select ProcessRankId from LongCapitalChangeAuditProcess where LongProjectsId=@LongProjectsId and ProcessOrder=@ProcessOrder+1)
set @OrderDepartmentId= (select ProcessDepartmentId from LongCapitalChangeAuditProcess where LongProjectsId=@LongProjectsId and ProcessOrder=@ProcessOrder+1)
exec [dbo].[LongCapitalChange_UpdateStatus] @LongProjectsId,'',@OrderRoleId,@OrderDepartmentId
end 
else
begin
exec[dbo].[LongCapitalChange_UpdateStatus] @LongProjectsId,@ExamineResult,0,0

end
end
else
begin
exec[dbo].[LongCapitalChange_UpdateStatus] @LongProjectsId,@ExamineResult,0,0

end
end
		if(@@ERROR<>0)
			begin
				rollback
				return -1
			end
	commit tran
	return 0
end
GO
/****** Object:  StoredProcedure [dbo].[LongProjectsDeclareProcess_Select]    Script Date: 12/07/2016 16:56:28 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
/*********************
--: LongProjectsProcess_Select
--: LongProjectsProcess, 
--
--: 
--LongProjectsRoleId
--: 
	
--:
	0 - 
	-1 -  
**************/

CREATE PROCEDURE [dbo].[LongProjectsDeclareProcess_Select]
AS
begin

	 select a.*,b.RankName as ProcessRankName
  from LongProjectsDeclareProcess a,Rank b
  where   a.ProcessRankId=b.RankId

end
GO
/****** Object:  StoredProcedure [dbo].[ProjectsFrom_SelectByProjectsFromId]    Script Date: 12/07/2016 16:56:29 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
/******
--: ProjectsFrom_SelectByProjectsFromId
--: ProjectsFrom, 
--: 
ProjectsFromId
--: 
	
--:
	0 - 
	-1 -  
******/
CREATE PROCEDURE [dbo].[ProjectsFrom_SelectByProjectsFromId]
@ProjectsFromId int
AS
begin

		select * from   ProjectsFrom where ProjectsFromId=@ProjectsFromId

end
GO
/****** Object:  StoredProcedure [dbo].[ProjectsFrom_Select]    Script Date: 12/07/2016 16:56:29 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
/******
--: ProjectsFrom_Select
--: ProjectsFromProjectsFrom 
--: 
--: 
	
--:
	0 - 
	-1 -  
******/
CREATE PROCEDURE [dbo].[ProjectsFrom_Select]

AS
begin

		select * from ProjectsFrom

end
GO
/****** Object:  StoredProcedure [dbo].[ProjectsFrom_Update]    Script Date: 12/07/2016 16:56:29 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
/*******
--: ProjectsFrom_Update
--: ProjectsFrom, 
--: 
ProjectsFromId,ProjectsFromName
--: 
	
--:
	0 - 
	-1 -  
*********/
CREATE PROCEDURE [dbo].[ProjectsFrom_Update]
@ProjectsFromId int,
@ProjectsFromExplain varchar(50),
@UserCardId varchar(50)
AS
begin
	begin tran
	if not exists(select * from ProjectsFrom where ProjectsFromId<>@ProjectsFromId and ProjectsFromExplain=@ProjectsFromExplain)
	
	begin	update ProjectsFrom set ProjectsFromExplain=@ProjectsFromExplain where ProjectsFromId=@ProjectsFromId
		exec [dbo].[Journal_Insert] @UserCardId,'',''
	end
		if(@@ERROR<>0)
			begin
				rollback
				return -1
			end
	commit tran
	return 0
end
GO
/****** Object:  StoredProcedure [dbo].[ProjectsLevel_Insert]    Script Date: 12/07/2016 16:56:29 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
/*********************
--: ProjectsFrom_Insert
--: ProjectsFrom, 
--: 
   ProjectsFromName
--: 
	
--:
	0 - 
	-1 -  
**************/
CREATE PROCEDURE [dbo].[ProjectsLevel_Insert]
@ProjectsLevelExplain varchar(50),
@UserCardId varchar(50)
AS
begin
	begin tran
	insert into ProjectsLevel(
	ProjectsLevelExplain
	)values(
	@ProjectsLevelExplain
	)
	exec [dbo].[Journal_Insert] @UserCardId,'',''
		if(@@ERROR<>0)
			begin
				rollback
				return -1
			end
	commit tran
	return 0
end
GO
/****** Object:  StoredProcedure [dbo].[ProjectsLevel_Delete]    Script Date: 12/07/2016 16:56:29 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
/*******
--: ProjectsFrom_Delete
--: ProjectsFrom, 
--: 
ProjectsFromId
--: 
	
--:
	0 - 
	-1 -  
*********/
CREATE PROCEDURE [dbo].[ProjectsLevel_Delete]
@ProjectsLevelId int,
@UserCardId varchar(50)
AS
begin
	begin tran
		delete ProjectsLevel where ProjectsLevelId=@ProjectsLevelId
		exec [dbo].[Journal_Insert] @UserCardId,'',''
		if(@@ERROR<>0)
			begin
				rollback
				return -1
			end
	commit tran
	return 0
end
GO
/****** Object:  StoredProcedure [dbo].[ProjectsFrom_Insert]    Script Date: 12/07/2016 16:56:29 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
/*********************
--: ProjectsFrom_Insert
--: ProjectsFrom, 
--: 
   ProjectsFromName
--: 
	
--:
	0 - 
	-1 -  
**************/
CREATE PROCEDURE [dbo].[ProjectsFrom_Insert]
@ProjectsFromExplain varchar(50),
@UserCardId varchar(50)
AS
begin
	begin tran
	insert into ProjectsFrom(
	ProjectsFromExplain
	)values(
	@ProjectsFromExplain
	)
	exec [dbo].[Journal_Insert] @UserCardId,'',''
		if(@@ERROR<>0)
			begin
				rollback
				return -1
			end
	commit tran
	return 0
end
GO
/****** Object:  StoredProcedure [dbo].[ProjectsFrom_Delete]    Script Date: 12/07/2016 16:56:29 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
/*******
--: ProjectsFrom_Delete
--: ProjectsFrom, 
--: 
ProjectsFromId
--: 
	
--:
	0 - 
	-1 -  
*********/
CREATE PROCEDURE [dbo].[ProjectsFrom_Delete]
@ProjectsFromId int,
@UserCardId varchar(50)
AS
begin
	begin tran
		delete ProjectsFrom where ProjectsFromId=@ProjectsFromId
		exec [dbo].[Journal_Insert] @UserCardId,'',''
		if(@@ERROR<>0)
			begin
				rollback
				return -1
			end
	commit tran
	return 0
end
GO
/****** Object:  StoredProcedure [dbo].[LongProjectsDeclareProcess_Insert]    Script Date: 12/07/2016 16:56:28 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
/*********************
--: LongProjectsProcess_Insert
--: LongProjectsProcess, 
--
--: 
LongProjectsRoleId,ProcessRoleId,ProcessOrder
--: 
	
--:
	0 - 
	-1 -  
**************/
CREATE PROCEDURE [dbo].[LongProjectsDeclareProcess_Insert]
	@ProcessRankId int,
	@ProcessOrder int,
	@ProcessDepartment varchar(50),
	@UserCardId varchar(50)
AS
begin
	begin tran
   declare 
   @MaxOrder int --
   --
  if  exists(select * from LongProjectsDeclareProcess where  ProcessRankId=@ProcessRankId and ProcessDepartment=@ProcessDepartment)
begin
return -1
end
 else
begin  
--0
if exists(select * from LongProjectsDeclareProcess)
begin
 set @MaxOrder=(select MAX(ProcessOrder) from LongProjectsDeclareProcess)
end
else
begin
set @MaxOrder=0
end
  --
   if(@ProcessOrder>@MaxOrder)
   begin
   --+1
   set @ProcessOrder=@MaxOrder+1
   insert into LongProjectsDeclareProcess ( ProcessRankId,ProcessOrder,ProcessDepartment)values
   (@ProcessRankId,@ProcessOrder,@ProcessDepartment)
end 
else
begin

--+1
   update LongProjectsDeclareProcess 
   set ProcessOrder=ProcessOrder+1
   where ProcessOrder>=@ProcessOrder
    insert into LongProjectsDeclareProcess ( ProcessRankId,ProcessOrder,ProcessDepartment)values
   (@ProcessRankId,@ProcessOrder,@ProcessDepartment)

   end
   --
   exec [dbo].[Journal_Insert] @UserCardId,'',''
end
		
		if(@@ERROR<>0)
			begin
				rollback
				return -1
			end
	commit tran
	return 0
end
GO
/****** Object:  StoredProcedure [dbo].[LongProjectsDeclareProcess_Delete]    Script Date: 12/07/2016 16:56:28 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
/*********************
--: LongProjectsProcess_Delete
--: LongProjectsProcess, 
--: 
  LongProjectsProcessId 
--: 
	
--:
	0 - 
	-1 -  
**************/
CREATE PROCEDURE [dbo].[LongProjectsDeclareProcess_Delete]
@LongProjectsProcessId int,
@UserCardId varchar(50)
AS
begin
	begin tran
	declare 
	@ProcessOrder int	
	--
	set @ProcessOrder=(select ProcessOrder from LongProjectsDeclareProcess where LongProjectsProcessId=@LongProjectsProcessId)
	--
	delete LongProjectsDeclareProcess 
	where LongProjectsProcessId=@LongProjectsProcessId 
     --
    update LongProjectsDeclareProcess 
    set ProcessOrder=ProcessOrder-1
    where  ProcessOrder>@ProcessOrder
	--
    exec [dbo].[Journal_Insert] @UserCardId,'',''
		if(@@ERROR<>0)
			begin
				rollback
				return -1
			end
	commit tran
	return 0
end
GO
/****** Object:  StoredProcedure [dbo].[LongProjects_Delete]    Script Date: 12/07/2016 16:56:28 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
/*******
--: LongProjects_Delete
--: LongProjects, 
--
--: 
LongProjectsId
--: 
	
--:
	0 - 
	-1 -  
*********/
CREATE PROCEDURE [dbo].[LongProjects_Delete]
@LongProjectsId varchar(50)
AS
begin
	begin tran
		declare
		@UserCardId varchar(50),--
		@DeclareStatus varchar(50) --
		set @UserCardId=(select UserCardId from LongProjects where LongProjectsId=@LongProjectsId) --
	  set @DeclareStatus=( select DeclareStatus from LongProjects where LongProjectsId=@LongProjectsId) --
	  if(@DeclareStatus<>'') --
	    begin
		delete LongProjects where LongProjectsId=@LongProjectsId --
	    delete LongProjectsDeclareAuditProcess
	    where LongProjectsId=@LongProjectsId     --
		delete LongProjectsDeclareExamine
		where LongProjectsId=@LongProjectsId     --
		delete LongProjectsDeclareWaitExamine
		where LongProjectsId=@LongProjectsId     --
	    exec [dbo].[Journal_Insert] @UserCardId,'',''   --
		end
		if(@@ERROR<>0)
			begin
				rollback
				return -1
			end
	commit tran
	return 0
end
GO
/****** Object:  StoredProcedure [dbo].[LongCapitalPlanProcess_Insert]    Script Date: 12/07/2016 16:56:28 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
/*********************
--: LongCapitalPlanProcess_Insert
--: LongCapitalPlanProcess, 
--: 
LongCapitalPlanRoleId,ProcessRoleId,ProcessOrder
--: 
	
--:
	0 - 
	-1 -  
**************/
CREATE PROCEDURE [dbo].[LongCapitalPlanProcess_Insert]
	@ProcessRankId int,
	@ProcessOrder int,
	@ProcessDepartment varchar(50),
	@UserCardId varchar(50)
AS
begin
	begin tran
   declare 
   @MaxOrder int
  if  exists(select * from LongCapitalPlanProcess where  ProcessRankId=@ProcessRankId and ProcessDepartment=@ProcessDepartment)
begin
return -1
end
 else
begin
--0
if exists(select * from LongCapitalPlanProcess)
begin
  set @MaxOrder=(select MAX(ProcessOrder) from LongCapitalPlanProcess)
end
else
begin
set @MaxOrder=0
end  
   if(@ProcessOrder>@MaxOrder)
   begin
   set @ProcessOrder=@MaxOrder+1
   insert into LongCapitalPlanProcess ( ProcessRankId,ProcessOrder,ProcessDepartment)values
   (@ProcessRankId,@ProcessOrder,@ProcessDepartment)
end else
begin


   update LongCapitalPlanProcess 
   set ProcessOrder=ProcessOrder+1
   where ProcessOrder>=@ProcessOrder
    insert into LongCapitalPlanProcess ( ProcessRankId,ProcessOrder,ProcessDepartment)values
   (@ProcessRankId,@ProcessOrder,@ProcessDepartment)

   end
   exec [dbo].[Journal_Insert] @UserCardId,'',''
end
		
		if(@@ERROR<>0)
			begin
				rollback
				return -1
			end
	commit tran
	return 0
end
GO
/****** Object:  StoredProcedure [dbo].[LongCapitalPlanProcess_Delete]    Script Date: 12/07/2016 16:56:28 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
/*********************
--: LongCapitalPlanProcess_Delete
--: LongCapitalPlanProcess, 
--: 
  LongCapitalPlanProcessId 
--: 
	
--:
	0 - 
	-1 -  
**************/
CREATE PROCEDURE [dbo].[LongCapitalPlanProcess_Delete]
@LongCapitalPlanProcessId int,
@UserCardId varchar(50)
AS
begin
	begin tran
	declare 
	@ProcessOrder int	
	set @ProcessOrder=(select ProcessOrder from LongCapitalPlanProcess where LongCapitalPlanProcessId=@LongCapitalPlanProcessId)
	
	delete LongCapitalPlanProcess 
	where LongCapitalPlanProcessId=@LongCapitalPlanProcessId 
     
    update LongCapitalPlanProcess 
    set ProcessOrder=ProcessOrder-1
    where  ProcessOrder>@ProcessOrder
    exec [dbo].[Journal_Insert] @UserCardId,'',''
		if(@@ERROR<>0)
			begin
				rollback
				return -1
			end
	commit tran
	return 0
end
GO
/****** Object:  StoredProcedure [dbo].[PaperProcess_Insert]    Script Date: 12/07/2016 16:56:29 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
/*********************
--: PaperProcess_Insert
--: PaperProcess, 
--: 
PaperRoleId,ProcessRoleId,ProcessOrder
--: 
	
--:
	0 - 
	-1 -  
**************/
CREATE PROCEDURE [dbo].[PaperProcess_Insert]
	@ProcessRoleId int,
	@ProcessOrder int,
	@ProcessDepartment varchar(50),
	@UserCardId varchar(50)
AS
begin
	begin tran
   declare 
   @MaxOrder int
  if  exists(select * from PaperProcess where  ProcessRankId=@ProcessRoleId and ProcessDepartment=@ProcessDepartment)
begin
return -1
end
 else
begin  
   set @MaxOrder=(select MAX(ProcessOrder) from PaperProcess)
   if(@ProcessOrder>@MaxOrder)
   begin
   set @ProcessOrder=@MaxOrder+1
   insert into PaperProcess ( ProcessRankId,ProcessOrder,ProcessDepartment)values
   (@ProcessRoleId,@ProcessOrder,@ProcessDepartment)
end else
begin


   update PaperProcess 
   set ProcessOrder=ProcessOrder+1
   where ProcessOrder>=@ProcessOrder
    insert into PaperProcess ( ProcessRankId,ProcessOrder,ProcessDepartment)values
   (@ProcessRoleId,@ProcessOrder,@ProcessDepartment)

   end
   exec [dbo].[Journal_Insert] @UserCardId,'',''
end
		
		if(@@ERROR<>0)
			begin
				rollback
				return -1
			end
	commit tran
	return 0
end
GO
/****** Object:  StoredProcedure [dbo].[PaperProcess_Delete]    Script Date: 12/07/2016 16:56:29 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
/*********************
--: PaperProcess_Delete
--: PaperProcess, 
--: 
  PaperProcessId 
--: 
	
--:
	0 - 
	-1 -  
**************/
CREATE PROCEDURE [dbo].[PaperProcess_Delete]
@PaperProcessId int,
@UserCardId varchar(50)
AS
begin
	begin tran
	declare 
	@ProcessOrder int	
	set @ProcessOrder=(select ProcessOrder from PaperProcess where PaperProcessId=@PaperProcessId)
	
	delete PaperProcess 
	where PaperProcessId=@PaperProcessId 
     
    update PaperProcess 
    set ProcessOrder=ProcessOrder-1
    where  ProcessOrder>@ProcessOrder
    exec [dbo].[Journal_Insert] @UserCardId,'',''
		if(@@ERROR<>0)
			begin
				rollback
				return -1
			end
	commit tran
	return 0
end
GO
/****** Object:  StoredProcedure [dbo].[LongProjectsInspectProcess_Insert]    Script Date: 12/07/2016 16:56:29 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
/*********************
--: LongProjectsProcess_Insert
--: LongProjectsProcess, 
--
--: 
LongProjectsRoleId,ProcessRoleId,ProcessOrder
--: 
	
--:
	0 - 
	-1 -  
**************/
CREATE PROCEDURE [dbo].[LongProjectsInspectProcess_Insert]
	@ProcessRankId int,
	@ProcessOrder int,
	@ProcessDepartment varchar(50),
	@UserCardId varchar(50)
AS
begin
	begin tran
   declare 
   @MaxOrder int --
   --
  if  exists(select * from LongProjectsInspectProcess where  ProcessRankId=@ProcessRankId and ProcessDepartment=@ProcessDepartment)
begin
return -1
end
 else
begin  
--0
if exists(select * from LongProjectsInspectProcess)
begin
 set @MaxOrder=(select MAX(ProcessOrder) from LongProjectsInspectProcess)
end
else
begin
set @MaxOrder=0
end
  --
   if(@ProcessOrder>@MaxOrder)
   begin
   --+1
   set @ProcessOrder=@MaxOrder+1
   insert into LongProjectsInspectProcess ( ProcessRankId,ProcessOrder,ProcessDepartment)values
   (@ProcessRankId,@ProcessOrder,@ProcessDepartment)
end 
else
begin

--+1
   update LongProjectsInspectProcess 
   set ProcessOrder=ProcessOrder+1
   where ProcessOrder>=@ProcessOrder
    insert into LongProjectsInspectProcess ( ProcessRankId,ProcessOrder,ProcessDepartment)values
   (@ProcessRankId,@ProcessOrder,@ProcessDepartment)

   end
   --
   exec [dbo].[Journal_Insert] @UserCardId,'',''
end
		
		if(@@ERROR<>0)
			begin
				rollback
				return -1
			end
	commit tran
	return 0
end
GO
/****** Object:  StoredProcedure [dbo].[LongProjectsInspectProcess_Delete]    Script Date: 12/07/2016 16:56:29 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
/*********************
--: LongProjectsProcess_Delete
--: LongProjectsProcess, 
--
--: 
  LongProjectsProcessId 
--: 
	
--:
	0 - 
	-1 -  
**************/
CREATE PROCEDURE [dbo].[LongProjectsInspectProcess_Delete]
@LongProjectsProcessId int,
@UserCardId varchar(50)
AS
begin
	begin tran
	declare 
	@ProcessOrder int	
	--
	set @ProcessOrder=(select ProcessOrder from LongProjectsInspectProcess where LongProjectsProcessId=@LongProjectsProcessId)
	--
	delete LongProjectsInspectProcess 
	where LongProjectsProcessId=@LongProjectsProcessId 
     --
    update LongProjectsInspectProcess 
    set ProcessOrder=ProcessOrder-1
    where  ProcessOrder>@ProcessOrder
	--
    exec [dbo].[Journal_Insert] @UserCardId,'',''
		if(@@ERROR<>0)
			begin
				rollback
				return -1
			end
	commit tran
	return 0
end
GO
/****** Object:  StoredProcedure [dbo].[Rank_Insert]    Script Date: 12/07/2016 16:56:30 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
/*********************
--: Rank_Insert
--: Rank, 
--: 
   RankName
--: 
	
--:
	0 - 
	-1 -  
**************/
CREATE PROCEDURE [dbo].[Rank_Insert]
@RankName varchar(50),
@UserCardId varchar(50),
@RBL varchar(50)
AS
begin
	begin tran
	insert into Rank(
	RankName,RBL
	)values(
	@RankName,@RBL
	)
	exec [dbo].[Journal_Insert] @UserCardId,'',''
		if(@@ERROR<>0)
			begin
				rollback
				return -1
			end
	commit tran
	return 0
end
GO
/****** Object:  StoredProcedure [dbo].[Rank_Delete]    Script Date: 12/07/2016 16:56:30 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
/*******
--: Rank_Delete
--: Rank, 
--: 
RankId
--: 
	
--:
	0 - 
	-1 -  
*********/
CREATE PROCEDURE [dbo].[Rank_Delete]
@RankId int,
@UserCardId varchar(50)
AS
begin
	begin tran
		delete Rank where RankId=@RankId
		exec [dbo].[Journal_Insert] @UserCardId,'',''
		if(@@ERROR<>0)
			begin
				rollback
				return -1
			end
	commit tran
	return 0
end
GO
/****** Object:  StoredProcedure [dbo].[Patent_Delete]    Script Date: 12/07/2016 16:56:29 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
/*******
--: Patent_Delete
--: Patent, 
--: 
PatentId
--: 
	
--:
	0 - 
	-1 -  
*********/
CREATE PROCEDURE [dbo].[Patent_Delete]
@PatentId int
AS
begin
	begin tran
		declare
		@UserCardId varchar(50),
		@TransferStatus varchar(50)
		set @UserCardId=(select UserCardId from Patent where PatentId=@PatentId)
	  set @TransferStatus=( select TransferStatus from Patent where PatentId=@PatentId)
	  if(@TransferStatus<>'')
	    begin
		delete Patent where PatentId=@PatentId
	    delete PatentAuditProcess
	    where PatentId=@PatentId
		delete PatentExamine where PatentId=@PatentId
		delete PatentPartner where PatentId=@PatentId
	    	exec [dbo].[Journal_Insert] @UserCardId,'',''
		end
		if(@@ERROR<>0)
			begin
				rollback
				return -1
			end
	commit tran
	return 0
end
GO
/****** Object:  StoredProcedure [dbo].[Rank_Update]    Script Date: 12/07/2016 16:56:30 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
/*******
--: Rank_Update
--: Department, 
--: 
RankId,RankName
--: 
	
--:
	0 - 
	-1 -  
*********/
CREATE PROCEDURE [dbo].[Rank_Update]
@RankId int,
@RankName varchar(50),
@UserCardId varchar(50),
@RBL varchar(50)
AS
begin
	begin tran
	if not exists(select * from Rank where RankId<>@RankId  and RankName=@RankName )
	begin
		update Rank
		 set RankName=@RankName ,
		 RBL=@RBL
		 where RankId=@RankId
		exec [dbo].[Journal_Insert] @UserCardId,'',''
		end
		if(@@ERROR<>0)
			begin
				rollback
				return -1
			end
	commit tran
	return 0
end
GO
/****** Object:  StoredProcedure [dbo].[PaperPartner_Update]    Script Date: 12/07/2016 16:56:29 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
/*********************
--: PaperPartner_Update
--: Paper, 
--: 


--: 
	
--:
	0 - 
	-1 -  
**************/
CREATE PROCEDURE [dbo].[PaperPartner_Update]
	@PaperPartnerId int,
	@UserCardId varchar(50),
	@PartnerRank int,
	@PartnerValue float
AS
begin
	begin tran
 declare 
   @PaperUserCardId varchar(50),
 @PartnerUserCardId varchar(50),
 @sum float,
    @PaperValue float,
    @PaperId int,
    @UserValue float
    set @PaperId=(select PaperId from PaperPartner where PaperPartnerId=@PaperPartnerId)
     set @PaperUserCardId=(select UserCardId from Paper where PaperId=@PaperId)
   set @PartnerUserCardId=(select PartnerUserCardId  from PaperPartner where PaperPartnerId=@PaperPartnerId)
  
  
    if(@PaperUserCardId<>@PartnerUserCardId)
   begin
   if(@PaperUserCardId<>@UserCardId)
   begin
  set @UserValue=(select PartnerValue from PaperPartner where PaperPartnerId=@PaperPartnerId)
    set @sum=(select SUM(PartnerValue) from PaperPartner where PaperId=@PaperId)
    set @PaperValue=(select PaperValue from Paper where PaperId=@PaperId)
    if(@sum-@UserValue+@PartnerValue<=@PaperValue)
    begin
		update PaperPartner set
		PartnerRank=@PartnerRank,
		PartnerValue=@PartnerValue,
		PartnerUserCardId=@UserCardId
		where PaperPartnerId=@PaperPartnerId 
		 exec [dbo].[Journal_Insert] @PaperUserCardId,'',''
end

   end
   end
   else
   begin
   if(@PartnerUserCardId=@UserCardId)
   begin
   set @UserValue=(select PartnerValue from PaperPartner where PaperPartnerId=@PaperPartnerId)
    set @sum=(select SUM(PartnerValue) from PaperPartner where PaperId=@PaperId)
    set @PaperValue=(select PaperValue from Paper where PaperId=@PaperId)
    if(@sum-@UserValue+@PartnerValue<=@PaperValue)
    begin
		update PaperPartner set
		PartnerRank=@PartnerRank,
		PartnerValue=@PartnerValue,
		PartnerUserCardId=@UserCardId
		where PaperPartnerId=@PaperPartnerId 
		 exec [dbo].[Journal_Insert] @PaperUserCardId,'',''
end

   end
   end
   
 

		if(@@ERROR<>0)
			begin
				rollback
				return -1
			end
	commit tran
	return 0
end
GO
/****** Object:  StoredProcedure [dbo].[PaperPartner_Insert]    Script Date: 12/07/2016 16:56:29 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
/*********************
--: PaperPartner_Insert
--: PaperPartner, 
--: 

--: 
	
--:
	0 - 
	-1 -  
**************/
CREATE PROCEDURE [dbo].[PaperPartner_Insert]
@PaperId int,
@PartnerValue float,
@PartnerRank int,
@UserCardId varchar(50)
AS
begin
	begin tran
	  if not exists( select * from PaperPartner where PaperId=@PaperId and PartnerUserCardId=@UserCardId)
    begin
    declare @sum float,
    @PaperValue float,
    	@PaperUserCardId varchar(50)
    set @PaperValue=(select PaperValue from Paper where PaperId=@PaperId)
    set @PaperUserCardId=(select UserCardId from Paper where PaperId=@PaperId)
		
    if exists(select * from PaperPartner where PaperId=@PaperId)
    begin
        set @sum=(select SUM(PartnerValue) from PaperPartner where PaperId=@PaperId)
    if(@sum+@PartnerValue<=@PaperValue)
    begin
     insert into PaperPartner(
     PaperId,PartnerValue,PartnerRank,PartnerUserCardId
     )values(
     @PaperId,@PartnerValue,@PartnerRank,@UserCardId
     )
	 exec [dbo].[Journal_Insert] @PaperUserCardId,'',''
	end
    end
    else
     begin
       if(@PartnerValue<=@PaperValue)
    begin
     insert into PaperPartner(
     PaperId,PartnerValue,PartnerRank,PartnerUserCardId
     )values(
     @PaperId,@PartnerValue,@PartnerRank,@UserCardId
     )
	 exec [dbo].[Journal_Insert] @PaperUserCardId,'',''
	end
    end
    

	end
	
		if(@@ERROR<>0)
			begin
				rollback
				return -1
			end
	commit tran
	return 0
end
GO
/****** Object:  StoredProcedure [dbo].[PaperPartner_Delete]    Script Date: 12/07/2016 16:56:29 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
/*******
--: PaperPartner_Delete
--: Paper, 
--: 
PaperPartnerId
--: 
	
--:
	0 - 
	-1 -  
*********/
CREATE PROCEDURE [dbo].[PaperPartner_Delete]
@PaperPartnerId int
AS
begin
	begin tran	
		declare 
		@PartnerUserCardId varchar(50),
		@PaperUserCardId varchar(50),
		@PaperId int
		set @PaperId=(select PaperId from PaperPartner where PaperPartnerId=@PaperPartnerId)
		set @PartnerUserCardId=(select PartnerUserCardId from PaperPartner where PaperPartnerId=@PaperPartnerId)
		set @PaperUserCardId=(select UserCardId from Paper where PaperId=@PaperId)
		if(@PaperUserCardId<>@PartnerUserCardId)
		begin
		delete PaperPartner where PaperPartnerId=@PaperPartnerId
			exec [dbo].[Journal_Insert] @PaperUserCardId,'',''
	   end
	   
		if(@@ERROR<>0)
			begin
				rollback
				return -1
			end
	commit tran
	return 0
end
GO
/****** Object:  StoredProcedure [dbo].[GuidancePartner_Update]    Script Date: 12/07/2016 16:56:28 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
/*********************
--: GuidancePartner_Update
--: Guidance, 
--: 


--: 
	
--:
	0 - 
	-1 -  
**************/
CREATE PROCEDURE [dbo].[GuidancePartner_Update]
	@GuidancePartnerId int,
	@UserCardId varchar(50),
	@PartnerRank int,
	@PartnerValue float
AS
begin
	begin tran
 declare 
   @GuidanceUserCardId varchar(50),
 @PartnerUserCardId varchar(50),
 @sum float,
    @GuidanceValue float,
    @GuidanceId int,
    @UserValue float
    set @GuidanceId=(select GuidanceId from GuidancePartner where GuidancePartnerId=@GuidancePartnerId)
     set @GuidanceUserCardId=(select UserCardId from Guidance where GuidanceId=@GuidanceId)
   set @PartnerUserCardId=(select PartnerUserCardId  from GuidancePartner where GuidancePartnerId=@GuidancePartnerId)
  
  
    if(@GuidanceUserCardId<>@PartnerUserCardId)
   begin
   if(@GuidanceUserCardId<>@UserCardId)
   begin
  set @UserValue=(select PartnerValue from GuidancePartner where GuidancePartnerId=@GuidancePartnerId)
    set @sum=(select SUM(PartnerValue) from GuidancePartner where GuidanceId=@GuidanceId)
    set @GuidanceValue=(select GuidanceValue from Guidance where GuidanceId=@GuidanceId)
    if(@sum-@UserValue+@PartnerValue<=@GuidanceValue)
    begin
		update GuidancePartner set
		PartnerRank=@PartnerRank,
		PartnerValue=@PartnerValue,
		PartnerUserCardId=@UserCardId
		where GuidancePartnerId=@GuidancePartnerId 
		  exec [dbo].[Journal_Insert] @GuidanceUserCardId,'',''
end

   end
   end
   else
   begin
   if(@PartnerUserCardId=@UserCardId)
   begin
   set @UserValue=(select PartnerValue from GuidancePartner where GuidancePartnerId=@GuidancePartnerId)
    set @sum=(select SUM(PartnerValue) from GuidancePartner where GuidanceId=@GuidanceId)
    set @GuidanceValue=(select GuidanceValue from Guidance where GuidanceId=@GuidanceId)
    if(@sum-@UserValue+@PartnerValue<=@GuidanceValue)
    begin
		update GuidancePartner set
		PartnerRank=@PartnerRank,
		PartnerValue=@PartnerValue,
		PartnerUserCardId=@UserCardId
		where GuidancePartnerId=@GuidancePartnerId 
		  exec [dbo].[Journal_Insert] @GuidanceUserCardId,'',''
end

   end
   end
   


		if(@@ERROR<>0)
			begin
				rollback
				return -1
			end
	commit tran
	return 0
end
GO
/****** Object:  StoredProcedure [dbo].[Harvest_Delete]    Script Date: 12/07/2016 16:56:28 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
/*******
--: Harvest_Delete
--: Harvest, 
--: 
HarvestId
--: 
	
--:
	0 - 
	-1 -  
*********/
CREATE PROCEDURE [dbo].[Harvest_Delete]
@HarvestId int
AS
begin
	begin tran
		declare
		@UserCardId varchar(50),
		@TransferStatus varchar(50)
		set @UserCardId=(select UserCardId from Harvest where HarvestId=@HarvestId)
	  set @TransferStatus=( select TransferStatus from Harvest where HarvestId=@HarvestId)
	  if(@TransferStatus<>'')
	    begin
		delete Harvest where HarvestId=@HarvestId
	    delete HarvestAuditProcess  where HarvestId=@HarvestId
		delete HarvestPartner where HarvestId=@HarvestId
		delete HarvestExamine where HarvestId=@HarvestId
	    	exec [dbo].[Journal_Insert] @UserCardId,'',''
		end
		if(@@ERROR<>0)
			begin
				rollback
				return -1
			end
	commit tran
	return 0
end
GO
/****** Object:  StoredProcedure [dbo].[ProjectsLevel_Update]    Script Date: 12/07/2016 16:56:29 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
/*******
--: ProjectsLevel_Update
--: ProjectsLevel, 
--: 
ProjectsLevelId,ProjectsLevelName
--: 
	
--:
	0 - 
	-1 -  
*********/
CREATE PROCEDURE [dbo].[ProjectsLevel_Update]
@ProjectsLevelId int,
@ProjectsLevelExplain varchar(50),
@UserCardId varchar(50)
AS
begin
	begin tran
	if not exists(select * from ProjectsLevel where ProjectsLevelId<>@ProjectsLevelId and ProjectsLevelExplain=@ProjectsLevelExplain)
	
	begin	update ProjectsLevel set ProjectsLevelExplain=@ProjectsLevelExplain where ProjectsLevelId=@ProjectsLevelId
		exec [dbo].[Journal_Insert] @UserCardId,'',''
	end
		if(@@ERROR<>0)
			begin
				rollback
				return -1
			end
	commit tran
	return 0
end
GO
/****** Object:  StoredProcedure [dbo].[ShortCapitalChange_SelectByUserCardId]    Script Date: 12/07/2016 16:56:30 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
/*********************
--: ShortCapitalChange_SelectByUserCardId
--: ShortCapitalChange, 
--: 
  UserCardId
--: 
	
--:
	0 - 
	-1 -  
**************/
CREATE PROCEDURE [dbo].[ShortCapitalChange_SelectByUserCardId]
	@UserCardId varchar(50),
	@RankId int
	AS
begin
   declare
   @DepartmentId int,
      @TeachersDepartmentId int
   set @DepartmentId=(select UserDepartmentId from UserInfo where UserCardId=@UserCardId)
   set @TeachersDepartmentId=(select TeachersDepartmentId from UserInfo where UserCardId=@UserCardId)

     select a.*,b.UserName,c.DepartmentName,c.DepartmentName,d.Company,d.ContractId,d.ContractMoney,d.ContractName,g.*
   from ShortCapitalChange a left join UserInfo b on a.UserCardId=b.UserCardId 
   left join Department c on a.DepartmentId=c.DepartmentId
   left join ShortProjects d on a.ShortProjectsId=d.ShortProjectsId
   left join ShortCapitalChangeWaitExamine e on  a.ShortProjectsId=e.ShortProjectsId
   left join ShortProjects f on a.ShortProjectsId=f.ShortProjectsId
   left join ShortCapitalBasic g on a.ShortProjectsId=g.ShortProjectsId
   where 
(   e.ProcessDepartmentId=@DepartmentId  
   and e.ProcessRankId=convert( varchar(50),@RankId) )or (   e.ProcessDepartmentId=@TeachersDepartmentId  
   and e.ProcessRankId=convert( varchar(50),@RankId) )
    
end
GO
/****** Object:  StoredProcedure [dbo].[ShortCapitalBasic_SelectCanUpdate]    Script Date: 12/07/2016 16:56:30 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
/******
--: AdminSeries_Select
--: AdminSeries, 
--
--: 
--: 
	
--:
	0 - 
	-1 -  
******/
CREATE PROCEDURE [dbo].[ShortCapitalBasic_SelectCanUpdate]
AS
begin

select a.ShortProjectsId,a.ContractId,a.ContractMoney,a.ContractName,a.Company,e.UserName ,d.DepartmentName,b.SuedCompany,b.Servicelife,b.SumMoney 
 from ShortProjects a left join ShortCapitalBasic b on a.ShortProjectsId=b.ShortProjectsId,
	Department d,UserInfo e
		where a.StandStatus=''
		and a.EndStatus=''
		and a.DepartmentId=d.DepartmentId
		and a.UserCardId=e.UserCardId

end
GO
/****** Object:  StoredProcedure [dbo].[PatentExamine_Select]    Script Date: 12/07/2016 16:56:29 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
/*********************
--: PatentExamine_Select
--: PatentExamine, 
--: 
  PatentId
--: 
	
--:
	0 - 
	-1 -  
**************/
CREATE PROCEDURE [dbo].[PatentExamine_Select]
@PatentId int
AS
BEGIN

 select a.*,c.UserName,d.RankName,e.DepartmentName
 from PatentExamine a,PatentAuditProcess b,UserInfo c,Rank d,Department e
 where a.PatentId=@PatentId and a.PatentId=b.PatentId and a.ExamineUserCardId=c.UserCardId 
 and a.ExamineNumber=b.ProcessOrder and b.ProcessRankId=d.RankId and c.UserDepartmentId=e.DepartmentId
   order by ExamineNumber
END
GO
/****** Object:  StoredProcedure [dbo].[Patent_SelectByUserCardId]    Script Date: 12/07/2016 16:56:29 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
/*********************
--: Patent_SelectByUserCardId
--: Patent, 
--: 
  UserCardId
--: 
	
--:
	0 - 
	-1 -  
**************/
CREATE PROCEDURE [dbo].[Patent_SelectByUserCardId]
	@UserCardId varchar(50),
	@RankId int
	AS
begin
   declare
   @DepartmentId int,
      @TeachersDepartmentId int
   set @DepartmentId=(select UserDepartmentId from UserInfo where UserCardId=@UserCardId)
   set @TeachersDepartmentId=(select TeachersDepartmentId from UserInfo where UserCardId=@UserCardId)
   select a.*,b.UserName,c.DepartmentName,c.DepartmentName
   from Patent a left join UserInfo b on  a.UserCardId=b.UserCardId
    left join Department c on a.DepartmentId=c.DepartmentId
   where (
   a.ProcessDepartmentId=@DepartmentId
   and a.ProcessRoleId= convert( varchar(50),@RankId))
   or (
   a.ProcessDepartmentId=@TeachersDepartmentId
   and a.ProcessRoleId= convert( varchar(50),@RankId))
    
end
GO
/****** Object:  StoredProcedure [dbo].[Patent_SelectByPatentUserCardId]    Script Date: 12/07/2016 16:56:29 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
/*********************
--: Patent_SelectByPatentUserCardId
--: Patent, 
--: 
  UserCardId
--: 
	
--:
	0 - 
	-1 -  
**************/
CREATE PROCEDURE [dbo].[Patent_SelectByPatentUserCardId]
	@UserCardId varchar(50)
	AS
begin
	 
	
	select b.UserName ,a.* ,c.DepartmentName 
	from Patent a,UserInfo b ,Department c
	where a.UserCardId=b.UserCardId and 
	a.UserCardId = @UserCardId and a.DepartmentId=c.DepartmentId  
	
end
GO
/****** Object:  StoredProcedure [dbo].[Patent_SelectByPartnerUserNo]    Script Date: 12/07/2016 16:56:29 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
/*********************
--: Patent_SelectByPatentUserCardId
--: Patent, 
--: 
  UserCardId
--: 
	
--:
	0 - 
	-1 -  
**************/
CREATE PROCEDURE [dbo].[Patent_SelectByPartnerUserNo]
	@UserCardId varchar(50)
	AS
begin
	 
	
	select b.UserName ,a.* ,c.DepartmentName 
	from Patent a,UserInfo b ,Department c,PatentPartner d
	where a.PatentId=d.PatentId and d.PartnerUserCardId=@UserCardId
	and d.PartnerUserCardId=b.UserCardId and b.UserDepartmentId=c.DepartmentId
	and a.TransferStatus=''
	
end
GO
/****** Object:  StoredProcedure [dbo].[Patent_SelectByPartnerUserCardId]    Script Date: 12/07/2016 16:56:29 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
/*********************
--: Patent_SelectByPartnerUserCardId
--: Patent, 
--: 
  UserCardId
--: 
	
--:
	0 - 
	-1 -  
**************/
CREATE PROCEDURE [dbo].[Patent_SelectByPartnerUserCardId]
	@UserCardId varchar(50),
	@ApplyYearId int
	AS
begin
	 
	
	select b.UserName ,a.* ,c.DepartmentName ,d.PartnerValue,d.PartnerRank
	from Patent a,UserInfo b ,Department c,PatentPartner d
	where d.PartnerUserCardId=b.UserCardId and 
	d.PartnerUserCardId = @UserCardId and b.UserDepartmentId=c.DepartmentId
	and a.PatentId=d.PatentId  and a.ApplyYearId=@ApplyYearId and a.TransferStatus=''
	
end
GO
/****** Object:  StoredProcedure [dbo].[Patent_SelectByPartnerUser]    Script Date: 12/07/2016 16:56:29 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
/*********************
--: Patent_SelectByPatentUserCardId
--: Patent, 
--: 
  UserCardId
--: 
	
--:
	0 - 
	-1 -  
**************/
CREATE PROCEDURE [dbo].[Patent_SelectByPartnerUser]
	@UserCardId varchar(50)
	AS
begin
	 
	
	select b.UserName ,a.* ,c.DepartmentName ,d.PartnerRank,d.PartnerValue
	from Patent a,UserInfo b ,Department c,PatentPartner d
	where   d.PartnerUserCardId=@UserCardId and a.PatentId=d.PatentId
	and a.UserCardId=b.UserCardId and b.UserDepartmentId=c.DepartmentId
	
end
GO
/****** Object:  StoredProcedure [dbo].[Patent_SelectByMyUserCardId]    Script Date: 12/07/2016 16:56:29 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
/*********************
--: Patent_SelectByPatentUserCardId
--: Patent, 
--: 
  UserCardId
--: 
	
--:
	0 - 
	-1 -  
**************/
CREATE PROCEDURE [dbo].[Patent_SelectByMyUserCardId]
	@UserCardId varchar(50)
	AS
begin

	select b.UserName ,a.* ,c.DepartmentName
	from Patent a,UserInfo b ,Department c
	where    a.UserCardId=@UserCardId
	and a.UserCardId=b.UserCardId and b.UserDepartmentId=c.DepartmentId
		and a.TransferStatus=''
end
GO
/****** Object:  StoredProcedure [dbo].[PaperExamine_Select]    Script Date: 12/07/2016 16:56:29 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
/*********************
--: PaperExamine_Select
--: PaperExamine, 
--: 
  PaperId
--: 
	
--:
	0 - 
	-1 -  
**************/
CREATE PROCEDURE [dbo].[PaperExamine_Select]
@PaperId int
AS
BEGIN

 select a.*,c.UserName,d.RankName,e.DepartmentName
 from PaperExamine a,PaperAuditProcess b,UserInfo c,Rank d,Department e
 where a.PaperId=@PaperId and a.PaperId=b.PaperId and a.ExamineUserCardId=c.UserCardId 
 and a.ExamineNumber=b.ProcessOrder and b.ProcessRankId=d.RankId and c.UserDepartmentId=e.DepartmentId
   order by ExamineNumber
END
GO
/****** Object:  StoredProcedure [dbo].[Paper_SelectByUserCardId]    Script Date: 12/07/2016 16:56:29 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
/*********************
--: Paper_SelectByUserCardId
--: Paper, 
--: 
  UserCardId
--: 
	
--:
	0 - 
	-1 -  
**************/
CREATE PROCEDURE [dbo].[Paper_SelectByUserCardId]
	@UserCardId varchar(50),
	@RankId int
	AS
begin
   declare
   @DepartmentId int,
      @TeachersDepartmentId int
   set @DepartmentId=(select UserDepartmentId from UserInfo where UserCardId=@UserCardId)
   set @TeachersDepartmentId=(select TeachersDepartmentId from UserInfo where UserCardId=@UserCardId)
   select a.*,b.UserName,c.DepartmentName,c.DepartmentName
   from Paper a left join UserInfo b on a.UserCardId=b.UserCardId 
   left join Department c on a.DepartmentId=c.DepartmentId
   where (
   a.ProcessDepartmentId=@DepartmentId
   and a.ProcessRoleId= convert( varchar(50),@RankId))
   or (
   a.ProcessDepartmentId=@TeachersDepartmentId
   and a.ProcessRoleId= convert( varchar(50),@RankId))
    
end
GO
/****** Object:  StoredProcedure [dbo].[Paper_SelectByPartnerUserNo]    Script Date: 12/07/2016 16:56:29 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
/*********************
--: Paper_SelectByPaperUserCardId
--: Paper, 
--: 
  UserCardId
--: 
	
--:
	0 - 
	-1 -  
**************/
CREATE PROCEDURE [dbo].[Paper_SelectByPartnerUserNo]
	@UserCardId varchar(50)
	AS
begin
	 
	
	select b.UserName ,a.* ,c.DepartmentName 
	from Paper a,UserInfo b ,Department c,PaperPartner d
	where a.PaperId=d.PaperId and d.PartnerUserCardId=@UserCardId
	and d.PartnerUserCardId=b.UserCardId and b.UserDepartmentId=c.DepartmentId
	and a.TransferStatus=''
	
end
GO
/****** Object:  StoredProcedure [dbo].[Paper_SelectByPartnerUserCardId]    Script Date: 12/07/2016 16:56:29 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
/*********************
--: Paper_SelectByPartnerUserCardId
--: Paper, 
--: 
  UserCardId
--: 
	
--:
	0 - 
	-1 -  
**************/
CREATE PROCEDURE [dbo].[Paper_SelectByPartnerUserCardId]
	@UserCardId varchar(50),
	@ApplyYearId int
	AS
begin
	 
	
	select b.UserName ,a.* ,c.DepartmentName ,d.PartnerValue,d.PartnerRank
	from Paper a,UserInfo b ,Department c,PaperPartner d
	where d.PartnerUserCardId=b.UserCardId and 
	d.PartnerUserCardId = @UserCardId and b.UserDepartmentId=c.DepartmentId
	and a.PaperId=d.PaperId  and a.ApplyYearId=@ApplyYearId and a.TransferStatus=''
	
end
GO
/****** Object:  StoredProcedure [dbo].[Paper_SelectByPartnerUser]    Script Date: 12/07/2016 16:56:29 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
/*********************
--: Paper_SelectByPaperUserCardId
--: Paper, 
--: 
  UserCardId
--: 
	
--:
	0 - 
	-1 -  
**************/
CREATE PROCEDURE [dbo].[Paper_SelectByPartnerUser]
	@UserCardId varchar(50)
	AS
begin
	 
	
	select b.UserName ,a.* ,c.DepartmentName ,d.PartnerRank,d.PartnerValue
	from Paper a,UserInfo b ,Department c,PaperPartner d
	where   d.PartnerUserCardId=@UserCardId and a.PaperId=d.PaperId
	and a.UserCardId=b.UserCardId and b.UserDepartmentId=c.DepartmentId
	
end
GO
/****** Object:  StoredProcedure [dbo].[Paper_SelectByPaperUserCardId]    Script Date: 12/07/2016 16:56:29 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
/*********************
--: Paper_SelectByPaperUserCardId
--: Paper, 
--: 
  UserCardId
--: 
	
--:
	0 - 
	-1 -  
**************/
CREATE PROCEDURE [dbo].[Paper_SelectByPaperUserCardId]
	@UserCardId varchar(50)
	AS
begin
	 
	
	select b.UserName ,a.* ,c.DepartmentName 
	from Paper a,UserInfo b ,Department c
	where a.UserCardId=b.UserCardId and 
	a.UserCardId = @UserCardId and a.DepartmentId=c.DepartmentId  
	
end
GO
/****** Object:  StoredProcedure [dbo].[Paper_SelectByMyUserCardId]    Script Date: 12/07/2016 16:56:29 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
/*********************
--: Paper_SelectByPaperUserCardId
--: Paper, 
--: 
  UserCardId
--: 
	
--:
	0 - 
	-1 -  
**************/
CREATE PROCEDURE [dbo].[Paper_SelectByMyUserCardId]
	@UserCardId varchar(50)
	AS
begin

	select b.UserName ,a.* ,c.DepartmentName
	from Paper a,UserInfo b ,Department c
	where    a.UserCardId=@UserCardId
	and a.UserCardId=b.UserCardId and b.UserDepartmentId=c.DepartmentId
		and a.TransferStatus=''
end
GO
/****** Object:  StoredProcedure [dbo].[LongProjectsStandExamine_Select]    Script Date: 12/07/2016 16:56:29 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
/*********************
--: LongProjectsDeclareExamine_Select
--: LongProjectsDeclareExamine, 
--
--: 
  LongProjectsId
--: 
	
--:
	0 - 
	-1 -  
**************/
CREATE PROCEDURE [dbo].[LongProjectsStandExamine_Select]
@LongProjectsId varchar(50)
AS
BEGIN

 select a.*,c.UserName,d.RankName,e.DepartmentName
from LongProjectsStandExamine a,LongProjectsStandAuditProcess b,UserInfo c,Rank d,Department e
where a.LongProjectsId=@LongProjectsId and a.LongProjectsId=b.LongProjectsId and a.ExamineUserCardId=c.UserCardId 
 and a.ExamineNumber=b.ProcessOrder and b.ProcessRankId=d.RankId and c.UserDepartmentId=e.DepartmentId
   order by ExamineNumber


END
GO
/****** Object:  StoredProcedure [dbo].[LongProjectsStandCanBranch_Select]    Script Date: 12/07/2016 16:56:29 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
/*********************
--: LongProjects_SelectByUserCardId
--: LongProjects, 
--
--: 
  UserCardId
--: 
	
--:
	0 - 
	-1 -  
**************/
CREATE PROCEDURE [dbo].[LongProjectsStandCanBranch_Select]
	AS
begin
  
   
   select a.*,b.UserName,c.DepartmentName,c.DepartmentName,e.ProjectsFromExplain,f.ProjectsLevelExplain,g.ProjectsSubjectExplain
   from LongProjects a,UserInfo b,Department c,ProjectsFrom e,ProjectsLevel f,ProjectsSubject g
   where a.UserCardId=b.UserCardId and 
    a.DepartmentId=c.DepartmentId and 
   a.ProjectsFromId=e.ProjectsFromId and
    a.ProjectsLevelId=f.ProjectsLevelId and 
	a.ProjectsSubjectId=g.ProjectsSubjectId 
	and a.DeclareStatus=''
	and a.StandStatus<>''
	and a.StandStatus<>''
	and a.StandStatus<>''
    
end
GO
/****** Object:  StoredProcedure [dbo].[LongProjectsStand_SelectByUserCardId]    Script Date: 12/07/2016 16:56:29 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
/*********************
--: LongProjects_SelectByUserCardId
--: LongProjects, 
--
--: 
  UserCardId
--: 
	
--:
	0 - 
	-1 -  
**************/
CREATE PROCEDURE [dbo].[LongProjectsStand_SelectByUserCardId]
	@UserCardId varchar(50),
	@RankId varchar(50)
	AS
begin
   declare
    @DepartmentId int,
      @TeachersDepartmentId int
   set @DepartmentId=(select UserDepartmentId from UserInfo where UserCardId=@UserCardId)
   set @TeachersDepartmentId=(select TeachersDepartmentId from UserInfo where UserCardId=@UserCardId)

   
   select a.*,b.UserName,c.DepartmentName,c.DepartmentName,e.ProjectsFromExplain,f.ProjectsLevelExplain,g.ProjectsSubjectExplain
   from LongProjects a left join UserInfo b on a.UserCardId=b.UserCardId
   left join Department c on a.DepartmentId=c.DepartmentId
   left join LongProjectsStandWaitExamine d on a.LongProjectsId=d.LongProjectsId
   left join ProjectsFrom e on a.ProjectsFromId=e.ProjectsFromId
   left join ProjectsLevel f on  a.ProjectsLevelId=f.ProjectsLevelId
   left join ProjectsSubject g on a.ProjectsSubjectId=g.ProjectsSubjectId
   where  
   (d.ProcessDepartmentId=@DepartmentId
   and d.ProcessRankId=convert( varchar(50),@RankId)) or( d.ProcessDepartmentId=@TeachersDepartmentId
   and d.ProcessRankId=convert( varchar(50),@RankId))
    
end
GO
/****** Object:  StoredProcedure [dbo].[LongProjectsInspectExamine_Select]    Script Date: 12/07/2016 16:56:29 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
/*********************
--: LongProjectsDeclareExamine_Select
--: LongProjectsDeclareExamine, 
--
--: 
  LongProjectsId
--: 
	
--:
	0 - 
	-1 -  
**************/
CREATE PROCEDURE [dbo].[LongProjectsInspectExamine_Select]
@LongProjectsId varchar(50)
AS
BEGIN

 select a.*,c.UserName,d.RankName,e.DepartmentName
from LongProjectsInspectExamine a,LongProjectsInspectAuditProcess b,UserInfo c,Rank d,Department e
where a.LongProjectsId=@LongProjectsId and a.LongProjectsId=b.LongProjectsId and a.ExamineUserCardId=c.UserCardId 
 and a.ExamineNumber=b.ProcessOrder and b.ProcessRankId=d.RankId and c.UserDepartmentId=e.DepartmentId
   order by ExamineNumber


END
GO
/****** Object:  StoredProcedure [dbo].[LongProjectsInspect_SelectByUserCardId]    Script Date: 12/07/2016 16:56:29 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
/*********************
--: LongProjects_SelectByUserCardId
--: LongProjects, 
--
--: 
  UserCardId
--: 
	
--:
	0 - 
	-1 -  
**************/
CREATE PROCEDURE [dbo].[LongProjectsInspect_SelectByUserCardId]
	@UserCardId varchar(50),
	@RankId varchar(50)
	AS
begin
   declare
    @DepartmentId int,
      @TeachersDepartmentId int
   set @DepartmentId=(select UserDepartmentId from UserInfo where UserCardId=@UserCardId)
   set @TeachersDepartmentId=(select TeachersDepartmentId from UserInfo where UserCardId=@UserCardId)

   select a.*,b.UserName,c.DepartmentName,c.DepartmentName,e.ProjectsFromExplain,f.ProjectsLevelExplain,g.ProjectsSubjectExplain
   from LongProjects a left join UserInfo b on a.UserCardId=b.UserCardId
   left join Department c on a.DepartmentId=c.DepartmentId
   left join LongProjectsInspectWaitExamine d on a.LongProjectsId=d.LongProjectsId
   left join ProjectsFrom e on a.ProjectsFromId=e.ProjectsFromId
   left join ProjectsLevel f on  a.ProjectsLevelId=f.ProjectsLevelId
   left join ProjectsSubject g on a.ProjectsSubjectId=g.ProjectsSubjectId
   where 
(   d.ProcessDepartmentId=@DepartmentId
   and d.ProcessRankId=convert( varchar(50),@RankId)) or  (  d.ProcessDepartmentId=@TeachersDepartmentId
   and d.ProcessRankId=convert( varchar(50),@RankId))

    
end
GO
/****** Object:  StoredProcedure [dbo].[LongProjectsEndExamine_Select]    Script Date: 12/07/2016 16:56:29 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
/*********************
--: LongProjectsDeclareExamine_Select
--: LongProjectsDeclareExamine, 
--
--: 
  LongProjectsId
--: 
	
--:
	0 - 
	-1 -  
**************/
CREATE PROCEDURE [dbo].[LongProjectsEndExamine_Select]
@LongProjectsId varchar(50)
AS
BEGIN

 select a.*,c.UserName,d.RankName,e.DepartmentName
from LongProjectsEndExamine a,LongProjectsEndAuditProcess b,UserInfo c,Rank d,Department e
where a.LongProjectsId=@LongProjectsId and a.LongProjectsId=b.LongProjectsId and a.ExamineUserCardId=c.UserCardId 
 and a.ExamineNumber=b.ProcessOrder and b.ProcessRankId=d.RankId and c.UserDepartmentId=e.DepartmentId
   order by ExamineNumber


END
GO
/****** Object:  StoredProcedure [dbo].[LongProjectsEndCanBranch_Select]    Script Date: 12/07/2016 16:56:29 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
/*********************
--: LongProjects_SelectByUserCardId
--: LongProjects, 
--
--: 
  UserCardId
--: 
	
--:
	0 - 
	-1 -  
**************/
CREATE PROCEDURE [dbo].[LongProjectsEndCanBranch_Select]
	AS
begin
  
   
   select a.*,b.UserName,c.DepartmentName,c.DepartmentName,e.ProjectsFromExplain,f.ProjectsLevelExplain,g.ProjectsSubjectExplain
   from LongProjects a,UserInfo b,Department c,ProjectsFrom e,ProjectsLevel f,ProjectsSubject g
   where a.UserCardId=b.UserCardId and 
    a.DepartmentId=c.DepartmentId and 
   a.ProjectsFromId=e.ProjectsFromId and
    a.ProjectsLevelId=f.ProjectsLevelId and 
	a.ProjectsSubjectId=g.ProjectsSubjectId 
	and a.InspectStatus=''
	and a.EndStatus<>''
	and a.EndStatus<>''
	and a.EndStatus<>''
    
end
GO
/****** Object:  StoredProcedure [dbo].[LongProjectsEnd_SelectByUserCardId]    Script Date: 12/07/2016 16:56:29 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
/*********************
--: LongProjects_SelectByUserCardId
--: LongProjects, 
--
--: 
  UserCardId
--: 
	
--:
	0 - 
	-1 -  
**************/
CREATE PROCEDURE [dbo].[LongProjectsEnd_SelectByUserCardId]
	@UserCardId varchar(50),
	@RankId varchar(50)
	AS
begin
   declare
   @DepartmentId int,
      @TeachersDepartmentId int
   set @DepartmentId=(select UserDepartmentId from UserInfo where UserCardId=@UserCardId)
   set @TeachersDepartmentId=(select TeachersDepartmentId from UserInfo where UserCardId=@UserCardId)

   
   select a.*,b.UserName,c.DepartmentName,c.DepartmentName,e.ProjectsFromExplain,f.ProjectsLevelExplain,g.ProjectsSubjectExplain
   from LongProjects a left join UserInfo b on a.UserCardId=b.UserCardId
    left join Department c on a.DepartmentId=c.DepartmentId 
	left join LongProjectsEndWaitExamine d on  a.LongProjectsId=d.LongProjectsId
	left join ProjectsFrom e on  a.ProjectsFromId=e.ProjectsFromId
	left join ProjectsLevel f on a.ProjectsLevelId=f.ProjectsLevelId
	left join ProjectsSubject g on a.ProjectsSubjectId=g.ProjectsSubjectId
   where 
   (d.ProcessDepartmentId=@DepartmentId
   and d.ProcessRankId=convert( varchar(50),@RankId))or (d.ProcessDepartmentId=@TeachersDepartmentId
   and d.ProcessRankId=convert( varchar(50),@RankId))
    
end
GO
/****** Object:  StoredProcedure [dbo].[LongProjectsDeclareExamine_Select]    Script Date: 12/07/2016 16:56:28 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
/*********************
--: LongProjectsDeclareExamine_Select
--: LongProjectsDeclareExamine, 
--
--: 
  LongProjectsId
--: 
	
--:
	0 - 
	-1 -  
**************/
CREATE PROCEDURE [dbo].[LongProjectsDeclareExamine_Select]
@LongProjectsId varchar(50)
AS
BEGIN

 select a.*,c.UserName,d.RankName,e.DepartmentName
from LongProjectsDeclareExamine a,LongProjectsDeclareAuditProcess b,UserInfo c,Rank d,Department e
where a.LongProjectsId=@LongProjectsId and a.LongProjectsId=b.LongProjectsId and a.ExamineUserCardId=c.UserCardId 
 and a.ExamineNumber=b.ProcessOrder and b.ProcessRankId=d.RankId and c.UserDepartmentId=e.DepartmentId
   order by ExamineNumber


END
GO
/****** Object:  StoredProcedure [dbo].[LongProjectsDeclare_SelectByUserCardId]    Script Date: 12/07/2016 16:56:28 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
/*********************
--: LongProjects_SelectByUserCardId
--: LongProjects, 
--
--: 
  UserCardId
--: 
	
--:
	0 - 
	-1 -  
**************/
CREATE PROCEDURE [dbo].[LongProjectsDeclare_SelectByUserCardId]
	@UserCardId varchar(50),
	@RankId varchar(50)
	AS
begin
   declare
   @DepartmentId int,
      @TeachersDepartmentId int
   set @DepartmentId=(select UserDepartmentId from UserInfo where UserCardId=@UserCardId)
   set @TeachersDepartmentId=(select TeachersDepartmentId from UserInfo where UserCardId=@UserCardId)
 
   
   select a.*,b.UserName,c.DepartmentName,c.DepartmentName ,e.ProjectsFromExplain,f.ProjectsLevelExplain,g.ProjectsSubjectExplain
   from LongProjects a left join UserInfo b on  a.UserCardId=b.UserCardId
   left join Department c on a.DepartmentId=c.DepartmentId
   left join LongProjectsDeclareWaitExamine d  on a.LongProjectsId=d.LongProjectsId 
   left join ProjectsFrom e  on a.ProjectsFromId=e.ProjectsFromId 
   left join ProjectsLevel f on  a.ProjectsLevelId=f.ProjectsLevelId
   left join ProjectsSubject g on  a.ProjectsSubjectId=g.ProjectsSubjectId
   where 
 (  d.ProcessDepartmentId=@DepartmentId
   and d.ProcessRankId=  convert( varchar(50),@RankId)) or (  d.ProcessDepartmentId=@TeachersDepartmentId
   and d.ProcessRankId=  convert( varchar(50),@RankId))
    
end
GO
/****** Object:  StoredProcedure [dbo].[LongProjects_SelectMyCanStand]    Script Date: 12/07/2016 16:56:28 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
/*********************
--: LongProjects_SelectByUserCardId
--: LongProjects, 
--
--: 
  UserCardId
--: 
	
--:
	0 - 
	-1 -  
**************/
CREATE PROCEDURE [dbo].[LongProjects_SelectMyCanStand]
@UserCardId varchar(50)
	AS
begin
  
  select a.*,b.ProjectsFromExplain,c.ProjectsLevelExplain,d.ProjectsSubjectExplain,e.UserName,f.DepartmentName
  from LongProjects a,ProjectsFrom b,ProjectsLevel c,ProjectsSubject d,UserInfo e,Department f
  where a.ProjectsFromId=b.ProjectsFromId
  and a.ProjectsLevelId =c.ProjectsLevelId 
  and a.ProjectsSubjectId=d.ProjectsSubjectId
  and a.UserCardId=e.UserCardId and a.DepartmentId=f.DepartmentId
  and a.DeclareStatus=''
  and a.StandStatus=''
  and a.UserCardId=@UserCardId

    
end
GO
/****** Object:  StoredProcedure [dbo].[LongProjects_SelectCanStand]    Script Date: 12/07/2016 16:56:28 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
/*********************
--: LongProjects_SelectByUserCardId
--: LongProjects, 
--
--: 
  UserCardId
--: 
	
--:
	0 - 
	-1 -  
**************/
CREATE PROCEDURE [dbo].[LongProjects_SelectCanStand]
	AS
begin
  
  select a.*,b.ProjectsFromExplain,c.ProjectsLevelExplain,d.ProjectsSubjectExplain,e.UserName,f.DepartmentName
  from LongProjects a,ProjectsFrom b,ProjectsLevel c,ProjectsSubject d,UserInfo e,Department f
  where a.ProjectsFromId=b.ProjectsFromId
  and a.ProjectsLevelId =c.ProjectsLevelId 
  and a.ProjectsSubjectId=d.ProjectsSubjectId
  and a.UserCardId=e.UserCardId and a.DepartmentId=f.DepartmentId
  and a.DeclareStatus=''
  and a.StandStatus=''

    
end
GO
/****** Object:  StoredProcedure [dbo].[LongProjects_SelectCanInspect]    Script Date: 12/07/2016 16:56:28 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
/*********************
--: LongProjects_SelectByUserCardId
--: LongProjects, 
--
--: 
  UserCardId
--: 
	
--:
	0 - 
	-1 -  
**************/
CREATE PROCEDURE [dbo].[LongProjects_SelectCanInspect]
@UserCardId varchar(50)
	AS
begin
  
   select a.*,b.ProjectsFromExplain,c.ProjectsLevelExplain,d.ProjectsSubjectExplain,e.UserName,f.DepartmentName
  from LongProjects a,ProjectsFrom b,ProjectsLevel c,ProjectsSubject d,UserInfo e,Department f
  where a.ProjectsFromId=b.ProjectsFromId
  and a.ProjectsLevelId =c.ProjectsLevelId 
  and a.ProjectsSubjectId=d.ProjectsSubjectId
  and a.UserCardId=e.UserCardId and a.DepartmentId=f.DepartmentId
  and a.DeclareStatus=''
  and a.StandStatus=''
  and a.InspectStatus=''
  and a.UserCardId=@UserCardId

    
end
GO
/****** Object:  StoredProcedure [dbo].[LongProjects_SelectCanEnd]    Script Date: 12/07/2016 16:56:28 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
/*********************
--: LongProjects_SelectByUserCardId
--: LongProjects, 
--
--: 
  UserCardId
--: 
	
--:
	0 - 
	-1 -  
**************/
CREATE PROCEDURE [dbo].[LongProjects_SelectCanEnd]
@UserCardId varchar(50)
	AS
begin
  
   select a.*,b.ProjectsFromExplain,c.ProjectsLevelExplain,d.ProjectsSubjectExplain,e.UserName,f.DepartmentName
  from LongProjects a,ProjectsFrom b,ProjectsLevel c,ProjectsSubject d,UserInfo e,Department f
  where a.ProjectsFromId=b.ProjectsFromId
  and a.ProjectsLevelId =c.ProjectsLevelId 
  and a.ProjectsSubjectId=d.ProjectsSubjectId
  and a.UserCardId=e.UserCardId and a.DepartmentId=f.DepartmentId
  and a.DeclareStatus=''
  and a.StandStatus=''
  and a.InspectStatus=''
  and a.EndStatus=''
  and a.UserCardId=@UserCardId

    
end
GO
/****** Object:  StoredProcedure [dbo].[LongCapitalPlanExamine_Select]    Script Date: 12/07/2016 16:56:28 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
/*********************
--: LongCapitalPlanExamine_Select
--: LongCapitalPlanExamine, 
--: 
  LongProjectsId
--: 
	
--:
	0 - 
	-1 -  
**************/
CREATE PROCEDURE [dbo].[LongCapitalPlanExamine_Select]
@LongProjectsId varchar(50)
AS
BEGIN

 select a.*,c.UserName,d.RankName,e.DepartmentName
 from LongCapitalPlanExamine a,LongCapitalPlanAuditProcess b,UserInfo c,Rank d,Department e
 where a.LongProjectsId=@LongProjectsId and a.LongProjectsId=b.LongProjectsId and a.ExamineUserCardId=c.UserCardId 
 and a.ExamineNumber=b.ProcessOrder and b.ProcessRankId=d.RankId and c.UserDepartmentId=e.DepartmentId
   order by ExamineNumber
END
GO
/****** Object:  StoredProcedure [dbo].[LongCapitalPlan_SelectByUserCardId]    Script Date: 12/07/2016 16:56:28 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
/*********************
--: LongCapitalPlan_SelectByUserCardId
--: LongCapitalPlan, 
--: 
  UserCardId
--: 
	
--:
	0 - 
	-1 -  
**************/
CREATE PROCEDURE [dbo].[LongCapitalPlan_SelectByUserCardId]
	@UserCardId varchar(50),
	@RankId int
	AS
begin
   declare
   @DepartmentId int,
      @TeachersDepartmentId int
   set @DepartmentId=(select UserDepartmentId from UserInfo where UserCardId=@UserCardId)
   set @TeachersDepartmentId=(select TeachersDepartmentId from UserInfo where UserCardId=@UserCardId)
   select a.*,b.UserName,c.DepartmentName,c.DepartmentName,d.ProjectsName,g.*
   from LongCapitalPlan a left join UserInfo b on  a.UserCardId=b.UserCardId 
    left join Department c on a.DepartmentId=c.DepartmentId 
	left join LongProjects d on a.LongProjectsId=d.LongProjectsId
	left join LongCapitalPlanWaitExamine e on a.LongProjectsId=e.LongProjectsId 
	left join LongProjects f on a.LongProjectsId=f.LongProjectsId
	left join LongCapitalBasic g on a.LongProjectsId=g.LongProjectsId
   where
   (e.ProcessDepartmentId=@DepartmentId 
   and e.ProcessRankId=convert( varchar(50),@RankId) ) or( e.ProcessDepartmentId=@TeachersDepartmentId 
   and e.ProcessRankId=convert( varchar(50),@RankId) )
    
end
GO
/****** Object:  StoredProcedure [dbo].[LongCapitalPlace_SelectCanUpdate]    Script Date: 12/07/2016 16:56:28 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
/******
--: AdminSeries_Select
--: AdminSeries, 
--
--: 
--: 
	
--:
	0 - 
	-1 -  
******/
CREATE PROCEDURE [dbo].[LongCapitalPlace_SelectCanUpdate]
AS
begin

select a.LongProjectsId,e.UserName,a.ProjectsName ,d.DepartmentName,c.ProjectsFromExplain,b.SuedCompany,b.Servicelife,b.SumMoney ,SUM(g.PlaceMoney)as SumPlaceMoney
 from LongProjects a,LongCapitalBasic b,LongCapitalPlan f left join LongCapitalplace g on f.LongProjectsId=g.LongProjectsId,
		ProjectsFrom c,Department d,UserInfo e
		where a.StandStatus=''
		and a.LongProjectsId=b.LongProjectsId
		and a.LongProjectsId=f.LongProjectsId
		and a.EndStatus=''
		and a.ProjectsFromId=c.ProjectsFromId
		and a.DepartmentId=d.DepartmentId
		and a.UserCardId=e.UserCardId
		group by a.LongProjectsId,e.UserName,a.ProjectsName ,d.DepartmentName,c.ProjectsFromExplain,b.SuedCompany,b.Servicelife,b.SumMoney
		
	

end
GO
/****** Object:  StoredProcedure [dbo].[LongCapitalPlace_SelectByUserCardId]    Script Date: 12/07/2016 16:56:28 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
/*********************
--: CapitalPlace_SelectByProjectsId
--: CapitalPlace, 
--: 

--: 
	
--:
	0 - 
	-1 -  
**************/
CREATE PROCEDURE [dbo].[LongCapitalPlace_SelectByUserCardId]
@UserCardId varchar(50)
	AS
BEGIN

	select a.LongProjectsId,e.UserName,a.ProjectsName ,d.DepartmentName,c.ProjectsFromExplain,b.SuedCompany,b.Servicelife,b.SumMoney ,SUM(g.PlaceMoney)as SumPlaceMoney
	 from LongProjects a,LongCapitalBasic b,LongCapitalPlan f left join LongCapitalplace g on f.LongProjectsId=g.LongProjectsId,
		ProjectsFrom c,Department d,UserInfo e
		where a.StandStatus=''
		and a.LongProjectsId=b.LongProjectsId
		and a.LongProjectsId=f.LongProjectsId
		and a.EndStatus=''
		and a.ProjectsFromId=c.ProjectsFromId
		and a.DepartmentId=d.DepartmentId
		and a.UserCardId=e.UserCardId
		and a.UserCardId=@UserCardId
		group by a.LongProjectsId,e.UserName,a.ProjectsName ,d.DepartmentName,c.ProjectsFromExplain,b.SuedCompany,b.Servicelife,b.SumMoney
		

END
GO
/****** Object:  StoredProcedure [dbo].[LongCapitalCloseExamine_Select]    Script Date: 12/07/2016 16:56:28 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
/*********************
--: LongCapitalCloseExamine_Select
--: LongCapitalCloseExamine, 
--: 
  LongProjectsId
--: 
	
--:
	0 - 
	-1 -  
**************/
CREATE PROCEDURE [dbo].[LongCapitalCloseExamine_Select]
@LongProjectsId varchar(50)
AS
BEGIN

 select a.*,c.UserName,d.RankName,e.DepartmentName
 from LongCapitalCloseExamine a,LongCapitalCloseAuditProcess b,UserInfo c,Rank d,Department e
 where a.LongProjectsId=@LongProjectsId and a.LongProjectsId=b.LongProjectsId and a.ExamineUserCardId=c.UserCardId 
 and a.ExamineNumber=b.ProcessOrder and b.ProcessRankId=d.RankId and c.UserDepartmentId=e.DepartmentId
   order by ExamineNumber
END
GO
/****** Object:  StoredProcedure [dbo].[LongCapitalClose_SelectByUserCardId]    Script Date: 12/07/2016 16:56:28 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
/*********************
--: LongCapitalClose_SelectByUserCardId
--: LongCapitalClose, 
--: 
  UserCardId
--: 
	
--:
	0 - 
	-1 -  
**************/
CREATE PROCEDURE [dbo].[LongCapitalClose_SelectByUserCardId]
	@UserCardId varchar(50),
	@RankId int
	AS
begin
  declare
   @DepartmentId int,
      @TeachersDepartmentId int
   set @DepartmentId=(select UserDepartmentId from UserInfo where UserCardId=@UserCardId)
   set @TeachersDepartmentId=(select TeachersDepartmentId from UserInfo where UserCardId=@UserCardId)
    select a.*,b.UserName,c.DepartmentName,c.DepartmentName,d.ProjectsName,g.*
   from LongCapitalClose a left join UserInfo b on  a.UserCardId=b.UserCardId
   left join Department c on   a.DepartmentId=c.DepartmentId
   left join LongProjects d on  a.LongProjectsId=d.LongProjectsId
   left join LongCapitalCloseWaitExamine e on a.LongProjectsId=e.LongProjectsId
   left join  LongProjects f on a.LongProjectsId=f.LongProjectsId
   left join  LongCapitalBasic g on a.LongProjectsId=g.LongProjectsId
   where 
 (  e.ProcessDepartmentId=@DepartmentId 
   and e.ProcessRankId=convert( varchar(50),@RankId) ) or( e.ProcessDepartmentId=@TeachersDepartmentId 
   and e.ProcessRankId=convert( varchar(50),@RankId) )
end
GO
/****** Object:  StoredProcedure [dbo].[LongCapitalChangeExamine_Select]    Script Date: 12/07/2016 16:56:28 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
/*********************
--: LongCapitalChangeExamine_Select
--: LongCapitalChangeExamine, 
--: 
  LongProjectsId
--: 
	
--:
	0 - 
	-1 -  
**************/
CREATE PROCEDURE [dbo].[LongCapitalChangeExamine_Select]
@LongProjectsId varchar(50)
AS
BEGIN

 select a.*,c.UserName,d.RankName,e.DepartmentName
 from LongCapitalChangeExamine a,LongCapitalChangeAuditProcess b,UserInfo c,Rank d,Department e
 where a.LongProjectsId=@LongProjectsId and a.LongProjectsId=b.LongProjectsId and a.ExamineUserCardId=c.UserCardId 
 and a.ExamineNumber=b.ProcessOrder and b.ProcessRankId=d.RankId and c.UserDepartmentId=e.DepartmentId
   order by ExamineNumber
END
GO
/****** Object:  StoredProcedure [dbo].[LongCapitalChange_SelectByUserCardId]    Script Date: 12/07/2016 16:56:28 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
/*********************
--: LongCapitalChange_SelectByUserCardId
--: LongCapitalChange, 
--: 
  UserCardId
--: 
	
--:
	0 - 
	-1 -  
**************/
CREATE PROCEDURE [dbo].[LongCapitalChange_SelectByUserCardId]
	@UserCardId varchar(50),
	@RankId int
	AS
begin
 declare
   @DepartmentId int,
      @TeachersDepartmentId int
   set @DepartmentId=(select UserDepartmentId from UserInfo where UserCardId=@UserCardId)
   set @TeachersDepartmentId=(select TeachersDepartmentId from UserInfo where UserCardId=@UserCardId)

     select a.*,b.UserName,c.DepartmentName,c.DepartmentName,d.ProjectsName,g.*
   from LongCapitalChange a left join UserInfo b on a.UserCardId=b.UserCardId 
   left join  Department c on a.DepartmentId=c.DepartmentId
   left join  LongProjects d on a.LongProjectsId=d.LongProjectsId
   left join  LongCapitalChangeWaitExamine e on a.LongProjectsId=e.LongProjectsId
   left join  LongProjects f on a.LongProjectsId=f.LongProjectsId
   left join LongCapitalBasic g on a.LongProjectsId=g.LongProjectsId
   where 
(   e.ProcessDepartmentId=@DepartmentId and 
    e.ProcessRankId=convert( varchar(50),@RankId) ) or(   e.ProcessDepartmentId=@TeachersDepartmentId and 
    e.ProcessRankId=convert( varchar(50),@RankId) )
    
    
end
GO
/****** Object:  StoredProcedure [dbo].[LongCapitalBasic_SelectCanUpdate]    Script Date: 12/07/2016 16:56:28 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
/******
--: AdminSeries_Select
--: AdminSeries, 
--
--: 
--: 
	
--:
	0 - 
	-1 -  
******/
CREATE PROCEDURE [dbo].[LongCapitalBasic_SelectCanUpdate]
AS
begin

select a.LongProjectsId,e.UserName,a.ProjectsName ,d.DepartmentName,c.ProjectsFromExplain,b.SuedCompany,b.Servicelife,b.SumMoney 
 from LongProjects a left join LongCapitalBasic b on a.LongProjectsId=b.LongProjectsId,
		ProjectsFrom c,Department d,UserInfo e
		where a.StandStatus=''
		and a.EndStatus=''
		and a.ProjectsFromId=c.ProjectsFromId
		and a.DepartmentId=d.DepartmentId
		and a.UserCardId=e.UserCardId

end
GO
/****** Object:  StoredProcedure [dbo].[HarvestExamine_Select]    Script Date: 12/07/2016 16:56:28 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
/*********************
--: HarvestExamine_Select
--: HarvestExamine, 
--: 
  HarvestId
--: 
	
--:
	0 - 
	-1 -  
**************/
CREATE PROCEDURE [dbo].[HarvestExamine_Select]
@HarvestId int
AS
BEGIN

 select a.*,c.UserName,d.RankName,e.DepartmentName
 from HarvestExamine a,HarvestAuditProcess b,UserInfo c,Rank d,Department e
 where a.HarvestId=@HarvestId and a.HarvestId=b.HarvestId and a.ExamineUserCardId=c.UserCardId 
 and a.ExamineNumber=b.ProcessOrder and b.ProcessRankId=d.RankId and c.UserDepartmentId=e.DepartmentId
   order by ExamineNumber
END
GO
/****** Object:  StoredProcedure [dbo].[Harvest_SelectByUserCardId]    Script Date: 12/07/2016 16:56:28 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
/*********************
--: Harvest_SelectByUserCardId
--: Harvest, 
--: 
  UserCardId
--: 
	
--:
	0 - 
	-1 -  
**************/
CREATE PROCEDURE [dbo].[Harvest_SelectByUserCardId]
	@UserCardId varchar(50),
	@RankId int
	AS
begin
   declare
    @DepartmentId int,
      @TeachersDepartmentId int
   set @DepartmentId=(select UserDepartmentId from UserInfo where UserCardId=@UserCardId)
   set @TeachersDepartmentId=(select TeachersDepartmentId from UserInfo where UserCardId=@UserCardId)
   select a.*,b.UserName,c.DepartmentName,c.DepartmentName
   from Harvest a left join UserInfo b on  a.UserCardId=b.UserCardId
   left join Department c on  a.DepartmentId=c.DepartmentId
   where 
  (
   a.ProcessDepartmentId=@DepartmentId
   and a.ProcessRoleId= convert( varchar(50),@RankId))
   or (
   a.ProcessDepartmentId=@TeachersDepartmentId
   and a.ProcessRoleId= convert( varchar(50),@RankId))
    
end
GO
/****** Object:  StoredProcedure [dbo].[Harvest_SelectByPartnerUserNo]    Script Date: 12/07/2016 16:56:28 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
/*********************
--: Harvest_SelectByHarvestUserCardId
--: Harvest, 
--: 
  UserCardId
--: 
	
--:
	0 - 
	-1 -  
**************/
CREATE PROCEDURE [dbo].[Harvest_SelectByPartnerUserNo]
	@UserCardId varchar(50)
	AS
begin
	 
	
	select b.UserName ,a.* ,c.DepartmentName 
	from Harvest a,UserInfo b ,Department c,HarvestPartner d
	where a.HarvestId=d.HarvestId and d.PartnerUserCardId=@UserCardId
	and d.PartnerUserCardId=b.UserCardId and b.UserDepartmentId=c.DepartmentId
	and a.TransferStatus=''
	
end
GO
/****** Object:  StoredProcedure [dbo].[Harvest_SelectByPartnerUserCardId]    Script Date: 12/07/2016 16:56:28 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
/*********************
--: Harvest_SelectByPartnerUserCardId
--: Harvest, 
--: 
  UserCardId
--: 
	
--:
	0 - 
	-1 -  
**************/
CREATE PROCEDURE [dbo].[Harvest_SelectByPartnerUserCardId]
	@UserCardId varchar(50),
	@ApplyYearId int
	AS
begin
	 
	
	select b.UserName ,a.* ,c.DepartmentName ,d.PartnerValue,d.PartnerRank
	from Harvest a,UserInfo b ,Department c,HarvestPartner d
	where d.PartnerUserCardId=b.UserCardId and 
	d.PartnerUserCardId = @UserCardId and b.UserDepartmentId=c.DepartmentId
	and a.HarvestId=d.HarvestId  and a.ApplyYearId=@ApplyYearId and a.TransferStatus=''
	
end
GO
/****** Object:  StoredProcedure [dbo].[GuidancePartner_Insert]    Script Date: 12/07/2016 16:56:28 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
/*********************
--: GuidancePartner_Insert
--: GuidancePartner, 
--: 

--: 
	
--:
	0 - 
	-1 -  
**************/
CREATE PROCEDURE [dbo].[GuidancePartner_Insert]
@GuidanceId int,
@PartnerValue float,
@PartnerRank int,
@UserCardId varchar(50)
AS
begin
	begin tran
	  if not exists( select * from GuidancePartner where GuidanceId=@GuidanceId and PartnerUserCardId=@UserCardId)
    begin
    declare @sum float,
    @GuidanceValue float,
    	@GuidanceUserCardId varchar(50)
    set @GuidanceValue=(select GuidanceValue from Guidance where GuidanceId=@GuidanceId)
    set @GuidanceUserCardId=(select UserCardId from Guidance where GuidanceId=@GuidanceId)
		
    if exists(select * from GuidancePartner where GuidanceId=@GuidanceId)
    begin
        set @sum=(select SUM(PartnerValue) from GuidancePartner where GuidanceId=@GuidanceId)
    if(@sum+@PartnerValue<=@GuidanceValue)
    begin
     insert into GuidancePartner(
     GuidanceId,PartnerValue,PartnerRank,PartnerUserCardId
     )values(
     @GuidanceId,@PartnerValue,@PartnerRank,@UserCardId
     )
	 exec [dbo].[Journal_Insert] @GuidanceUserCardId,'',''
	end
    end
    else
     begin
       if(@PartnerValue<=@GuidanceValue)
    begin
     insert into GuidancePartner(
     GuidanceId,PartnerValue,PartnerRank,PartnerUserCardId
     )values(
     @GuidanceId,@PartnerValue,@PartnerRank,@UserCardId
     )
	 exec [dbo].[Journal_Insert] @GuidanceUserCardId,'',''
	end
    end
    

	end
	
		if(@@ERROR<>0)
			begin
				rollback
				return -1
			end
	commit tran
	return 0
end
GO
/****** Object:  StoredProcedure [dbo].[GuidancePartner_Delete]    Script Date: 12/07/2016 16:56:28 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
/*******
--: GuidancePartner_Delete
--: Guidance, 
--: 
GuidancePartnerId
--: 
	
--:
	0 - 
	-1 -  
*********/
CREATE PROCEDURE [dbo].[GuidancePartner_Delete]
@GuidancePartnerId int
AS
begin
	begin tran	
		declare 
		@PartnerUserCardId varchar(50),
		@GuidanceUserCardId varchar(50),
		@GuidanceId int
		set @GuidanceId=(select GuidanceId from GuidancePartner where GuidancePartnerId=@GuidancePartnerId)
		set @PartnerUserCardId=(select PartnerUserCardId from GuidancePartner where GuidancePartnerId=@GuidancePartnerId)
		set @GuidanceUserCardId=(select UserCardId from Guidance where GuidanceId=@GuidanceId)
		if(@GuidanceUserCardId<>@PartnerUserCardId)
		begin
		delete GuidancePartner where GuidancePartnerId=@GuidancePartnerId
			exec [dbo].[Journal_Insert] @GuidanceUserCardId,'',''
	   end
	   
		if(@@ERROR<>0)
			begin
				rollback
				return -1
			end
	commit tran
	return 0
end
GO
/****** Object:  StoredProcedure [dbo].[HarvestPartner_Insert]    Script Date: 12/07/2016 16:56:28 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
/*********************
--: HarvestPartner_Insert
--: HarvestPartner, 
--: 

--: 
	
--:
	0 - 
	-1 -  
**************/
CREATE PROCEDURE [dbo].[HarvestPartner_Insert]
@HarvestId int,
@PartnerValue float,
@PartnerRank int,
@UserCardId varchar(50)
AS
begin
	begin tran
	  if not exists( select * from HarvestPartner where HarvestId=@HarvestId and PartnerUserCardId=@UserCardId)
    begin
    declare @sum float,
    @HarvestValue float,
    	@HarvestUserCardId varchar(50)
    set @HarvestValue=(select HarvestValue from Harvest where HarvestId=@HarvestId)
    set @HarvestUserCardId=(select UserCardId from Harvest where HarvestId=@HarvestId)
		
    if exists(select * from HarvestPartner where HarvestId=@HarvestId)
    begin
        set @sum=(select SUM(PartnerValue) from HarvestPartner where HarvestId=@HarvestId)
    if(@sum+@PartnerValue<=@HarvestValue)
    begin
     insert into HarvestPartner(
     HarvestId,PartnerValue,PartnerRank,PartnerUserCardId
     )values(
     @HarvestId,@PartnerValue,@PartnerRank,@UserCardId
     )
	 exec [dbo].[Journal_Insert] @HarvestUserCardId,'',''
	end
    end
    else
     begin
       if(@PartnerValue<=@HarvestValue)
    begin
     insert into HarvestPartner(
     HarvestId,PartnerValue,PartnerRank,PartnerUserCardId
     )values(
     @HarvestId,@PartnerValue,@PartnerRank,@UserCardId
     )
	 exec [dbo].[Journal_Insert] @HarvestUserCardId,'',''
	end
    end
    

	end
	
		if(@@ERROR<>0)
			begin
				rollback
				return -1
			end
	commit tran
	return 0
end
GO
/****** Object:  StoredProcedure [dbo].[HarvestPartner_Delete]    Script Date: 12/07/2016 16:56:28 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
/*******
--: HarvestPartner_Delete
--: Harvest, 
--: 
HarvestPartnerId
--: 
	
--:
	0 - 
	-1 -  
*********/
CREATE PROCEDURE [dbo].[HarvestPartner_Delete]
@HarvestPartnerId int
AS
begin
	begin tran	
		declare 
		@PartnerUserCardId varchar(50),
		@HarvestUserCardId varchar(50),
		@HarvestId int
		set @HarvestId=(select HarvestId from HarvestPartner where HarvestPartnerId=@HarvestPartnerId)
		set @PartnerUserCardId=(select PartnerUserCardId from HarvestPartner where HarvestPartnerId=@HarvestPartnerId)
		set @HarvestUserCardId=(select UserCardId from Harvest where HarvestId=@HarvestId)
		if(@HarvestUserCardId<>@PartnerUserCardId)
		begin
		delete HarvestPartner where HarvestPartnerId=@HarvestPartnerId
			exec [dbo].[Journal_Insert] @HarvestUserCardId,'',''
	   end
	   
		if(@@ERROR<>0)
			begin
				rollback
				return -1
			end
	commit tran
	return 0
end
GO
/****** Object:  StoredProcedure [dbo].[LongCapitalChangeProcess_Insert]    Script Date: 12/07/2016 16:56:28 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
/*********************
--: LongCapitalChangeProcess_Insert
--: LongCapitalChangeProcess, 
--: 
LongCapitalChangeRoleId,ProcessRoleId,ProcessOrder
--: 
	
--:
	0 - 
	-1 -  
**************/
CREATE PROCEDURE [dbo].[LongCapitalChangeProcess_Insert]
	@ProcessRankId int,
	@ProcessOrder int,
	@ProcessDepartment varchar(50),
	@UserCardId varchar(50)
AS
begin
	begin tran
   declare 
   @MaxOrder int
  if  exists(select * from LongCapitalChangeProcess where  ProcessRankId=@ProcessRankId and ProcessDepartment=@ProcessDepartment)
begin
return -1
end
 else
begin
--0
if exists(select * from LongCapitalChangeProcess)
begin
  set @MaxOrder=(select MAX(ProcessOrder) from LongCapitalChangeProcess)
end
else
begin
set @MaxOrder=0
end  
   if(@ProcessOrder>@MaxOrder)
   begin
   set @ProcessOrder=@MaxOrder+1
   insert into LongCapitalChangeProcess ( ProcessRankId,ProcessOrder,ProcessDepartment)values
   (@ProcessRankId,@ProcessOrder,@ProcessDepartment)
end else
begin


   update LongCapitalChangeProcess 
   set ProcessOrder=ProcessOrder+1
   where ProcessOrder>=@ProcessOrder
    insert into LongCapitalChangeProcess ( ProcessRankId,ProcessOrder,ProcessDepartment)values
   (@ProcessRankId,@ProcessOrder,@ProcessDepartment)

   end
   exec [dbo].[Journal_Insert] @UserCardId,'',''
end
		
		if(@@ERROR<>0)
			begin
				rollback
				return -1
			end
	commit tran
	return 0
end
GO
/****** Object:  StoredProcedure [dbo].[LongCapitalChangeProcess_Delete]    Script Date: 12/07/2016 16:56:28 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
/*********************
--: LongCapitalChangeProcess_Delete
--: LongCapitalChangeProcess, 
--: 
  LongCapitalChangeProcessId 
--: 
	
--:
	0 - 
	-1 -  
**************/
CREATE PROCEDURE [dbo].[LongCapitalChangeProcess_Delete]
@LongCapitalChangeProcessId int,
@UserCardId varchar(50)
AS
begin
	begin tran
	declare 
	@ProcessOrder int	
	set @ProcessOrder=(select ProcessOrder from LongCapitalChangeProcess where LongCapitalChangeProcessId=@LongCapitalChangeProcessId)
	
	delete LongCapitalChangeProcess 
	where LongCapitalChangeProcessId=@LongCapitalChangeProcessId 
     
    update LongCapitalChangeProcess 
    set ProcessOrder=ProcessOrder-1
    where  ProcessOrder>@ProcessOrder
    exec [dbo].[Journal_Insert] @UserCardId,'',''
		if(@@ERROR<>0)
			begin
				rollback
				return -1
			end
	commit tran
	return 0
end
GO
/****** Object:  StoredProcedure [dbo].[CapitalItem_Insert]    Script Date: 12/07/2016 16:56:27 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
/*********************
--: CapitalItem_Insert
--: CapitalItem, 
--: 
   CapitalItemName
--: 
	
--:
	0 - 
	-1 -  
**************/
CREATE PROCEDURE [dbo].[CapitalItem_Insert]
@CapitalItemName varchar(50),
 @UserCardId varchar(50)
AS
begin
	begin tran
	insert into CapitalItem(
	CapitalItemName
	)values(
	@CapitalItemName
	)
	exec [dbo].[Journal_Insert] @UserCardId,'',''
		if(@@ERROR<>0)
			begin
				rollback
				return -1
			end
	commit tran
	return 0
end
GO
/****** Object:  StoredProcedure [dbo].[CapitalItem_Delete]    Script Date: 12/07/2016 16:56:27 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
/*******
--: CapitalItem_Delete
--: CapitalItem, 
--: 
CapitalItemId
--: 
	
--:
	0 - 
	-1 -  
*********/
CREATE PROCEDURE [dbo].[CapitalItem_Delete]
@CapitalItemId int,
@UserCardId varchar(50)
AS
begin
	begin tran
		delete CapitalItem where CapitalItemId=@CapitalItemId
		exec [dbo].[Journal_Insert] @UserCardId,'',''
		if(@@ERROR<>0)
			begin
				rollback
				return -1
			end
	commit tran
	return 0
end
GO
/****** Object:  StoredProcedure [dbo].[Authority_Delete]    Script Date: 12/07/2016 16:56:27 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
/*******
--: Authority_Delete
--: Authority, 
--: 
RoleId
--: 
	
--:
	0 - 
	-1 -  
*********/
CREATE PROCEDURE [dbo].[Authority_Delete]
@RoleId int,
@UserCardId varchar(50)
AS
begin
	begin tran
		delete Authority where RoleId=@RoleId
		exec [dbo].[Journal_Insert] @UserCardId,'',''
		if(@@ERROR<>0)
			begin
				rollback
				return -1
			end
	commit tran
	return 0
end
GO
/****** Object:  StoredProcedure [dbo].[UserRank_Insert]    Script Date: 12/07/2016 16:56:31 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
/*********************
--: UserRank_Insert
--: UserRank, 
--: 
   UserCardId,RankId,DepartmentId,
--: 
	
--:
	0 - 
	-1 -  
**************/
CREATE PROCEDURE [dbo].[UserRank_Insert]
@UserCardId varchar(50),
@RankId int,
@UserCardId2 varchar(50)
AS
begin
	begin tran
	if not exists(select * from UserRank where UserCardId=@UserCardId and RankId=@RankId)
	begin
		insert into UserRank (
		UserCardId,RankId
		) values(
		@UserCardId,@RankId
		)
			set @UserCardId=''+@UserCardId
	exec [dbo].[Journal_Insert] @UserCardId2,'',@UserCardId
	end
		if(@@ERROR<>0)
			begin
				rollback
				return -1
			end
	commit tran
	return 0
end
GO
/****** Object:  StoredProcedure [dbo].[UserInfo_SelectRoleSum]    Script Date: 12/07/2016 16:56:31 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
/******
--  UserInfo_SelectRoleSum
-- 
-- 
-- RoleId     
-- 
--    @RoleSum
--     0
--     1
--     2
--     3

******/
CREATE PROCEDURE [dbo].[UserInfo_SelectRoleSum]
   @RoleId int,
   @RoleSum    int output
AS
begin
 if exists(select * from userRole where RoleId=@RoleId)
   begin 
    set @RoleSum=(select count(UserRoleId) from UserRole where RoleId=@RoleId)
    end
    else
    begin
      set @RoleSum=0
    end

end
GO
/****** Object:  StoredProcedure [dbo].[ShortCapitalPlanProcess_Insert]    Script Date: 12/07/2016 16:56:30 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
/*********************
--: ShortCapitalPlanProcess_Insert
--: ShortCapitalPlanProcess, 
--: 
ShortCapitalPlanRoleId,ProcessRoleId,ProcessOrder
--: 
	
--:
	0 - 
	-1 -  
**************/
CREATE PROCEDURE [dbo].[ShortCapitalPlanProcess_Insert]
	@ProcessRankId int,
	@ProcessOrder int,
	@ProcessDepartment varchar(50),
	@UserCardId varchar(50)
AS
begin
	begin tran
   declare 
   @MaxOrder int
  if  exists(select * from ShortCapitalPlanProcess where  ProcessRankId=@ProcessRankId and ProcessDepartment=@ProcessDepartment)
begin
return -1
end
 else
begin
--0
if exists(select * from ShortCapitalPlanProcess)
begin
  set @MaxOrder=(select MAX(ProcessOrder) from ShortCapitalPlanProcess)
end
else
begin
set @MaxOrder=0
end  
   if(@ProcessOrder>@MaxOrder)
   begin
   set @ProcessOrder=@MaxOrder+1
   insert into ShortCapitalPlanProcess ( ProcessRankId,ProcessOrder,ProcessDepartment)values
   (@ProcessRankId,@ProcessOrder,@ProcessDepartment)
end else
begin


   update ShortCapitalPlanProcess 
   set ProcessOrder=ProcessOrder+1
   where ProcessOrder>=@ProcessOrder
    insert into ShortCapitalPlanProcess ( ProcessRankId,ProcessOrder,ProcessDepartment)values
   (@ProcessRankId,@ProcessOrder,@ProcessDepartment)

   end
   exec [dbo].[Journal_Insert] @UserCardId,'',''
end
		
		if(@@ERROR<>0)
			begin
				rollback
				return -1
			end
	commit tran
	return 0
end
GO
/****** Object:  StoredProcedure [dbo].[ShortCapitalPlanProcess_Delete]    Script Date: 12/07/2016 16:56:30 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
/*********************
--: ShortCapitalPlanProcess_Delete
--: ShortCapitalPlanProcess, 
--: 
  ShortCapitalPlanProcessId 
--: 
	
--:
	0 - 
	-1 -  
**************/
CREATE PROCEDURE [dbo].[ShortCapitalPlanProcess_Delete]
@ShortCapitalPlanProcessId int,
@UserCardId varchar(50)
AS
begin
	begin tran
	declare 
	@ProcessOrder int	
	set @ProcessOrder=(select ProcessOrder from ShortCapitalPlanProcess where ShortCapitalPlanProcessId=@ShortCapitalPlanProcessId)
	
	delete ShortCapitalPlanProcess 
	where ShortCapitalPlanProcessId=@ShortCapitalPlanProcessId 
     
    update ShortCapitalPlanProcess 
    set ProcessOrder=ProcessOrder-1
    where  ProcessOrder>@ProcessOrder
    exec [dbo].[Journal_Insert] @UserCardId,'',''
		if(@@ERROR<>0)
			begin
				rollback
				return -1
			end
	commit tran
	return 0
end
GO
/****** Object:  StoredProcedure [dbo].[LongProjectsStandProcess_Insert]    Script Date: 12/07/2016 16:56:29 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
/*********************
--: LongProjectsProcess_Insert
--: LongProjectsProcess, 
--
--: 
LongProjectsRoleId,ProcessRoleId,ProcessOrder
--: 
	
--:
	0 - 
	-1 -  
**************/
CREATE PROCEDURE [dbo].[LongProjectsStandProcess_Insert]
	@ProcessRankId int,
	@ProcessOrder int,
	@ProcessDepartment varchar(50),
	@UserCardId varchar(50)
AS
begin
	begin tran
   declare 
   @MaxOrder int --
   --
  if  exists(select * from LongProjectsStandProcess where  ProcessRankId=@ProcessRankId and ProcessDepartment=@ProcessDepartment)
begin
return -1
end
 else
begin  
--0
if exists(select * from LongProjectsStandProcess)
begin
 set @MaxOrder=(select MAX(ProcessOrder) from LongProjectsStandProcess)
end
else
begin
set @MaxOrder=0
end
  --
   if(@ProcessOrder>@MaxOrder)
   begin
   --+1
   set @ProcessOrder=@MaxOrder+1
   insert into LongProjectsStandProcess ( ProcessRankId,ProcessOrder,ProcessDepartment)values
   (@ProcessRankId,@ProcessOrder,@ProcessDepartment)
end 
else
begin

--+1
   update LongProjectsStandProcess 
   set ProcessOrder=ProcessOrder+1
   where ProcessOrder>=@ProcessOrder
    insert into LongProjectsStandProcess ( ProcessRankId,ProcessOrder,ProcessDepartment)values
   (@ProcessRankId,@ProcessOrder,@ProcessDepartment)

   end
   --
   exec [dbo].[Journal_Insert] @UserCardId,'',''
end
		
		if(@@ERROR<>0)
			begin
				rollback
				return -1
			end
	commit tran
	return 0
end
GO
/****** Object:  StoredProcedure [dbo].[LongProjectsStandProcess_Delete]    Script Date: 12/07/2016 16:56:29 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
/*********************
--: LongProjectsProcess_Delete
--: LongProjectsProcess, 
--
--: 
  LongProjectsProcessId 
--: 
	
--:
	0 - 
	-1 -  
**************/
CREATE PROCEDURE [dbo].[LongProjectsStandProcess_Delete]
@LongProjectsProcessId int,
@UserCardId varchar(50)
AS
begin
	begin tran
	declare 
	@ProcessOrder int	
	--
	set @ProcessOrder=(select ProcessOrder from LongProjectsStandProcess where LongProjectsProcessId=@LongProjectsProcessId)
	--
	delete LongProjectsStandProcess 
	where LongProjectsProcessId=@LongProjectsProcessId 
     --
    update LongProjectsStandProcess 
    set ProcessOrder=ProcessOrder-1
    where  ProcessOrder>@ProcessOrder
	--
    exec [dbo].[Journal_Insert] @UserCardId,'',''
		if(@@ERROR<>0)
			begin
				rollback
				return -1
			end
	commit tran
	return 0
end
GO
/****** Object:  StoredProcedure [dbo].[AssessRank_Insert]    Script Date: 12/07/2016 16:56:27 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
/*********************
--: AssessRank_Insert
--: AssessRank, 
--: 
   AssessRankName
--: 
	
--:
	0 - 
	-1 -  
**************/
CREATE PROCEDURE [dbo].[AssessRank_Insert]
@RankName varchar(50),
@RankMinValue float,
@RankMaxValue float,
@RankExplain varchar(100),
@UserCardId varchar(50)
AS
begin
	begin tran

	insert into AssessRank(
RankName,RankMinValue,RankMaxValue,RankExplain
	)values(
@RankName,@RankMinValue,@RankMaxValue,@RankExplain
	)
	exec [dbo].[Journal_Insert] @UserCardId,'',''
		if(@@ERROR<>0)
			begin
				rollback
				return -1
			end
	commit tran
	return 0
end
GO
/****** Object:  StoredProcedure [dbo].[AssessRank_Delete]    Script Date: 12/07/2016 16:56:27 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
/*******
--: AssessRank_Delete
--: AssessRank, 
--: 
AssessRankId
--: 
	
--:
	0 - 
	-1 -  
*********/
CREATE PROCEDURE [dbo].[AssessRank_Delete]
@AssessRankId int,
@UserCardId varchar(50)
AS
begin
	begin tran
		delete AssessRank where AssessRankId=@AssessRankId
		exec [dbo].[Journal_Insert] @UserCardId,'',''
		if(@@ERROR<>0)
			begin
				rollback
				return -1
			end
	commit tran
	return 0
end
GO
/****** Object:  StoredProcedure [dbo].[GuidanceProcess_Insert]    Script Date: 12/07/2016 16:56:28 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
/*********************
--: GuidanceProcess_Insert
--: GuidanceProcess, 
--: 
GuidanceRoleId,ProcessRoleId,ProcessOrder
--: 
	
--:
	0 - 
	-1 -  
**************/
CREATE PROCEDURE [dbo].[GuidanceProcess_Insert]
	@ProcessRoleId int,
	@ProcessOrder int,
	@ProcessDepartment varchar(50),
	@UserCardId varchar(50)
AS
begin
	begin tran
   declare 
   @MaxOrder int
  if  exists(select * from GuidanceProcess where  ProcessRankId=@ProcessRoleId and ProcessDepartment=@ProcessDepartment)
begin
return -1
end
 else
begin  
   set @MaxOrder=(select MAX(ProcessOrder) from GuidanceProcess)
   if(@ProcessOrder>@MaxOrder)
   begin
   set @ProcessOrder=@MaxOrder+1
   insert into GuidanceProcess ( ProcessRankId,ProcessOrder,ProcessDepartment)values
   (@ProcessRoleId,@ProcessOrder,@ProcessDepartment)
end else
begin


   update GuidanceProcess 
   set ProcessOrder=ProcessOrder+1
   where ProcessOrder>=@ProcessOrder
    insert into GuidanceProcess ( ProcessRankId,ProcessOrder,ProcessDepartment)values
   (@ProcessRoleId,@ProcessOrder,@ProcessDepartment)

   end
   exec [dbo].[Journal_Insert] @UserCardId,'',''
end
		
		if(@@ERROR<>0)
			begin
				rollback
				return -1
			end
	commit tran
	return 0
end
GO
/****** Object:  StoredProcedure [dbo].[GuidanceProcess_Delete]    Script Date: 12/07/2016 16:56:28 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
/*********************
--: GuidanceProcess_Delete
--: GuidanceProcess, 
--: 
  GuidanceProcessId 
--: 
	
--:
	0 - 
	-1 -  
**************/
CREATE PROCEDURE [dbo].[GuidanceProcess_Delete]
@GuidanceProcessId int,
@UserCardId varchar(50)
AS
begin
	begin tran
	declare 
	@ProcessOrder int	
	set @ProcessOrder=(select ProcessOrder from GuidanceProcess where GuidanceProcessId=@GuidanceProcessId)
	
	delete GuidanceProcess 
	where GuidanceProcessId=@GuidanceProcessId 
     
    update GuidanceProcess 
    set ProcessOrder=ProcessOrder-1
    where  ProcessOrder>@ProcessOrder
    exec [dbo].[Journal_Insert] @UserCardId,'',''
		if(@@ERROR<>0)
			begin
				rollback
				return -1
			end
	commit tran
	return 0
end
GO
/****** Object:  StoredProcedure [dbo].[AuthorityView_Select]    Script Date: 12/07/2016 16:56:27 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
/******
--: Authority_Select
--: Authority, 
--: 
RoleId
--: 
	
--:
	0 - 
	-1 -  
******/
CREATE PROCEDURE [dbo].[AuthorityView_Select]
@RankId int
AS
begin

		select * from AuthorityView  where RoleId=@RankId
		order by ModelNum
end
GO
/****** Object:  StoredProcedure [dbo].[Authority_SelectByUserCardId]    Script Date: 12/07/2016 16:56:27 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
/******
--: Authority_Select
--: Authority, 
--: 
--: 
	
--:
	0 - 
	-1 -  
******/
CREATE PROCEDURE [dbo].[Authority_SelectByUserCardId]
@UserCardId varchar(50),
@ModelUrl varchar(100)
AS
begin
select * 
from UserRank a,AuthorityView b
where a.RankId=b.RoleId and a.UserCardId=@UserCardId and b.ModelUrl=@ModelUrl
end
GO
/****** Object:  StoredProcedure [dbo].[Authority_SelectByUser]    Script Date: 12/07/2016 16:56:27 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
/******
--: Authority_SelectByUser
--: Authority, 
--: 
UserCardId
--: 
	
--:
	0 - 
	-1 -  
******/
CREATE PROCEDURE [dbo].[Authority_SelectByUser]
@UserCardId varchar(50)
AS
begin

		select distinct b.ModelName,b.ModelId,b.ModelUrl,b.ModelFatherId,b.ModelFatherName
from UserRole a,AuthorityView b
where a.RoleId=b.RoleId and a.UserCardId=@UserCardId
order by ModelFatherId ,ModelId desc
end
GO
/****** Object:  StoredProcedure [dbo].[UseOffice_Update]    Script Date: 12/07/2016 16:56:30 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
/*******
--: UseOffice_Update
--: Department, 
--: 
UseOfficeId,UseOfficeName
--: 
	
--:
	0 - 
	-1 -  
*********/
CREATE PROCEDURE [dbo].[UseOffice_Update]
@UseOfficeId int,
@UserCardId varchar(50),
@DepartmentName varchar(50),
@RoleName varchar(50),
@LevelName varchar(50),
@StartDate	date,
@EndDate	varchar(50),
@IsCurrent varchar(50),
@IsAgent varchar(50)
AS
begin
	begin tran

		update UseOffice 
		set UserCardId=@UserCardId,
		DepartmentName=@DepartmentName,
		RoleName=@RoleName,
		LevelName=@LevelName,
		StartDate=@StartDate,
		EndDate=@EndDate,
		IsCurrent=@IsCurrent,
		IsAgent=@IsAgent		
		where UseOfficeId=@UseOfficeId

		if(@@ERROR<>0)
			begin
				rollback
				return -1
			end
	commit tran
	return 0
end
GO
/****** Object:  StoredProcedure [dbo].[AssessRank_Update]    Script Date: 12/07/2016 16:56:27 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
/*******
--: AssessRank_Update
--: AssessRank, 
--: 
AssessRankId
--: 
	
--:
	0 - 
	-1 -  
*********/
CREATE PROCEDURE [dbo].[AssessRank_Update]
@AssessRankId int,
@RankName varchar(50),
@RankMinValue float,
@RankMaxValue float,
@RankExplain varchar(50),
@UserCardId varchar(50)
AS
begin
	begin tran

		update AssessRank 
		set RankName=@RankName,
		RankMinValue=@RankMinValue,
		RankMaxValue=@RankMaxValue,
		RankExplain=@RankExplain
		where AssessRankId=@AssessRankId
		exec [dbo].[Journal_Insert] @UserCardId,'',''
		if(@@ERROR<>0)
			begin
				rollback
				return -1
			end
	commit tran
	return 0
end
GO
/****** Object:  StoredProcedure [dbo].[HarvestProcess_Insert]    Script Date: 12/07/2016 16:56:28 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
/*********************
--: HarvestProcess_Insert
--: HarvestProcess, 
--: 
HarvestRoleId,ProcessRoleId,ProcessOrder
--: 
	
--:
	0 - 
	-1 -  
**************/
CREATE PROCEDURE [dbo].[HarvestProcess_Insert]
	@ProcessRoleId int,
	@ProcessOrder int,
	@ProcessDepartment varchar(50),
	@UserCardId varchar(50)
AS
begin
	begin tran
   declare 
   @MaxOrder int
  if  exists(select * from HarvestProcess where  ProcessRankId=@ProcessRoleId and ProcessDepartment=@ProcessDepartment)
begin
return -1
end
 else
begin  
   set @MaxOrder=(select MAX(ProcessOrder) from HarvestProcess)
   if(@ProcessOrder>@MaxOrder)
   begin
   set @ProcessOrder=@MaxOrder+1
   insert into HarvestProcess ( ProcessRankId,ProcessOrder,ProcessDepartment)values
   (@ProcessRoleId,@ProcessOrder,@ProcessDepartment)
end else
begin


   update HarvestProcess 
   set ProcessOrder=ProcessOrder+1
   where ProcessOrder>=@ProcessOrder
    insert into HarvestProcess ( ProcessRankId,ProcessOrder,ProcessDepartment)values
   (@ProcessRoleId,@ProcessOrder,@ProcessDepartment)

   end
   exec [dbo].[Journal_Insert] @UserCardId,'',''
end
		
		if(@@ERROR<>0)
			begin
				rollback
				return -1
			end
	commit tran
	return 0
end
GO
/****** Object:  StoredProcedure [dbo].[HarvestProcess_Delete]    Script Date: 12/07/2016 16:56:28 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
/*********************
--: HarvestProcess_Delete
--: HarvestProcess, 
--: 
  HarvestProcessId 
--: 
	
--:
	0 - 
	-1 -  
**************/
CREATE PROCEDURE [dbo].[HarvestProcess_Delete]
@HarvestProcessId int,
@UserCardId varchar(50)
AS
begin
	begin tran
	declare 
	@ProcessOrder int	
	set @ProcessOrder=(select ProcessOrder from HarvestProcess where HarvestProcessId=@HarvestProcessId)
	
	delete HarvestProcess 
	where HarvestProcessId=@HarvestProcessId 
     
    update HarvestProcess 
    set ProcessOrder=ProcessOrder-1
    where  ProcessOrder>@ProcessOrder
    exec [dbo].[Journal_Insert] @UserCardId,'',''
		if(@@ERROR<>0)
			begin
				rollback
				return -1
			end
	commit tran
	return 0
end
GO
/****** Object:  StoredProcedure [dbo].[HarvestPartner_Update]    Script Date: 12/07/2016 16:56:28 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
/*********************
--: HarvestPartner_Update
--: Harvest, 
--: 


--: 
	
--:
	0 - 
	-1 -  
**************/
CREATE PROCEDURE [dbo].[HarvestPartner_Update]
	@HarvestPartnerId int,
	@UserCardId varchar(50),
	@PartnerRank int,
	@PartnerValue float
AS
begin
	begin tran
 declare 
   @HarvestUserCardId varchar(50),
 @PartnerUserCardId varchar(50),
 @sum float,
    @HarvestValue float,
    @HarvestId int,
    @UserValue float
    set @HarvestId=(select HarvestId from HarvestPartner where HarvestPartnerId=@HarvestPartnerId)
     set @HarvestUserCardId=(select UserCardId from Harvest where HarvestId=@HarvestId)
   set @PartnerUserCardId=(select PartnerUserCardId  from HarvestPartner where HarvestPartnerId=@HarvestPartnerId)
  
  
    if(@HarvestUserCardId<>@PartnerUserCardId)
   begin
   if(@HarvestUserCardId<>@UserCardId)
   begin
  set @UserValue=(select PartnerValue from HarvestPartner where HarvestPartnerId=@HarvestPartnerId)
    set @sum=(select SUM(PartnerValue) from HarvestPartner where HarvestId=@HarvestId)
    set @HarvestValue=(select HarvestValue from Harvest where HarvestId=@HarvestId)
    if(@sum-@UserValue+@PartnerValue<=@HarvestValue)
    begin
		update HarvestPartner set
		PartnerRank=@PartnerRank,
		PartnerValue=@PartnerValue,
		PartnerUserCardId=@UserCardId
		where HarvestPartnerId=@HarvestPartnerId 
		  exec [dbo].[Journal_Insert] @HarvestUserCardId,'',''
end

   end
   end
   else
   begin
   if(@PartnerUserCardId=@UserCardId)
   begin
   set @UserValue=(select PartnerValue from HarvestPartner where HarvestPartnerId=@HarvestPartnerId)
    set @sum=(select SUM(PartnerValue) from HarvestPartner where HarvestId=@HarvestId)
    set @HarvestValue=(select HarvestValue from Harvest where HarvestId=@HarvestId)
    if(@sum-@UserValue+@PartnerValue<=@HarvestValue)
    begin
		update HarvestPartner set
		PartnerRank=@PartnerRank,
		PartnerValue=@PartnerValue,
		PartnerUserCardId=@UserCardId
		where HarvestPartnerId=@HarvestPartnerId 
		  exec [dbo].[Journal_Insert] @HarvestUserCardId,'',''
end

   end
   end
   


		if(@@ERROR<>0)
			begin
				rollback
				return -1
			end
	commit tran
	return 0
end
GO
/****** Object:  StoredProcedure [dbo].[AdminSeries_Insert]    Script Date: 12/07/2016 16:56:27 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
/*********************
--: AdminSeries_Insert
--: AdminSeries, 
--: 
   AdminSeriesName
--: 
	
--:
	0 - 
	-1 -  
**************/
CREATE PROCEDURE [dbo].[AdminSeries_Insert]
@AdminSeriesName varchar(50),
@UserCardId varchar(50)
AS
begin
	begin tran
	insert into AdminSeries(
    AdminSeriesName
	)values(
	@AdminSeriesName
	)
	exec [dbo].[Journal_Insert] @UserCardId,'',''
		if(@@ERROR<>0)
			begin
				rollback
				return -1
			end
	commit tran
	return 0
end
GO
/****** Object:  StoredProcedure [dbo].[AdminSeries_Delete]    Script Date: 12/07/2016 16:56:27 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
/*******
--: AdminSeries_Delete
--: AdminSeries, 
--: 
AdminSeriesId
--: 
	
--:
	0 - 
	-1 -  
*********/
CREATE PROCEDURE [dbo].[AdminSeries_Delete]
@AdminSeriesId int,
@UserCardId varchar(50)
AS
begin
	begin tran
		delete AdminSeries where AdminSeriesId=@AdminSeriesId
			exec [dbo].[Journal_Insert] @UserCardId,'',''
		if(@@ERROR<>0)
			begin
				rollback
				return -1
			end
	commit tran
	return 0
end
GO
/****** Object:  StoredProcedure [dbo].[AdminSeries_Update]    Script Date: 12/07/2016 16:56:27 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
/*******
--: AdminSeries_Update
--: AdminSeries, 
--: 
AdminSeriesId,AdminSeriesName,AdminSeriesUrl,AdminSeriesFatherId,AdminSeriesFatherName
--: 
	
--:
	0 - 
	-1 -  
*********/
CREATE PROCEDURE [dbo].[AdminSeries_Update]
@AdminSeriesId int,
@AdminSeriesName varchar(50),
@UserCardId varchar(50)
AS
begin
	begin tran
	if not exists(select * from AdminSeries where AdminSeriesId<>@AdminSeriesId and AdminSeriesName=@AdminSeriesName)
	begin
		Update AdminSeries set AdminSeriesName=@AdminSeriesName where AdminSeriesId=@AdminSeriesId
		exec [dbo].[Journal_Insert] @UserCardId,'',''
		end
		if(@@ERROR<>0)
			begin
				rollback
				return -1
			end
	commit tran
	return 0
end
GO
/****** Object:  StoredProcedure [dbo].[Guidance_Delete]    Script Date: 12/07/2016 16:56:28 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
/*******
--: Guidance_Delete
--: Guidance, 
--: 
GuidanceId
--: 
	
--:
	0 - 
	-1 -  
*********/
CREATE PROCEDURE [dbo].[Guidance_Delete]
@GuidanceId int
AS
begin
	begin tran
		declare
		@UserCardId varchar(50),
		@TransferStatus varchar(50)
		set @UserCardId=(select UserCardId from Guidance where GuidanceId=@GuidanceId)
	  set @TransferStatus=( select TransferStatus from Guidance where GuidanceId=@GuidanceId)
	  if(@TransferStatus<>'')
	    begin
		delete Guidance where GuidanceId=@GuidanceId
	    delete GuidanceAuditProcess where GuidanceId=@GuidanceId
		delete GuidancePartner where GuidanceId=@GuidanceId
		delete GuidanceExamine where GuidanceId=@GuidanceId
	    	exec [dbo].[Journal_Insert] @UserCardId,'',''
		end
		if(@@ERROR<>0)
			begin
				rollback
				return -1
			end
	commit tran
	return 0
end
GO
/****** Object:  StoredProcedure [dbo].[PatentProcess_Insert]    Script Date: 12/07/2016 16:56:29 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
/*********************
--: PatentProcess_Insert
--: PatentProcess, 
--: 
PatentRoleId,ProcessRoleId,ProcessOrder
--: 
	
--:
	0 - 
	-1 -  
**************/
CREATE PROCEDURE [dbo].[PatentProcess_Insert]
	@ProcessRoleId int,
	@ProcessOrder int,
	@ProcessDepartment varchar(50),
	@UserCardId varchar(50)
AS
begin
	begin tran
   declare 
   @MaxOrder int
  if  exists(select * from PatentProcess where  ProcessRankId=@ProcessRoleId and ProcessDepartment=@ProcessDepartment)
begin
return -1
end
 else
begin  
   set @MaxOrder=(select MAX(ProcessOrder) from PatentProcess)
   if(@ProcessOrder>@MaxOrder)
   begin
   set @ProcessOrder=@MaxOrder+1
   insert into PatentProcess ( ProcessRankId,ProcessOrder,ProcessDepartment)values
   (@ProcessRoleId,@ProcessOrder,@ProcessDepartment)
end else
begin


   update PatentProcess 
   set ProcessOrder=ProcessOrder+1
   where ProcessOrder>=@ProcessOrder
    insert into PatentProcess ( ProcessRankId,ProcessOrder,ProcessDepartment)values
   (@ProcessRoleId,@ProcessOrder,@ProcessDepartment)

   end
   exec [dbo].[Journal_Insert] @UserCardId,'',''
end
		
		if(@@ERROR<>0)
			begin
				rollback
				return -1
			end
	commit tran
	return 0
end
GO
/****** Object:  StoredProcedure [dbo].[PatentProcess_Delete]    Script Date: 12/07/2016 16:56:29 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
/*********************
--: PatentProcess_Delete
--: PatentProcess, 
--: 
  PatentProcessId 
--: 
	
--:
	0 - 
	-1 -  
**************/
CREATE PROCEDURE [dbo].[PatentProcess_Delete]
@PatentProcessId int,
@UserCardId varchar(50)
AS
begin
	begin tran
	declare 
	@ProcessOrder int	
	set @ProcessOrder=(select ProcessOrder from PatentProcess where PatentProcessId=@PatentProcessId)
	
	delete PatentProcess 
	where PatentProcessId=@PatentProcessId 
     
    update PatentProcess 
    set ProcessOrder=ProcessOrder-1
    where  ProcessOrder>@ProcessOrder
    exec [dbo].[Journal_Insert] @UserCardId,'',''
		if(@@ERROR<>0)
			begin
				rollback
				return -1
			end
	commit tran
	return 0
end
GO
/****** Object:  StoredProcedure [dbo].[LongProjectsEndProcess_Insert]    Script Date: 12/07/2016 16:56:29 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
/*********************
--: LongProjectsProcess_Insert
--: LongProjectsProcess, 
--
--: 
LongProjectsRoleId,ProcessRoleId,ProcessOrder
--: 
	
--:
	0 - 
	-1 -  
**************/
CREATE PROCEDURE [dbo].[LongProjectsEndProcess_Insert]
	@ProcessRankId int,
	@ProcessOrder int,
	@ProcessDepartment varchar(50),
	@UserCardId varchar(50)
AS
begin
	begin tran
   declare 
   @MaxOrder int --
   --
  if  exists(select * from LongProjectsEndProcess where  ProcessRankId=@ProcessRankId and ProcessDepartment=@ProcessDepartment)
begin
return -1
end
 else
begin  
--0
if exists(select * from LongProjectsEndProcess)
begin
 set @MaxOrder=(select MAX(ProcessOrder) from LongProjectsEndProcess)
end
else
begin
set @MaxOrder=0
end
  --
   if(@ProcessOrder>@MaxOrder)
   begin
   --+1
   set @ProcessOrder=@MaxOrder+1
   insert into LongProjectsEndProcess ( ProcessRankId,ProcessOrder,ProcessDepartment)values
   (@ProcessRankId,@ProcessOrder,@ProcessDepartment)
end 
else
begin

--+1
   update LongProjectsEndProcess 
   set ProcessOrder=ProcessOrder+1
   where ProcessOrder>=@ProcessOrder
    insert into LongProjectsEndProcess ( ProcessRankId,ProcessOrder,ProcessDepartment)values
   (@ProcessRankId,@ProcessOrder,@ProcessDepartment)

   end
   --
   exec [dbo].[Journal_Insert] @UserCardId,'',''
end
		
		if(@@ERROR<>0)
			begin
				rollback
				return -1
			end
	commit tran
	return 0
end
GO
/****** Object:  StoredProcedure [dbo].[LongProjectsEndProcess_Delete]    Script Date: 12/07/2016 16:56:29 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
/*********************
--: LongProjectsProcess_Delete
--: LongProjectsProcess, 
--
--: 
  LongProjectsProcessId 
--: 
	
--:
	0 - 
	-1 -  
**************/
CREATE PROCEDURE [dbo].[LongProjectsEndProcess_Delete]
@LongProjectsProcessId int,
@UserCardId varchar(50)
AS
begin
	begin tran
	declare 
	@ProcessOrder int	
	--
	set @ProcessOrder=(select ProcessOrder from LongProjectsEndProcess where LongProjectsProcessId=@LongProjectsProcessId)
	--
	delete LongProjectsEndProcess 
	where LongProjectsProcessId=@LongProjectsProcessId 
     --
    update LongProjectsEndProcess 
    set ProcessOrder=ProcessOrder-1
    where  ProcessOrder>@ProcessOrder
	--
    exec [dbo].[Journal_Insert] @UserCardId,'',''
		if(@@ERROR<>0)
			begin
				rollback
				return -1
			end
	commit tran
	return 0
end
GO
/****** Object:  StoredProcedure [dbo].[PatentPartner_Update]    Script Date: 12/07/2016 16:56:29 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
/*********************
--: PatentPartner_Update
--: Patent, 
--: 


--: 
	
--:
	0 - 
	-1 -  
**************/
CREATE PROCEDURE [dbo].[PatentPartner_Update]
	@PatentPartnerId int,
	@UserCardId varchar(50),
	@PartnerRank int,
	@PartnerValue float
AS
begin
	begin tran
 declare 
   @PatentUserCardId varchar(50),
 @PartnerUserCardId varchar(50),
 @sum float,
    @PatentValue float,
    @PatentId int,
    @UserValue float
    set @PatentId=(select PatentId from PatentPartner where PatentPartnerId=@PatentPartnerId)
     set @PatentUserCardId=(select UserCardId from Patent where PatentId=@PatentId)
   set @PartnerUserCardId=(select PartnerUserCardId  from PatentPartner where PatentPartnerId=@PatentPartnerId)
  
  
    if(@PatentUserCardId<>@PartnerUserCardId)
   begin
   if(@PatentUserCardId<>@UserCardId)
   begin
  set @UserValue=(select PartnerValue from PatentPartner where PatentPartnerId=@PatentPartnerId)
    set @sum=(select SUM(PartnerValue) from PatentPartner where PatentId=@PatentId)
    set @PatentValue=(select PatentValue from Patent where PatentId=@PatentId)
    if(@sum-@UserValue+@PartnerValue<=@PatentValue)
    begin
		update PatentPartner set
		PartnerRank=@PartnerRank,
		PartnerValue=@PartnerValue,
		PartnerUserCardId=@UserCardId
		where PatentPartnerId=@PatentPartnerId 
		  exec [dbo].[Journal_Insert] @PatentUserCardId,'',''
end

   end
   end
   else
   begin
   if(@PartnerUserCardId=@UserCardId)
   begin
   set @UserValue=(select PartnerValue from PatentPartner where PatentPartnerId=@PatentPartnerId)
    set @sum=(select SUM(PartnerValue) from PatentPartner where PatentId=@PatentId)
    set @PatentValue=(select PatentValue from Patent where PatentId=@PatentId)
    if(@sum-@UserValue+@PartnerValue<=@PatentValue)
    begin
		update PatentPartner set
		PartnerRank=@PartnerRank,
		PartnerValue=@PartnerValue,
		PartnerUserCardId=@UserCardId
		where PatentPartnerId=@PatentPartnerId 
		  exec [dbo].[Journal_Insert] @PatentUserCardId,'',''
end

   end
   end
   


		if(@@ERROR<>0)
			begin
				rollback
				return -1
			end
	commit tran
	return 0
end
GO
/****** Object:  StoredProcedure [dbo].[Paper_Delete]    Script Date: 12/07/2016 16:56:29 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
/*******
--: Paper_Delete
--: Paper, 
--: 
PaperId
--: 
	
--:
	0 - 
	-1 -  
*********/
CREATE PROCEDURE [dbo].[Paper_Delete]
@PaperId int
AS
begin
	begin tran
		declare
		@UserCardId varchar(50),
		@TransferStatus varchar(50)
		set @UserCardId=(select UserCardId from Paper where PaperId=@PaperId)
	  set @TransferStatus=( select TransferStatus from Paper where PaperId=@PaperId)
	  if(@TransferStatus<>'')
	    begin
		delete Paper where PaperId=@PaperId
	    delete PaperAuditProcess where PaperId=@PaperId
		delete PaperExamine where PaperId=@PaperId
		delete PaperPartner where PaperId=@PaperId
	    	exec [dbo].[Journal_Insert] @UserCardId,'',''
		end
		if(@@ERROR<>0)
			begin
				rollback
				return -1
			end
	commit tran
	return 0
end
GO
/****** Object:  StoredProcedure [dbo].[LongCapitalPlan_Delete]    Script Date: 12/07/2016 16:56:28 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
/*******
--: LongCapitalPlan_Delete
--: LongCapitalPlan, 
--: 
LongProjectsId
--: 
	
--:
	0 - 
	-1 -  
*********/
CREATE PROCEDURE [dbo].[LongCapitalPlan_Delete]
@LongProjectsId int
AS
begin
	begin tran
		declare
		@UserCardId varchar(50),
		@TransferStatus varchar(50)
		set @UserCardId=(select UserCardId from LongCapitalPlan where LongProjectsId=@LongProjectsId)
	  set @TransferStatus=( select TransferStatus from LongCapitalPlan where LongProjectsId=@LongProjectsId)
	  if(@TransferStatus<>'')
	    begin
		delete LongCapitalPlan where LongProjectsId=@LongProjectsId
	  
	    delete LongCapitalPlanAuditProcess
	    where LongProjectsId=@LongProjectsId
		delete LongCapitalPlanExamine
		where LongProjectsId=@LongProjectsId
		 
	    	exec [dbo].[Journal_Insert] @UserCardId,'',''

		end
		if(@@ERROR<>0)
			begin
				rollback
				return -1
			end
	commit tran
	return 0
end
GO
/****** Object:  StoredProcedure [dbo].[Model_Update]    Script Date: 12/07/2016 16:56:29 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
/*******
--: Model_Update
--: Model, 
--: 
ModelId,ModelName,ModelUrl,ModelFatherId,ModelFatherName
--: 
	
--:
	0 - 
	-1 -  
*********/
CREATE PROCEDURE [dbo].[Model_Update]
@ModelId int,
@ModelName varchar(50),
@ModelUrl varchar(50),
@ModelFatherId int,
@ModelFatherName varchar(50),
@UserCardId varchar(50),
@ModelNum int
AS
begin
	begin tran
		Update Model 
		set ModelName=@ModelName,
		ModelUrl=@ModelUrl,
		ModelFatherId=@ModelFatherId,
		ModelFatherName=@ModelFatherName,
		ModelNum=@ModelNum
		where ModelId=@ModelId
		exec [dbo].[Journal_Insert] @UserCardId,'',''
		if exists( select * from Model where ModelFatherId=@ModelId)
		begin
		update Model 
		set ModelFatherName=@ModelName 
		where ModelFatherId=@ModelId
		end
		if(@@ERROR<>0)
			begin
				rollback
				return -1
			end
	commit tran
	return 0
end
GO
/****** Object:  StoredProcedure [dbo].[WorkLoadProjectsProcess_Insert]    Script Date: 12/07/2016 16:56:31 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
/*********************
--: WorkLoadProjectsProcess_Insert
--: WorkLoadProjectsProcess, 
--: 
WorkLoadProjectsRoleId,ProcessRoleId,ProcessOrder
--: 
	
--:
	0 - 
	-1 -  
**************/
CREATE PROCEDURE [dbo].[WorkLoadProjectsProcess_Insert]
	@ProcessRoleId int,
	@ProcessOrder int,
	@ProcessDepartment varchar(50),
	@UserCardId varchar(50)
AS
begin
	begin tran
   declare 
   @MaxOrder int
  if  exists(select * from WorkLoadProjectsProcess where  ProcessRankId=@ProcessRoleId and ProcessDepartment=@ProcessDepartment)
begin
return -1
end
 else
begin  
   set @MaxOrder=(select MAX(ProcessOrder) from WorkLoadProjectsProcess)
   if(@ProcessOrder>@MaxOrder)
   begin
   set @ProcessOrder=@MaxOrder+1
   insert into WorkLoadProjectsProcess ( ProcessRankId,ProcessOrder,ProcessDepartment)values
   (@ProcessRoleId,@ProcessOrder,@ProcessDepartment)
end else
begin


   update WorkLoadProjectsProcess 
   set ProcessOrder=ProcessOrder+1
   where ProcessOrder>=@ProcessOrder
    insert into WorkLoadProjectsProcess ( ProcessRankId,ProcessOrder,ProcessDepartment)values
   (@ProcessRoleId,@ProcessOrder,@ProcessDepartment)

   end
   exec [dbo].[Journal_Insert] @UserCardId,'',''
end
		
		if(@@ERROR<>0)
			begin
				rollback
				return -1
			end
	commit tran
	return 0
end
GO
/****** Object:  StoredProcedure [dbo].[WorkLoadProjectsProcess_Delete]    Script Date: 12/07/2016 16:56:31 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
/*********************
--: WorkLoadProjectsProcess_Delete
--: WorkLoadProjectsProcess, 
--: 
  WorkLoadProjectsProcessId 
--: 
	
--:
	0 - 
	-1 -  
**************/
CREATE PROCEDURE [dbo].[WorkLoadProjectsProcess_Delete]
@WorkLoadProjectsProcessId int,
@UserCardId varchar(50)
AS
begin
	begin tran
	declare 
	@ProcessOrder int	
	set @ProcessOrder=(select ProcessOrder from WorkLoadProjectsProcess where WorkLoadProjectsProcessId=@WorkLoadProjectsProcessId)
	
	delete WorkLoadProjectsProcess 
	where WorkLoadProjectsProcessId=@WorkLoadProjectsProcessId 
     
    update WorkLoadProjectsProcess 
    set ProcessOrder=ProcessOrder-1
    where  ProcessOrder>@ProcessOrder
    exec [dbo].[Journal_Insert] @UserCardId,'',''
		if(@@ERROR<>0)
			begin
				rollback
				return -1
			end
	commit tran
	return 0
end
GO
/****** Object:  StoredProcedure [dbo].[Model_Insert]    Script Date: 12/07/2016 16:56:29 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
/*********************
--: Model_Insert
--: Model, 
--: 
   ModelName,ModelUrl,ModelFatherId,ModelFatherName
--: 
	
--:
	0 - 
	-1 -  
**************/
CREATE PROCEDURE [dbo].[Model_Insert]
@ModelName varchar(50),
@ModelUrl varchar(50),
@ModelFatherId int,
@ModelFatherName varchar(50),
@UserCardId varchar(50),
@ModelNum int
AS
begin
	begin tran
	insert into Model(
    ModelName,ModelUrl,ModelFatherId,ModelFatherName,ModelNum	
	)values(
	@ModelName,@ModelUrl,@ModelFatherId,@ModelFatherName,@ModelNum
	)
	exec [dbo].[Journal_Insert] @UserCardId,'',''
		if(@@ERROR<>0)
			begin
				rollback
				return -1
			end
	commit tran
	return 0
end
GO
/****** Object:  StoredProcedure [dbo].[Model_Delete]    Script Date: 12/07/2016 16:56:29 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
/*******
--: Model_Delete
--: Model, 
--: 
ModelId
--: 
	
--:
	0 - 
	-1 -  
*********/
CREATE PROCEDURE [dbo].[Model_Delete]
@ModelId int,
@UserCardId varchar(50)
AS
begin
	begin tran
		delete Model where ModelId=@ModelId
		exec [dbo].[Journal_Insert] @UserCardId,'',''
		if(@@ERROR<>0)
			begin
				rollback
				return -1
			end
	commit tran
	return 0
end
GO
/****** Object:  StoredProcedure [dbo].[WorkLoadProjectsPartner_Update]    Script Date: 12/07/2016 16:56:31 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
/*********************
--: WorkLoadProjectsPartner_Update
--: WorkLoadProjects, 
--: 


--: 
	
--:
	0 - 
	-1 -  
**************/
CREATE PROCEDURE [dbo].[WorkLoadProjectsPartner_Update]
	@WorkLoadProjectsPartnerId int,
	@UserCardId varchar(50),
	@PartnerRank int,
	@PartnerValue float
AS
begin
	begin tran
 declare 
   @WorkLoadProjectsUserCardId varchar(50),
 @PartnerUserCardId varchar(50),
 @sum float,
    @WorkLoadProjectsValue float,
    @WorkLoadProjectsId int,
    @UserValue float
    set @WorkLoadProjectsId=(select WorkLoadProjectsId from WorkLoadProjectsPartner where WorkLoadProjectsPartnerId=@WorkLoadProjectsPartnerId)
     set @WorkLoadProjectsUserCardId=(select UserCardId from WorkLoadProjects where WorkLoadProjectsId=@WorkLoadProjectsId)
   set @PartnerUserCardId=(select PartnerUserCardId  from WorkLoadProjectsPartner where WorkLoadProjectsPartnerId=@WorkLoadProjectsPartnerId)
  
  
    if(@WorkLoadProjectsUserCardId<>@PartnerUserCardId)
   begin
   if(@WorkLoadProjectsUserCardId<>@UserCardId)
   begin
  set @UserValue=(select PartnerValue from WorkLoadProjectsPartner where WorkLoadProjectsPartnerId=@WorkLoadProjectsPartnerId)
    set @sum=(select SUM(PartnerValue) from WorkLoadProjectsPartner where WorkLoadProjectsId=@WorkLoadProjectsId)
    set @WorkLoadProjectsValue=(select ProjectsValue from WorkLoadProjects where WorkLoadProjectsId=@WorkLoadProjectsId)
    if(@sum-@UserValue+@PartnerValue<=@WorkLoadProjectsValue)
    begin
		update WorkLoadProjectsPartner set
		PartnerRank=@PartnerRank,
		PartnerValue=@PartnerValue,
		PartnerUserCardId=@UserCardId
		where WorkLoadProjectsPartnerId=@WorkLoadProjectsPartnerId 
		  exec [dbo].[Journal_Insert] @WorkLoadProjectsUserCardId,'',''
end

   end
   end
   else
   begin
   if(@PartnerUserCardId=@UserCardId)
   begin
   set @UserValue=(select PartnerValue from WorkLoadProjectsPartner where WorkLoadProjectsPartnerId=@WorkLoadProjectsPartnerId)
    set @sum=(select SUM(PartnerValue) from WorkLoadProjectsPartner where WorkLoadProjectsId=@WorkLoadProjectsId)
    set @WorkLoadProjectsValue=(select ProjectsValue from WorkLoadProjects where WorkLoadProjectsId=@WorkLoadProjectsId)
    if(@sum-@UserValue+@PartnerValue<=@WorkLoadProjectsValue)
    begin
		update WorkLoadProjectsPartner set
		PartnerRank=@PartnerRank,
		PartnerValue=@PartnerValue,
		PartnerUserCardId=@UserCardId
		where WorkLoadProjectsPartnerId=@WorkLoadProjectsPartnerId 
		  exec [dbo].[Journal_Insert] @WorkLoadProjectsUserCardId,'',''
end

   end
   end
   


		if(@@ERROR<>0)
			begin
				rollback
				return -1
			end
	commit tran
	return 0
end
GO
/****** Object:  StoredProcedure [dbo].[WorkLoadProjectsPartner_Insert]    Script Date: 12/07/2016 16:56:31 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
/*********************
--: WorkLoadProjectsPartner_Insert
--: WorkLoadProjectsPartner, 
--: 

--: 
	
--:
	0 - 
	-1 -  
**************/
CREATE PROCEDURE [dbo].[WorkLoadProjectsPartner_Insert]
@WorkLoadProjectsId int,
@PartnerValue float,
@PartnerRank int,
@UserCardId varchar(50)
AS
begin
	begin tran
	  if not exists( select * from WorkLoadProjectsPartner where WorkLoadProjectsId=@WorkLoadProjectsId and PartnerUserCardId=@UserCardId)
    begin
    declare @sum float,
    @WorkLoadProjectsValue float,
    	@WorkLoadProjectsUserCardId varchar(50)
    set @WorkLoadProjectsValue=(select ProjectsValue from WorkLoadProjects where WorkLoadProjectsId=@WorkLoadProjectsId)
    set @WorkLoadProjectsUserCardId=(select UserCardId from WorkLoadProjects where WorkLoadProjectsId=@WorkLoadProjectsId)
		
    if exists(select * from WorkLoadProjectsPartner where WorkLoadProjectsId=@WorkLoadProjectsId)
    begin
        set @sum=(select SUM(PartnerValue) from WorkLoadProjectsPartner where WorkLoadProjectsId=@WorkLoadProjectsId)
    if(@sum+@PartnerValue<=@WorkLoadProjectsValue)
    begin
     insert into WorkLoadProjectsPartner(
     WorkLoadProjectsId,PartnerValue,PartnerRank,PartnerUserCardId
     )values(
     @WorkLoadProjectsId,@PartnerValue,@PartnerRank,@UserCardId
     )
	 exec [dbo].[Journal_Insert] @WorkLoadProjectsUserCardId,'',''
	end
    end
    else
     begin
       if(@PartnerValue<=@WorkLoadProjectsValue)
    begin
     insert into WorkLoadProjectsPartner(
     WorkLoadProjectsId,PartnerValue,PartnerRank,PartnerUserCardId
     )values(
     @WorkLoadProjectsId,@PartnerValue,@PartnerRank,@UserCardId
     )
	 exec [dbo].[Journal_Insert] @WorkLoadProjectsUserCardId,'',''
	end
    end
    

	end
	
		if(@@ERROR<>0)
			begin
				rollback
				return -1
			end
	commit tran
	return 0
end
GO
/****** Object:  StoredProcedure [dbo].[WorkLoadProjectsPartner_Delete]    Script Date: 12/07/2016 16:56:31 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
/*******
--: WorkLoadProjectsPartner_Delete
--: WorkLoadProjects, 
--: 
WorkLoadProjectsPartnerId
--: 
	
--:
	0 - 
	-1 -  
*********/
CREATE PROCEDURE [dbo].[WorkLoadProjectsPartner_Delete]
@WorkLoadProjectsPartnerId int
AS
begin
	begin tran	
		declare 
		@PartnerUserCardId varchar(50),
		@WorkLoadProjectsUserCardId varchar(50),
		@WorkLoadProjectsId int
		set @WorkLoadProjectsId=(select WorkLoadProjectsId from WorkLoadProjectsPartner where WorkLoadProjectsPartnerId=@WorkLoadProjectsPartnerId)
		set @PartnerUserCardId=(select PartnerUserCardId from WorkLoadProjectsPartner where WorkLoadProjectsPartnerId=@WorkLoadProjectsPartnerId)
		set @WorkLoadProjectsUserCardId=(select UserCardId from WorkLoadProjects where WorkLoadProjectsId=@WorkLoadProjectsId)
		if(@WorkLoadProjectsUserCardId<>@PartnerUserCardId)
		begin
		delete WorkLoadProjectsPartner where WorkLoadProjectsPartnerId=@WorkLoadProjectsPartnerId
			exec [dbo].[Journal_Insert] @WorkLoadProjectsUserCardId,'',''
	   end
	   
		if(@@ERROR<>0)
			begin
				rollback
				return -1
			end
	commit tran
	return 0
end
GO
/****** Object:  StoredProcedure [dbo].[WinningPartner_Insert]    Script Date: 12/07/2016 16:56:31 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
/*********************
--: WinningPartner_Insert
--: WinningPartner, 
--: 

--: 
	
--:
	0 - 
	-1 -  
**************/
CREATE PROCEDURE [dbo].[WinningPartner_Insert]
@WinningId int,
@PartnerValue float,
@PartnerRank int,
@UserCardId varchar(50)
AS
begin
	begin tran
	  if not exists( select * from WinningPartner where WinningId=@WinningId and PartnerUserCardId=@UserCardId)
    begin
    declare @sum float,
    @WinningValue float,
    	@WinningUserCardId varchar(50)
    set @WinningValue=(select WinningValue from Winning where WinningId=@WinningId)
    set @WinningUserCardId=(select UserCardId from Winning where WinningId=@WinningId)
		
    if exists(select * from WinningPartner where WinningId=@WinningId)
    begin
        set @sum=(select SUM(PartnerValue) from WinningPartner where WinningId=@WinningId)
    if(@sum+@PartnerValue<=@WinningValue)
    begin
     insert into WinningPartner(
     WinningId,PartnerValue,PartnerRank,PartnerUserCardId
     )values(
     @WinningId,@PartnerValue,@PartnerRank,@UserCardId
     )
	 exec [dbo].[Journal_Insert] @WinningUserCardId,'',''
	end
    end
    else
     begin
       if(@PartnerValue<=@WinningValue)
    begin
     insert into WinningPartner(
     WinningId,PartnerValue,PartnerRank,PartnerUserCardId
     )values(
     @WinningId,@PartnerValue,@PartnerRank,@UserCardId
     )
	 exec [dbo].[Journal_Insert] @WinningUserCardId,'',''
	end
    end
    

	end
	
		if(@@ERROR<>0)
			begin
				rollback
				return -1
			end
	commit tran
	return 0
end
GO
/****** Object:  StoredProcedure [dbo].[WinningPartner_Delete]    Script Date: 12/07/2016 16:56:31 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
/*******
--: WinningPartner_Delete
--: Winning, 
--: 
WinningPartnerId
--: 
	
--:
	0 - 
	-1 -  
*********/
CREATE PROCEDURE [dbo].[WinningPartner_Delete]
@WinningPartnerId int
AS
begin
	begin tran	
		declare 
		@PartnerUserCardId varchar(50),
		@WinningUserCardId varchar(50),
		@WinningId int
		set @WinningId=(select WinningId from WinningPartner where WinningPartnerId=@WinningPartnerId)
		set @PartnerUserCardId=(select PartnerUserCardId from WinningPartner where WinningPartnerId=@WinningPartnerId)
		set @WinningUserCardId=(select UserCardId from Winning where WinningId=@WinningId)
		if(@WinningUserCardId<>@PartnerUserCardId)
		begin
		delete WinningPartner where WinningPartnerId=@WinningPartnerId
			exec [dbo].[Journal_Insert] @WinningUserCardId,'',''
	   end
	   
		if(@@ERROR<>0)
			begin
				rollback
				return -1
			end
	commit tran
	return 0
end
GO
/****** Object:  StoredProcedure [dbo].[WorkLoadProjects_Delete]    Script Date: 12/07/2016 16:56:31 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
/*******
--: WorkLoadProjects_Delete
--: WorkLoadProjects, 
--: 
WorkLoadProjectsId
--: 
	
--:
	0 - 
	-1 -  
*********/
CREATE PROCEDURE [dbo].[WorkLoadProjects_Delete]
@WorkLoadProjectsId int
AS
begin
	begin tran
		declare
		@UserCardId varchar(50),
		@TransferStatus varchar(50)
		set @UserCardId=(select UserCardId from WorkLoadProjects where WorkLoadProjectsId=@WorkLoadProjectsId)
	  set @TransferStatus=( select TransferStatus from WorkLoadProjects where WorkLoadProjectsId=@WorkLoadProjectsId)
	  if(@TransferStatus<>'')
	    begin
		delete WorkLoadProjects where WorkLoadProjectsId=@WorkLoadProjectsId
	    delete WorkLoadProjectsAuditProcess
	    where WorkLoadProjectsId=@WorkLoadProjectsId
		delete WorkLoadProjectsPartner where WorkLoadProjectsId=@WorkLoadProjectsId
		delete WorkLoadProjectsExamine where WorkLoadProjectsId=@WorkLoadProjectsId
	    	exec [dbo].[Journal_Insert] @UserCardId,'',''
		end
		if(@@ERROR<>0)
			begin
				rollback
				return -1
			end
	commit tran
	return 0
end
GO
/****** Object:  StoredProcedure [dbo].[UserRole_Delete]    Script Date: 12/07/2016 16:56:31 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
/*******
--: UserRole_Delete
--: UserRole, 
--: 
UserRoleId
--: 
	
--:
	0 - 
	-1 -  
*********/
CREATE PROCEDURE [dbo].[UserRole_Delete]
@UserRoleId int,
@UserCardId varchar(50)
AS
begin
	begin tran
		delete UserRole where UserRoleId=@UserRoleId
	exec [dbo].[Journal_Insert] @UserCardId,'',''
		if(@@ERROR<>0)
			begin
				rollback
				return -1
			end
	commit tran
	return 0
end
GO
/****** Object:  StoredProcedure [dbo].[UserRole_SelectByUserRoleId]    Script Date: 12/07/2016 16:56:31 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
/******
--: UserRole_SelectByUserRoleId
--: UserRole, 
--: 
UserRoleId
--: 
	
--:
	0 - 
	-1 -  
******/
CREATE PROCEDURE [dbo].[UserRole_SelectByUserRoleId]
@UserRoleId  int
AS
begin

		select * from  UserRole where UserRoleId=@UserRoleId

end
GO
/****** Object:  StoredProcedure [dbo].[Harvest_SelectByPartnerUser]    Script Date: 12/07/2016 16:56:28 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
/*********************
--: Harvest_SelectByHarvestUserCardId
--: Harvest, 
--: 
  UserCardId
--: 
	
--:
	0 - 
	-1 -  
**************/
CREATE PROCEDURE [dbo].[Harvest_SelectByPartnerUser]
	@UserCardId varchar(50)
	AS
begin
	 
	
	select b.UserName ,a.* ,c.DepartmentName ,d.PartnerRank,d.PartnerValue
	from Harvest a,UserInfo b ,Department c,HarvestPartner d
	where  d.PartnerUserCardId=@UserCardId and a.HarvestId=d.HarvestId
	and a.UserCardId=b.UserCardId and b.UserDepartmentId=c.DepartmentId
	
end
GO
/****** Object:  StoredProcedure [dbo].[Harvest_SelectByMyUserCardId]    Script Date: 12/07/2016 16:56:28 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
/*********************
--: Harvest_SelectByHarvestUserCardId
--: Harvest, 
--: 
  UserCardId
--: 
	
--:
	0 - 
	-1 -  
**************/
CREATE PROCEDURE [dbo].[Harvest_SelectByMyUserCardId]
	@UserCardId varchar(50)
	AS
begin

	select b.UserName ,a.* ,c.DepartmentName
	from Harvest a,UserInfo b ,Department c
	where    a.UserCardId=@UserCardId
	and a.UserCardId=b.UserCardId and b.UserDepartmentId=c.DepartmentId
		and a.TransferStatus=''
end
GO
/****** Object:  StoredProcedure [dbo].[Harvest_SelectByHarvestUserCardId]    Script Date: 12/07/2016 16:56:28 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
/*********************
--: Harvest_SelectByHarvestUserCardId
--: Harvest, 
--: 
  UserCardId
--: 
	
--:
	0 - 
	-1 -  
**************/
CREATE PROCEDURE [dbo].[Harvest_SelectByHarvestUserCardId]
	@UserCardId varchar(50)
	AS
begin
	 
	
	select b.UserName ,a.* ,c.DepartmentName 
	from Harvest a,UserInfo b ,Department c
	where a.UserCardId=b.UserCardId and 
	a.UserCardId = @UserCardId and a.DepartmentId=c.DepartmentId  
	
end
GO
/****** Object:  StoredProcedure [dbo].[GuidanceExamine_Select]    Script Date: 12/07/2016 16:56:28 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
/*********************
--: GuidanceExamine_Select
--: GuidanceExamine, 
--: 
  GuidanceId
--: 
	
--:
	0 - 
	-1 -  
**************/
CREATE PROCEDURE [dbo].[GuidanceExamine_Select]
@GuidanceId int
AS
BEGIN

 select a.*,c.UserName,d.RankName,e.DepartmentName
 from GuidanceExamine a,GuidanceAuditProcess b,UserInfo c,Rank d,Department e
 where a.GuidanceId=@GuidanceId and a.GuidanceId=b.GuidanceId and a.ExamineUserCardId=c.UserCardId 
 and a.ExamineNumber=b.ProcessOrder and b.ProcessRankId=d.RankId and c.UserDepartmentId=e.DepartmentId
   order by ExamineNumber
END
GO
/****** Object:  StoredProcedure [dbo].[Guidance_SelectByUserCardId]    Script Date: 12/07/2016 16:56:28 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
/*********************
--: Guidance_SelectByUserCardId
--: Guidance, 
--: 
  UserCardId
--: 
	
--:
	0 - 
	-1 -  
**************/
CREATE PROCEDURE [dbo].[Guidance_SelectByUserCardId]
	@UserCardId varchar(50),
	@RankId int
	AS
begin
   declare
   @DepartmentId int,
      @TeachersDepartmentId int
   set @DepartmentId=(select UserDepartmentId from UserInfo where UserCardId=@UserCardId)
   set @TeachersDepartmentId=(select TeachersDepartmentId from UserInfo where UserCardId=@UserCardId)
   select a.*,b.UserName,c.DepartmentName,c.DepartmentName
   from Guidance a left join UserInfo b on a.UserCardId=b.UserCardId 
   left join Department c on a.DepartmentId=c.DepartmentId
   where  
  (
   a.ProcessDepartmentId=@DepartmentId
   and a.ProcessRoleId= convert( varchar(50),@RankId))
   or (
   a.ProcessDepartmentId=@TeachersDepartmentId
   and a.ProcessRoleId= convert( varchar(50),@RankId))
    
end
GO
/****** Object:  StoredProcedure [dbo].[Guidance_SelectByPartnerUserNo]    Script Date: 12/07/2016 16:56:28 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
/*********************
--: Guidance_SelectByGuidanceUserCardId
--: Guidance, 
--: 
  UserCardId
--: 
	
--:
	0 - 
	-1 -  
**************/
CREATE PROCEDURE [dbo].[Guidance_SelectByPartnerUserNo]
	@UserCardId varchar(50)
	AS
begin
	 
	
	select b.UserName ,a.* ,c.DepartmentName 
	from Guidance a,UserInfo b ,Department c,GuidancePartner d
	where a.GuidanceId=d.GuidanceId and d.PartnerUserCardId=@UserCardId
	and d.PartnerUserCardId=b.UserCardId and b.UserDepartmentId=c.DepartmentId
	and a.TransferStatus=''
	
end
GO
/****** Object:  StoredProcedure [dbo].[Guidance_SelectByPartnerUserCardId]    Script Date: 12/07/2016 16:56:28 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
/*********************
--: Guidance_SelectByPartnerUserCardId
--: Guidance, 
--: 
  UserCardId
--: 
	
--:
	0 - 
	-1 -  
**************/
CREATE PROCEDURE [dbo].[Guidance_SelectByPartnerUserCardId]
	@UserCardId varchar(50),
	@ApplyYearId int
	AS
begin
	 
	
	select b.UserName ,a.* ,c.DepartmentName ,d.PartnerValue,d.PartnerRank
	from Guidance a,UserInfo b ,Department c,GuidancePartner d
	where d.PartnerUserCardId=b.UserCardId and 
	d.PartnerUserCardId = @UserCardId and b.UserDepartmentId=c.DepartmentId
	and a.GuidanceId=d.GuidanceId  and a.ApplyYearId=@ApplyYearId and a.TransferStatus=''
	
end
GO
/****** Object:  StoredProcedure [dbo].[Guidance_SelectByPartnerUser]    Script Date: 12/07/2016 16:56:28 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
/*********************
--: Guidance_SelectByGuidanceUserCardId
--: Guidance, 
--: 
  UserCardId
--: 
	
--:
	0 - 
	-1 -  
**************/
CREATE PROCEDURE [dbo].[Guidance_SelectByPartnerUser]
	@UserCardId varchar(50)
	AS
begin
	 
	
	select b.UserName ,a.* ,c.DepartmentName ,d.PartnerRank,d.PartnerValue
	from Guidance a,UserInfo b ,Department c,GuidancePartner d
	where   d.PartnerUserCardId=@UserCardId and a.GuidanceId=d.GuidanceId
	and a.UserCardId=b.UserCardId and b.UserDepartmentId=c.DepartmentId
	
end
GO
/****** Object:  StoredProcedure [dbo].[Guidance_SelectByMyUserCardId]    Script Date: 12/07/2016 16:56:28 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
/*********************
--: Guidance_SelectByGuidanceUserCardId
--: Guidance, 
--: 
  UserCardId
--: 
	
--:
	0 - 
	-1 -  
**************/
CREATE PROCEDURE [dbo].[Guidance_SelectByMyUserCardId]
	@UserCardId varchar(50)
	AS
begin

	select b.UserName ,a.* ,c.DepartmentName
	from Guidance a,UserInfo b ,Department c
	where    a.UserCardId=@UserCardId
	and a.UserCardId=b.UserCardId and b.UserDepartmentId=c.DepartmentId
		and a.TransferStatus=''
end
GO
/****** Object:  StoredProcedure [dbo].[Guidance_SelectByGuidanceUserCardId]    Script Date: 12/07/2016 16:56:28 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
/*********************
--: Guidance_SelectByGuidanceUserCardId
--: Guidance, 
--: 
  UserCardId
--: 
	
--:
	0 - 
	-1 -  
**************/
CREATE PROCEDURE [dbo].[Guidance_SelectByGuidanceUserCardId]
	@UserCardId varchar(50)
	AS
begin
	 
	
	select b.UserName ,a.* ,c.DepartmentName 
	from Guidance a,UserInfo b ,Department c
	where a.UserCardId=b.UserCardId and 
	a.UserCardId = @UserCardId and a.DepartmentId=c.DepartmentId  
	
end
GO
/****** Object:  StoredProcedure [dbo].[CapitalItem_Update]    Script Date: 12/07/2016 16:56:27 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
/*******
--: CapitalItem_Update
--: Department, 
--: 
CapitalItemId,CapitalItemName
--: 
	
--:
	0 - 
	-1 -  
*********/
CREATE PROCEDURE [dbo].[CapitalItem_Update]
@CapitalItemId int,
@CapitalItemName varchar(50),
@UserCardId varchar(50)
AS
begin
	begin tran
		update CapitalItem set CapitalItemName=@CapitalItemName where CapitalItemId=@CapitalItemId
		exec [dbo].[Journal_Insert] @UserCardId,'',''
		if(@@ERROR<>0)
			begin
				rollback
				return -1
			end
	commit tran
	return 0
end
GO
/****** Object:  StoredProcedure [dbo].[TeachingPartner_Insert]    Script Date: 12/07/2016 16:56:30 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
/*********************
--: TeachingPartner_Insert
--: TeachingPartner, 
--: 

--: 
	
--:
	0 - 
	-1 -  
**************/
CREATE PROCEDURE [dbo].[TeachingPartner_Insert]
@TeachingId int,
@PartnerValue float,
@PartnerRank int,
@UserCardId varchar(50)
AS
begin
	begin tran
	  if not exists( select * from TeachingPartner where TeachingId=@TeachingId and PartnerUserCardId=@UserCardId)
    begin
    declare @sum float,
    @TeachingValue float,
    	@TeachingUserCardId varchar(50)
    set @TeachingValue=(select TeachingValue from Teaching where TeachingId=@TeachingId)
    set @TeachingUserCardId=(select UserCardId from Teaching where TeachingId=@TeachingId)
		
    if exists(select * from TeachingPartner where TeachingId=@TeachingId)
    begin
        set @sum=(select SUM(PartnerValue) from TeachingPartner where TeachingId=@TeachingId)
    if(@sum+@PartnerValue<=@TeachingValue)
    begin
     insert into TeachingPartner(
     TeachingId,PartnerValue,PartnerRank,PartnerUserCardId
     )values(
     @TeachingId,@PartnerValue,@PartnerRank,@UserCardId
     )
	 exec [dbo].[Journal_Insert] @TeachingUserCardId,'',''
	end
    end
    else
     begin
       if(@PartnerValue<=@TeachingValue)
    begin
     insert into TeachingPartner(
     TeachingId,PartnerValue,PartnerRank,PartnerUserCardId
     )values(
     @TeachingId,@PartnerValue,@PartnerRank,@UserCardId
     )
	 exec [dbo].[Journal_Insert] @TeachingUserCardId,'',''
	end
    end
    

	end
	
		if(@@ERROR<>0)
			begin
				rollback
				return -1
			end
	commit tran
	return 0
end
GO
/****** Object:  StoredProcedure [dbo].[TeachingPartner_Delete]    Script Date: 12/07/2016 16:56:30 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
/*******
--: TeachingPartner_Delete
--: Teaching, 
--: 
TeachingPartnerId
--: 
	
--:
	0 - 
	-1 -  
*********/
CREATE PROCEDURE [dbo].[TeachingPartner_Delete]
@TeachingPartnerId int
AS
begin
	begin tran	
		declare 
		@PartnerUserCardId varchar(50),
		@TeachingUserCardId varchar(50),
		@TeachingId int
		set @TeachingId=(select TeachingId from TeachingPartner where TeachingPartnerId=@TeachingPartnerId)
		set @PartnerUserCardId=(select PartnerUserCardId from TeachingPartner where TeachingPartnerId=@TeachingPartnerId)
		set @TeachingUserCardId=(select UserCardId from Teaching where TeachingId=@TeachingId)
		if(@TeachingUserCardId<>@PartnerUserCardId)
		begin
		delete TeachingPartner where TeachingPartnerId=@TeachingPartnerId
			exec [dbo].[Journal_Insert] @TeachingUserCardId,'',''
	   end
	   
		if(@@ERROR<>0)
			begin
				rollback
				return -1
			end
	commit tran
	return 0
end
GO
/****** Object:  StoredProcedure [dbo].[TeachingProcess_Insert]    Script Date: 12/07/2016 16:56:30 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
/*********************
--: TeachingProcess_Insert
--: TeachingProcess, 
--: 
TeachingRoleId,ProcessRoleId,ProcessOrder
--: 
	
--:
	0 - 
	-1 -  
**************/
CREATE PROCEDURE [dbo].[TeachingProcess_Insert]
	@ProcessRoleId int,
	@ProcessOrder int,
	@ProcessDepartment varchar(50),
	@UserCardId varchar(50)
AS
begin
	begin tran
   declare 
   @MaxOrder int
  if  exists(select * from TeachingProcess where  ProcessRankId=@ProcessRoleId and ProcessDepartment=@ProcessDepartment)
begin
return -1
end
 else
begin  
   set @MaxOrder=(select MAX(ProcessOrder) from TeachingProcess)
   if(@ProcessOrder>@MaxOrder)
   begin
   set @ProcessOrder=@MaxOrder+1
   insert into TeachingProcess ( ProcessRankId,ProcessOrder,ProcessDepartment)values
   (@ProcessRoleId,@ProcessOrder,@ProcessDepartment)
end else
begin


   update TeachingProcess 
   set ProcessOrder=ProcessOrder+1
   where ProcessOrder>=@ProcessOrder
    insert into TeachingProcess ( ProcessRankId,ProcessOrder,ProcessDepartment)values
   (@ProcessRoleId,@ProcessOrder,@ProcessDepartment)

   end
   exec [dbo].[Journal_Insert] @UserCardId,'',''
end
		
		if(@@ERROR<>0)
			begin
				rollback
				return -1
			end
	commit tran
	return 0
end
GO
/****** Object:  StoredProcedure [dbo].[TeachingProcess_Delete]    Script Date: 12/07/2016 16:56:30 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
/*********************
--: TeachingProcess_Delete
--: TeachingProcess, 
--: 
  TeachingProcessId 
--: 
	
--:
	0 - 
	-1 -  
**************/
CREATE PROCEDURE [dbo].[TeachingProcess_Delete]
@TeachingProcessId int,
@UserCardId varchar(50)
AS
begin
	begin tran
	declare 
	@ProcessOrder int	
	set @ProcessOrder=(select ProcessOrder from TeachingProcess where TeachingProcessId=@TeachingProcessId)
	
	delete TeachingProcess 
	where TeachingProcessId=@TeachingProcessId 
     
    update TeachingProcess 
    set ProcessOrder=ProcessOrder-1
    where  ProcessOrder>@ProcessOrder
    exec [dbo].[Journal_Insert] @UserCardId,'',''
		if(@@ERROR<>0)
			begin
				rollback
				return -1
			end
	commit tran
	return 0
end
GO
/****** Object:  StoredProcedure [dbo].[WinningProcess_Insert]    Script Date: 12/07/2016 16:56:31 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
/*********************
--: WinningProcess_Insert
--: WinningProcess, 
--: 
WinningRoleId,ProcessRoleId,ProcessOrder
--: 
	
--:
	0 - 
	-1 -  
**************/
CREATE PROCEDURE [dbo].[WinningProcess_Insert]
	@ProcessRoleId int,
	@ProcessOrder int,
	@ProcessDepartment varchar(50),
	@UserCardId varchar(50)
AS
begin
	begin tran
   declare 
   @MaxOrder int
  if  exists(select * from WinningProcess where  ProcessRankId=@ProcessRoleId and ProcessDepartment=@ProcessDepartment)
begin
return -1
end
 else
begin  
   set @MaxOrder=(select MAX(ProcessOrder) from WinningProcess)
   if(@ProcessOrder>@MaxOrder)
   begin
   set @ProcessOrder=@MaxOrder+1
   insert into WinningProcess ( ProcessRankId,ProcessOrder,ProcessDepartment)values
   (@ProcessRoleId,@ProcessOrder,@ProcessDepartment)
end else
begin


   update WinningProcess 
   set ProcessOrder=ProcessOrder+1
   where ProcessOrder>=@ProcessOrder
    insert into WinningProcess ( ProcessRankId,ProcessOrder,ProcessDepartment)values
   (@ProcessRoleId,@ProcessOrder,@ProcessDepartment)

   end
   exec [dbo].[Journal_Insert] @UserCardId,'',''
end
		
		if(@@ERROR<>0)
			begin
				rollback
				return -1
			end
	commit tran
	return 0
end
GO
/****** Object:  StoredProcedure [dbo].[WinningProcess_Delete]    Script Date: 12/07/2016 16:56:31 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
/*********************
--: WinningProcess_Delete
--: WinningProcess, 
--: 
  WinningProcessId 
--: 
	
--:
	0 - 
	-1 -  
**************/
CREATE PROCEDURE [dbo].[WinningProcess_Delete]
@WinningProcessId int,
@UserCardId varchar(50)
AS
begin
	begin tran
	declare 
	@ProcessOrder int	
	set @ProcessOrder=(select ProcessOrder from WinningProcess where WinningProcessId=@WinningProcessId)
	
	delete WinningProcess 
	where WinningProcessId=@WinningProcessId 
     
    update WinningProcess 
    set ProcessOrder=ProcessOrder-1
    where  ProcessOrder>@ProcessOrder
    exec [dbo].[Journal_Insert] @UserCardId,'',''
		if(@@ERROR<>0)
			begin
				rollback
				return -1
			end
	commit tran
	return 0
end
GO
/****** Object:  StoredProcedure [dbo].[WinningPartner_Update]    Script Date: 12/07/2016 16:56:31 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
/*********************
--: WinningPartner_Update
--: Winning, 
--: 


--: 
	
--:
	0 - 
	-1 -  
**************/
CREATE PROCEDURE [dbo].[WinningPartner_Update]
	@WinningPartnerId int,
	@UserCardId varchar(50),
	@PartnerRank int,
	@PartnerValue float
AS
begin
	begin tran
 declare 
   @WinningUserCardId varchar(50),
 @PartnerUserCardId varchar(50),
 @sum float,
    @WinningValue float,
    @WinningId int,
    @UserValue float
    set @WinningId=(select WinningId from WinningPartner where WinningPartnerId=@WinningPartnerId)
     set @WinningUserCardId=(select UserCardId from Winning where WinningId=@WinningId)
   set @PartnerUserCardId=(select PartnerUserCardId  from WinningPartner where WinningPartnerId=@WinningPartnerId)
  
  
    if(@WinningUserCardId<>@PartnerUserCardId)
   begin
   if(@WinningUserCardId<>@UserCardId)
   begin
  set @UserValue=(select PartnerValue from WinningPartner where WinningPartnerId=@WinningPartnerId)
    set @sum=(select SUM(PartnerValue) from WinningPartner where WinningId=@WinningId)
    set @WinningValue=(select WinningValue from Winning where WinningId=@WinningId)
    if(@sum-@UserValue+@PartnerValue<=@WinningValue)
    begin
		update WinningPartner set
		PartnerRank=@PartnerRank,
		PartnerValue=@PartnerValue,
		PartnerUserCardId=@UserCardId
		where WinningPartnerId=@WinningPartnerId 
		  exec [dbo].[Journal_Insert] @WinningUserCardId,'',''
end

   end
   end
   else
   begin
   if(@PartnerUserCardId=@UserCardId)
   begin
   set @UserValue=(select PartnerValue from WinningPartner where WinningPartnerId=@WinningPartnerId)
    set @sum=(select SUM(PartnerValue) from WinningPartner where WinningId=@WinningId)
    set @WinningValue=(select WinningValue from Winning where WinningId=@WinningId)
    if(@sum-@UserValue+@PartnerValue<=@WinningValue)
    begin
		update WinningPartner set
		PartnerRank=@PartnerRank,
		PartnerValue=@PartnerValue,
		PartnerUserCardId=@UserCardId
		where WinningPartnerId=@WinningPartnerId 
		  exec [dbo].[Journal_Insert] @WinningUserCardId,'',''
end

   end
   end
   


		if(@@ERROR<>0)
			begin
				rollback
				return -1
			end
	commit tran
	return 0
end
GO
/****** Object:  StoredProcedure [dbo].[Winning_Delete]    Script Date: 12/07/2016 16:56:31 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
/*******
--: Winning_Delete
--: Winning, 
--: 
WinningId
--: 
	
--:
	0 - 
	-1 -  
*********/
CREATE PROCEDURE [dbo].[Winning_Delete]
@WinningId int
AS
begin
	begin tran
		declare
		@UserCardId varchar(50),
		@TransferStatus varchar(50)
		set @UserCardId=(select UserCardId from Winning where WinningId=@WinningId)
	  set @TransferStatus=( select TransferStatus from Winning where WinningId=@WinningId)
	  if(@TransferStatus<>'')
	    begin
		delete Winning where WinningId=@WinningId
	    delete WinningAuditProcess
	    where WinningId=@WinningId
		delete WinningExamine where WinningId=@WinningId
		delete WinningPartner where WinningId=@WinningId
	    	exec [dbo].[Journal_Insert] @UserCardId,'',''
		end
		if(@@ERROR<>0)
			begin
				rollback
				return -1
			end
	commit tran
	return 0
end
GO
/****** Object:  StoredProcedure [dbo].[UseOffice_SelectByUserCardId]    Script Date: 12/07/2016 16:56:30 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
/******
--: UseOffice_SelectByUserCardId
--: UseOffice, 
--: 
UserCardId
--: 
	
--:
	0 - 
	-1 -  
******/
CREATE PROCEDURE [dbo].[UseOffice_SelectByUserCardId]
@UserCardId varchar(50)
AS
begin

		select distinct  * from   UseOffice where UserCardId=@UserCardId
		order by UseOfficeId

end
GO
/****** Object:  StoredProcedure [dbo].[UseOffice_SelectByUseOfficeId]    Script Date: 12/07/2016 16:56:30 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
/******
--: UseOffice_SelectByUseOfficeId
--: UseOffice, 
--: 
UseOfficeId
--: 
	
--:
	0 - 
	-1 -  
******/
CREATE PROCEDURE [dbo].[UseOffice_SelectByUseOfficeId]
@UseOfficeId int
AS
begin

		select * from   UseOffice where UseOfficeId=@UseOfficeId

end
GO
/****** Object:  StoredProcedure [dbo].[UseOffice_Insert]    Script Date: 12/07/2016 16:56:30 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
/*********************
--: UseOffice_Insert
--: UseOffice, 
--: 
   UseOfficeName
--: 
	
--:
	0 - 
	-1 -  
**************/
CREATE PROCEDURE [dbo].[UseOffice_Insert]
@UserCardId varchar(50),
@DepartmentName varchar(50),
@RoleName varchar(50),
@LevelName varchar(50),
@StartDate	date,
@EndDate	varchar(50),
@IsCurrent varchar(50),
@IsAgent varchar(50)
AS
begin
	begin tran
	insert into UseOffice(
	UserCardId,DepartmentName,RoleName,LevelName,StartDate,EndDate,IsCurrent,IsAgent
	)values(
	@UserCardId,@DepartmentName,@RoleName,@LevelName,@StartDate,@EndDate,@IsCurrent,@IsAgent
	)
		if(@@ERROR<>0)
			begin
				rollback
				return -1
			end
	commit tran
	return 0
end
GO
/****** Object:  StoredProcedure [dbo].[UseOffice_Delete]    Script Date: 12/07/2016 16:56:30 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
/*******
--: UseOffice_Delete
--: UseOffice, 
--: 
UsexOfficeId
--: 
	
--:
	0 - 
	-1 -  
*********/
CREATE PROCEDURE [dbo].[UseOffice_Delete]
@UseOfficeId int
AS
begin
	begin tran
		delete UseOffice where UseOfficeId=@UseOfficeId
		if(@@ERROR<>0)
			begin
				rollback
				return -1
			end
	commit tran
	return 0
end
GO
/****** Object:  StoredProcedure [dbo].[TeachingPartner_Update]    Script Date: 12/07/2016 16:56:30 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
/*********************
--: TeachingPartner_Update
--: Teaching, 
--: 


--: 
	
--:
	0 - 
	-1 -  
**************/
CREATE PROCEDURE [dbo].[TeachingPartner_Update]
	@TeachingPartnerId int,
	@UserCardId varchar(50),
	@PartnerRank int,
	@PartnerValue float
AS
begin
	begin tran
 declare 
   @TeachingUserCardId varchar(50),
 @PartnerUserCardId varchar(50),
 @sum float,
    @TeachingValue float,
    @TeachingId int,
    @UserValue float
    set @TeachingId=(select TeachingId from TeachingPartner where TeachingPartnerId=@TeachingPartnerId)
     set @TeachingUserCardId=(select UserCardId from Teaching where TeachingId=@TeachingId)
   set @PartnerUserCardId=(select PartnerUserCardId  from TeachingPartner where TeachingPartnerId=@TeachingPartnerId)
  
  
    if(@TeachingUserCardId<>@PartnerUserCardId)
   begin
   if(@TeachingUserCardId<>@UserCardId)
   begin
  set @UserValue=(select PartnerValue from TeachingPartner where TeachingPartnerId=@TeachingPartnerId)
    set @sum=(select SUM(PartnerValue) from TeachingPartner where TeachingId=@TeachingId)
    set @TeachingValue=(select TeachingValue from Teaching where TeachingId=@TeachingId)
    if(@sum-@UserValue+@PartnerValue<=@TeachingValue)
    begin
		update TeachingPartner set
		PartnerRank=@PartnerRank,
		PartnerValue=@PartnerValue,
		PartnerUserCardId=@UserCardId
		where TeachingPartnerId=@TeachingPartnerId 
		  exec [dbo].[Journal_Insert] @TeachingUserCardId,'',''
end

   end
   end
   else
   begin
   if(@PartnerUserCardId=@UserCardId)
   begin
   set @UserValue=(select PartnerValue from TeachingPartner where TeachingPartnerId=@TeachingPartnerId)
    set @sum=(select SUM(PartnerValue) from TeachingPartner where TeachingId=@TeachingId)
    set @TeachingValue=(select TeachingValue from Teaching where TeachingId=@TeachingId)
    if(@sum-@UserValue+@PartnerValue<=@TeachingValue)
    begin
		update TeachingPartner set
		PartnerRank=@PartnerRank,
		PartnerValue=@PartnerValue,
		PartnerUserCardId=@UserCardId
		where TeachingPartnerId=@TeachingPartnerId 
		  exec [dbo].[Journal_Insert] @TeachingUserCardId,'',''
end

   end
   end
   


		if(@@ERROR<>0)
			begin
				rollback
				return -1
			end
	commit tran
	return 0
end
GO
/****** Object:  StoredProcedure [dbo].[Teaching_Delete]    Script Date: 12/07/2016 16:56:30 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
/*******
--: Teaching_Delete
--: Teaching, 
--: 
TeachingId
--: 
	
--:
	0 - 
	-1 -  
*********/
CREATE PROCEDURE [dbo].[Teaching_Delete]
@TeachingId int
AS
begin
	begin tran
		declare
		@UserCardId varchar(50),
		@TransferStatus varchar(50)
		set @UserCardId=(select UserCardId from Teaching where TeachingId=@TeachingId)
	  set @TransferStatus=( select TransferStatus from Teaching where TeachingId=@TeachingId)
	  if(@TransferStatus<>'')
	    begin
		delete Teaching where TeachingId=@TeachingId
	    delete TeachingAuditProcess
	    where TeachingId=@TeachingId
		delete TeachingExamine where TeachingId=@TeachingId
		delete TeachingPartner where TeachingId=@TeachingId
	    	exec [dbo].[Journal_Insert] @UserCardId,'',''
		end
		if(@@ERROR<>0)
			begin
				rollback
				return -1
			end
	commit tran
	return 0
end
GO
/****** Object:  StoredProcedure [dbo].[ShortProjects_Delete]    Script Date: 12/07/2016 16:56:30 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
/*******
--: ShortProjects_Delete
--: ShortProjects, 
--
--: 
ShortProjectsId
--: 
	
--:
	0 - 
	-1 -  
*********/
CREATE PROCEDURE [dbo].[ShortProjects_Delete]
@ShortProjectsId varchar(50)
AS
begin
	begin tran
		declare
		@UserCardId varchar(50),--
		@StandStatus varchar(50) --
		set @UserCardId=(select UserCardId from ShortProjects where ShortProjectsId=@ShortProjectsId) --
	  set @StandStatus=( select StandStatus from ShortProjects where ShortProjectsId=@ShortProjectsId) --
	  if(@StandStatus<>'') --
	    begin
		delete ShortProjects where ShortProjectsId=@ShortProjectsId --
	    delete ShortProjectsStandAuditProcess
	    where ShortProjectsId=@ShortProjectsId     --
		delete ShortProjectsStandExamine
		where ShortProjectsId=@ShortProjectsId     --
		delete ShortProjectsStandWaitExamine
		where ShortProjectsId=@ShortProjectsId     --
	    exec [dbo].[Journal_Insert] @UserCardId,'',''   --
		end
		if(@@ERROR<>0)
			begin
				rollback
				return -1
			end
	commit tran
	return 0
end
GO
/****** Object:  StoredProcedure [dbo].[ShortCapitalPlan_Delete]    Script Date: 12/07/2016 16:56:30 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
/*******
--: ShortCapitalPlan_Delete
--: ShortCapitalPlan, 
--: 
ShortProjectsId
--: 
	
--:
	0 - 
	-1 -  
*********/
CREATE PROCEDURE [dbo].[ShortCapitalPlan_Delete]
@ShortProjectsId int
AS
begin
	begin tran
		declare
		@UserCardId varchar(50),
		@TransferStatus varchar(50)
		set @UserCardId=(select UserCardId from ShortCapitalPlan where ShortProjectsId=@ShortProjectsId)
	  set @TransferStatus=( select TransferStatus from ShortCapitalPlan where ShortProjectsId=@ShortProjectsId)
	  if(@TransferStatus<>'')
	    begin
		delete ShortCapitalPlan where ShortProjectsId=@ShortProjectsId
	  
	    delete ShortCapitalPlanAuditProcess
	    where ShortProjectsId=@ShortProjectsId
		delete ShortCapitalPlanExamine
		where ShortProjectsId=@ShortProjectsId
		 
	    	exec [dbo].[Journal_Insert] @UserCardId,'',''

		end
		if(@@ERROR<>0)
			begin
				rollback
				return -1
			end
	commit tran
	return 0
end
GO
/****** Object:  StoredProcedure [dbo].[ProjectsTemplate_Insert]    Script Date: 12/07/2016 16:56:30 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
-- =============================================
-- Author:		<Author,,Name>
-- Create date: <Create Date,,>
-- Description:	<Description,,>
-- =============================================
CREATE PROCEDURE [dbo].[ProjectsTemplate_Insert]
@Category varchar(50),
@TemplateName varchar(50),
@FileUrl text,
@UserCardId varchar(50)
AS
begin
	insert into ProjectsTemplate
	(Category,TemplateName,FileUrl)
	values
	(@Category,@TemplateName,@FileUrl)
	exec [dbo].[Journal_Insert] @UserCardId,'',''
	if(@@ERROR<>0)
	begin
	  rollback 
	  return -1
	end
	else
	begin
	 return 0
	end
  end
GO
/****** Object:  StoredProcedure [dbo].[ProjectsTemplate_Delete]    Script Date: 12/07/2016 16:56:29 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
-- =============================================
-- Author:		<Author,,Name>
-- Create date: <Create Date,,>
-- Description:	<Description,,>
-- =============================================
CREATE PROCEDURE [dbo].[ProjectsTemplate_Delete]
@TemplateId int,
@UserCardId varchar(50)
AS
begin
delete ProjectsTemplate 
where TemplateId=@TemplateId
exec [dbo].[Journal_Insert] @UserCardId,'',''
	if(@@ERROR<>0)
	begin
	  rollback 
	  return -1
	end
	else
	begin
	 return 0
	end
  end
GO
/****** Object:  StoredProcedure [dbo].[PatentPartner_Insert]    Script Date: 12/07/2016 16:56:29 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
/*********************
--: PatentPartner_Insert
--: PatentPartner, 
--: 

--: 
	
--:
	0 - 
	-1 -  
**************/
CREATE PROCEDURE [dbo].[PatentPartner_Insert]
@PatentId int,
@PartnerValue float,
@PartnerRank int,
@UserCardId varchar(50)
AS
begin
	begin tran
	  if not exists( select * from PatentPartner where PatentId=@PatentId and PartnerUserCardId=@UserCardId)
    begin
    declare @sum float,
    @PatentValue float,
    	@PatentUserCardId varchar(50)
    set @PatentValue=(select PatentValue from Patent where PatentId=@PatentId)
    set @PatentUserCardId=(select UserCardId from Patent where PatentId=@PatentId)
		
    if exists(select * from PatentPartner where PatentId=@PatentId)
    begin
        set @sum=(select SUM(PartnerValue) from PatentPartner where PatentId=@PatentId)
    if(@sum+@PartnerValue<=@PatentValue)
    begin
     insert into PatentPartner(
     PatentId,PartnerValue,PartnerRank,PartnerUserCardId
     )values(
     @PatentId,@PartnerValue,@PartnerRank,@UserCardId
     )
	 exec [dbo].[Journal_Insert] @PatentUserCardId,'',''
	end
    end
    else
     begin
       if(@PartnerValue<=@PatentValue)
    begin
     insert into PatentPartner(
     PatentId,PartnerValue,PartnerRank,PartnerUserCardId
     )values(
     @PatentId,@PartnerValue,@PartnerRank,@UserCardId
     )
	 exec [dbo].[Journal_Insert] @PatentUserCardId,'',''
	end
    end
    

	end
	
		if(@@ERROR<>0)
			begin
				rollback
				return -1
			end
	commit tran
	return 0
end
GO
/****** Object:  StoredProcedure [dbo].[PatentPartner_Delete]    Script Date: 12/07/2016 16:56:29 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
/*******
--: PatentPartner_Delete
--: Patent, 
--: 
PatentPartnerId
--: 
	
--:
	0 - 
	-1 -  
*********/
CREATE PROCEDURE [dbo].[PatentPartner_Delete]
@PatentPartnerId int
AS
begin
	begin tran	
		declare 
		@PartnerUserCardId varchar(50),
		@PatentUserCardId varchar(50),
		@PatentId int
		set @PatentId=(select PatentId from PatentPartner where PatentPartnerId=@PatentPartnerId)
		set @PartnerUserCardId=(select PartnerUserCardId from PatentPartner where PatentPartnerId=@PatentPartnerId)
		set @PatentUserCardId=(select UserCardId from Patent where PatentId=@PatentId)
		if(@PatentUserCardId<>@PartnerUserCardId)
		begin
		delete PatentPartner where PatentPartnerId=@PatentPartnerId
			exec [dbo].[Journal_Insert] @PatentUserCardId,'',''
	   end
	   
		if(@@ERROR<>0)
			begin
				rollback
				return -1
			end
	commit tran
	return 0
end
GO
/****** Object:  StoredProcedure [dbo].[LongCapitalCloseProcess_Insert]    Script Date: 12/07/2016 16:56:28 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
/*********************
--: LongCapitalCloseProcess_Insert
--: LongCapitalCloseProcess, 
--: 
LongCapitalCloseRoleId,ProcessRoleId,ProcessOrder
--: 
	
--:
	0 - 
	-1 -  
**************/
CREATE PROCEDURE [dbo].[LongCapitalCloseProcess_Insert]
	@ProcessRankId int,
	@ProcessOrder int,
	@ProcessDepartment varchar(50),
	@UserCardId varchar(50)
AS
begin
	begin tran
   declare 
   @MaxOrder int
  if  exists(select * from LongCapitalCloseProcess where  ProcessRankId=@ProcessRankId and ProcessDepartment=@ProcessDepartment)
begin
return -1
end
 else
begin
--0
if exists(select * from LongCapitalCloseProcess)
begin
  set @MaxOrder=(select MAX(ProcessOrder) from LongCapitalCloseProcess)
end
else
begin
set @MaxOrder=0
end  
   if(@ProcessOrder>@MaxOrder)
   begin
   set @ProcessOrder=@MaxOrder+1
   insert into LongCapitalCloseProcess ( ProcessRankId,ProcessOrder,ProcessDepartment)values
   (@ProcessRankId,@ProcessOrder,@ProcessDepartment)
end else
begin


   update LongCapitalCloseProcess 
   set ProcessOrder=ProcessOrder+1
   where ProcessOrder>=@ProcessOrder
    insert into LongCapitalCloseProcess ( ProcessRankId,ProcessOrder,ProcessDepartment)values
   (@ProcessRankId,@ProcessOrder,@ProcessDepartment)

   end
   exec [dbo].[Journal_Insert] @UserCardId,'',''
end
		
		if(@@ERROR<>0)
			begin
				rollback
				return -1
			end
	commit tran
	return 0
end
GO
/****** Object:  StoredProcedure [dbo].[LongCapitalCloseProcess_Delete]    Script Date: 12/07/2016 16:56:28 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
/*********************
--: LongCapitalCloseProcess_Delete
--: LongCapitalCloseProcess, 
--: 
  LongCapitalCloseProcessId 
--: 
	
--:
	0 - 
	-1 -  
**************/
CREATE PROCEDURE [dbo].[LongCapitalCloseProcess_Delete]
@LongCapitalCloseProcessId int,
@UserCardId varchar(50)
AS
begin
	begin tran
	declare 
	@ProcessOrder int	
	set @ProcessOrder=(select ProcessOrder from LongCapitalCloseProcess where LongCapitalCloseProcessId=@LongCapitalCloseProcessId)
	
	delete LongCapitalCloseProcess 
	where LongCapitalCloseProcessId=@LongCapitalCloseProcessId 
     
    update LongCapitalCloseProcess 
    set ProcessOrder=ProcessOrder-1
    where  ProcessOrder>@ProcessOrder
    exec [dbo].[Journal_Insert] @UserCardId,'',''
		if(@@ERROR<>0)
			begin
				rollback
				return -1
			end
	commit tran
	return 0
end
GO
/****** Object:  StoredProcedure [dbo].[ProjectsSubject_Update]    Script Date: 12/07/2016 16:56:29 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
/*******
--: ProjectsSubject_Update
--: ProjectsSubject, 
--: 
ProjectsSubjectId,ProjectsSubjectName
--: 
	
--:
	0 - 
	-1 -  
*********/
CREATE PROCEDURE [dbo].[ProjectsSubject_Update]
@ProjectsSubjectId int,
@ProjectsSubjectExplain varchar(50),
@UserCardId varchar(50)
AS
begin
	begin tran
	if not exists(select * from ProjectsSubject where ProjectsSubjectId<>@ProjectsSubjectId and ProjectsSubjectExplain=@ProjectsSubjectExplain)
	
	begin	update ProjectsSubject set ProjectsSubjectExplain=@ProjectsSubjectExplain where ProjectsSubjectId=@ProjectsSubjectId
		exec [dbo].[Journal_Insert] @UserCardId,'',''
	end
		if(@@ERROR<>0)
			begin
				rollback
				return -1
			end
	commit tran
	return 0
end
GO
/****** Object:  StoredProcedure [dbo].[ProjectsSubject_Insert]    Script Date: 12/07/2016 16:56:29 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
/*********************
--: ProjectsFrom_Insert
--: ProjectsFrom, 
--: 
   ProjectsFromName
--: 
	
--:
	0 - 
	-1 -  
**************/
CREATE PROCEDURE [dbo].[ProjectsSubject_Insert]
@ProjectsSubjectExplain varchar(50),
@UserCardId varchar(50)
AS
begin
	begin tran
	insert into ProjectsSubject(
	ProjectsSubjectExplain
	)values(
	@ProjectsSubjectExplain
	)
	exec [dbo].[Journal_Insert] @UserCardId,'',''
		if(@@ERROR<>0)
			begin
				rollback
				return -1
			end
	commit tran
	return 0
end
GO
/****** Object:  StoredProcedure [dbo].[ProjectsSubject_Delete]    Script Date: 12/07/2016 16:56:29 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
/*******
--: ProjectsFrom_Delete
--: ProjectsFrom, 
--: 
ProjectsFromId
--: 
	
--:
	0 - 
	-1 -  
*********/
CREATE PROCEDURE [dbo].[ProjectsSubject_Delete]
@ProjectsSubjectId int,
@UserCardId varchar(50)
AS
begin
	begin tran
		delete ProjectsSubject where ProjectsSubjectId=@ProjectsSubjectId
		select * from ProjectsSubject
		exec [dbo].[Journal_Insert] @UserCardId,'',''
		if(@@ERROR<>0)
			begin
				rollback
				return -1
			end
	commit tran
	return 0
end
GO
/****** Object:  StoredProcedure [dbo].[WorkLoadProjectsExamine_Select]    Script Date: 12/07/2016 16:56:31 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
/*********************
--: WorkLoadProjectsExamine_Select
--: WorkLoadProjectsExamine, 
--: 
  WorkLoadProjectsId
--: 
	
--:
	0 - 
	-1 -  
**************/
CREATE PROCEDURE [dbo].[WorkLoadProjectsExamine_Select]
@WorkLoadProjectsId int
AS
BEGIN

 select a.*,c.UserName,d.RankName,e.DepartmentName
 from WorkLoadProjectsExamine a,WorkLoadProjectsAuditProcess b,UserInfo c,Rank d,Department e
 where a.WorkLoadProjectsId=@WorkLoadProjectsId and a.WorkLoadProjectsId=b.WorkLoadProjectsId and a.ExamineUserCardId=c.UserCardId 
 and a.ExamineNumber=b.ProcessOrder and b.ProcessRankId=d.RankId and c.UserDepartmentId=e.DepartmentId
   order by ExamineNumber
END
GO
/****** Object:  StoredProcedure [dbo].[WorkLoadProjects_SelectByWorkLoadProjectsUserCardId]    Script Date: 12/07/2016 16:56:31 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
/*********************
--: WorkLoadProjects_SelectByWorkLoadProjectsUserCardId
--: WorkLoadProjects, 
--: 
  UserCardId
--: 
	
--:
	0 - 
	-1 -  
**************/
CREATE PROCEDURE [dbo].[WorkLoadProjects_SelectByWorkLoadProjectsUserCardId]
	@UserCardId varchar(50)
	AS
begin
	 
	
	select b.UserName ,a.* ,c.DepartmentName 
	from WorkLoadProjects a,UserInfo b ,Department c
	where a.UserCardId=b.UserCardId and 
	a.UserCardId = @UserCardId and a.DepartmentId=c.DepartmentId  
	
end
GO
/****** Object:  StoredProcedure [dbo].[WorkLoadProjects_SelectByUserCardId]    Script Date: 12/07/2016 16:56:31 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
/*********************
--: WorkLoadProjects_SelectByUserCardId
--: WorkLoadProjects, 
--: 
  UserCardId
--: 
	
--:
	0 - 
	-1 -  
**************/
CREATE PROCEDURE [dbo].[WorkLoadProjects_SelectByUserCardId]
	@UserCardId varchar(50),
	@RankId int
	AS
begin
   declare
  @DepartmentId int,
      @TeachersDepartmentId int
   set @DepartmentId=(select UserDepartmentId from UserInfo where UserCardId=@UserCardId)
   set @TeachersDepartmentId=(select TeachersDepartmentId from UserInfo where UserCardId=@UserCardId)
   select a.*,b.UserName,c.DepartmentName,c.DepartmentName
   from WorkLoadProjects a left join UserInfo b on a.UserCardId=b.UserCardId
   left join Department c on a.DepartmentId=c.DepartmentId
   where  
 (
   a.ProcessDepartmentId=@DepartmentId
   and a.ProcessRankId= convert( varchar(50),@RankId))
   or (
   a.ProcessDepartmentId=@TeachersDepartmentId
   and a.ProcessRankId= convert( varchar(50),@RankId))
    
end
GO
/****** Object:  StoredProcedure [dbo].[WorkLoadProjects_SelectByPartnerUserNo]    Script Date: 12/07/2016 16:56:31 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
/*********************
--: WorkLoadProjects_SelectByPartnerUserNo
--: WorkLoadProjects, 
--: 
  UserCardId
--: 
	
--:
	0 - 
	-1 -  
**************/
CREATE PROCEDURE [dbo].[WorkLoadProjects_SelectByPartnerUserNo]
	@UserCardId varchar(50)
	AS
begin
	 
	
	select b.UserName ,a.* ,c.DepartmentName 
	from WorkLoadProjects a,UserInfo b ,Department c,WorkLoadProjectsPartner d
	where a.WorkLoadProjectsId=d.WorkLoadProjectsId and d.PartnerUserCardId=@UserCardId
	and d.PartnerUserCardId=b.UserCardId and b.UserDepartmentId=c.DepartmentId
	and a.TransferStatus=''
	
end
GO
/****** Object:  StoredProcedure [dbo].[WorkLoadProjects_SelectByPartnerUserCardId]    Script Date: 12/07/2016 16:56:31 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
/*********************
--: [WorkLoadProjects_SelectByPartnerUserCardId
--: WorkLoadProjects, 
--: 
  UserCardId
--: 
	
--:
	0 - 
	-1 -  
**************/
CREATE PROCEDURE [dbo].[WorkLoadProjects_SelectByPartnerUserCardId]
	@UserCardId varchar(50),
	@ApplyYearId int
	AS
begin
	 
	
	select b.UserName ,a.* ,c.DepartmentName ,d.PartnerValue,d.PartnerRank
	from WorkLoadProjects a,UserInfo b ,Department c,WorkLoadProjectsPartner d
	where d.PartnerUserCardId=b.UserCardId and 
	d.PartnerUserCardId = @UserCardId and b.UserDepartmentId=c.DepartmentId
	and a.WorkLoadProjectsId=d.WorkLoadProjectsId  and a.ApplyYearId=@ApplyYearId and a.TransferStatus=''
	
end
GO
/****** Object:  StoredProcedure [dbo].[WorkLoadProjects_SelectByPartnerUser]    Script Date: 12/07/2016 16:56:31 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
/*********************
--: WorkLoadProjects_SelectByPartnerUser
--: WorkLoadProjects, 
--: 
  UserCardId
--: 
	
--:
	0 - 
	-1 -  
**************/
CREATE PROCEDURE [dbo].[WorkLoadProjects_SelectByPartnerUser]
	@UserCardId varchar(50)
	AS
begin
	 
	
	select b.UserName ,a.* ,c.DepartmentName ,d.PartnerRank,d.PartnerValue
	from WorkLoadProjects a,UserInfo b ,Department c,WorkLoadProjectsPartner d
	where   d.PartnerUserCardId=@UserCardId and a.WorkLoadProjectsId=d.WorkLoadProjectsId
	and a.UserCardId=b.UserCardId and b.UserDepartmentId=c.DepartmentId
	
end
GO
/****** Object:  StoredProcedure [dbo].[WorkLoadProjects_SelectByMyUserCardId]    Script Date: 12/07/2016 16:56:31 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
/*********************
--: WorkLoadProjects_SelectByWorkLoadProjectsUserCardId
--: WorkLoadProjects, 
--: 
  UserCardId
--: 
	
--:
	0 - 
	-1 -  
**************/
CREATE PROCEDURE [dbo].[WorkLoadProjects_SelectByMyUserCardId]
	@UserCardId varchar(50)
	AS
begin

	select b.UserName ,a.* ,c.DepartmentName
	from WorkLoadProjects a,UserInfo b ,Department c
	where    a.UserCardId=@UserCardId
	and a.UserCardId=b.UserCardId and b.UserDepartmentId=c.DepartmentId
		and a.TransferStatus=''
end
GO
/****** Object:  StoredProcedure [dbo].[WinningExamine_Select]    Script Date: 12/07/2016 16:56:31 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
/*********************
--: WinningExamine_Select
--: WinningExamine, 
--: 
  WinningId
--: 
	
--:
	0 - 
	-1 -  
**************/
CREATE PROCEDURE [dbo].[WinningExamine_Select]
@WinningId int
AS
BEGIN

 select a.*,c.UserName,d.RankName,e.DepartmentName
 from WinningExamine a,WinningAuditProcess b,UserInfo c,Rank d,Department e
 where a.WinningId=@WinningId and a.WinningId=b.WinningId and a.ExamineUserCardId=c.UserCardId 
 and a.ExamineNumber=b.ProcessOrder and b.ProcessRankId=d.RankId and c.UserDepartmentId=e.DepartmentId
   order by ExamineNumber
END
GO
/****** Object:  StoredProcedure [dbo].[Winning_SelectByWinningUserCardId]    Script Date: 12/07/2016 16:56:31 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
/*********************
--: Winning_SelectByWinningUserCardId
--: Winning, 
--: 
  UserCardId
--: 
	
--:
	0 - 
	-1 -  
**************/
CREATE PROCEDURE [dbo].[Winning_SelectByWinningUserCardId]
	@UserCardId varchar(50)
	AS
begin
	 
	
	select b.UserName ,a.* ,c.DepartmentName 
	from Winning a,UserInfo b ,Department c
	where a.UserCardId=b.UserCardId and 
	a.UserCardId = @UserCardId and a.DepartmentId=c.DepartmentId  
	
end
GO
/****** Object:  StoredProcedure [dbo].[Winning_SelectByUserCardId]    Script Date: 12/07/2016 16:56:31 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
/*********************
--: Winning_SelectByUserCardId
--: Winning, 
--: 
  UserCardId
--: 
	
--:
	0 - 
	-1 -  
**************/
CREATE PROCEDURE [dbo].[Winning_SelectByUserCardId]
	@UserCardId varchar(50),
	@RankId int
	AS
begin
   declare
   @DepartmentId int,
      @TeachersDepartmentId int
   set @DepartmentId=(select UserDepartmentId from UserInfo where UserCardId=@UserCardId)
   set @TeachersDepartmentId=(select TeachersDepartmentId from UserInfo where UserCardId=@UserCardId)
   select a.*,b.UserName,c.DepartmentName,c.DepartmentName
   from Winning a left join UserInfo b on a.UserCardId=b.UserCardId
   left join Department c on  a.DepartmentId=c.DepartmentId
   where (
   a.ProcessDepartmentId=@DepartmentId
   and a.ProcessRoleId= convert( varchar(50),@RankId))
   or (
   a.ProcessDepartmentId=@TeachersDepartmentId
   and a.ProcessRoleId= convert( varchar(50),@RankId))
    
end
GO
/****** Object:  StoredProcedure [dbo].[Winning_SelectByPartnerUserNo]    Script Date: 12/07/2016 16:56:31 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
/*********************
--:Winning_SelectByPartnerUserNo
--: Winning, 
--: 
  UserCardId
--: 
	
--:
	0 - 
	-1 -  
**************/
CREATE PROCEDURE [dbo].[Winning_SelectByPartnerUserNo]
	@UserCardId varchar(50)
	AS
begin
	 
	
	select b.UserName ,a.* ,c.DepartmentName 
	from Winning a,UserInfo b ,Department c,WinningPartner d
	where a.WinningId=d.WinningId and d.PartnerUserCardId=@UserCardId
	and d.PartnerUserCardId=b.UserCardId and b.UserDepartmentId=c.DepartmentId
	and a.TransferStatus=''
	
end
GO
/****** Object:  StoredProcedure [dbo].[Winning_SelectByPartnerUserCardId]    Script Date: 12/07/2016 16:56:31 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
/*********************
--: Winning_SelectByPartnerUserCardId
--: Winning, 
--: 
  UserCardId
--: 
	
--:
	0 - 
	-1 -  
**************/
CREATE PROCEDURE [dbo].[Winning_SelectByPartnerUserCardId]
	@UserCardId varchar(50),
	@ApplyYearId int
	AS
begin
	 
	
	select b.UserName ,a.* ,c.DepartmentName ,d.PartnerValue,d.PartnerRank
	from Winning a,UserInfo b ,Department c,WinningPartner d
	where d.PartnerUserCardId=b.UserCardId and 
	d.PartnerUserCardId = @UserCardId and b.UserDepartmentId=c.DepartmentId
	and a.WinningId=d.WinningId  and a.ApplyYearId=@ApplyYearId and a.TransferStatus=''
	
end
GO
/****** Object:  StoredProcedure [dbo].[Winning_SelectByPartnerUser]    Script Date: 12/07/2016 16:56:31 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
/*********************
--: Winning_SelectByPartnerUser
--: Winning, 
--: 
  UserCardId
--: 
	
--:
	0 - 
	-1 -  
**************/
CREATE PROCEDURE [dbo].[Winning_SelectByPartnerUser]
	@UserCardId varchar(50)
	AS
begin
	 
	
	select b.UserName ,a.* ,c.DepartmentName ,d.PartnerRank,d.PartnerValue
	from Winning a,UserInfo b ,Department c,WinningPartner d
	where   d.PartnerUserCardId=@UserCardId and a.WinningId=d.WinningId
	and a.UserCardId=b.UserCardId and b.UserDepartmentId=c.DepartmentId
	
end
GO
/****** Object:  StoredProcedure [dbo].[Winning_SelectByMyUserCardId]    Script Date: 12/07/2016 16:56:31 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
/*********************
--: Winning_SelectByWinningUserCardId
--: Winning, 
--: 
  UserCardId
--: 
	
--:
	0 - 
	-1 -  
**************/
CREATE PROCEDURE [dbo].[Winning_SelectByMyUserCardId]
	@UserCardId varchar(50)
	AS
begin

	select b.UserName ,a.* ,c.DepartmentName
	from Winning a,UserInfo b ,Department c
	where    a.UserCardId=@UserCardId
	and a.UserCardId=b.UserCardId and b.UserDepartmentId=c.DepartmentId
		and a.TransferStatus=''
end
GO
/****** Object:  StoredProcedure [dbo].[UserInfo_SelectDepartment]    Script Date: 12/07/2016 16:56:30 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
/******
-- UserInfo_SelectDepartment
-- 
-- 
-- RoleId     
-- 
--    @RoleSum
--     0
--     1
--     2
--     3

******/
CREATE PROCEDURE [dbo].[UserInfo_SelectDepartment]

AS
begin


select count(b.UserDepartmentId) as ActualProple,a.DepartmentName as Name
from Department a,UserInfo b where a.DepartmentId=b.UserDepartmentId
group by a.DepartmentName

end
GO
/****** Object:  StoredProcedure [dbo].[UserInfo_SelectByUserCardId]    Script Date: 12/07/2016 16:56:30 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
/******
--: UserInfo_SelectByUserCardId]
--: UserInfo, 
--: 
--UserCardId
--: 
	
--:
	0 - 
	-1 -  
******/
CREATE PROCEDURE [dbo].[UserInfo_SelectByUserCardId]
	@UserCardId varchar(50)
AS
begin
select a.*,c.JobName,d.PostName,e.DepartmentName
from UserInfo a left join UseJobPost b on a.UserCardId=b.UserCardId
left join Job c on b.JobId=c.JobId left join Post d on b.PostId=d.PostId
left join Department e on a.UserDepartmentId=e.DepartmentId
where a.UserCardId=@UserCardId

end
GO
/****** Object:  StoredProcedure [dbo].[UseJobPost_SelectByUserCardId]    Script Date: 12/07/2016 16:56:30 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
/******
--: UserJobPost_SelectByUserCardId
--: UseJobPost, 
--: 
UserCardId
--: 
	
--:
	0 - 
	-1 -  
******/
CREATE PROCEDURE [dbo].[UseJobPost_SelectByUserCardId]
@UserCardId varchar(50)
AS
begin

		select distinct  a.*,b.DepartmentName,c.JobName,d.PostName,d.PlanPeople
		,a.JobDate,a.JobSeries,a.WorkLevel,a.IsCurrent
		from   UseJobPost a left join Department b on a.DepartmentId=b.DepartmentId
		left join Job c on a.JobId=c.JobId
		left join Post d on a.PostId=d.PostId
		where UserCardId=@UserCardId
		order by UseJobPostId

end
GO
/****** Object:  StoredProcedure [dbo].[TeachingExamine_Select]    Script Date: 12/07/2016 16:56:30 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
/*********************
--: TeachingExamine_Select
--: TeachingExamine, 
--: 
  TeachingId
--: 
	
--:
	0 - 
	-1 -  
**************/
CREATE PROCEDURE [dbo].[TeachingExamine_Select]
@TeachingId int
AS
BEGIN

 select a.*,c.UserName,d.RankName,e.DepartmentName
 from TeachingExamine a,TeachingAuditProcess b,UserInfo c,Rank d,Department e
 where a.TeachingId=@TeachingId and a.TeachingId=b.TeachingId and a.ExamineUserCardId=c.UserCardId 
 and a.ExamineNumber=b.ProcessOrder and b.ProcessRankId=d.RankId and c.UserDepartmentId=e.DepartmentId
   order by ExamineNumber
END
GO
/****** Object:  StoredProcedure [dbo].[Teaching_SelectByUserCardId]    Script Date: 12/07/2016 16:56:30 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
/*********************
--: Teaching_SelectByUserCardId
--: Teaching, 
--: 
  UserCardId
--: 
	
--:
	0 - 
	-1 -  
**************/
CREATE PROCEDURE [dbo].[Teaching_SelectByUserCardId]
	@UserCardId varchar(50),
	@RankId int
	AS
begin
   declare
   @DepartmentId int,
   @TeachersDepartmentId int
   set @DepartmentId=(select UserDepartmentId from UserInfo where UserCardId=@UserCardId)
   set @TeachersDepartmentId=(select TeachersDepartmentId from UserInfo where UserCardId=@UserCardId)
   select a.*,b.UserName,c.DepartmentName,c.DepartmentName
   from Teaching a left join Userinfo b on a.UserCardId=b.UserCardId
    left join Department c on a.DepartmentId=c.DepartmentId
   where
 (  a.ProcessDepartmentId=@DepartmentId 
   and  a.ProcessRoleId=CONVERT(varchar, @RankId)) or  
   (  a.ProcessDepartmentId=@TeachersDepartmentId 
   and a.ProcessRoleId=CONVERT(varchar, @RankId))
    
end
GO
/****** Object:  StoredProcedure [dbo].[Teaching_SelectByTeachingUserCardId]    Script Date: 12/07/2016 16:56:30 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
/*********************
--: Teaching_SelectByTeachingUserCardId
--: Teaching, 
--: 
  UserCardId
--: 
	
--:
	0 - 
	-1 -  
**************/
CREATE PROCEDURE [dbo].[Teaching_SelectByTeachingUserCardId]
	@UserCardId varchar(50)
	AS
begin
	 
	
	select b.UserName ,a.* ,c.DepartmentName 
	from Teaching a,UserInfo b ,Department c
	where a.UserCardId=b.UserCardId and 
	a.UserCardId = @UserCardId and a.DepartmentId=c.DepartmentId  
	
end
GO
/****** Object:  StoredProcedure [dbo].[Teaching_SelectByPartnerUserNo]    Script Date: 12/07/2016 16:56:30 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
/*********************
--: Teaching_SelectByPartnerUserNo
--: Teaching, 
--: 
  UserCardId
--: 
	
--:
	0 - 
	-1 -  
**************/
CREATE PROCEDURE [dbo].[Teaching_SelectByPartnerUserNo]
	@UserCardId varchar(50)
	AS
begin
	 
	
	select b.UserName ,a.* ,c.DepartmentName 
	from Teaching a,UserInfo b ,Department c,TeachingPartner d
	where a.TeachingId=d.TeachingId and d.PartnerUserCardId=@UserCardId
	and d.PartnerUserCardId=b.UserCardId and b.UserDepartmentId=c.DepartmentId
	and a.TransferStatus=''
	
end
GO
/****** Object:  StoredProcedure [dbo].[Teaching_SelectByPartnerUserCardId]    Script Date: 12/07/2016 16:56:30 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
/*********************
--: Teaching_SelectByPartnerUserCardId
--: Teaching, 
--: 
  UserCardId
--: 
	
--:
	0 - 
	-1 -  
**************/
CREATE PROCEDURE [dbo].[Teaching_SelectByPartnerUserCardId]
	@UserCardId varchar(50),
	@ApplyYearId int
	AS
begin
	 
	
	select b.UserName ,a.* ,c.DepartmentName ,d.PartnerValue,d.PartnerRank
	from Teaching a,UserInfo b ,Department c,TeachingPartner d
	where d.PartnerUserCardId=b.UserCardId and 
	d.PartnerUserCardId = @UserCardId and b.UserDepartmentId=c.DepartmentId
	and a.TeachingId=d.TeachingId  and a.ApplyYearId=@ApplyYearId and a.TransferStatus=''
	
end
GO
/****** Object:  StoredProcedure [dbo].[Teaching_SelectByPartnerUser]    Script Date: 12/07/2016 16:56:30 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
/*********************
--: Teaching_SelectByTeachingUserCardId
--: Teaching, 
--: 
  UserCardId
--: 
	
--:
	0 - 
	-1 -  
**************/
CREATE PROCEDURE [dbo].[Teaching_SelectByPartnerUser]
	@UserCardId varchar(50)
	AS
begin
	 
	
	--select b.UserName ,a.* ,c.DepartmentName 
	--from Teaching a,UserInfo b ,Department c
	--where   a.UserCardId=@UserCardId
	--and a.UserCardId=b.UserCardId and b.UserDepartmentId=c.DepartmentId
	select b.UserName ,a.* ,c.DepartmentName,d.PartnerRank,d.PartnerValue
	from Teaching a,UserInfo b ,Department c,TeachingPartner d
	where   a.TeachingId=d.TeachingId and d.PartnerUserCardId=@UserCardId
	and a.UserCardId=b.UserCardId and b.UserDepartmentId=c.DepartmentId
end
GO
/****** Object:  StoredProcedure [dbo].[Teaching_SelectByMyUserCardId]    Script Date: 12/07/2016 16:56:30 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
/*********************
--: Teaching_SelectByTeachingUserCardId
--: Teaching, 
--: 
  UserCardId
--: 
	
--:
	0 - 
	-1 -  
**************/
CREATE PROCEDURE [dbo].[Teaching_SelectByMyUserCardId]
	@UserCardId varchar(50)
	AS
begin
	 
	
	--select b.UserName ,a.* ,c.DepartmentName 
	--from Teaching a,UserInfo b ,Department c
	--where   a.UserCardId=@UserCardId
	--and a.UserCardId=b.UserCardId and b.UserDepartmentId=c.DepartmentId
	select b.UserName ,a.* ,c.DepartmentName
	from Teaching a,UserInfo b ,Department c
	where    a.UserCardId=@UserCardId
	and a.UserCardId=b.UserCardId and b.UserDepartmentId=c.DepartmentId
		and a.TransferStatus=''
end
GO
/****** Object:  StoredProcedure [dbo].[ShortProjectsStandExamine_Select]    Script Date: 12/07/2016 16:56:30 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
/*********************
--: ShortProjectsDeclareExamine_Select
--: ShortProjectsDeclareExamine, 
--
--: 
  ShortProjectsId
--: 
	
--:
	0 - 
	-1 -  
**************/
CREATE PROCEDURE [dbo].[ShortProjectsStandExamine_Select]
@ShortProjectsId varchar(50)
AS
BEGIN

 select a.*,c.UserName,d.RankName,e.DepartmentName
from ShortProjectsStandExamine a,ShortProjectsStandAuditProcess b,UserInfo c,Rank d,Department e
where a.ShortProjectsId=@ShortProjectsId and a.ShortProjectsId=b.ShortProjectsId and a.ExamineUserCardId=c.UserCardId 
 and a.ExamineNumber=b.ProcessOrder and b.ProcessRankId=d.RankId and c.UserDepartmentId=e.DepartmentId
   order by ExamineNumber


END
GO
/****** Object:  StoredProcedure [dbo].[ShortProjectsStand_SelectByUserCardId]    Script Date: 12/07/2016 16:56:30 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
/*********************
--: ShortProjects_SelectByUserCardId
--: ShortProjects, 
--
--: 
  UserCardId
--: 
	
--:
	0 - 
	-1 -  
**************/
CREATE PROCEDURE [dbo].[ShortProjectsStand_SelectByUserCardId]
	@UserCardId varchar(50),
	@RankId varchar(50)
	AS
begin
   declare
     @DepartmentId int,
      @TeachersDepartmentId int
   set @DepartmentId=(select UserDepartmentId from UserInfo where UserCardId=@UserCardId)
   set @TeachersDepartmentId=(select TeachersDepartmentId from UserInfo where UserCardId=@UserCardId)

   
   select a.*,b.UserName,c.DepartmentName,c.DepartmentName
   from ShortProjects a left join UserInfo b on  a.UserCardId=b.UserCardId
   left join Department c on a.DepartmentId=c.DepartmentId
   left join ShortProjectsStandWaitExamine d on a.ShortProjectsId=d.ShortProjectsId
   where 
   (  d.ProcessDepartmentId=@DepartmentId
   and d.ProcessRankId=convert( varchar(50),@RankId)) or(   d.ProcessDepartmentId=@TeachersDepartmentId
   and d.ProcessRankId=convert( varchar(50),@RankId))
 
  
    
end
GO
/****** Object:  StoredProcedure [dbo].[ShortProjectsEndExamine_Select]    Script Date: 12/07/2016 16:56:30 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
/*********************
--: ShortProjectsDeclareExamine_Select
--: ShortProjectsDeclareExamine, 
--
--: 
  ShortProjectsId
--: 
	
--:
	0 - 
	-1 -  
**************/
CREATE PROCEDURE [dbo].[ShortProjectsEndExamine_Select]
@ShortProjectsId varchar(50)
AS
BEGIN

 select a.*,c.UserName,d.RankName,e.DepartmentName
from ShortProjectsEndExamine a,ShortProjectsEndAuditProcess b,UserInfo c,Rank d,Department e
where a.ShortProjectsId=@ShortProjectsId and a.ShortProjectsId=b.ShortProjectsId and a.ExamineUserCardId=c.UserCardId 
 and a.ExamineNumber=b.ProcessOrder and b.ProcessRankId=d.RankId and c.UserDepartmentId=e.DepartmentId
   order by ExamineNumber


END
GO
/****** Object:  StoredProcedure [dbo].[ShortProjectsEnd_SelectByUserCardId]    Script Date: 12/07/2016 16:56:30 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
/*********************
--: ShortProjects_SelectByUserCardId
--: ShortProjects, 
--
--: 
  UserCardId
--: 
	
--:
	0 - 
	-1 -  
**************/
CREATE PROCEDURE [dbo].[ShortProjectsEnd_SelectByUserCardId]
	@UserCardId varchar(50),
	@RankId varchar(50)
	AS
begin
   declare
      @DepartmentId int,
      @TeachersDepartmentId int
   set @DepartmentId=(select UserDepartmentId from UserInfo where UserCardId=@UserCardId)
   set @TeachersDepartmentId=(select TeachersDepartmentId from UserInfo where UserCardId=@UserCardId)

   
   select a.*,b.UserName,c.DepartmentName,c.DepartmentName
   from ShortProjects a left join UserInfo b on a.UserCardId=b.UserCardId
   left join Department c on a.DepartmentId=c.DepartmentId
   left join ShortProjectsEndWaitExamine d on a.ShortProjectsId=d.ShortProjectsId
   where  
  ( d.ProcessDepartmentId=@DepartmentId
   and d.ProcessRankId=convert( varchar(50),@RankId)
 ) or(  d.ProcessDepartmentId=@TeachersDepartmentId
   and d.ProcessRankId=convert( varchar(50),@RankId)
 )
    
end
GO
/****** Object:  StoredProcedure [dbo].[ShortProjects_SelectCanEnd]    Script Date: 12/07/2016 16:56:30 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
/*********************
--: ShortProjects_SelectByUserCardId
--: ShortProjects, 
--
--: 
  UserCardId
--: 
	
--:
	0 - 
	-1 -  
**************/
CREATE PROCEDURE [dbo].[ShortProjects_SelectCanEnd]
@UserCardId varchar(50)
	AS
begin
  
   select a.*,e.UserName,f.DepartmentName
  from ShortProjects a,UserInfo e,Department f
  where 
  a.UserCardId=e.UserCardId and a.DepartmentId=f.DepartmentId
  and a.StandStatus=''
  and a.EndStatus=''
  and a.UserCardId=@UserCardId

    
end
GO
/****** Object:  StoredProcedure [dbo].[ShortCapitalPlanExamine_Select]    Script Date: 12/07/2016 16:56:30 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
/*********************
--: ShortCapitalPlanExamine_Select
--: ShortCapitalPlanExamine, 
--: 
  ShortProjectsId
--: 
	
--:
	0 - 
	-1 -  
**************/
CREATE PROCEDURE [dbo].[ShortCapitalPlanExamine_Select]
@ShortProjectsId varchar(50)
AS
BEGIN

 select a.*,c.UserName,d.RankName,e.DepartmentName
 from ShortCapitalPlanExamine a,ShortCapitalPlanAuditProcess b,UserInfo c,Rank d,Department e
 where a.ShortProjectsId=@ShortProjectsId and a.ShortProjectsId=b.ShortProjectsId and a.ExamineUserCardId=c.UserCardId 
 and a.ExamineNumber=b.ProcessOrder and b.ProcessRankId=d.RankId and c.UserDepartmentId=e.DepartmentId
   order by ExamineNumber
END
GO
/****** Object:  StoredProcedure [dbo].[ShortCapitalPlan_SelectByUserCardId]    Script Date: 12/07/2016 16:56:30 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
/*********************
--: ShortCapitalPlan_SelectByUserCardId
--: ShortCapitalPlan, 
--: 
  UserCardId
--: 
	
--:
	0 - 
	-1 -  
**************/
CREATE PROCEDURE [dbo].[ShortCapitalPlan_SelectByUserCardId]
	@UserCardId varchar(50),
	@RankId int
	AS
begin
   declare
     @DepartmentId int,
      @TeachersDepartmentId int
   set @DepartmentId=(select UserDepartmentId from UserInfo where UserCardId=@UserCardId)
   set @TeachersDepartmentId=(select TeachersDepartmentId from UserInfo where UserCardId=@UserCardId)

  select a.*,b.UserName,c.DepartmentName,c.DepartmentName,d.Company,d.ContractId,d.ContractMoney,d.ContractName,g.*
   from ShortCapitalPlan a left join UserInfo b on a.UserCardId=b.UserCardId
   left join Department c on a.DepartmentId=c.DepartmentId
   left join ShortProjects d on a.ShortProjectsId=d.ShortProjectsId
   left join ShortCapitalPlanWaitExamine e on a.ShortProjectsId=e.ShortProjectsId
   left join ShortProjects f on a.ShortProjectsId=f.ShortProjectsId
   left join ShortCapitalBasic g on a.ShortProjectsId=g.ShortProjectsId
   where  
  ( e.ProcessDepartmentId=@DepartmentId 
   and e.ProcessRankId=convert( varchar(50),@RankId) ) or(  e.ProcessDepartmentId=@TeachersDepartmentId 
   and e.ProcessRankId=convert( varchar(50),@RankId) )
    
end
GO
/****** Object:  StoredProcedure [dbo].[ShortCapitalPlace_SelectCanUpdate]    Script Date: 12/07/2016 16:56:30 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
/******
--: AdminSeries_Select
--: AdminSeries, 
--
--: 
--: 
	
--:
	0 - 
	-1 -  
******/
CREATE PROCEDURE [dbo].[ShortCapitalPlace_SelectCanUpdate]
AS
begin

select a.ShortProjectsId,e.UserName,a.Company,a.ContractId,a.ContractMoney,a.ContractName ,d.DepartmentName,b.SuedCompany,b.Servicelife,b.SumMoney ,SUM(g.PlaceMoney)as SumPlaceMoney
 from ShortProjects a,ShortCapitalBasic b,ShortCapitalPlan f left join ShortCapitalplace g on f.ShortProjectsId=g.ShortProjectsId,
		Department d,UserInfo e
		where a.StandStatus=''
		and a.ShortProjectsId=b.ShortProjectsId
		and a.ShortProjectsId=f.ShortProjectsId
		and a.EndStatus=''
		and a.DepartmentId=d.DepartmentId
		and a.UserCardId=e.UserCardId
		group by a.ShortProjectsId,e.UserName,a.Company,a.ContractId,a.ContractMoney,a.ContractName ,d.DepartmentName,b.SuedCompany,b.Servicelife,b.SumMoney
		
	

end
GO
/****** Object:  StoredProcedure [dbo].[ShortCapitalPlace_SelectByUserCardId]    Script Date: 12/07/2016 16:56:30 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
/*********************
--: CapitalPlace_SelectByProjectsId
--: CapitalPlace, 
--: 

--: 
	
--:
	0 - 
	-1 -  
**************/
CREATE PROCEDURE [dbo].[ShortCapitalPlace_SelectByUserCardId]
@UserCardId varchar(50)
	AS
BEGIN

	select a.ShortProjectsId,e.UserName,a.Company,a.ContractId,a.ContractMoney,a.ContractName ,d.DepartmentName,b.SuedCompany,b.Servicelife,b.SumMoney ,SUM(g.PlaceMoney)as SumPlaceMoney
	 from ShortProjects a,ShortCapitalBasic b,ShortCapitalPlan f left join ShortCapitalplace g on f.ShortProjectsId=g.ShortProjectsId,
		Department d,UserInfo e
		where a.StandStatus=''
		and a.ShortProjectsId=b.ShortProjectsId
		and a.ShortProjectsId=f.ShortProjectsId
		and a.EndStatus=''
		and a.DepartmentId=d.DepartmentId
		and a.UserCardId=e.UserCardId
		and a.UserCardId=@UserCardId
		group by a.ShortProjectsId,e.UserName ,a.Company,a.ContractId,a.ContractMoney,a.ContractName,d.DepartmentName,b.SuedCompany,b.Servicelife,b.SumMoney
		

END
GO
/****** Object:  StoredProcedure [dbo].[ShortCapitalCloseExamine_Select]    Script Date: 12/07/2016 16:56:30 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
/*********************
--: ShortCapitalCloseExamine_Select
--: ShortCapitalCloseExamine, 
--: 
  ShortProjectsId
--: 
	
--:
	0 - 
	-1 -  
**************/
CREATE PROCEDURE [dbo].[ShortCapitalCloseExamine_Select]
@ShortProjectsId varchar(50)
AS
BEGIN

 select a.*,c.UserName,d.RankName,e.DepartmentName
 from ShortCapitalCloseExamine a,ShortCapitalCloseAuditProcess b,UserInfo c,Rank d,Department e
 where a.ShortProjectsId=@ShortProjectsId and a.ShortProjectsId=b.ShortProjectsId and a.ExamineUserCardId=c.UserCardId 
 and a.ExamineNumber=b.ProcessOrder and b.ProcessRankId=d.RankId and c.UserDepartmentId=e.DepartmentId
   order by ExamineNumber
END
GO
/****** Object:  StoredProcedure [dbo].[ShortCapitalClose_SelectByUserCardId]    Script Date: 12/07/2016 16:56:30 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
/*********************
--: ShortCapitalClose_SelectByUserCardId
--: ShortCapitalClose, 
--: 
  UserCardId
--: 
	
--:
	0 - 
	-1 -  
**************/
CREATE PROCEDURE [dbo].[ShortCapitalClose_SelectByUserCardId]
	@UserCardId varchar(50),
	@RankId int
	AS
begin
   declare
   @DepartmentId int,
      @TeachersDepartmentId int
   set @DepartmentId=(select UserDepartmentId from UserInfo where UserCardId=@UserCardId)
   set @TeachersDepartmentId=(select TeachersDepartmentId from UserInfo where UserCardId=@UserCardId)
     select a.*,b.UserName,c.DepartmentName,c.DepartmentName,d.Company,d.ContractId,d.ContractMoney,d.ContractName,g.*
   from ShortCapitalClose a left join UserInfo b on  a.UserCardId=b.UserCardId
   left join Department c on a.DepartmentId=c.DepartmentId
   left join ShortProjects d on a.ShortProjectsId=d.ShortProjectsId
   left join ShortCapitalCloseWaitExamine e on a.ShortProjectsId=e.ShortProjectsId 
   left join ShortProjects f on a.ShortProjectsId=f.ShortProjectsId
   left join ShortCapitalBasic g on a.ShortProjectsId=g.ShortProjectsId
   where 
   (e.ProcessDepartmentId=@DepartmentId  
   and e.ProcessRankId=convert( varchar(50),@RankId))or (e.ProcessDepartmentId=@TeachersDepartmentId  
   and e.ProcessRankId=convert( varchar(50),@RankId) )
   
end
GO
/****** Object:  StoredProcedure [dbo].[ShortCapitalChangeExamine_Select]    Script Date: 12/07/2016 16:56:30 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
/*********************
--: ShortCapitalChangeExamine_Select
--: ShortCapitalChangeExamine, 
--: 
  ShortProjectsId
--: 
	
--:
	0 - 
	-1 -  
**************/
CREATE PROCEDURE [dbo].[ShortCapitalChangeExamine_Select]
@ShortProjectsId varchar(50)
AS
BEGIN

 select a.*,c.UserName,d.RankName,e.DepartmentName
 from ShortCapitalChangeExamine a,ShortCapitalChangeAuditProcess b,UserInfo c,Rank d,Department e
 where a.ShortProjectsId=@ShortProjectsId and a.ShortProjectsId=b.ShortProjectsId and a.ExamineUserCardId=c.UserCardId 
 and a.ExamineNumber=b.ProcessOrder and b.ProcessRankId=d.RankId and c.UserDepartmentId=e.DepartmentId
   order by ExamineNumber
END
GO
/****** Object:  StoredProcedure [dbo].[ShortCapitalChangeProcess_Insert]    Script Date: 12/07/2016 16:56:30 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
/*********************
--: ShortCapitalChangeProcess_Insert
--: ShortCapitalChangeProcess, 
--: 
ShortCapitalChangeRoleId,ProcessRoleId,ProcessOrder
--: 
	
--:
	0 - 
	-1 -  
**************/
CREATE PROCEDURE [dbo].[ShortCapitalChangeProcess_Insert]
	@ProcessRankId int,
	@ProcessOrder int,
	@ProcessDepartment varchar(50),
	@UserCardId varchar(50)
AS
begin
	begin tran
   declare 
   @MaxOrder int
  if  exists(select * from ShortCapitalChangeProcess where  ProcessRankId=@ProcessRankId and ProcessDepartment=@ProcessDepartment)
begin
return -1
end
 else
begin
--0
if exists(select * from ShortCapitalChangeProcess)
begin
  set @MaxOrder=(select MAX(ProcessOrder) from ShortCapitalChangeProcess)
end
else
begin
set @MaxOrder=0
end  
   if(@ProcessOrder>@MaxOrder)
   begin
   set @ProcessOrder=@MaxOrder+1
   insert into ShortCapitalChangeProcess ( ProcessRankId,ProcessOrder,ProcessDepartment)values
   (@ProcessRankId,@ProcessOrder,@ProcessDepartment)
end else
begin


   update ShortCapitalChangeProcess 
   set ProcessOrder=ProcessOrder+1
   where ProcessOrder>=@ProcessOrder
    insert into ShortCapitalChangeProcess ( ProcessRankId,ProcessOrder,ProcessDepartment)values
   (@ProcessRankId,@ProcessOrder,@ProcessDepartment)

   end
   exec [dbo].[Journal_Insert] @UserCardId,'',''
end
		
		if(@@ERROR<>0)
			begin
				rollback
				return -1
			end
	commit tran
	return 0
end
GO
/****** Object:  StoredProcedure [dbo].[ShortCapitalChangeProcess_Delete]    Script Date: 12/07/2016 16:56:30 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
/*********************
--: ShortCapitalChangeProcess_Delete
--: ShortCapitalChangeProcess, 
--: 
  ShortCapitalChangeProcessId 
--: 
	
--:
	0 - 
	-1 -  
**************/
CREATE PROCEDURE [dbo].[ShortCapitalChangeProcess_Delete]
@ShortCapitalChangeProcessId int,
@UserCardId varchar(50)
AS
begin
	begin tran
	declare 
	@ProcessOrder int	
	set @ProcessOrder=(select ProcessOrder from ShortCapitalChangeProcess where ShortCapitalChangeProcessId=@ShortCapitalChangeProcessId)
	
	delete ShortCapitalChangeProcess 
	where ShortCapitalChangeProcessId=@ShortCapitalChangeProcessId 
     
    update ShortCapitalChangeProcess 
    set ProcessOrder=ProcessOrder-1
    where  ProcessOrder>@ProcessOrder
    exec [dbo].[Journal_Insert] @UserCardId,'',''
		if(@@ERROR<>0)
			begin
				rollback
				return -1
			end
	commit tran
	return 0
end
GO
/****** Object:  StoredProcedure [dbo].[ShortProjectsProcess_Insert]    Script Date: 12/07/2016 16:56:30 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
/*********************
--: ShortProjectsProcess_Insert
--: ShortProjectsProcess, 
--: 
ShortProjectsRoleId,ProcessRoleId,ProcessOrder
--: 
	
--:
	0 - 
	-1 -  
**************/
CREATE PROCEDURE [dbo].[ShortProjectsProcess_Insert]
	@ProcessRankId int,
	@ProcessOrder int,
	@ProcessDepartment varchar(50),
	@UserCardId varchar(50)
AS
begin
	begin tran
   declare 
   @MaxOrder int --
    --
  if  exists(select * from ShortProjectsProcess where  ProcessRankId=@ProcessRankId and ProcessDepartment=@ProcessDepartment)
begin
return -1
end
 else
begin  
--0
   if exists(select * from ShortProjectsProcess)
begin
 set @MaxOrder=(select MAX(ProcessOrder) from ShortProjectsProcess)
end
else
begin
set @MaxOrder=0
end
--
   if(@ProcessOrder>@MaxOrder)
   begin
    --+1
   set @ProcessOrder=@MaxOrder+1
   insert into ShortProjectsProcess ( ProcessRankId,ProcessOrder,ProcessDepartment)values
   (@ProcessRankId,@ProcessOrder,@ProcessDepartment)
end else
begin


--+1
   update ShortProjectsProcess 
   set ProcessOrder=ProcessOrder+1
   where ProcessOrder>=@ProcessOrder
    insert into ShortProjectsProcess ( ProcessRankId,ProcessOrder,ProcessDepartment)values
   (@ProcessRankId,@ProcessOrder,@ProcessDepartment)

   end
    --
   exec [dbo].[Journal_Insert] @UserCardId,'',''
end
		
		if(@@ERROR<>0)
			begin
				rollback
				return -1
			end
	commit tran
	return 0
end
GO
/****** Object:  StoredProcedure [dbo].[ShortProjectsProcess_Delete]    Script Date: 12/07/2016 16:56:30 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
/*********************
--: ShortProjectsProcess_Delete
--: ShortProjectsProcess, 
--: 
  ShortProjectsProcessId 
--: 
	
--:
	0 - 
	-1 -  
**************/
CREATE PROCEDURE [dbo].[ShortProjectsProcess_Delete]
@ShortProjectsProcessId int,
@UserCardId varchar(50)
AS
begin
	begin tran
	declare 
	@ProcessOrder int	
	set @ProcessOrder=(select ProcessOrder from ShortProjectsProcess where ShortProjectsProcessId=@ShortProjectsProcessId)
	
	delete ShortProjectsProcess 
	where ShortProjectsProcessId=@ShortProjectsProcessId 
     
    update ShortProjectsProcess 
    set ProcessOrder=ProcessOrder-1
    where  ProcessOrder>@ProcessOrder
    exec [dbo].[Journal_Insert] @UserCardId,'',''
		if(@@ERROR<>0)
			begin
				rollback
				return -1
			end
	commit tran
	return 0
end
GO
/****** Object:  StoredProcedure [dbo].[ShortCapitalCloseProcess_Insert]    Script Date: 12/07/2016 16:56:30 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
/*********************
--: ShortCapitalCloseProcess_Insert
--: ShortCapitalCloseProcess, 
--: 
ShortCapitalCloseRoleId,ProcessRoleId,ProcessOrder
--: 
	
--:
	0 - 
	-1 -  
**************/
CREATE PROCEDURE [dbo].[ShortCapitalCloseProcess_Insert]
	@ProcessRankId int,
	@ProcessOrder int,
	@ProcessDepartment varchar(50),
	@UserCardId varchar(50)
AS
begin
	begin tran
   declare 
   @MaxOrder int
  if  exists(select * from ShortCapitalCloseProcess where  ProcessRankId=@ProcessRankId and ProcessDepartment=@ProcessDepartment)
begin
return -1
end
 else
begin
--0
if exists(select * from ShortCapitalCloseProcess)
begin
  set @MaxOrder=(select MAX(ProcessOrder) from ShortCapitalCloseProcess)
end
else
begin
set @MaxOrder=0
end  
   if(@ProcessOrder>@MaxOrder)
   begin
   set @ProcessOrder=@MaxOrder+1
   insert into ShortCapitalCloseProcess ( ProcessRankId,ProcessOrder,ProcessDepartment)values
   (@ProcessRankId,@ProcessOrder,@ProcessDepartment)
end else
begin


   update ShortCapitalCloseProcess 
   set ProcessOrder=ProcessOrder+1
   where ProcessOrder>=@ProcessOrder
    insert into ShortCapitalCloseProcess ( ProcessRankId,ProcessOrder,ProcessDepartment)values
   (@ProcessRankId,@ProcessOrder,@ProcessDepartment)

   end
   exec [dbo].[Journal_Insert] @UserCardId,'',''
end
		
		if(@@ERROR<>0)
			begin
				rollback
				return -1
			end
	commit tran
	return 0
end
GO
/****** Object:  StoredProcedure [dbo].[ShortCapitalCloseProcess_Delete]    Script Date: 12/07/2016 16:56:30 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
/*********************
--: ShortCapitalCloseProcess_Delete
--: ShortCapitalCloseProcess, 
--: 
  ShortCapitalCloseProcessId 
--: 
	
--:
	0 - 
	-1 -  
**************/
CREATE PROCEDURE [dbo].[ShortCapitalCloseProcess_Delete]
@ShortCapitalCloseProcessId int,
@UserCardId varchar(50)
AS
begin
	begin tran
	declare 
	@ProcessOrder int	
	set @ProcessOrder=(select ProcessOrder from ShortCapitalCloseProcess where ShortCapitalCloseProcessId=@ShortCapitalCloseProcessId)
	
	delete ShortCapitalCloseProcess 
	where ShortCapitalCloseProcessId=@ShortCapitalCloseProcessId 
     
    update ShortCapitalCloseProcess 
    set ProcessOrder=ProcessOrder-1
    where  ProcessOrder>@ProcessOrder
    exec [dbo].[Journal_Insert] @UserCardId,'',''
		if(@@ERROR<>0)
			begin
				rollback
				return -1
			end
	commit tran
	return 0
end
GO
/****** Object:  StoredProcedure [dbo].[ShortCapitalChangeAuditProcess_Insert]    Script Date: 12/07/2016 16:56:30 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
/*********************
--: ShortCapitalChangeAuditProcess_Insert
--: ShortCapitalChange, 
--: 
  ShortProjectsId,DepartmentId,
--: 
	
--:
	0 - 
	-1 -  
**************/
CREATE PROCEDURE [dbo].[ShortCapitalChangeAuditProcess_Insert]
@ShortProjectsId varchar(50)

AS
begin
	begin tran
	declare
	@UserCardId varchar(50),
	@DepartmentId int,
	@ProcessRankId int,
	@ProcessOrder int=1,
	@MaxOrder int
	set @UserCardId=(select UserCardId from ShortCapitalChange where ShortProjectsId=@ShortProjectsId)
	set @DepartmentId=(select DepartmentId from ShortCapitalChange where ShortProjectsId=@ShortProjectsId)
	

	while exists ( select * from ShortCapitalChangeProcess where ProcessOrder=@ProcessOrder )
	begin
    declare
    @ProcessDepartment varchar(50)
    set @ProcessDepartment=(select ProcessDepartment from ShortCapitalChangeProcess where ProcessOrder=@ProcessOrder)
	set @ProcessRankId=(select ProcessRankId from ShortCapitalChangeProcess where  ProcessOrder=@ProcessOrder)
	if(@ProcessDepartment='()')
	begin
	insert into ShortCapitalChangeAuditProcess(ShortProjectsId,ProcessDepartmentId,ProcessRankId,ProcessOrder)values
	(@ShortProjectsId,@DepartmentId,@ProcessRankId,@ProcessOrder)
	end

	else
	begin
	set @ProcessDepartment=(select DepartmentId From Department where DepartmentName=@ProcessDepartment)
	
	insert into ShortCapitalChangeAuditProcess(ShortProjectsId,ProcessDepartmentId,ProcessRankId,ProcessOrder)values
	(@ShortProjectsId,@ProcessDepartment,@ProcessRankId,@ProcessOrder)
	end
	set @ProcessOrder=@ProcessOrder+1
	end
		if(@@ERROR<>0)
			begin
				rollback
				return -1
			end
	commit tran
	return 0
end
GO
/****** Object:  StoredProcedure [dbo].[ShortCapitalChange_Insert]    Script Date: 12/07/2016 16:56:30 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
/*********************
--: ShortCapitalChange_Insert
--: ShortCapitalChange, 
--: 

--: 
	
--:
	0 - 
	-1 -  
**************/
CREATE PROCEDURE [dbo].[ShortCapitalChange_Insert]
@ShortProjectsId varchar(50),
@UserCardId varchar(50),
@FileUrl text
AS
begin
	begin tran
declare
	@DepartmentId int,
	@ProcessRoleId int
	set @DepartmentId=(select UserDepartmentId  from UserInfo where UserCardId=@UserCardId)	
	set @ProcessRoleId=(select ProcessRankId from ShortCapitalChangeProcess where  ProcessOrder=1)
		if exists(select * from ShortCapitalChangeProcess where  ProcessOrder=1)
	begin
	if not exists(select * from ShortCapitalChange where ShortProjectsId=@ShortProjectsId)
	begin
	
	insert into ShortCapitalChange(
  ShortProjectsId,UserCardId,DepartmentId,ShortCapitalChangeUrl
  )
  values
  (@ShortProjectsId,@UserCardId,@DepartmentId,@FileUrl
  )
  end
  else
  begin
  update ShortCapitalChange
  set ShortCapitalChangeUrl=@FileUrl
  where ShortProjectsId=@ShortProjectsId
  end
	delete ShortCapitalChangeAuditProcess
	where ShortProjectsId=@ShortProjectsId
	delete ShortCapitalChangeExamine
	where ShortProjectsId=@ShortProjectsId
	delete ShortCapitalChangeWaitExamine
	where ShortProjectsId=@ShortProjectsId

	exec[dbo].[ShortCapitalChangeAuditProcess_Insert] @ShortProjectsId
	set @DepartmentId=(select ProcessDepartmentId from ShortCapitalChangeAuditProcess where ShortProjectsId=@ShortProjectsId and ProcessOrder=1)
   set @ProcessRoleId=(select ProcessRankId from  ShortCapitalChangeAuditProcess where ShortProjectsId=@ShortProjectsId and ProcessOrder=1)
    exec[dbo].[ShortCapitalChange_UpdateStatus] @ShortProjectsId,'',@ProcessRoleId,@DepartmentId
	exec [dbo].[Journal_Insert] @UserCardId,'',''
	
	end
	

		if(@@ERROR<>0)
			begin
				rollback
				return -1
			end
	commit tran
	return 0
end
GO
/****** Object:  StoredProcedure [dbo].[ShortProjectsStandAuditProcess_Insert]    Script Date: 12/07/2016 16:56:30 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
/*********************
--: ShortProjectsAuditProcess_Insert
--: ShortProjects, 
--: 
  ShortProjectsId,DepartmentId,
--: 
	
--:
	0 - 
	-1 -  
**************/
CREATE PROCEDURE [dbo].[ShortProjectsStandAuditProcess_Insert]
@ShortProjectsId varchar(50)

AS
begin
	begin tran
	declare
	@DepartmentId int,--
	@ProcessRankId int,--
	@ProcessOrder int=1,--
	@MaxOrder int--
	set @DepartmentId=(select DepartmentId from ShortProjects where ShortProjectsId=@ShortProjectsId)--
	
	--
	while exists ( select * from ShortProjectsProcess where ProcessOrder=@ProcessOrder )
	begin
    declare
    @ProcessDepartment varchar(50)--
    set @ProcessDepartment=(select ProcessDepartment from ShortProjectsProcess where ProcessOrder=@ProcessOrder) --
	set @ProcessRankId=(select ProcessRankId from ShortProjectsProcess where  ProcessOrder=@ProcessOrder)--
	if(@ProcessDepartment='()') --
	begin
	--
	insert into ShortProjectsStandAuditProcess(ShortProjectsId,ProcessDepartmentId,ProcessRankId,ProcessOrder)values
	(@ShortProjectsId,@DepartmentId,@ProcessRankId,@ProcessOrder)
	end

	else
	begin
	--
	set @ProcessDepartment=(select DepartmentId From Department where DepartmentName=@ProcessDepartment)
	
	insert into ShortProjectsStandAuditProcess(ShortProjectsId,ProcessDepartmentId,ProcessRankId,ProcessOrder)values
	(@ShortProjectsId,@ProcessDepartment,@ProcessRankId,@ProcessOrder)
	end
	--+1
	set @ProcessOrder=@ProcessOrder+1
	end
		if(@@ERROR<>0)
			begin
				rollback
				return -1
			end
	commit tran
	return 0
end
GO
/****** Object:  StoredProcedure [dbo].[ShortCapitalCloseAuditProcess_Insert]    Script Date: 12/07/2016 16:56:30 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
/*********************
--: ShortCapitalCloseAuditProcess_Insert
--: ShortCapitalClose, 
--: 
  ShortProjectsId,DepartmentId,
--: 
	
--:
	0 - 
	-1 -  
**************/
CREATE PROCEDURE [dbo].[ShortCapitalCloseAuditProcess_Insert]
@ShortProjectsId varchar(50)

AS
begin
	begin tran
	declare
	@UserCardId varchar(50),
	@DepartmentId int,
	@ProcessRankId int,
	@ProcessOrder int=1,
	@MaxOrder int
	set @UserCardId=(select UserCardId from ShortCapitalClose where ShortProjectsId=@ShortProjectsId)
	set @DepartmentId=(select DepartmentId from ShortCapitalClose where ShortProjectsId=@ShortProjectsId)
	

	while exists ( select * from ShortCapitalCloseProcess where ProcessOrder=@ProcessOrder )
	begin
    declare
    @ProcessDepartment varchar(50)
    set @ProcessDepartment=(select ProcessDepartment from ShortCapitalCloseProcess where ProcessOrder=@ProcessOrder)
	set @ProcessRankId=(select ProcessRankId from ShortCapitalCloseProcess where  ProcessOrder=@ProcessOrder)
	if(@ProcessDepartment='()')
	begin
	insert into ShortCapitalCloseAuditProcess(ShortProjectsId,ProcessDepartmentId,ProcessRankId,ProcessOrder)values
	(@ShortProjectsId,@DepartmentId,@ProcessRankId,@ProcessOrder)
	end

	else
	begin
	set @ProcessDepartment=(select DepartmentId From Department where DepartmentName=@ProcessDepartment)
	
	insert into ShortCapitalCloseAuditProcess(ShortProjectsId,ProcessDepartmentId,ProcessRankId,ProcessOrder)values
	(@ShortProjectsId,@ProcessDepartment,@ProcessRankId,@ProcessOrder)
	end
	set @ProcessOrder=@ProcessOrder+1
	end
		if(@@ERROR<>0)
			begin
				rollback
				return -1
			end
	commit tran
	return 0
end
GO
/****** Object:  StoredProcedure [dbo].[ShortCapitalClose_Insert]    Script Date: 12/07/2016 16:56:30 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
/*********************
--: ShortCapitalClose_Insert
--: ShortCapitalClose, 
--: 

--: 
	
--:
	0 - 
	-1 -  
**************/
CREATE PROCEDURE [dbo].[ShortCapitalClose_Insert]
@ShortProjectsId varchar(50),
@UserCardId varchar(50),
@FileUrl text
AS
begin
	begin tran
declare
	@DepartmentId int,
	@ProcessRoleId int
	set @DepartmentId=(select UserDepartmentId  from UserInfo where UserCardId=@UserCardId)	
	set @ProcessRoleId=(select ProcessRankId from ShortCapitalCloseProcess where  ProcessOrder=1)
		if exists(select * from ShortCapitalCloseProcess where  ProcessOrder=1)
	begin
	if not exists(select * from ShortCapitalClose where ShortProjectsId=@ShortProjectsId)
	begin
	
	insert into ShortCapitalClose(
  ShortProjectsId,UserCardId,DepartmentId,ShortCapitalCloseUrl
  )
  values
  (@ShortProjectsId,@UserCardId,@DepartmentId,@FileUrl
  )
  end
  else
  begin
  update ShortCapitalClose
  set ShortCapitalCloseUrl=@FileUrl
  where ShortProjectsId=@ShortProjectsId
  end
	delete ShortCapitalCloseAuditProcess
	where ShortProjectsId=@ShortProjectsId
	delete ShortCapitalCloseExamine
	where ShortProjectsId=@ShortProjectsId
	delete ShortCapitalCloseWaitExamine
	where ShortProjectsId=@ShortProjectsId

	exec[dbo].[ShortCapitalCloseAuditProcess_Insert] @ShortProjectsId
	set @DepartmentId=(select ProcessDepartmentId from ShortCapitalCloseAuditProcess where ShortProjectsId=@ShortProjectsId and ProcessOrder=1)
   set @ProcessRoleId=(select ProcessRankId from  ShortCapitalCloseAuditProcess where ShortProjectsId=@ShortProjectsId and ProcessOrder=1)
    exec[dbo].[ShortCapitalClose_UpdateStatus] @ShortProjectsId,'',@ProcessRoleId,@DepartmentId
	exec [dbo].[Journal_Insert] @UserCardId,'',''
	
	end
	

		if(@@ERROR<>0)
			begin
				rollback
				return -1
			end
	commit tran
	return 0
end
GO
/****** Object:  StoredProcedure [dbo].[ShortProjectsEndAuditProcess_Insert]    Script Date: 12/07/2016 16:56:30 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
/*********************
--: ShortProjectsAuditProcess_Insert
--: ShortProjects, 
--: 
  ShortProjectsId,DepartmentId,
--: 
	
--:
	0 - 
	-1 -  
**************/
CREATE PROCEDURE [dbo].[ShortProjectsEndAuditProcess_Insert]
@ShortProjectsId varchar(50)

AS
begin
	begin tran
	declare
	@DepartmentId int,--
	@ProcessRankId int,--
	@ProcessOrder int=1,--
	@MaxOrder int--
	set @DepartmentId=(select DepartmentId from ShortProjects where ShortProjectsId=@ShortProjectsId)--
	
	--
	while exists ( select * from ShortProjectsProcess where ProcessOrder=@ProcessOrder )
	begin
    declare
    @ProcessDepartment varchar(50)--
    set @ProcessDepartment=(select ProcessDepartment from ShortProjectsProcess where ProcessOrder=@ProcessOrder) --
	set @ProcessRankId=(select ProcessRankId from ShortProjectsProcess where  ProcessOrder=@ProcessOrder)--
	if(@ProcessDepartment='()') --
	begin
	--
	insert into ShortProjectsEndAuditProcess(ShortProjectsId,ProcessDepartmentId,ProcessRankId,ProcessOrder)values
	(@ShortProjectsId,@DepartmentId,@ProcessRankId,@ProcessOrder)
	end

	else
	begin
	--
	set @ProcessDepartment=(select DepartmentId From Department where DepartmentName=@ProcessDepartment)
	
	insert into ShortProjectsEndAuditProcess(ShortProjectsId,ProcessDepartmentId,ProcessRankId,ProcessOrder)values
	(@ShortProjectsId,@ProcessDepartment,@ProcessRankId,@ProcessOrder)
	end
	--+1
	set @ProcessOrder=@ProcessOrder+1
	end
		if(@@ERROR<>0)
			begin
				rollback
				return -1
			end
	commit tran
	return 0
end
GO
/****** Object:  StoredProcedure [dbo].[ShortCapitalPlanAuditProcess_Insert]    Script Date: 12/07/2016 16:56:30 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
/*********************
--: ShortCapitalPlanAuditProcess_Insert
--: ShortCapitalPlan, 
--: 
  ShortProjectsId,DepartmentId,
--: 
	
--:
	0 - 
	-1 -  
**************/
CREATE PROCEDURE [dbo].[ShortCapitalPlanAuditProcess_Insert]
@ShortProjectsId varchar(50)

AS
begin
	begin tran
	declare
	@UserCardId varchar(50),
	@DepartmentId int,
	@ProcessRankId int,
	@ProcessOrder int=1,
	@MaxOrder int
	set @UserCardId=(select UserCardId from ShortCapitalPlan where ShortProjectsId=@ShortProjectsId)
	set @DepartmentId=(select DepartmentId from ShortCapitalPlan where ShortProjectsId=@ShortProjectsId)
	

	while exists ( select * from ShortCapitalPlanProcess where ProcessOrder=@ProcessOrder )
	begin
    declare
    @ProcessDepartment varchar(50)
    set @ProcessDepartment=(select ProcessDepartment from ShortCapitalPlanProcess where ProcessOrder=@ProcessOrder)
	set @ProcessRankId=(select ProcessRankId from ShortCapitalPlanProcess where  ProcessOrder=@ProcessOrder)
	if(@ProcessDepartment='()')
	begin
	insert into ShortCapitalPlanAuditProcess(ShortProjectsId,ProcessDepartmentId,ProcessRankId,ProcessOrder)values
	(@ShortProjectsId,@DepartmentId,@ProcessRankId,@ProcessOrder)
	end

	else
	begin
	set @ProcessDepartment=(select DepartmentId From Department where DepartmentName=@ProcessDepartment)
	
	insert into ShortCapitalPlanAuditProcess(ShortProjectsId,ProcessDepartmentId,ProcessRankId,ProcessOrder)values
	(@ShortProjectsId,@ProcessDepartment,@ProcessRankId,@ProcessOrder)
	end
	set @ProcessOrder=@ProcessOrder+1
	end
		if(@@ERROR<>0)
			begin
				rollback
				return -1
			end
	commit tran
	return 0
end
GO
/****** Object:  StoredProcedure [dbo].[ShortCapitalPlan_Insert]    Script Date: 12/07/2016 16:56:30 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
/*********************
--: ShortCapitalPlan_Insert
--: ShortCapitalPlan, 
--: 

--: 
	
--:
	0 - 
	-1 -  
**************/
CREATE PROCEDURE [dbo].[ShortCapitalPlan_Insert]
@ShortProjectsId varchar(50),
@UserCardId varchar(50),
@FileUrl text
AS
begin
	begin tran
declare
	@DepartmentId int,
	@ProcessRoleId int
	set @DepartmentId=(select UserDepartmentId  from UserInfo where UserCardId=@UserCardId)	
	set @ProcessRoleId=(select ProcessRankId from ShortCapitalPlanProcess where  ProcessOrder=1)
		if exists(select * from ShortCapitalPlanProcess where  ProcessOrder=1)
	begin
	if not exists(select * from ShortCapitalPlan where ShortProjectsId=@ShortProjectsId)
	begin
	
	insert into ShortCapitalPlan(
  ShortProjectsId,UserCardId,DepartmentId,ShortCapitalPlanUrl
  )
  values
  (@ShortProjectsId,@UserCardId,@DepartmentId,@FileUrl
  )
  end
  else
  begin
  update ShortCapitalPlan
  set ShortCapitalPlanUrl=@FileUrl
  where ShortProjectsId=@ShortProjectsId
  end
	delete ShortCapitalPlanAuditProcess
	where ShortProjectsId=@ShortProjectsId
	delete ShortCapitalPlanExamine
	where ShortProjectsId=@ShortProjectsId
	delete ShortCapitalPlanWaitExamine
	where ShortProjectsId=@ShortProjectsId

	exec[dbo].[ShortCapitalPlanAuditProcess_Insert] @ShortProjectsId
	set @DepartmentId=(select ProcessDepartmentId from ShortCapitalPlanAuditProcess where ShortProjectsId=@ShortProjectsId and ProcessOrder=1)
   set @ProcessRoleId=(select ProcessRankId from  ShortCapitalPlanAuditProcess where ShortProjectsId=@ShortProjectsId and ProcessOrder=1)
    exec[dbo].[ShortCapitalPlan_UpdateStatus] @ShortProjectsId,'',@ProcessRoleId,@DepartmentId
	exec [dbo].[Journal_Insert] @UserCardId,'',''
	
	end
	

		if(@@ERROR<>0)
			begin
				rollback
				return -1
			end
	commit tran
	return 0
end
GO
/****** Object:  StoredProcedure [dbo].[Education_Update]    Script Date: 12/07/2016 16:56:28 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
/*******
--: Education_Update
--: Education, 
--: 
EducationId,EducationName
--: 
	
--:
	0 - 
	-1 -  
*********/
CREATE PROCEDURE [dbo].[Education_Update]
@EducationId int,
@EducationName varchar(50),
@UserCardId varchar(50)
AS
begin
	begin tran
	if not exists (select * from Education where EducationId<>@EducationId and EducationName=@EducationName)
	begin
		update Education set EducationName=@EducationName where EducationId=@EducationId
		exec [dbo].[Journal_Insert] @UserCardId,'',''
		end
		if(@@ERROR<>0)
			begin
				rollback
				return -1
			end
	commit tran
	return 0
end
GO
/****** Object:  StoredProcedure [dbo].[Education_SelectByEducationId]    Script Date: 12/07/2016 16:56:28 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
/******
--: Education_SelectByEducationId
--: Education, 
--: 
EducationId
--: 
	
--:
	0 - 
	-1 -  
******/
CREATE PROCEDURE [dbo].[Education_SelectByEducationId]
@EducationId int
AS
begin

		select * from   Education where EducationId=@EducationId

end
GO
/****** Object:  StoredProcedure [dbo].[UserEducation_SelectByUserCardId]    Script Date: 12/07/2016 16:56:30 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
/******
--: UserEducation_SelectByUserCardId
--: UserEducation, 
--: 
EducationId
--: 
	
--:
	0 - 
	-1 -  
******/
CREATE PROCEDURE [dbo].[UserEducation_SelectByUserCardId]
@UserCardId varchar(50)
AS
begin

		select  distinct  * from UserEducation where UserCardId=@UserCardId

end
GO
/****** Object:  StoredProcedure [dbo].[UserEducation_Save]    Script Date: 12/07/2016 16:56:30 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
/*********************
--:UserEducation_Save
--: UserEducation, 
--: 
   EducationName
--: 
	
--:
	0 - 
	-1 -  
**************/
CREATE PROCEDURE [dbo].[UserEducation_Save]
@UserCardId varchar(50),
@FirstEducationId int,
@FirstDate varchar(50),
@FirstSchool varchar(100),
@FirstProfession varchar(100),
@HighestEducationId int,
@HighestDate varchar(50),
@HighestSchool varchar(100),
@HighestProfession varchar(100)



AS
begin
	begin tran
	if not exists (select * from UserEducation where UserCardId=@UserCardId)
	begin
	insert into UserEducation(UserCardId,FirstEducationId,FirstDate,FirstSchool,FirstProfession,HighestEducationId,HighestDate,HighestSchool,HighestProfession)
	values
	(@UserCardId,@FirstEducationId,@FirstDate,@FirstSchool,@FirstProfession,@HighestEducationId,@HighestDate,@HighestSchool,@HighestProfession)
	end
	else
	begin
	update UserEducation
	set 
	FirstEducationId=@FirstEducationId,
	FirstDate=@FirstDate,
	FirstProfession=@FirstProfession,
	FirstSchool=@FirstSchool,
	HighestDate=@HighestDate,
	HighestEducationId=@HighestEducationId,
	HighestProfession=@HighestProfession,
	HighestSchool=@HighestSchool
	where UserCardId=@UserCardId
	end
	
	
		if(@@ERROR<>0)
			begin
				rollback
				return -1
			end
	commit tran
	return 0
end
GO
/****** Object:  StoredProcedure [dbo].[WinningAuditProcess_Insert]    Script Date: 12/07/2016 16:56:31 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
/*********************
--: WinningAuditProcess_Insert
--: Winning, 
--: 
  WinningId,DepartmentId,
--: 
	
--:
	0 - 
	-1 -  
**************/
CREATE PROCEDURE [dbo].[WinningAuditProcess_Insert]
@WinningId int

AS
begin
	begin tran
	declare
	@UserCardId varchar(50),
	@DepartmentId int,
	@ProcessRankId int,
	@ProcessOrder int=1,
	@MaxOrder int
	set @UserCardId=(select UserCardId from Winning where WinningId=@WinningId)
	set @DepartmentId=(select DepartmentId from Winning where WinningId=@WinningId)
	

	while exists ( select * from WinningProcess where ProcessOrder=@ProcessOrder )
	begin
    declare
    @ProcessDepartment varchar(50)
    set @ProcessDepartment=(select ProcessDepartment from WinningProcess where ProcessOrder=@ProcessOrder)
	set @ProcessRankId=(select ProcessRankId from WinningProcess where  ProcessOrder=@ProcessOrder)
	if(@ProcessDepartment='')
	begin
	insert into WinningAuditProcess(WinningId,ProcessDepartmentId,ProcessRankId,ProcessOrder)values
	(@WinningId,@DepartmentId,@ProcessRankId,@ProcessOrder)
	end

	else
	begin
	set @ProcessDepartment=(select DepartmentId From Department where DepartmentName=@ProcessDepartment)
	
	insert into WinningAuditProcess(WinningId,ProcessDepartmentId,ProcessRankId,ProcessOrder)values
	(@WinningId,@ProcessDepartment,@ProcessRankId,@ProcessOrder)
	end
	set @ProcessOrder=@ProcessOrder+1
	end
		if(@@ERROR<>0)
			begin
				rollback
				return -1
			end
	commit tran
	return 0
end
GO
/****** Object:  StoredProcedure [dbo].[TeachingAuditProcess_Insert]    Script Date: 12/07/2016 16:56:30 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
/*********************
--: TeachingAuditProcess_Insert
--: Teaching, 
--: 
  TeachingId,DepartmentId,
--: 
	
--:
	0 - 
	-1 -  
**************/
CREATE PROCEDURE [dbo].[TeachingAuditProcess_Insert]
@TeachingId int

AS
begin
	begin tran
	declare
	@UserCardId varchar(50),
	@DepartmentId int,
	@ProcessRankId int,
	@ProcessOrder int=1,
	@MaxOrder int
	set @UserCardId=(select UserCardId from Teaching where TeachingId=@TeachingId)
	set @DepartmentId=(select DepartmentId from Teaching where TeachingId=@TeachingId)
	

	while exists ( select * from TeachingProcess where ProcessOrder=@ProcessOrder )
	begin
    declare
    @ProcessDepartment varchar(50)
    set @ProcessDepartment=(select ProcessDepartment from TeachingProcess where ProcessOrder=@ProcessOrder)
	set @ProcessRankId=(select ProcessRankId from TeachingProcess where  ProcessOrder=@ProcessOrder)
	if(@ProcessDepartment='')
	begin
	insert into TeachingAuditProcess(TeachingId,ProcessDepartmentId,ProcessRankId,ProcessOrder)values
	(@TeachingId,@DepartmentId,@ProcessRankId,@ProcessOrder)
	end

	else
	begin
	set @ProcessDepartment=(select DepartmentId From Department where DepartmentName=@ProcessDepartment)
	
	insert into TeachingAuditProcess(TeachingId,ProcessDepartmentId,ProcessRankId,ProcessOrder)values
	(@TeachingId,@ProcessDepartment,@ProcessRankId,@ProcessOrder)
	end
	set @ProcessOrder=@ProcessOrder+1
	end
		if(@@ERROR<>0)
			begin
				rollback
				return -1
			end
	commit tran
	return 0
end
GO
/****** Object:  StoredProcedure [dbo].[WorkLoadProjectsAuditProcess_Insert]    Script Date: 12/07/2016 16:56:31 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
/*********************
--: WorkLoadProjectsAuditProcess_Insert
--: WorkLoadProjects, 
--: 
  WorkLoadProjectsId,DepartmentId,
--: 
	
--:
	0 - 
	-1 -  
**************/
CREATE PROCEDURE [dbo].[WorkLoadProjectsAuditProcess_Insert]
@WorkLoadProjectsId int

AS
begin
	begin tran
	declare
	@UserCardId varchar(50),
	@DepartmentId int,
	@ProcessRankId int,
	@ProcessOrder int=1,
	@MaxOrder int
	set @UserCardId=(select UserCardId from WorkLoadProjects where WorkLoadProjectsId=@WorkLoadProjectsId)
	set @DepartmentId=(select DepartmentId from WorkLoadProjects where WorkLoadProjectsId=@WorkLoadProjectsId)
	

	while exists ( select * from WorkLoadProjectsProcess where ProcessOrder=@ProcessOrder )
	begin
    declare
    @ProcessDepartment varchar(50)
    set @ProcessDepartment=(select ProcessDepartment from WorkLoadProjectsProcess where ProcessOrder=@ProcessOrder)
	set @ProcessRankId=(select ProcessRankId from WorkLoadProjectsProcess where  ProcessOrder=@ProcessOrder)
	if(@ProcessDepartment='')
	begin
	insert into WorkLoadProjectsAuditProcess(WorkLoadProjectsId,ProcessDepartmentId,ProcessRankId,ProcessOrder)values
	(@WorkLoadProjectsId,@DepartmentId,@ProcessRankId,@ProcessOrder)
	end

	else
	begin
	set @ProcessDepartment=(select DepartmentId From Department where DepartmentName=@ProcessDepartment)
	
	insert into WorkLoadProjectsAuditProcess(WorkLoadProjectsId,ProcessDepartmentId,ProcessRankId,ProcessOrder)values
	(@WorkLoadProjectsId,@ProcessDepartment,@ProcessRankId,@ProcessOrder)
	end
	set @ProcessOrder=@ProcessOrder+1
	end
		if(@@ERROR<>0)
			begin
				rollback
				return -1
			end
	commit tran
	return 0
end
GO
/****** Object:  StoredProcedure [dbo].[LongCapitalCloseAuditProcess_Insert]    Script Date: 12/07/2016 16:56:28 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
/*********************
--: LongCapitalCloseAuditProcess_Insert
--: LongCapitalClose, 
--: 
  LongProjectsId,DepartmentId,
--: 
	
--:
	0 - 
	-1 -  
**************/
CREATE PROCEDURE [dbo].[LongCapitalCloseAuditProcess_Insert]
@LongProjectsId varchar(50)

AS
begin
	begin tran
	declare
	@UserCardId varchar(50),
	@DepartmentId int,
	@ProcessRankId int,
	@ProcessOrder int=1,
	@MaxOrder int
	set @UserCardId=(select UserCardId from LongCapitalClose where LongProjectsId=@LongProjectsId)
	set @DepartmentId=(select DepartmentId from LongCapitalClose where LongProjectsId=@LongProjectsId)
	

	while exists ( select * from LongCapitalCloseProcess where ProcessOrder=@ProcessOrder )
	begin
    declare
    @ProcessDepartment varchar(50)
    set @ProcessDepartment=(select ProcessDepartment from LongCapitalCloseProcess where ProcessOrder=@ProcessOrder)
	set @ProcessRankId=(select ProcessRankId from LongCapitalCloseProcess where  ProcessOrder=@ProcessOrder)
	if(@ProcessDepartment='()')
	begin
	insert into LongCapitalCloseAuditProcess(LongProjectsId,ProcessDepartmentId,ProcessRankId,ProcessOrder)values
	(@LongProjectsId,@DepartmentId,@ProcessRankId,@ProcessOrder)
	end

	else
	begin
	set @ProcessDepartment=(select DepartmentId From Department where DepartmentName=@ProcessDepartment)
	
	insert into LongCapitalCloseAuditProcess(LongProjectsId,ProcessDepartmentId,ProcessRankId,ProcessOrder)values
	(@LongProjectsId,@ProcessDepartment,@ProcessRankId,@ProcessOrder)
	end
	set @ProcessOrder=@ProcessOrder+1
	end
		if(@@ERROR<>0)
			begin
				rollback
				return -1
			end
	commit tran
	return 0
end
GO
/****** Object:  StoredProcedure [dbo].[LongCapitalClose_Insert]    Script Date: 12/07/2016 16:56:28 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
/*********************
--: LongCapitalClose_Insert
--: LongCapitalClose, 
--: 

--: 
	
--:
	0 - 
	-1 -  
**************/
CREATE PROCEDURE [dbo].[LongCapitalClose_Insert]
@LongProjectsId varchar(50),
@UserCardId varchar(50),
@FileUrl text
AS
begin
	begin tran
declare
	@DepartmentId int,
	@ProcessRoleId int
	set @DepartmentId=(select UserDepartmentId  from UserInfo where UserCardId=@UserCardId)	
	set @ProcessRoleId=(select ProcessRankId from LongCapitalCloseProcess where  ProcessOrder=1)
		if exists(select * from LongCapitalCloseProcess where  ProcessOrder=1)
	begin
	if not exists(select * from LongCapitalClose where LongProjectsId=@longProjectsId)
	begin
	
	insert into LongCapitalClose(
  LongProjectsId,UserCardId,DepartmentId,LongCapitalCloseUrl
  )
  values
  (@LongProjectsId,@UserCardId,@DepartmentId,@FileUrl
  )
  end
  else
  begin
  update LongCapitalClose
  set LongCapitalCloseUrl=@FileUrl
  where LongProjectsId=@LongProjectsId
  end
	delete LongCapitalCloseAuditProcess
	where LongProjectsId=@LongProjectsId
	delete LongCapitalCloseExamine
	where LongProjectsId=@LongProjectsId
	delete LongCapitalCloseWaitExamine
	where LongProjectsId=@LongProjectsId

	exec[dbo].[LongCapitalCloseAuditProcess_Insert] @LongProjectsId
	set @DepartmentId=(select ProcessDepartmentId from LongCapitalCloseAuditProcess where LongProjectsId=@LongProjectsId and ProcessOrder=1)
   set @ProcessRoleId=(select ProcessRankId from  LongCapitalCloseAuditProcess where LongProjectsId=@LongProjectsId and ProcessOrder=1)
    exec[dbo].[LongCapitalClose_UpdateStatus] @LongProjectsId,'',@ProcessRoleId,@DepartmentId
	exec [dbo].[Journal_Insert] @UserCardId,'',''
	
	end
	

		if(@@ERROR<>0)
			begin
				rollback
				return -1
			end
	commit tran
	return 0
end
GO
/****** Object:  StoredProcedure [dbo].[LongCapitalChangeAuditProcess_Insert]    Script Date: 12/07/2016 16:56:28 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
/*********************
--: LongCapitalChangeAuditProcess_Insert
--: LongCapitalChange, 
--: 
  LongProjectsId,DepartmentId,
--: 
	
--:
	0 - 
	-1 -  
**************/
CREATE PROCEDURE [dbo].[LongCapitalChangeAuditProcess_Insert]
@LongProjectsId varchar(50)

AS
begin
	begin tran
	declare
	@UserCardId varchar(50),
	@DepartmentId int,
	@ProcessRankId int,
	@ProcessOrder int=1,
	@MaxOrder int
	set @UserCardId=(select UserCardId from LongCapitalChange where LongProjectsId=@LongProjectsId)
	set @DepartmentId=(select DepartmentId from LongCapitalChange where LongProjectsId=@LongProjectsId)
	

	while exists ( select * from LongCapitalChangeProcess where ProcessOrder=@ProcessOrder )
	begin
    declare
    @ProcessDepartment varchar(50)
    set @ProcessDepartment=(select ProcessDepartment from LongCapitalChangeProcess where ProcessOrder=@ProcessOrder)
	set @ProcessRankId=(select ProcessRankId from LongCapitalChangeProcess where  ProcessOrder=@ProcessOrder)
	if(@ProcessDepartment='()')
	begin
	insert into LongCapitalChangeAuditProcess(LongProjectsId,ProcessDepartmentId,ProcessRankId,ProcessOrder)values
	(@LongProjectsId,@DepartmentId,@ProcessRankId,@ProcessOrder)
	end

	else
	begin
	set @ProcessDepartment=(select DepartmentId From Department where DepartmentName=@ProcessDepartment)
	
	insert into LongCapitalChangeAuditProcess(LongProjectsId,ProcessDepartmentId,ProcessRankId,ProcessOrder)values
	(@LongProjectsId,@ProcessDepartment,@ProcessRankId,@ProcessOrder)
	end
	set @ProcessOrder=@ProcessOrder+1
	end
		if(@@ERROR<>0)
			begin
				rollback
				return -1
			end
	commit tran
	return 0
end
GO
/****** Object:  StoredProcedure [dbo].[LongCapitalChange_Insert]    Script Date: 12/07/2016 16:56:28 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
/*********************
--: LongCapitalChange_Insert
--: LongCapitalChange, 
--: 

--: 
	
--:
	0 - 
	-1 -  
**************/
CREATE PROCEDURE [dbo].[LongCapitalChange_Insert]
@LongProjectsId varchar(50),
@UserCardId varchar(50),
@FileUrl text
AS
begin
	begin tran
declare
	@DepartmentId int,
	@ProcessRoleId int
	set @DepartmentId=(select UserDepartmentId  from UserInfo where UserCardId=@UserCardId)	
	set @ProcessRoleId=(select ProcessRankId from LongCapitalChangeProcess where  ProcessOrder=1)
		if exists(select * from LongCapitalChangeProcess where  ProcessOrder=1)
	begin
	if not exists(select * from LongCapitalChange where LongProjectsId=@longProjectsId)
	begin
	
	insert into LongCapitalChange(
  LongProjectsId,UserCardId,DepartmentId,LongCapitalChangeUrl
  )
  values
  (@LongProjectsId,@UserCardId,@DepartmentId,@FileUrl
  )
  end
  else
  begin
  update LongCapitalChange
  set LongCapitalChangeUrl=@FileUrl
  where LongProjectsId=@LongProjectsId
  end
	delete LongCapitalChangeAuditProcess
	where LongProjectsId=@LongProjectsId
	delete LongCapitalChangeExamine
	where LongProjectsId=@LongProjectsId
	delete LongCapitalChangeWaitExamine
	where LongProjectsId=@LongProjectsId

	exec[dbo].[LongCapitalChangeAuditProcess_Insert] @LongProjectsId
	set @DepartmentId=(select ProcessDepartmentId from LongCapitalChangeAuditProcess where LongProjectsId=@LongProjectsId and ProcessOrder=1)
   set @ProcessRoleId=(select ProcessRankId from  LongCapitalChangeAuditProcess where LongProjectsId=@LongProjectsId and ProcessOrder=1)
    exec[dbo].[LongCapitalChange_UpdateStatus] @LongProjectsId,'',@ProcessRoleId,@DepartmentId
	exec [dbo].[Journal_Insert] @UserCardId,'',''
	
	end
	

		if(@@ERROR<>0)
			begin
				rollback
				return -1
			end
	commit tran
	return 0
end
GO
/****** Object:  StoredProcedure [dbo].[UserInfo_SelectEducationSum]    Script Date: 12/07/2016 16:56:31 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
/******
-- UserInfo_SelectEducationSum
--UserInfo, 
-- 
-- EducationId     
-- 
--    @UserEducationSum

******/
CREATE PROCEDURE [dbo].[UserInfo_SelectEducationSum]
   @EducationId int,
   @EducationSum    int output
AS
begin
 if exists(select * from UserEducation where FirstEducationId=@EducationId or HighestEducationId=@EducationId)
   begin 
    set @EducationSum=(select count(*) from UserEducation where FirstEducationId=@EducationId or HighestEducationId=@EducationId)
    end
    else
    begin
      set @EducationSum=0
    end

end
GO
/****** Object:  StoredProcedure [dbo].[HarvestAuditProcess_Insert]    Script Date: 12/07/2016 16:56:28 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
/*********************
--: HarvestAuditProcess_Insert
--: Harvest, 
--: 
  HarvestId,DepartmentId,
--: 
	
--:
	0 - 
	-1 -  
**************/
CREATE PROCEDURE [dbo].[HarvestAuditProcess_Insert]
@HarvestId int

AS
begin
	begin tran
	declare
	@UserCardId varchar(50),
	@DepartmentId int,
	@ProcessRankId int,
	@ProcessOrder int=1,
	@MaxOrder int
	set @UserCardId=(select UserCardId from Harvest where HarvestId=@HarvestId)
	set @DepartmentId=(select DepartmentId from Harvest where HarvestId=@HarvestId)
	

	while exists ( select * from HarvestProcess where ProcessOrder=@ProcessOrder )
	begin
    declare
    @ProcessDepartment varchar(50)
    set @ProcessDepartment=(select ProcessDepartment from HarvestProcess where ProcessOrder=@ProcessOrder)
	set @ProcessRankId=(select ProcessRankId from HarvestProcess where  ProcessOrder=@ProcessOrder)
	if(@ProcessDepartment='')
	begin
	insert into HarvestAuditProcess(HarvestId,ProcessDepartmentId,ProcessRankId,ProcessOrder)values
	(@HarvestId,@DepartmentId,@ProcessRankId,@ProcessOrder)
	end

	else
	begin
	set @ProcessDepartment=(select DepartmentId From Department where DepartmentName=@ProcessDepartment)
	
	insert into HarvestAuditProcess(HarvestId,ProcessDepartmentId,ProcessRankId,ProcessOrder)values
	(@HarvestId,@ProcessDepartment,@ProcessRankId,@ProcessOrder)
	end
	set @ProcessOrder=@ProcessOrder+1
	end
		if(@@ERROR<>0)
			begin
				rollback
				return -1
			end
	commit tran
	return 0
end
GO
/****** Object:  StoredProcedure [dbo].[GuidanceAuditProcess_Insert]    Script Date: 12/07/2016 16:56:28 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
/*********************
--: GuidanceAuditProcess_Insert
--: Guidance, 
--: 
  GuidanceId,DepartmentId,
--: 
	
--:
	0 - 
	-1 -  
**************/
CREATE PROCEDURE [dbo].[GuidanceAuditProcess_Insert]
@GuidanceId int

AS
begin
	begin tran
	declare
	@UserCardId varchar(50),
	@DepartmentId int,
	@ProcessRankId int,
	@ProcessOrder int=1,
	@MaxOrder int
	set @UserCardId=(select UserCardId from Guidance where GuidanceId=@GuidanceId)
	set @DepartmentId=(select DepartmentId from Guidance where GuidanceId=@GuidanceId)
	

	while exists ( select * from GuidanceProcess where ProcessOrder=@ProcessOrder )
	begin
    declare
    @ProcessDepartment varchar(50)
    set @ProcessDepartment=(select ProcessDepartment from GuidanceProcess where ProcessOrder=@ProcessOrder)
	set @ProcessRankId=(select ProcessRankId from GuidanceProcess where  ProcessOrder=@ProcessOrder)
	if(@ProcessDepartment='')
	begin
	insert into GuidanceAuditProcess(GuidanceId,ProcessDepartmentId,ProcessRankId,ProcessOrder)values
	(@GuidanceId,@DepartmentId,@ProcessRankId,@ProcessOrder)
	end

	else
	begin
	set @ProcessDepartment=(select DepartmentId From Department where DepartmentName=@ProcessDepartment)
	
	insert into GuidanceAuditProcess(GuidanceId,ProcessDepartmentId,ProcessRankId,ProcessOrder)values
	(@GuidanceId,@ProcessDepartment,@ProcessRankId,@ProcessOrder)
	end
	set @ProcessOrder=@ProcessOrder+1
	end
		if(@@ERROR<>0)
			begin
				rollback
				return -1
			end
	commit tran
	return 0
end
GO
/****** Object:  StoredProcedure [dbo].[Education_Select]    Script Date: 12/07/2016 16:56:28 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
/******
--: Education_Select
--: Education, 
--: 
--: 
	
--:
	0 - 
	-1 -  
******/
CREATE PROCEDURE [dbo].[Education_Select]

AS
begin

		select * from Education

end
GO
/****** Object:  StoredProcedure [dbo].[Education_Insert]    Script Date: 12/07/2016 16:56:28 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
/*********************
--: Education_Insert
--: Education, 
--: 
   EducationName
--: 
	
--:
	0 - 
	-1 -  
**************/
CREATE PROCEDURE [dbo].[Education_Insert]
@EducationName varchar(50),
@UserCardId varchar(50)
AS
begin
	begin tran
	insert into Education(
	EducationName
	)values(
	@EducationName
	)
	exec [dbo].[Journal_Insert] @UserCardId,'',''
		if(@@ERROR<>0)
			begin
				rollback
				return -1
			end
	commit tran
	return 0
end
GO
/****** Object:  StoredProcedure [dbo].[Education_Delete]    Script Date: 12/07/2016 16:56:28 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
/*******
--: Education_Delete
--: Education, 
--: 
EducationId
--: 
	
--:
	0 - 
	-1 -  
*********/
CREATE PROCEDURE [dbo].[Education_Delete]
@EducationId int,
@UserCardId varchar(50)
AS
begin
	begin tran
		delete Education where EducationId=@EducationId
		exec [dbo].[Journal_Insert] @UserCardId,'',''
		if(@@ERROR<>0)
			begin
				rollback
				return -1
			end
	commit tran
	return 0
end
GO
/****** Object:  StoredProcedure [dbo].[Department_Update]    Script Date: 12/07/2016 16:56:28 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
/*******
--: Department_Update
--: Department, 
--: 
DepartmentId,DepartmentName
--: 
	
--:
	0 - 
	-1 -  
*********/
CREATE PROCEDURE [dbo].[Department_Update]
@DepartmentId int,
@DepartmentName varchar(50),
@UserCardId varchar(50)
AS
begin
	begin tran
	
		update Department set DepartmentName=@DepartmentName where DepartmentId=@DepartmentId
		exec [dbo].[Journal_Insert] @UserCardId,'',''
		if(@@ERROR<>0)
			begin
				rollback
				return -1
			end
	commit tran
	return 0
end
GO
/****** Object:  StoredProcedure [dbo].[Department_SelectByDepartmentId]    Script Date: 12/07/2016 16:56:28 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
/******
--: Department_SelectByDepartmentId
--: Department, 
--: 
DepartmentId
--: 
	
--:
	0 - 
	-1 -  
******/
CREATE PROCEDURE [dbo].[Department_SelectByDepartmentId]
@DepartmentId int
AS
begin

		select * from   Department where DepartmentId=@DepartmentId

end
GO
/****** Object:  StoredProcedure [dbo].[Department_Select]    Script Date: 12/07/2016 16:56:28 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
/******
--: Department_Select
--: Department, 
--: 
--: 
	
--:
	0 - 
	-1 -  
******/
CREATE PROCEDURE [dbo].[Department_Select]

AS
begin

	select * from Department

end
GO
/****** Object:  StoredProcedure [dbo].[Department_Insert]    Script Date: 12/07/2016 16:56:28 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
/*********************
--: Department_Insert
--: Department, 
--: 
   DepartmentName,PlanPeople
--: 
	
--:
	0 - 
	-1 -  
**************/
CREATE PROCEDURE [dbo].[Department_Insert]
@DepartmentName varchar(50),
@UserCardId varchar(50)
AS
begin
	begin tran
	insert into Department(
	DepartmentName
	)values(
	@DepartmentName
	)
	exec [dbo].[Journal_Insert] @UserCardId,'',''

		if(@@ERROR<>0)
			begin
				rollback
				return -1
			end
	commit tran
	return 0
end
GO
/****** Object:  StoredProcedure [dbo].[Department_Delete]    Script Date: 12/07/2016 16:56:28 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
/*******
--: Department_Delete
--: Department, 
--: 
DepartmentId
--: 
	
--:
	0 - 
	-1 -  
*********/
CREATE PROCEDURE [dbo].[Department_Delete]
@DepartmentId int,
@UserCardId varchar(50)
AS
begin
	begin tran
		
		declare 
		@DepartmentName varchar(50)
		set @DepartmentName=(select DepartmentName from Department where DepartmentId=@DepartmentId )
	
		delete Department where DepartmentId=@DepartmentId
		exec [dbo].[Journal_Insert] @UserCardId,'',''
		if(@@ERROR<>0)
			begin
				rollback
				return -1
			end
	commit tran
	return 0
end
GO
/****** Object:  StoredProcedure [dbo].[PatentAuditProcess_Insert]    Script Date: 12/07/2016 16:56:29 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
/*********************
--: PatentAuditProcess_Insert
--: Patent, 
--: 
  PatentId,DepartmentId,
--: 
	
--:
	0 - 
	-1 -  
**************/
CREATE PROCEDURE [dbo].[PatentAuditProcess_Insert]
@PatentId int

AS
begin
	begin tran
	declare
	@UserCardId varchar(50),
	@DepartmentId int,
	@ProcessRankId int,
	@ProcessOrder int=1,
	@MaxOrder int
	set @UserCardId=(select UserCardId from Patent where PatentId=@PatentId)
	set @DepartmentId=(select DepartmentId from Patent where PatentId=@PatentId)
	

	while exists ( select * from PatentProcess where ProcessOrder=@ProcessOrder )
	begin
    declare
    @ProcessDepartment varchar(50)
    set @ProcessDepartment=(select ProcessDepartment from PatentProcess where ProcessOrder=@ProcessOrder)
	set @ProcessRankId=(select ProcessRankId from PatentProcess where  ProcessOrder=@ProcessOrder)
	if(@ProcessDepartment='')
	begin
	insert into PatentAuditProcess(PatentId,ProcessDepartmentId,ProcessRankId,ProcessOrder)values
	(@PatentId,@DepartmentId,@ProcessRankId,@ProcessOrder)
	end

	else
	begin
	set @ProcessDepartment=(select DepartmentId From Department where DepartmentName=@ProcessDepartment)
	
	insert into PatentAuditProcess(PatentId,ProcessDepartmentId,ProcessRankId,ProcessOrder)values
	(@PatentId,@ProcessDepartment,@ProcessRankId,@ProcessOrder)
	end
	set @ProcessOrder=@ProcessOrder+1
	end
		if(@@ERROR<>0)
			begin
				rollback
				return -1
			end
	commit tran
	return 0
end
GO
/****** Object:  StoredProcedure [dbo].[PaperAuditProcess_Insert]    Script Date: 12/07/2016 16:56:29 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
/*********************
--: PaperAuditProcess_Insert
--: Paper, 
--: 
  PaperId,DepartmentId,
--: 
	
--:
	0 - 
	-1 -  
**************/
CREATE PROCEDURE [dbo].[PaperAuditProcess_Insert]
@PaperId int

AS
begin
	begin tran
	declare
	@UserCardId varchar(50),
	@DepartmentId int,
	@ProcessRankId int,
	@ProcessOrder int=1,
	@MaxOrder int
	set @UserCardId=(select UserCardId from Paper where PaperId=@PaperId)
	set @DepartmentId=(select DepartmentId from Paper where PaperId=@PaperId)
	

	while exists ( select * from PaperProcess where ProcessOrder=@ProcessOrder )
	begin
    declare
    @ProcessDepartment varchar(50)
    set @ProcessDepartment=(select ProcessDepartment from PaperProcess where ProcessOrder=@ProcessOrder)
	set @ProcessRankId=(select ProcessRankId from PaperProcess where  ProcessOrder=@ProcessOrder)
	if(@ProcessDepartment='')
	begin
	insert into PaperAuditProcess(PaperId,ProcessDepartmentId,ProcessRankId,ProcessOrder)values
	(@PaperId,@DepartmentId,@ProcessRankId,@ProcessOrder)
	end

	else
	begin
	set @ProcessDepartment=(select DepartmentId From Department where DepartmentName=@ProcessDepartment)
	
	insert into PaperAuditProcess(PaperId,ProcessDepartmentId,ProcessRankId,ProcessOrder)values
	(@PaperId,@ProcessDepartment,@ProcessRankId,@ProcessOrder)
	end
	set @ProcessOrder=@ProcessOrder+1
	end
		if(@@ERROR<>0)
			begin
				rollback
				return -1
			end
	commit tran
	return 0
end
GO
/****** Object:  StoredProcedure [dbo].[LongProjectsStandAuditProcess_Insert]    Script Date: 12/07/2016 16:56:29 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
/*********************
--: LongProjectsAuditProcess_Insert
--: LongProjects, 
--: 
  LongProjectsId,DepartmentId,
--: 
	
--:
	0 - 
	-1 -  
**************/
CREATE PROCEDURE [dbo].[LongProjectsStandAuditProcess_Insert]
@LongProjectsId varchar(50)

AS
begin
	begin tran
	declare
	@DepartmentId int,--
	@ProcessRankId int,--
	@ProcessOrder int=1,--
	@MaxOrder int--
	set @DepartmentId=(select DepartmentId from LongProjects where LongProjectsId=@LongProjectsId)--
	
	--
	while exists ( select * from LongProjectsStandProcess where ProcessOrder=@ProcessOrder )
	begin
    declare
    @ProcessDepartment varchar(50)--
    set @ProcessDepartment=(select ProcessDepartment from LongProjectsStandProcess where ProcessOrder=@ProcessOrder) --
	set @ProcessRankId=(select ProcessRankId from LongProjectsStandProcess where  ProcessOrder=@ProcessOrder)--
	if(@ProcessDepartment='()') --
	begin
	--
	insert into LongProjectsStandAuditProcess(LongProjectsId,ProcessDepartmentId,ProcessRankId,ProcessOrder)values
	(@LongProjectsId,@DepartmentId,@ProcessRankId,@ProcessOrder)
	end

	else
	begin
	--
	set @ProcessDepartment=(select DepartmentId From Department where DepartmentName=@ProcessDepartment)
	
	insert into LongProjectsStandAuditProcess(LongProjectsId,ProcessDepartmentId,ProcessRankId,ProcessOrder)values
	(@LongProjectsId,@ProcessDepartment,@ProcessRankId,@ProcessOrder)
	end
	--+1
	set @ProcessOrder=@ProcessOrder+1
	end
		if(@@ERROR<>0)
			begin
				rollback
				return -1
			end
	commit tran
	return 0
end
GO
/****** Object:  StoredProcedure [dbo].[LongProjectsInspectAuditProcess_Insert]    Script Date: 12/07/2016 16:56:29 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
/*********************
--: LongProjectsAuditProcess_Insert
--: LongProjects, 
--: 
  LongProjectsId,DepartmentId,
--: 
	
--:
	0 - 
	-1 -  
**************/
CREATE PROCEDURE [dbo].[LongProjectsInspectAuditProcess_Insert]
@LongProjectsId varchar(50)

AS
begin
	begin tran
	declare
	@DepartmentId int,--
	@ProcessRankId int,--
	@ProcessOrder int=1,--
	@MaxOrder int--
	set @DepartmentId=(select DepartmentId from LongProjects where LongProjectsId=@LongProjectsId)--
	
	--
	while exists ( select * from LongProjectsInspectProcess where ProcessOrder=@ProcessOrder )
	begin
    declare
    @ProcessDepartment varchar(50)--
    set @ProcessDepartment=(select ProcessDepartment from LongProjectsInspectProcess where ProcessOrder=@ProcessOrder) --
	set @ProcessRankId=(select ProcessRankId from LongProjectsInspectProcess where  ProcessOrder=@ProcessOrder)--
	if(@ProcessDepartment='()') --
	begin
	--
	insert into LongProjectsInspectAuditProcess(LongProjectsId,ProcessDepartmentId,ProcessRankId,ProcessOrder)values
	(@LongProjectsId,@DepartmentId,@ProcessRankId,@ProcessOrder)
	end

	else
	begin
	--
	set @ProcessDepartment=(select DepartmentId From Department where DepartmentName=@ProcessDepartment)
	
	insert into LongProjectsInspectAuditProcess(LongProjectsId,ProcessDepartmentId,ProcessRankId,ProcessOrder)values
	(@LongProjectsId,@ProcessDepartment,@ProcessRankId,@ProcessOrder)
	end
	--+1
	set @ProcessOrder=@ProcessOrder+1
	end
		if(@@ERROR<>0)
			begin
				rollback
				return -1
			end
	commit tran
	return 0
end
GO
/****** Object:  StoredProcedure [dbo].[LongCapitalPlanAuditProcess_Insert]    Script Date: 12/07/2016 16:56:28 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
/*********************
--: LongCapitalPlanAuditProcess_Insert
--: LongCapitalPlan, 
--: 
  LongProjectsId,DepartmentId,
--: 
	
--:
	0 - 
	-1 -  
**************/
CREATE PROCEDURE [dbo].[LongCapitalPlanAuditProcess_Insert]
@LongProjectsId varchar(50)

AS
begin
	begin tran
	declare
	@UserCardId varchar(50),
	@DepartmentId int,
	@ProcessRankId int,
	@ProcessOrder int=1,
	@MaxOrder int
	set @UserCardId=(select UserCardId from LongCapitalPlan where LongProjectsId=@LongProjectsId)
	set @DepartmentId=(select DepartmentId from LongCapitalPlan where LongProjectsId=@LongProjectsId)
	

	while exists ( select * from LongCapitalPlanProcess where ProcessOrder=@ProcessOrder )
	begin
    declare
    @ProcessDepartment varchar(50)
    set @ProcessDepartment=(select ProcessDepartment from LongCapitalPlanProcess where ProcessOrder=@ProcessOrder)
	set @ProcessRankId=(select ProcessRankId from LongCapitalPlanProcess where  ProcessOrder=@ProcessOrder)
	if(@ProcessDepartment='()')
	begin
	insert into LongCapitalPlanAuditProcess(LongProjectsId,ProcessDepartmentId,ProcessRankId,ProcessOrder)values
	(@LongProjectsId,@DepartmentId,@ProcessRankId,@ProcessOrder)
	end

	else
	begin
	set @ProcessDepartment=(select DepartmentId From Department where DepartmentName=@ProcessDepartment)
	
	insert into LongCapitalPlanAuditProcess(LongProjectsId,ProcessDepartmentId,ProcessRankId,ProcessOrder)values
	(@LongProjectsId,@ProcessDepartment,@ProcessRankId,@ProcessOrder)
	end
	set @ProcessOrder=@ProcessOrder+1
	end
		if(@@ERROR<>0)
			begin
				rollback
				return -1
			end
	commit tran
	return 0
end
GO
/****** Object:  StoredProcedure [dbo].[LongCapitalPlan_Insert]    Script Date: 12/07/2016 16:56:28 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
/*********************
--: LongCapitalPlan_Insert
--: LongCapitalPlan, 
--: 

--: 
	
--:
	0 - 
	-1 -  
**************/
CREATE PROCEDURE [dbo].[LongCapitalPlan_Insert]
@LongProjectsId varchar(50),
@UserCardId varchar(50),
@FileUrl text
AS
begin
	begin tran
declare
	@DepartmentId int,
	@ProcessRoleId int
	set @DepartmentId=(select UserDepartmentId  from UserInfo where UserCardId=@UserCardId)	
	set @ProcessRoleId=(select ProcessRankId from LongCapitalPlanProcess where  ProcessOrder=1)
		if exists(select * from LongCapitalPlanProcess where  ProcessOrder=1)
	begin
	if not exists(select * from LongCapitalPlan where LongProjectsId=@longProjectsId)
	begin
	
	insert into LongCapitalPlan(
  LongProjectsId,UserCardId,DepartmentId,LongCapitalPlanUrl
  )
  values
  (@LongProjectsId,@UserCardId,@DepartmentId,@FileUrl
  )
  end
  else
  begin
  update LongCapitalPlan
  set LongCapitalPlanUrl=@FileUrl
  where LongProjectsId=@LongProjectsId
  end
	delete LongCapitalPlanAuditProcess
	where LongProjectsId=@LongProjectsId
	delete LongCapitalPlanExamine
	where LongProjectsId=@LongProjectsId
	delete LongCapitalPlanWaitExamine
	where LongProjectsId=@LongProjectsId

	exec[dbo].[LongCapitalPlanAuditProcess_Insert] @LongProjectsId
	set @DepartmentId=(select ProcessDepartmentId from LongCapitalPlanAuditProcess where LongProjectsId=@LongProjectsId and ProcessOrder=1)
   set @ProcessRoleId=(select ProcessRankId from  LongCapitalPlanAuditProcess where LongProjectsId=@LongProjectsId and ProcessOrder=1)
    exec[dbo].[LongCapitalPlan_UpdateStatus] @LongProjectsId,'',@ProcessRoleId,@DepartmentId
	exec [dbo].[Journal_Insert] @UserCardId,'',''
	
	end
	

		if(@@ERROR<>0)
			begin
				rollback
				return -1
			end
	commit tran
	return 0
end
GO
/****** Object:  StoredProcedure [dbo].[LongProjectsEndAuditProcess_Insert]    Script Date: 12/07/2016 16:56:29 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
/*********************
--: LongProjectsAuditProcess_Insert
--: LongProjects, 
--: 
  LongProjectsId,DepartmentId,
--: 
	
--:
	0 - 
	-1 -  
**************/
CREATE PROCEDURE [dbo].[LongProjectsEndAuditProcess_Insert]
@LongProjectsId varchar(50)

AS
begin
	begin tran
	declare
	@DepartmentId int,--
	@ProcessRankId int,--
	@ProcessOrder int=1,--
	@MaxOrder int--
	set @DepartmentId=(select DepartmentId from LongProjects where LongProjectsId=@LongProjectsId)--
	
	--
	while exists ( select * from LongProjectsEndProcess where ProcessOrder=@ProcessOrder )
	begin
    declare
    @ProcessDepartment varchar(50)--
    set @ProcessDepartment=(select ProcessDepartment from LongProjectsEndProcess where ProcessOrder=@ProcessOrder) --
	set @ProcessRankId=(select ProcessRankId from LongProjectsEndProcess where  ProcessOrder=@ProcessOrder)--
	if(@ProcessDepartment='()') --
	begin
	--
	insert into LongProjectsEndAuditProcess(LongProjectsId,ProcessDepartmentId,ProcessRankId,ProcessOrder)values
	(@LongProjectsId,@DepartmentId,@ProcessRankId,@ProcessOrder)
	end

	else
	begin
	--
	set @ProcessDepartment=(select DepartmentId From Department where DepartmentName=@ProcessDepartment)
	
	insert into LongProjectsEndAuditProcess(LongProjectsId,ProcessDepartmentId,ProcessRankId,ProcessOrder)values
	(@LongProjectsId,@ProcessDepartment,@ProcessRankId,@ProcessOrder)
	end
	--+1
	set @ProcessOrder=@ProcessOrder+1
	end
		if(@@ERROR<>0)
			begin
				rollback
				return -1
			end
	commit tran
	return 0
end
GO
/****** Object:  StoredProcedure [dbo].[LongProjectsDeclareAuditProcess_Insert]    Script Date: 12/07/2016 16:56:28 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
/*********************
--: LongProjectsAuditProcess_Insert
--: LongProjects, 
--: 
  LongProjectsId,DepartmentId,
--: 
	
--:
	0 - 
	-1 -  
**************/
CREATE PROCEDURE [dbo].[LongProjectsDeclareAuditProcess_Insert]
@LongProjectsId varchar(50)

AS
begin
	begin tran
	declare
	@DepartmentId int,--
	@ProcessRankId int,--
	@ProcessOrder int=1,--
	@MaxOrder int--
	set @DepartmentId=(select DepartmentId from LongProjects where LongProjectsId=@LongProjectsId)--
	
	--
	while exists ( select * from LongProjectsDeclareProcess where ProcessOrder=@ProcessOrder )
	begin
    declare
    @ProcessDepartment varchar(50)--
    set @ProcessDepartment=(select ProcessDepartment from LongProjectsDeclareProcess where ProcessOrder=@ProcessOrder) --
	set @ProcessRankId=(select ProcessRankId from LongProjectsDeclareProcess where  ProcessOrder=@ProcessOrder)--
	if(@ProcessDepartment='()') --
	begin
	--
	insert into LongProjectsDeclareAuditProcess(LongProjectsId,ProcessDepartmentId,ProcessRankId,ProcessOrder)values
	(@LongProjectsId,@DepartmentId,@ProcessRankId,@ProcessOrder)
	end

	else
	begin
	--
	set @ProcessDepartment=(select DepartmentId From Department where DepartmentName=@ProcessDepartment)
	
	insert into LongProjectsDeclareAuditProcess(LongProjectsId,ProcessDepartmentId,ProcessRankId,ProcessOrder)values
	(@LongProjectsId,@ProcessDepartment,@ProcessRankId,@ProcessOrder)
	end
	--+1
	set @ProcessOrder=@ProcessOrder+1
	end
		if(@@ERROR<>0)
			begin
				rollback
				return -1
			end
	commit tran
	return 0
end
GO
/****** Object:  StoredProcedure [dbo].[LongProjectsEnd_Update]    Script Date: 12/07/2016 16:56:29 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
/*********************
--: LongProjects_Insert
--: LongProjects, 
--
--: 

--: 
	
--:
	0 - 
	-1 -  
**************/
CREATE PROCEDURE [dbo].[LongProjectsEnd_Update]
@LongProjectsId varchar(50),
@FileUrl text
AS
begin
	begin tran
		declare 
		@UserCardId varchar(50),--

	@EndStatus varchar(50),--
	@DepartmentId int,--
	@ProcessRankId int--
	set @UserCardId=(select UserCardId from LongProjects where LongProjectsId=@LongProjectsId)--
	set @EndStatus=(select EndStatus from LongProjects where LongProjectsId=@LongProjectsId) --
	if(@EndStatus<>'')--
	begin
	update LongProjects
	set EndUrl=@FileUrl
	where LongProjectsId=@LongProjectsId --Url
	delete LongProjectsEndAuditProcess
	where LongProjectsId=@LongProjectsId --
	delete LongProjectsEndExamine
	where LongProjectsId=@LongProjectsId--
		delete LongProjectsEndWaitExamine
	where LongProjectsId=@LongProjectsId--
	exec[dbo].[LongProjectsEndAuditProcess_Insert] @LongProjectsId --
	exec [dbo].[Journal_Insert] @UserCardId,'',''  --
	set @DepartmentId=(select ProcessDepartmentId from  LongProjectsEndAuditProcess where LongProjectsId=@LongProjectsId and ProcessOrder=1)--
   set @ProcessRankId=(select ProcessRankId from  LongProjectsEndAuditProcess where LongProjectsId=@LongProjectsId and ProcessOrder=1)--
    exec[dbo].[LongProjects_UpdateEndStatus] @LongProjectsId,'',@ProcessRankId,@DepartmentId --

	end
	
		if(@@ERROR<>0)
			begin
				rollback
				return -1
			end
	commit tran
	return 0
end
GO
/****** Object:  StoredProcedure [dbo].[LongProjectsInspect_Update]    Script Date: 12/07/2016 16:56:29 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
/*********************
--: LongProjects_Insert
--: LongProjects, 
--
--: 

--: 
	
--:
	0 - 
	-1 -  
**************/
CREATE PROCEDURE [dbo].[LongProjectsInspect_Update]
@LongProjectsId varchar(50),
@FileUrl text
AS
begin
	begin tran
		declare 
		@UserCardId varchar(50),--

	@InspectStatus varchar(50),--
	@DepartmentId int,--
	@ProcessRankId int--
	set @UserCardId=(select UserCardId from LongProjects where LongProjectsId=@LongProjectsId)--
	set @InspectStatus=(select InspectStatus from LongProjects where LongProjectsId=@LongProjectsId) --
	if(@InspectStatus<>'')--
	begin
	update LongProjects
	set InspectUrl=@FileUrl
	where LongProjectsId=@LongProjectsId --Url
	delete LongProjectsInspectAuditProcess
	where LongProjectsId=@LongProjectsId --
	delete LongProjectsInspectExamine
	where LongProjectsId=@LongProjectsId--
		delete LongProjectsInspectWaitExamine
	where LongProjectsId=@LongProjectsId--
	exec[dbo].[LongProjectsInspectAuditProcess_Insert] @LongProjectsId --
	exec [dbo].[Journal_Insert] @UserCardId,'',''  --
	set @DepartmentId=(select ProcessDepartmentId from  LongProjectsInspectAuditProcess where LongProjectsId=@LongProjectsId and ProcessOrder=1)--
   set @ProcessRankId=(select ProcessRankId from  LongProjectsInspectAuditProcess where LongProjectsId=@LongProjectsId and ProcessOrder=1)--
    exec[dbo].[LongProjects_UpdateInspectStatus] @LongProjectsId,'',@ProcessRankId,@DepartmentId --

	end
	
		if(@@ERROR<>0)
			begin
				rollback
				return -1
			end
	commit tran
	return 0
end
GO
/****** Object:  StoredProcedure [dbo].[LongProjectsStand_Update]    Script Date: 12/07/2016 16:56:29 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
/*********************
--: LongProjects_Insert
--: LongProjects, 
--
--: 

--: 
	
--:
	0 - 
	-1 -  
**************/
CREATE PROCEDURE [dbo].[LongProjectsStand_Update]
@LongProjectsId varchar(50),
@UserCardId varchar(50)
AS
begin
	begin tran
		declare 
	@StandStatus varchar(50),--
	@DepartmentId int,--
	@ProcessRankId int--
	set @StandStatus=(select StandStatus from LongProjects where LongProjectsId=@LongProjectsId) --
	if(@StandStatus<>'')--
	begin
	delete LongProjectsStandAuditProcess
	where LongProjectsId=@LongProjectsId --
	
	exec[dbo].[LongProjectsStandAuditProcess_Insert] @LongProjectsId --
	exec [dbo].[Journal_Insert] @UserCardId,'',''  --
	set @DepartmentId=(select ProcessDepartmentId from  LongProjectsStandAuditProcess where LongProjectsId=@LongProjectsId and ProcessOrder=1)--
   set @ProcessRankId=(select ProcessRankId from  LongProjectsStandAuditProcess where LongProjectsId=@LongProjectsId and ProcessOrder=1)--
    exec[dbo].[LongProjects_UpdateStandStatus] @LongProjectsId,'',@ProcessRankId,@DepartmentId --

	end
	
		if(@@ERROR<>0)
			begin
				rollback
				return -1
			end
	commit tran
	return 0
end
GO
/****** Object:  StoredProcedure [dbo].[Paper_Update]    Script Date: 12/07/2016 16:56:29 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
/*********************
--: Paper_Update
--: Paper, 
--: 
  PaperId,BookName,PressCategory,PressName,PressDate,Revision,TotalNumber,PaperValue

--: 
	
--:
	0 - 
	-1 -  
**************/
CREATE PROCEDURE [dbo].[Paper_Update]
	@PaperId int,
	@PaperSubject varchar(50),
    @PaperName varchar(50),
    @PaperLevel varchar(50),
    @PaperYears varchar(50),
	@PaperValue float,
	@PartnerRank int,
	@PartnerValue float,
	@Remarks text
AS
begin
	begin tran
	declare
	@UserCardId varchar(50),
	@TransferStatus varchar(50),
	@DepartmentId int,
	@PaperRoleId int,
	@ProcessRoleId int
	set @UserCardId=(select UserCardId from Paper where PaperId=@PaperId)
	set @TransferStatus=(select TransferStatus from Paper where PaperId=@PaperId)
	if(@TransferStatus<>'')
	begin
	
	update Paper set
	PaperName=@PaperName,
	PaperSubject=@PaperSubject,
	PaperLevel=@PaperLevel,
	PaperYears=@PaperYears,
	PaperValue=@PaperValue,
	Remarks=@Remarks
	where 
	PaperId=@PaperId 
	exec [dbo].[PaperPartner_UpdatePaperId] @PaperId,@UserCardId,@PartnerRank,@PartnerValue
	delete PaperAuditProcess where PaperId=@PaperId
	exec[dbo].PaperAuditProcess_Insert @PaperId
	delete PaperExamine where PaperId=@PaperId
	set @DepartmentId=(select ProcessDepartmentId from PaperAuditProcess where PaperId=@PaperId and ProcessOrder=1)
	  set @ProcessRoleId=(select ProcessRankId from PaperAuditProcess where PaperId=@PaperId and ProcessOrder=1)
    exec[dbo].Paper_UpdateStatus @PaperId,'',@ProcessRoleId,@DepartmentId
		exec [dbo].[Journal_Insert] @UserCardId,'',''
	end
		if(@@ERROR<>0)
			begin
				rollback
				return -1
			end
	commit tran
	return 0
end
GO
/****** Object:  StoredProcedure [dbo].[Patent_Update]    Script Date: 12/07/2016 16:56:29 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
/*********************
--: Patent_Update
--: Patent, 
--: 
  PatentId,BookName,PressCategory,PressName,PressDate,Revision,TotalNumber,PatentValue

--: 
	
--:
	0 - 
	-1 -  
**************/
CREATE PROCEDURE [dbo].[Patent_Update]
	@PatentId int,
	@PatentCateGory varchar(50),
    @PatentName varchar(50),
    @PatentLevel varchar(50),
    @PatentPrizes varchar(50),
	@PatentValue float,
	@PartnerRank int,
	@PartnerValue float,
	@Remarks text
AS
begin
	begin tran
	declare
	@UserCardId varchar(50),
	@TransferStatus varchar(50),
	@DepartmentId int,
	@PatentRoleId int,
	@ProcessRoleId int
	set @UserCardId=(select UserCardId from Patent where PatentId=@PatentId)
	set @TransferStatus=(select TransferStatus from Patent where PatentId=@PatentId)
	if(@TransferStatus<>'')
	begin
	
	update Patent set
	PatentName=@PatentName,
	PatentCateGory=@PatentCateGory,
	PatentLevel=@PatentLevel,
	PatentPrizes=@PatentPrizes,
	PatentValue=@PatentValue,
	Remarks=@Remarks
	
	where 
	PatentId=@PatentId
	exec [dbo].[PatentPartner_UpdatePatentId] @PatentId,@UserCardId,@PartnerRank,@PartnerValue
	delete PatentAuditProcess where PatentId=@PatentId
	exec[dbo].PatentAuditProcess_Insert @PatentId
		delete PatentExamine where PatentId=@PatentId
	set @DepartmentId=(select ProcessDepartmentId from PatentAuditProcess where PatentId=@PatentId and ProcessOrder=1)
	  set @ProcessRoleId=(select ProcessRankId from PatentAuditProcess where PatentId=@PatentId and ProcessOrder=1)
    exec[dbo].Patent_UpdateStatus @PatentId,'',@ProcessRoleId,@DepartmentId
		exec [dbo].[Journal_Insert] @UserCardId,'',''
	end
		if(@@ERROR<>0)
			begin
				rollback
				return -1
			end
	commit tran
	return 0
end
GO
/****** Object:  StoredProcedure [dbo].[Guidance_Update]    Script Date: 12/07/2016 16:56:28 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
/*********************
--: Guidance_Update
--: Guidance, 
--: 
  GuidanceId,BookName,PressCategory,PressName,PressDate,Revision,TotalNumber,GuidanceValue

--: 
	
--:
	0 - 
	-1 -  
**************/
CREATE PROCEDURE [dbo].[Guidance_Update]
	@GuidanceId int,
    @GuidanceName varchar(50),
    @GuidanceLevel varchar(50),
	@GuidanceValue float,
	@PartnerRank int,
	@PartnerValue float,
	@Remarks text
AS
begin
	begin tran
	declare
	@UserCardId varchar(50),
	@TransferStatus varchar(50),
	@DepartmentId int,
	@GuidanceRoleId int,
	@ProcessRoleId int
	set @UserCardId=(select UserCardId from Guidance where GuidanceId=@GuidanceId)
	set @TransferStatus=(select TransferStatus from Guidance where GuidanceId=@GuidanceId)
	if(@TransferStatus<>'')
	begin
	
	update Guidance set
	GuidanceName=@GuidanceName,
	GuidanceLevel=@GuidanceLevel,
	GuidanceValue=@GuidanceValue,
	Remarks=@Remarks
	where 
	GuidanceId=@GuidanceId

	exec [dbo].[GuidancePartner_UpdateGuidanceId] @GuidanceId,@UserCardId,@PartnerRank,@PartnerValue

	delete GuidanceAuditProcess where GuidanceId=@GuidanceId
	exec[dbo].GuidanceAuditProcess_Insert @GuidanceId
	delete GuidanceExamine where GuidanceId=@GuidanceId
	set @DepartmentId=(select ProcessDepartmentId from GuidanceAuditProcess where GuidanceId=@GuidanceId and ProcessOrder=1)
	  set @ProcessRoleId=(select ProcessRankId from GuidanceAuditProcess where GuidanceId=@GuidanceId and ProcessOrder=1)
    exec[dbo].Guidance_UpdateStatus @GuidanceId,'',@ProcessRoleId,@DepartmentId
		exec [dbo].[Journal_Insert] @UserCardId,'',''
	end
		if(@@ERROR<>0)
			begin
				rollback
				return -1
			end
	commit tran
	return 0
end
GO
/****** Object:  StoredProcedure [dbo].[Harvest_Update]    Script Date: 12/07/2016 16:56:28 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
/*********************
--: Harvest_Update
--: Harvest, 
--: 
  HarvestId,BookName,PressCategory,PressName,PressDate,Revision,TotalNumber,HarvestValue

--: 
	
--:
	0 - 
	-1 -  
**************/
CREATE PROCEDURE [dbo].[Harvest_Update]
	@HarvestId int,
    @HarvestName varchar(50),
    @AppraisalCompany varchar(50),
    @AppraisalLevel varchar(50),
	@HarvestValue float,
	@PartnerRank int,
	@PartnerValue float,
	@Remarks text
AS
begin
	begin tran
	declare
	@UserCardId varchar(50),
	@TransferStatus varchar(50),
	@DepartmentId int,
	@HarvestRoleId int,
	@ProcessRoleId int
	set @UserCardId=(select UserCardId from Harvest where HarvestId=@HarvestId)
	set @TransferStatus=(select TransferStatus from Harvest where HarvestId=@HarvestId)
	if(@TransferStatus<>'')
	begin
	
	update Harvest set
	HarvestName=@HarvestName,
	HarvestValue=@HarvestValue,
	AppraisalCompany=@AppraisalCompany,
	AppraisalLevel=@AppraisalLevel,
	Remarks=@Remarks
	where 
	HarvestId=@HarvestId 

	exec [dbo].[HarvestPartner_UpdateHarvestId] @HarvestId,@UserCardId,@PartnerRank,@PartnerValue
	delete HarvestAuditProcess where HarvestId=@HarvestId
	exec[dbo].HarvestAuditProcess_Insert @HarvestId
		delete HarvestExamine where HarvestId=@HarvestId
	set @DepartmentId=(select ProcessDepartmentId from HarvestAuditProcess where HarvestId=@HarvestId and ProcessOrder=1)
	  set @ProcessRoleId=(select ProcessRankId from HarvestAuditProcess where HarvestId=@HarvestId and ProcessOrder=1)
    exec[dbo].Harvest_UpdateStatus @HarvestId,'',@ProcessRoleId,@DepartmentId
		exec [dbo].[Journal_Insert] @UserCardId,'',''
	end
		if(@@ERROR<>0)
			begin
				rollback
				return -1
			end
	commit tran
	return 0
end
GO
/****** Object:  StoredProcedure [dbo].[LongProjects_Update]    Script Date: 12/07/2016 16:56:28 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
/*********************
--: LongProjects_Insert
--: LongProjects, 
--
--: 

--: 
	
--:
	0 - 
	-1 -  
**************/
CREATE PROCEDURE [dbo].[LongProjects_Update]
@LongProjectsId varchar(50),
@UserCardId varchar(50),
@ProjectsName varchar(100),
@ProjectsFromId int,
@ProjectsSubjectId int,
@ProjectsLevelId int,
@Company varchar(50),
@DeclareUrl text
AS
begin
	begin tran
		declare 
	@DeclareStatus varchar(50),--
	@DepartmentId int,--
	@ProcessRankId int--
	set @DeclareStatus=(select DeclareStatus from LongProjects where LongProjectsId=@LongProjectsId) --
	if(@DeclareStatus<>'')--
	begin
	update LongProjects  --
	set
	DeclareUrl=@DeclareUrl,
	ProjectsName=@ProjectsName,
	ProjectsFromId=@ProjectsFromId,
	ProjectsLevelId=@ProjectsLevelId,
	ProjectsSubjectId=@ProjectsSubjectId,
	Company=@Company,
	DeclareStatus=''
	where LongProjectsId=@LongProjectsId

	delete LongProjectsDeclareAuditProcess
	where LongProjectsId=@LongProjectsId --
	delete LongProjectsDeclareExamine
	where LongProjectsId=@LongProjectsId--
		delete LongProjectsDeclareWaitExamine
	where LongProjectsId=@LongProjectsId--
	exec[dbo].[LongProjectsDeclareAuditProcess_Insert] @LongProjectsId --
	exec [dbo].[Journal_Insert] @UserCardId,'',''  --
	set @DepartmentId=(select ProcessDepartmentId from  LongProjectsDeclareAuditProcess where LongProjectsId=@LongProjectsId and ProcessOrder=1)--
   set @ProcessRankId=(select ProcessRankId from  LongProjectsDeclareAuditProcess where LongProjectsId=@LongProjectsId and ProcessOrder=1)--
    exec[dbo].[LongProjects_UpdateDeclareStatus] @LongProjectsId,'',@ProcessRankId,@DepartmentId --
	end
	
		if(@@ERROR<>0)
			begin
				rollback
				return -1
			end
	commit tran
	return 0
end
GO
/****** Object:  StoredProcedure [dbo].[WorkLoadProjects_Update]    Script Date: 12/07/2016 16:56:31 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
/*********************
--: WorkLoadProjects_Update
--: WorkLoadProjects, 
--: 
  WorkLoadProjectsId,BookName,PressCategory,PressName,PressDate,Revision,TotalNumber,WorkLoadProjectsValue

--: 
	
--:
	0 - 
	-1 -  
**************/
CREATE PROCEDURE [dbo].[WorkLoadProjects_Update]
	@WorkLoadProjectsId int,
	@ProjectsId varchar(50),
    @WorkLoadProjectsName varchar(50),
    @WorkLoadFrom varchar(50),
	@StartEndDate varchar(50),
	@WorkLoadCapital varchar(50),
	@CateGory varchar(50),
	@WorkLoadProjectsValue float,
	@PartnerRank int,
	@PartnerValue float,
	@Remarks text
AS
begin
	begin tran
	declare
	@UserCardId varchar(50),
	@TransferStatus varchar(50),
	@DepartmentId int,
	@WorkLoadProjectsRoleId int,
	@ProcessRoleId int
	set @UserCardId=(select UserCardId from WorkLoadProjects where WorkLoadProjectsId=@WorkLoadProjectsId)
	set @TransferStatus=(select TransferStatus from WorkLoadProjects where WorkLoadProjectsId=@WorkLoadProjectsId)
	if(@TransferStatus<>'')
	begin
	
	update WorkLoadProjects set
	ProjectsId=@ProjectsId,
	WorkLoadProjectsName=@WorkLoadProjectsName,
	WorkLoadFrom=@WorkLoadFrom,
	StartEndDate=@StartEndDate,
	WorkLoadCapital=@WorkLoadCapital,
	CateGory=@CateGory,
	ProjectsValue=@WorkLoadProjectsValue,
	Remarks=@Remarks
	where 
	WorkLoadProjectsId=@WorkLoadProjectsId 
	exec [dbo].[WorkLoadProjectsPartner_UpdateWorkLoadProjectsId] @WorkLoadProjectsId,@UserCardId,@PartnerRank,@PartnerValue
	delete WorkLoadProjectsAuditProcess where WorkLoadProjectsId=@WorkLoadProjectsId
	exec[dbo].WorkLoadProjectsAuditProcess_Insert @WorkLoadProjectsId
	delete WorkLoadProjectsExamine where WorkLoadProjectsId=@WorkLoadProjectsId
	set @DepartmentId=(select ProcessDepartmentId from WorkLoadProjectsAuditProcess where WorkLoadProjectsId=@WorkLoadProjectsId and ProcessOrder=1)
	  set @ProcessRoleId=(select ProcessRankId from WorkLoadProjectsAuditProcess where WorkLoadProjectsId=@WorkLoadProjectsId and ProcessOrder=1)
    exec[dbo].WorkLoadProjects_UpdateStatus @WorkLoadProjectsId,'',@ProcessRoleId,@DepartmentId
		exec [dbo].[Journal_Insert] @UserCardId,'',''
	end
		if(@@ERROR<>0)
			begin
				rollback
				return -1
			end
	commit tran
	return 0
end
GO
/****** Object:  StoredProcedure [dbo].[Winning_Update]    Script Date: 12/07/2016 16:56:31 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
/*********************
--: Winning_Update
--: Winning, 
--: 
  WinningId,BookName,PressCategory,PressName,PressDate,Revision,TotalNumber,WinningValue

--: 
	
--:
	0 - 
	-1 -  
**************/
CREATE PROCEDURE [dbo].[Winning_Update]
	@WinningId int,
    @WinningName varchar(50),
    @WinningCateGory varchar(50),
    @WinningLevel varchar(50),
	@WinningValue float,
	@PartnerRank int,
	@PartnerValue float,
	@Remarks text
AS
begin
	begin tran
	declare
	@UserCardId varchar(50),
	@TransferStatus varchar(50),
	@DepartmentId int,
	@WinningRoleId int,
	@ProcessRoleId int
	set @UserCardId=(select UserCardId from Winning where WinningId=@WinningId)
	set @TransferStatus=(select TransferStatus from Winning where WinningId=@WinningId)
	if(@TransferStatus<>'')
	begin
	
	update Winning set
	WinningName=@WinningName,
	WinningValue=@WinningValue,
	WinningCateGory=@WinningCateGory,
	WinningLevel=@WinningLevel,
	Remarks=@Remarks
	where 
	WinningId=@WinningId 
	exec [dbo].[WinningPartner_UpdateWinningId] @WinningId,@UserCardId,@PartnerRank,@PartnerValue
	delete WinningAuditProcess where WinningId=@WinningId
	exec[dbo].WinningAuditProcess_Insert @WinningId
	delete WinningExamine where WinningId=@WinningId
	set @DepartmentId=(select ProcessDepartmentId from WinningAuditProcess where WinningId=@WinningId and ProcessOrder=1)
	  set @ProcessRoleId=(select ProcessRankId from WinningAuditProcess where WinningId=@WinningId and ProcessOrder=1)
    exec[dbo].Winning_UpdateStatus @WinningId,'',@ProcessRoleId,@DepartmentId
		exec [dbo].[Journal_Insert] @UserCardId,'',''
	end
		if(@@ERROR<>0)
			begin
				rollback
				return -1
			end
	commit tran
	return 0
end
GO
/****** Object:  StoredProcedure [dbo].[Teaching_Update]    Script Date: 12/07/2016 16:56:30 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
/*********************
--: Teaching_Update
--: Teaching, 
--: 
  TeachingId,BookName,PressCategory,PressName,PressDate,Revision,TotalNumber,TeachingValue

--: 
	
--:
	0 - 
	-1 -  
**************/
CREATE PROCEDURE [dbo].[Teaching_Update]
	@TeachingId int,
	@BookName varchar(50),
	@PressCateGory varchar(50),
	@PressName varchar(50),
	@PressDate varchar(50),
	@Revision varchar(50),
	@TotalNumber varchar(50),  
	@TeachingValue float,
	@PartnerRank int,
	@PartnerValue float,
	@Remarks text
AS
begin
	begin tran
	declare
	@UserCardId varchar(50),
	@TransferStatus varchar(50),
	@DepartmentId int,
	@TeachingRoleId int,
	@ProcessRoleId int
	set @UserCardId=(select UserCardId from Teaching where TeachingId=@TeachingId)
	set @TransferStatus=(select TransferStatus from Teaching where TeachingId=@TeachingId)
	if(@TransferStatus<>'')
	begin
	
	update Teaching set
	BookName=@BookName,
	PressCateGory=@PressCateGory,
	PressName=@PressName,
	PressDate=@PressDate,
	Revision=@Revision,
	TotalNumber=@TotalNumber,
	TeachingValue=@TeachingValue,
	Remarks=@Remarks
	where 
	TeachingId=@TeachingId 
	exec [dbo].[TeachingPartner_UpdateTeachingId] @TeachingId,@UserCardId,@PartnerRank,@PartnerValue
	delete TeachingAuditProcess where TeachingId=@TeachingId
	exec[dbo].TeachingAuditProcess_Insert @TeachingId
	delete TeachingExamine where TeachingId=@TeachingId
	set @DepartmentId=(select ProcessDepartmentId from TeachingAuditProcess where TeachingId=@TeachingId and ProcessOrder=1)
	  set @ProcessRoleId=(select ProcessRankId from TeachingAuditProcess where TeachingId=@TeachingId and ProcessOrder=1)
    exec[dbo].Teaching_UpdateStatus @TeachingId,'',@ProcessRoleId,@DepartmentId
		exec [dbo].[Journal_Insert] @UserCardId,'',''
	end
		if(@@ERROR<>0)
			begin
				rollback
				return -1
			end
	commit tran
	return 0
end
GO
/****** Object:  StoredProcedure [dbo].[Status_Update]    Script Date: 12/07/2016 16:56:30 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
/*******
--: Status_Update
--: Status, 
--: 
StatusId,StatusName
--: 
	
--:
	0 - 
	-1 -  
*********/
CREATE PROCEDURE [dbo].[Status_Update]
@StatusId int,
@StatusName varchar(50),
@UserCardId varchar(50)
AS
begin
	begin tran
		update Status set StatusName=@StatusName where StatusId=@StatusId
		exec [dbo].[Journal_Insert] @UserCardId,'',''
		if(@@ERROR<>0)
			begin
				rollback
				return -1
			end
	commit tran
	return 0
end
GO
/****** Object:  StoredProcedure [dbo].[Status_SelectByStatusId]    Script Date: 12/07/2016 16:56:30 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
/******
--: Status_SelectByStatusId
--: Status, 
--: 
StatusId
--: 
	
--:
	0 - 
	-1 -  
******/
CREATE PROCEDURE [dbo].[Status_SelectByStatusId]
@StatusId int
AS
begin

		select * from   Status where StatusId=@StatusId

end
GO
/****** Object:  StoredProcedure [dbo].[Status_Select]    Script Date: 12/07/2016 16:56:30 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
/******
--: Status_Select
--: Status, 
--: 
--: 
	
--:
	0 - 
	-1 -  
******/
CREATE PROCEDURE [dbo].[Status_Select]

AS
begin

		select * from Status

end
GO
/****** Object:  StoredProcedure [dbo].[Status_Insert]    Script Date: 12/07/2016 16:56:30 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
/*********************
--: Status_Insert
--: Status, 
--: 
   StatusName
--: 
	
--:
	0 - 
	-1 -  
**************/
CREATE PROCEDURE [dbo].[Status_Insert]
@StatusName varchar(50),
@UserCardId varchar(50)
AS
begin
	begin tran
	insert into Status(
	StatusName
	)values(
	@StatusName
	)
	exec [dbo].[Journal_Insert] @UserCardId,'',''
		if(@@ERROR<>0)
			begin
				rollback
				return -1
			end
	commit tran
	return 0
end
GO
/****** Object:  StoredProcedure [dbo].[Status_Delete]    Script Date: 12/07/2016 16:56:30 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
/*******
--: Status_Delete
--: Status, 
--: 
StatusId
--: 
	
--:
	0 - 
	-1 -  
*********/
CREATE PROCEDURE [dbo].[Status_Delete]
@StatusId int,
@UserCardId varchar(50)
AS
begin
	begin tran
		delete Status where StatusId=@StatusId
		exec [dbo].[Journal_Insert] @UserCardId,'',''
		if(@@ERROR<>0)
			begin
				rollback
				return -1
			end
	commit tran
	return 0
end
GO
/****** Object:  StoredProcedure [dbo].[ShortProjectsEnd_Update]    Script Date: 12/07/2016 16:56:30 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
/*********************
--: ShortProjects_Insert
--: ShortProjects, 
--
--: 

--: 
	
--:
	0 - 
	-1 -  
**************/
CREATE PROCEDURE [dbo].[ShortProjectsEnd_Update]
@ShortProjectsId varchar(50),
@FileUrl text
AS
begin
	begin tran
		declare 
		@UserCardId varchar(50),--

	@EndStatus varchar(50),--
	@DepartmentId int,--
	@ProcessRankId int--
	set @UserCardId=(select UserCardId from ShortProjects where ShortProjectsId=@ShortProjectsId)--
	set @EndStatus=(select EndStatus from ShortProjects where ShortProjectsId=@ShortProjectsId) --
	if(@EndStatus<>'')--
	begin
	update ShortProjects
	set EndUrl=@FileUrl
	where ShortProjectsId=@ShortProjectsId --Url
	delete ShortProjectsEndAuditProcess
	where ShortProjectsId=@ShortProjectsId --
	delete ShortProjectsEndExamine
	where ShortProjectsId=@ShortProjectsId--
		delete ShortProjectsEndWaitExamine
	where ShortProjectsId=@ShortProjectsId--
	exec[dbo].[ShortProjectsEndAuditProcess_Insert] @ShortProjectsId --
	exec [dbo].[Journal_Insert] @UserCardId,'',''  --
	set @DepartmentId=(select ProcessDepartmentId from  ShortProjectsEndAuditProcess where ShortProjectsId=@ShortProjectsId and ProcessOrder=1)--
   set @ProcessRankId=(select ProcessRankId from  ShortProjectsEndAuditProcess where ShortProjectsId=@ShortProjectsId and ProcessOrder=1)--
    exec[dbo].[ShortProjects_UpdateEndStatus] @ShortProjectsId,'',@ProcessRankId,@DepartmentId --

	end
	
		if(@@ERROR<>0)
			begin
				rollback
				return -1
			end
	commit tran
	return 0
end
GO
/****** Object:  StoredProcedure [dbo].[ShortProjects_Update]    Script Date: 12/07/2016 16:56:30 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
/*********************
--: ShortProjects_Insert
--: ShortProjects, 
--
--: 

--: 
	
--:
	0 - 
	-1 -  
**************/
CREATE PROCEDURE [dbo].[ShortProjects_Update]
@ShortProjectsId varchar(50),
@UserCardId varchar(50),
@ContractName varchar(50),
@ContractId varchar(50),
@Company varchar(100),
@ContractMoney float,
@FileUrl text
AS
begin
	begin tran
		declare 
	@StandStatus varchar(50),--
	@DepartmentId int,--
	@ProcessRankId int--
	set @StandStatus=(select StandStatus from ShortProjects where ShortProjectsId=@ShortProjectsId) --
	if(@StandStatus<>'')--
	begin
	update ShortProjects  --
	set
	StandUrl=@FileUrl,
	ContractId=@ContractId,
	ContractMoney=@ContractMoney,
	@ContractName=@ContractName,
	Company=@Company,
	StandStatus=''
	where ShortProjectsId=@ShortProjectsId

	delete ShortProjectsStandAuditProcess
	where ShortProjectsId=@ShortProjectsId --
	delete ShortProjectsStandExamine
	where ShortProjectsId=@ShortProjectsId--
		delete ShortProjectsStandWaitExamine
	where ShortProjectsId=@ShortProjectsId--
	exec[dbo].[ShortProjectsStandAuditProcess_Insert] @ShortProjectsId --
	exec [dbo].[Journal_Insert] @UserCardId,'',''  --
	set @DepartmentId=(select ProcessDepartmentId from  ShortProjectsStandAuditProcess where ShortProjectsId=@ShortProjectsId and ProcessOrder=1)--
   set @ProcessRankId=(select ProcessRankId from  ShortProjectsStandAuditProcess where ShortProjectsId=@ShortProjectsId and ProcessOrder=1)--
    exec[dbo].[ShortProjects_UpdateStandStatus] @ShortProjectsId,'',@ProcessRankId,@DepartmentId --
	end
	
		if(@@ERROR<>0)
			begin
				rollback
				return -1
			end
	commit tran
	return 0
end
GO
/****** Object:  StoredProcedure [dbo].[WorkLoadProjects_Insert]    Script Date: 12/07/2016 16:56:31 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
/*********************
--: WorkLoadProjects_Insert
--: WorkLoadProjects, 
--: 

--: 
	
--:
	0 - 
	-1 -  
**************/
CREATE PROCEDURE [dbo].[WorkLoadProjects_Insert]
@ProjectsId varchar(50),
@UserCardId varchar(50),
@WorkLoadProjectsName varchar(50),
@WorkLoadForm varchar(50),
@StartEndDate varchar(50),
@WorkLoadCapital float,
@Category varchar(50),
@WorkLoadProjectsValue float,
@PartnerRank int,
@PartnerValue float,
@Remarks text
AS
begin
	begin tran
		declare 
	@ApplyYearId int,
	@DepartmentId int,
	@ProcessRoleId int
	set @ApplyYearId=(select ApplyYearId from ApplyYear where IsApply=1)
	set @DepartmentId=(select UserDepartmentId  from UserInfo where UserCardId=@UserCardId)	
	set @ProcessRoleId=(select ProcessRankId from WorkLoadProjectsProcess where  ProcessOrder=1)
	
		if exists(select * from WorkLoadProjectsProcess where  ProcessOrder=1)
	begin
	insert into WorkLoadProjects(
  ProjectsId, UserCardId,DepartmentId,ApplyYearId,WorkLoadProjectsName,WorkLoadFrom,StartEndDate,WorkLoadCapital,CateGory,ProjectsValue,TransferStatus,ProcessRankId,FollDate,Remarks
	)values(
@ProjectsId, @UserCardId,@DepartmentId,@ApplyYearId,@WorkLoadProjectsName,@WorkLoadForm,@StartEndDate,@WorkLoadCapital,@Category,@WorkLoadProjectsValue,'',@ProcessRoleId,GETDATE(),@Remarks	)
	declare @WorkLoadProjectsId int =(select MAX(WorkLoadProjectsId) from WorkLoadProjects)
	exec[dbo].[WorkLoadProjectsAuditProcess_Insert] @WorkLoadProjectsId
	exec[dbo].[WorkLoadProjectsPartner_Insert] @WorkLoadProjectsId,@PartnerValue,@PartnerRank,@UserCardId
	set @DepartmentId=(select ProcessDepartmentId from WorkLoadProjectsAuditProcess where WorkLoadProjectsId=@WorkLoadProjectsId and ProcessOrder=1)
   set @ProcessRoleId=(select ProcessRankId from  WorkLoadProjectsAuditProcess where WorkLoadProjectsId=@WorkLoadProjectsId and ProcessOrder=1)
    exec[dbo].[WorkLoadProjects_UpdateStatus] @WorkLoadProjectsId,'',@ProcessRoleId,@DepartmentId
	exec [dbo].[Journal_Insert] @UserCardId,'',''
	
	end
	
		if(@@ERROR<>0)
			begin
				rollback
				return -1
			end
	commit tran
	return 0
end
GO
/****** Object:  StoredProcedure [dbo].[Winning_Insert]    Script Date: 12/07/2016 16:56:31 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
/*********************
--: Winning_Insert
--: Winning, 
--: 

--: 
	
--:
	0 - 
	-1 -  
**************/
CREATE PROCEDURE [dbo].[Winning_Insert]
@UserCardId varchar(50),
@WinningName varchar(50),
@WinningCategory varchar(50),
@WinningLevel varchar(50),
@WinningValue float,
@PartnerRank int,
@PartnerValue float,
@Remarks text
AS
begin
	begin tran
		declare 
	@ApplyYearId int,
	@DepartmentId int,
	@ProcessRoleId int
	set @ApplyYearId=(select ApplyYearId from ApplyYear where IsApply=1)
	set @DepartmentId=(select UserDepartmentId  from UserInfo where UserCardId=@UserCardId)	
	set @ProcessRoleId=(select ProcessRankId from WinningProcess where  ProcessOrder=1)
	
		if exists(select * from WinningProcess where  ProcessOrder=1)
	begin
	insert into Winning(
    UserCardId,DepartmentId,ApplyYearId,WinningName,WinningCateGory,WinningLevel,WinningValue,TransferStatus,ProcessRoleId,FollDate,Remarks
	)values(
@UserCardId,@DepartmentId,@ApplyYearId,@WinningName,@WinningCategory,@WinningLevel,@WinningValue,'',@ProcessRoleId,GETDATE(),@Remarks	)
	declare @WinningId int set @WinningId=(select MAX(WinningId) from Winning)
	exec[dbo].[WinningAuditProcess_Insert] @WinningId
	exec[dbo].[WinningPartner_Insert] @WinningId,@PartnerValue,@PartnerRank,@UserCardId
	set @DepartmentId=(select ProcessDepartmentId from WinningAuditProcess where WinningId=@WinningId and ProcessOrder=1)
   set @ProcessRoleId=(select ProcessRankId from  WinningAuditProcess where WinningId=@WinningId and ProcessOrder=1)
    exec[dbo].[Winning_UpdateStatus] @WinningId,'',@ProcessRoleId,@DepartmentId
	exec [dbo].[Journal_Insert] @UserCardId,'',''
	
	end
	
		if(@@ERROR<>0)
			begin
				rollback
				return -1
			end
	commit tran
	return 0
end
GO
/****** Object:  StoredProcedure [dbo].[Teaching_Insert]    Script Date: 12/07/2016 16:56:30 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
/*********************
--: Teaching_Insert
--: Teaching, 
--: 

--: 
	
--:
	0 - 
	-1 -  
**************/
CREATE PROCEDURE [dbo].[Teaching_Insert]
@UserCardId varchar(50),
@BookName varchar(50),
@PressCateGory varchar(50),
@PressName varchar(50),
@PressDate varchar(50),
@Revision varchar(50),
@TotalNumber varchar(50),  
@TeachingValue float,
@PartnerRank int,
@PartnerValue float,
@Remarks text
AS
begin
	begin tran
		declare 
	@ApplyYearId int,
	@DepartmentId int,
	@ProcessRoleId int
	set @ApplyYearId=(select ApplyYearId from ApplyYear where IsApply=1)
	set @DepartmentId=(select UserDepartmentId  from UserInfo where UserCardId=@UserCardId)	
	set @ProcessRoleId=(select ProcessRankId from TeachingProcess where  ProcessOrder=1)
	
		if exists(select * from TeachingProcess where  ProcessOrder=1)
	begin
	insert into Teaching(
    UserCardId,DepartmentId,ApplyYearId,BookName,PressCateGory,PressName,PressDate,Revision,TotalNumber,  TeachingValue,TransferStatus,ProcessRoleId,FollDate,Remarks
	)values(
@UserCardId,@DepartmentId,@ApplyYearId,@BookName,@PressCateGory,@PressName,@PressDate,@Revision,@TotalNumber,  @TeachingValue,'',@ProcessRoleId,GETDATE(),@Remarks	)
	declare @TeachingId int set @TeachingId=(select MAX(TeachingId) from Teaching)
	exec[dbo].[TeachingAuditProcess_Insert] @TeachingId
	exec[dbo].[TeachingPartner_Insert] @TeachingId,@PartnerValue,@PartnerRank,@UserCardId
	set @DepartmentId=(select ProcessDepartmentId from TeachingAuditProcess where TeachingId=@TeachingId and ProcessOrder=1)
   set @ProcessRoleId=(select ProcessRankId from  TeachingAuditProcess where TeachingId=@TeachingId and ProcessOrder=1)
    exec[dbo].[Teaching_UpdateStatus] @TeachingId,'',@ProcessRoleId,@DepartmentId
	exec [dbo].[Journal_Insert] @UserCardId,'',''
	
	end
	
		if(@@ERROR<>0)
			begin
				rollback
				return -1
			end
	commit tran
	return 0
end
GO
/****** Object:  StoredProcedure [dbo].[ShortProjects_SelectByShortProjectsId]    Script Date: 12/07/2016 16:56:30 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
/*********************
--: ShortProjects_SelectByShortProjectsId
--: ShortProjectsIdShortProjects, 
--
--: 
ShortProjectsId
--: 
	
--:
	0 - 
	-1 -  
**************/
CREATE PROCEDURE [dbo].[ShortProjects_SelectByShortProjectsId]
	@ShortProjectsId varchar(50)
	AS
BEGIN
select a.*,c.ReportDate,d.DepartmentName,e.UserName
from ShortProjects a,ApplyYear c,Department d,UserInfo e
where a.ShortProjectsId=@ShortProjectsId 
and a.ApplyYearId=c.ApplyYearId and a.UserCardId=e.UserCardId and a.DepartmentId=d.DepartmentId

END
GO
/****** Object:  StoredProcedure [dbo].[ShortProjects_Insert]    Script Date: 12/07/2016 16:56:30 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
/*********************
--: ShortProjects_Insert
--: ShortProjects, 
--
--: 

--: 
	
--:
	0 - 
	-1 -  
**************/
CREATE PROCEDURE [dbo].[ShortProjects_Insert]
@ShortProjectsId varchar(50),
@UserCardId varchar(50),
@ContractName varchar(50),
@ContractId varchar(50),
@Company varchar(100),
@ContractMoney float,
@FileUrl text
AS
begin
	begin tran
		declare 
	@ApplyYearId int,--
	@DepartmentId int,--
	@ProcessRankId int--
	set @ApplyYearId=(select ApplyYearId from ApplyYear where IsApply=1)--
	set @DepartmentId=(select UserDepartmentId  from UserInfo where UserCardId=@UserCardId)	 --
	if not exists( select * from ShortProjects  where ShortProjectsId=@ShortProjectsId) --
	begin
		if exists(select * from ShortProjectsProcess where  ProcessOrder=1)--
	begin
	--
	insert into ShortProjects(
    ShortProjectsId,UserCardId,DepartmentId,ApplyYearId,ContractId,ContractMoney,ContractName,Company,StandUrl,StandStatus
	)values(
@ShortProjectsId, @UserCardId,@DepartmentId,@ApplyYearId,@ContractId,@ContractMoney,@ContractName,@Company,@FileUrl,''	)
	
	exec[dbo].[ShortProjectsStandAuditProcess_Insert] @ShortProjectsId --
    set @DepartmentId=(select ProcessDepartmentId from  ShortProjectsStandAuditProcess where ShortProjectsId=@ShortProjectsId and ProcessOrder=1)--
    set @ProcessRankId=(select ProcessRankId from  ShortProjectsStandAuditProcess where ShortProjectsId=@ShortProjectsId and ProcessOrder=1)--
    exec[dbo].[ShortProjects_UpdateStandStatus] @ShortProjectsId,'',@ProcessRankId,@DepartmentId --
	exec [dbo].[Journal_Insert] @UserCardId,'','' --
	
	end
	end

		if(@@ERROR<>0)
			begin
				rollback
				return -1
			end
	commit tran
	return 0
end
GO
/****** Object:  StoredProcedure [dbo].[Patent_Insert]    Script Date: 12/07/2016 16:56:29 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
/*********************
--: Patent_Insert
--: Patent, 
--: 

--: 
	
--:
	0 - 
	-1 -  
**************/
CREATE PROCEDURE [dbo].[Patent_Insert]
@UserCardId varchar(50),
@PatentCateGory varchar(50),
@PatentName varchar(50),
@PatentPrizes varchar(50),
@PatentLevel varchar(50),
@PatentValue float,
@PartnerRank int,
@PartnerValue float,
@Remarks text
AS
begin
	begin tran
		declare 
	@ApplyYearId int,
	@DepartmentId int,
	@ProcessRoleId int
	set @ApplyYearId=(select ApplyYearId from ApplyYear where IsApply=1)
	set @DepartmentId=(select UserDepartmentId  from UserInfo where UserCardId=@UserCardId)	
	set @ProcessRoleId=(select ProcessRankId from PatentProcess where  ProcessOrder=1)
	
		if exists(select * from PatentProcess where  ProcessOrder=1)
	begin
	insert into Patent(
    UserCardId,DepartmentId,ApplyYearId,PatentCateGory,PatentName,PatentPrizes,PatentLevel,PatentValue,TransferStatus,ProcessRoleId,FollDate,Remarks
	)values(
@UserCardId,@DepartmentId,@ApplyYearId,@PatentCateGory,@PatentName,@PatentPrizes,@PatentLevel,@PatentValue,'',@ProcessRoleId,GETDATE(),@Remarks	)
	declare @PatentId int set @PatentId=(select MAX(PatentId) from Patent)
	exec[dbo].[PatentAuditProcess_Insert] @PatentId
	exec[dbo].[PatentPartner_Insert] @PatentId,@PartnerValue,@PartnerRank,@UserCardId
	set @DepartmentId=(select ProcessDepartmentId from PatentAuditProcess where PatentId=@PatentId and ProcessOrder=1)
   set @ProcessRoleId=(select ProcessRankId from  PatentAuditProcess where PatentId=@PatentId and ProcessOrder=1)
    exec[dbo].[Patent_UpdateStatus] @PatentId,'',@ProcessRoleId,@DepartmentId
	exec [dbo].[Journal_Insert] @UserCardId,'',''
	
	end
	
		if(@@ERROR<>0)
			begin
				rollback
				return -1
			end
	commit tran
	return 0
end
GO
/****** Object:  StoredProcedure [dbo].[Paper_Insert]    Script Date: 12/07/2016 16:56:29 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
/*********************
--: Paper_Insert
--: Paper, 
--: 

--: 
	
--:
	0 - 
	-1 -  
**************/
CREATE PROCEDURE [dbo].[Paper_Insert]
@UserCardId varchar(50),
@PaperSubject varchar(50),
@PaperName varchar(50),
@PaperYears varchar(50),
@PaperLevel varchar(50),
@PaperValue float,
@PartnerRank int,
@PartnerValue float,
@Remarks text
AS
begin
	begin tran
		declare 
	@ApplyYearId int,
	@DepartmentId int,
	@ProcessRoleId int
	set @ApplyYearId=(select ApplyYearId from ApplyYear where IsApply=1)
	set @DepartmentId=(select UserDepartmentId  from UserInfo where UserCardId=@UserCardId)	
	set @ProcessRoleId=(select ProcessRankId from PaperProcess where  ProcessOrder=1)
	
		if exists(select * from PaperProcess where  ProcessOrder=1)
	begin
	insert into Paper(
    UserCardId,DepartmentId,ApplyYearId,PaperSubject,PaperName,PaperYears,PaperLevel,PaperValue,TransferStatus,ProcessRoleId,FollDate,Remarks
	)values(
@UserCardId,@DepartmentId,@ApplyYearId,@PaperSubject,@PaperName,@PaperYears,@PaperLevel,@PaperValue,'',@ProcessRoleId,GETDATE(),@Remarks	)
	declare @PaperId int set @PaperId=(select MAX(PaperId) from Paper)
	exec[dbo].[PaperAuditProcess_Insert] @PaperId
	exec[dbo].[PaperPartner_Insert] @PaperId,@PartnerValue,@PartnerRank,@UserCardId
	set @DepartmentId=(select ProcessDepartmentId from PaperAuditProcess where PaperId=@PaperId and ProcessOrder=1)
   set @ProcessRoleId=(select ProcessRankId from  PaperAuditProcess where PaperId=@PaperId and ProcessOrder=1)
    exec[dbo].[Paper_UpdateStatus] @PaperId,'',@ProcessRoleId,@DepartmentId
	exec [dbo].[Journal_Insert] @UserCardId,'',''
	
	end
	
		if(@@ERROR<>0)
			begin
				rollback
				return -1
			end
	commit tran
	return 0
end
GO
/****** Object:  StoredProcedure [dbo].[LongProjects_SelectByLongProjectsId]    Script Date: 12/07/2016 16:56:28 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
/*********************
--: LongProjects_SelectByLongProjectsId
--: LongProjectsIdLongProjects, 
--
--: 
LongProjectsId
--: 
	
--:
	0 - 
	-1 -  
**************/
CREATE PROCEDURE [dbo].[LongProjects_SelectByLongProjectsId]
	@LongProjectsId varchar(50)
	AS
BEGIN
select a.*,c.ReportDate,d.DepartmentName,e.UserName,f.ProjectsFromExplain,g.ProjectsLevelExplain,h.ProjectsSubjectExplain
from LongProjects a,ApplyYear c,Department d,UserInfo e,ProjectsFrom f,ProjectsLevel g ,ProjectsSubject h
where a.LongProjectsId=@LongProjectsId 
and a.ApplyYearId=c.ApplyYearId and a.UserCardId=e.UserCardId and a.DepartmentId=d.DepartmentId
and a.ProjectsFromId=f.ProjectsFromId and a.ProjectsLevelId=g.ProjectsLevelId
and a.ProjectsSubjectId=h.ProjectsSubjectId
END
GO
/****** Object:  StoredProcedure [dbo].[LongProjects_Insert]    Script Date: 12/07/2016 16:56:28 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
/*********************
--: LongProjects_Insert
--: LongProjects, 
--
--: 

--: 
	
--:
	0 - 
	-1 -  
**************/
CREATE PROCEDURE [dbo].[LongProjects_Insert]
@LongProjectsId varchar(50),
@UserCardId varchar(50),
@ProjectsName varchar(100),
@ProjectsFromId int,
@ProjectsSubjectId int,
@ProjectsLevelId int,
@Company varchar(50),
@DeclareUrl text
AS
begin
	begin tran
		declare 
	@ApplyYearId int,--
	@DepartmentId int,--
	@ProcessRankId int--
	set @ApplyYearId=(select ApplyYearId from ApplyYear where IsApply=1)--
	set @DepartmentId=(select UserDepartmentId  from UserInfo where UserCardId=@UserCardId)	 --
	if not exists( select * from LongProjects  where LongProjectsId=@LongProjectsId) --
	begin
		if exists(select * from LongProjectsDeclareProcess where  ProcessOrder=1)--
	begin
	--
	insert into LongProjects(
    LongProjectsId,UserCardId,DepartmentId,ApplyYearId,ProjectsName,ProjectsFromId,ProjectsLevelId,ProjectsSubjectId,Company,DeclareStatus,DeclareUrl
	)values(
@LongProjectsId, @UserCardId,@DepartmentId,@ApplyYearId,@ProjectsName,@ProjectsFromId,@ProjectsLevelId,@ProjectsSubjectId,@Company,'',@DeclareUrl	)
	
	exec[dbo].[LongProjectsDeclareAuditProcess_Insert] @LongProjectsId --
    set @DepartmentId=(select ProcessDepartmentId from  LongProjectsDeclareAuditProcess where LongProjectsId=@LongProjectsId and ProcessOrder=1)--
    set @ProcessRankId=(select ProcessRankId from  LongProjectsDeclareAuditProcess where LongProjectsId=@LongProjectsId and ProcessOrder=1)--
    exec[dbo].[LongProjects_UpdateDeclareStatus] @LongProjectsId,'',@ProcessRankId,@DepartmentId --
	exec [dbo].[Journal_Insert] @UserCardId,'','' --
	
	end
	end

		if(@@ERROR<>0)
			begin
				rollback
				return -1
			end
	commit tran
	return 0
end
GO
/****** Object:  StoredProcedure [dbo].[Harvest_Insert]    Script Date: 12/07/2016 16:56:28 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
/*********************
--: Harvest_Insert
--: Harvest, 
--: 

--: 
	
--:
	0 - 
	-1 -  
**************/
CREATE PROCEDURE [dbo].[Harvest_Insert]
@UserCardId varchar(50),
@HarvestName varchar(50),
@AppraisalCompany varchar(50),
@AppraisalLevel varchar(50),
@HarvestValue float,
@PartnerRank int,
@PartnerValue float,
@Remarks text
AS
begin
	begin tran
		declare 
	@ApplyYearId int,
	@DepartmentId int,
	@ProcessRoleId int
	set @ApplyYearId=(select ApplyYearId from ApplyYear where IsApply=1)
	set @DepartmentId=(select UserDepartmentId  from UserInfo where UserCardId=@UserCardId)	
	set @ProcessRoleId=(select ProcessRankId from HarvestProcess where  ProcessOrder=1)
	
		if exists(select * from HarvestProcess where  ProcessOrder=1)
	begin
	insert into Harvest(
    UserCardId,DepartmentId,ApplyYearId,HarvestName,AppraisalCompany,AppraisalLevel,HarvestValue,TransferStatus,ProcessRoleId,FollDate,Remarks
	)values(
@UserCardId,@DepartmentId,@ApplyYearId,@HarvestName,@AppraisalCompany,@AppraisalLevel,@HarvestValue,'',@ProcessRoleId,GETDATE(),@Remarks	)
	declare @HarvestId int set @HarvestId=(select MAX(HarvestId) from Harvest)
	exec[dbo].[HarvestAuditProcess_Insert] @HarvestId
	exec[dbo].[HarvestPartner_Insert] @HarvestId,@PartnerValue,@PartnerRank,@UserCardId
	set @DepartmentId=(select ProcessDepartmentId from HarvestAuditProcess where HarvestId=@HarvestId and ProcessOrder=1)
   set @ProcessRoleId=(select ProcessRankId from  HarvestAuditProcess where HarvestId=@HarvestId and ProcessOrder=1)
    exec[dbo].[Harvest_UpdateStatus] @HarvestId,'',@ProcessRoleId,@DepartmentId
	exec [dbo].[Journal_Insert] @UserCardId,'',''
	
	end
	
		if(@@ERROR<>0)
			begin
				rollback
				return -1
			end
	commit tran
	return 0
end
GO
/****** Object:  StoredProcedure [dbo].[Guidance_Insert]    Script Date: 12/07/2016 16:56:28 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
/*********************
--: Guidance_Insert
--: Guidance, 
--: 

--: 
	
--:
	0 - 
	-1 -  
**************/
CREATE PROCEDURE [dbo].[Guidance_Insert]
@UserCardId varchar(50),
@GuidanceName varchar(50),
@GuidanceLevel varchar(50),
@GuidanceValue float,
@PartnerRank int,
@PartnerValue float,
@Remarks text
AS
begin
	begin tran
		declare 
	@ApplyYearId int,
	@DepartmentId int,
	@ProcessRoleId int
	set @ApplyYearId=(select ApplyYearId from ApplyYear where IsApply=1)
	set @DepartmentId=(select UserDepartmentId  from UserInfo where UserCardId=@UserCardId)	
	set @ProcessRoleId=(select ProcessRankId from GuidanceProcess where  ProcessOrder=1)
	
		if exists(select * from GuidanceProcess where  ProcessOrder=1)
	begin
	insert into Guidance(
    UserCardId,DepartmentId,ApplyYearId,GuidanceName,GuidanceLevel,GuidanceValue,TransferStatus,ProcessRoleId,FollDate,Remarks
	)values(
@UserCardId,@DepartmentId,@ApplyYearId,@GuidanceName,@GuidanceLevel,@GuidanceValue,'',@ProcessRoleId,GETDATE(),@Remarks	)
	declare @GuidanceId int set @GuidanceId=(select MAX(GuidanceId) from Guidance)
	exec[dbo].[GuidanceAuditProcess_Insert] @GuidanceId
	exec[dbo].[GuidancePartner_Insert] @GuidanceId,@PartnerValue,@PartnerRank,@UserCardId
	set @DepartmentId=(select ProcessDepartmentId from GuidanceAuditProcess where GuidanceId=@GuidanceId and ProcessOrder=1)
   set @ProcessRoleId=(select ProcessRankId from  GuidanceAuditProcess where GuidanceId=@GuidanceId and ProcessOrder=1)
    exec[dbo].[Guidance_UpdateStatus] @GuidanceId,'',@ProcessRoleId,@DepartmentId
	exec [dbo].[Journal_Insert] @UserCardId,'',''
	
	end
	
		if(@@ERROR<>0)
			begin
				rollback
				return -1
			end
	commit tran
	return 0
end
GO
/****** Object:  StoredProcedure [dbo].[AssessValue_SelectDepValue]    Script Date: 12/07/2016 16:56:27 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
/******
--: AssessValue_SelectByApplyYearId
--: AssessValue, 
--: 
--: 
	
--:
	0 - 
	-1 -  
******/
CREATE PROCEDURE [dbo].[AssessValue_SelectDepValue]
@ApplyYearId int 
AS
begin
if(@ApplyYearId>0)
begin
		select d.ReportDate,c.DepartmentName ,SUM(a.ShouldValue) as ShouldValue,SUM(a.NowValue) as NowValue
from AssessValue a,UserInfo b,Department c,ApplyYear d
where a.UserCardId=b.UserCardId and b.UserDepartmentId=c.DepartmentId and a.ApplyYearId=d.ApplyYearId
and a.ApplyYearId=@ApplyYearId
group by  d.ReportDate,c.DepartmentName  
end
else
begin
	select d.ReportDate,c.DepartmentName ,SUM(a.ShouldValue) as ShouldValue,SUM(a.NowValue) as NowValue
from AssessValue a,UserInfo b,Department c,ApplyYear d
where a.UserCardId=b.UserCardId and b.UserDepartmentId=c.DepartmentId and a.ApplyYearId=d.ApplyYearId
group by  d.ReportDate,c.DepartmentName 
end
end
GO
/****** Object:  StoredProcedure [dbo].[AssessValue_SelectCheck]    Script Date: 12/07/2016 16:56:27 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
/******
--: AssessValue_Select
--: AssessValue, 
--: 
--: 
	
--:
	0 - 
	-1 -  
******/
CREATE PROCEDURE [dbo].[AssessValue_SelectCheck]
@UserCardId varchar(50)
AS
begin
 declare 
 @ApplyYearId int
 set @ApplyYearId=(select ApplyYearId from ApplyYear where IsApply=1)
	if  not exists(select * from AssessValue where UserCardId=@UserCardId and ApplyYearId=@ApplyYearId)
	begin
	exec[dbo].[AssessValue_Insert] @UserCardId
	end

end
GO
/****** Object:  StoredProcedure [dbo].[AssessValue_SelectByUserCardId]    Script Date: 12/07/2016 16:56:27 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
/******
--: AssessValue_Select
--: AssessValue, 
--: 
--: 
	
--:
	0 - 
	-1 -  
******/
CREATE PROCEDURE [dbo].[AssessValue_SelectByUserCardId]
@UserCardId varchar(50)
AS
begin

	select c.ReportDate ,b.UserName,d.DepartmentName,a.ShouldValue,a.NowValue,a.ApplyYearId,a.AssessResult
from AssessValue a,UserInfo b,ApplyYear c,Department d
where a.ApplyYearId=c.ApplyYearId and a.UserCardId=b.UserCardId
and b.UserDepartmentId=d.DepartmentId
		and a.UserCardId=@UserCardId

end
GO
/****** Object:  StoredProcedure [dbo].[AssessValue_SelectByApplyYearId]    Script Date: 12/07/2016 16:56:27 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
/******
--: AssessValue_SelectByApplyYearId
--: AssessValue, 
--: 
--: 
	
--:
	0 - 
	-1 -  
******/
CREATE PROCEDURE [dbo].[AssessValue_SelectByApplyYearId]
@ApplyYearId int,
@UserCardId varchar(50)
AS
begin

		select a.*,b.ReportDate,d.DepartmentName,c.UserName 
		from AssessValue a,ApplyYear b,UserInfo c,Department d
		where a.ApplyYearId=@ApplyYearId and a.UserCardId=@UserCardId
		and a.ApplyYearId=b.ApplyYearId and a.UserCardId=c.UserCardId
		and c.UserDepartmentId=d.DepartmentId

end
GO
/****** Object:  StoredProcedure [dbo].[UseRemuneration_Update]    Script Date: 12/07/2016 16:56:30 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
/*******
--: UseRemuneration_Update
--: Department, 
--: 

--: 
	
--:
	0 - 
	-1 -  
*********/
CREATE PROCEDURE [dbo].[UseRemuneration_Update]
@UseRemunerationId int,
@UserCardId varchar(50),
@Remuneration varchar(50),
@StartDate varchar(50),
@EndDate varchar(50),
@RoleName varchar(50)
AS
begin
	begin tran

		update UseRemuneration 
		set UserCardId=@UserCardId,
		Remuneration=@Remuneration,
		StartDate=@StartDate,
		@EndDate=@EndDate,
		RoleName=@RoleName
		where UseRemunerationId=@UseRemunerationId

		if(@@ERROR<>0)
			begin
				rollback
				return -1
			end
	commit tran
	return 0
end
GO
/****** Object:  StoredProcedure [dbo].[UseRemuneration_SelectByUseRemunerationId]    Script Date: 12/07/2016 16:56:30 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
/******
--: UseRemuneration_SelectByUseRemunerationId
--: UseRemuneration, 
--: 
UseRemunerationId
--: 
	
--:
	0 - 
	-1 -  
******/
CREATE PROCEDURE [dbo].[UseRemuneration_SelectByUseRemunerationId]
@UseRemunerationId int
AS
begin

		select * from   UseRemuneration where UseRemunerationId=@UseRemunerationId

end
GO
/****** Object:  StoredProcedure [dbo].[UseRemuneration_SelectByUserCardId]    Script Date: 12/07/2016 16:56:30 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
/******
--: UserRemuneration_SelectByUserCardId
--: UseRemuneration, 
--: 
UserCardId
--: 
	
--:
	0 - 
	-1 -  
******/
CREATE PROCEDURE [dbo].[UseRemuneration_SelectByUserCardId]
@UserCardId varchar(50)
AS
begin

		select *
		from UseRemuneration
		where UserCardId=@UserCardId

end
GO
/****** Object:  StoredProcedure [dbo].[UseRemuneration_Insert]    Script Date: 12/07/2016 16:56:30 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
/*********************
--: UseRemuneration_Insert
--: UseRemuneration, 
--: 
   UseRemunerationName
--: 
	
--:
	0 - 
	-1 -  
**************/
CREATE PROCEDURE [dbo].[UseRemuneration_Insert]
@UserCardId varchar(50),
@Remuneration varchar(50),
@StartDate varchar(50),
@EndDate varchar(50),
@RoleName varchar(50)
AS
begin
	begin tran
	insert into UseRemuneration(
	UserCardId,Remuneration,StartDate,EndDate,RoleName
	)values(
	@UserCardId,@Remuneration,@StartDate,@EndDate,@RoleName
	)
		if(@@ERROR<>0)
			begin
				rollback
				return -1
			end
	commit tran
	return 0
end
GO
/****** Object:  StoredProcedure [dbo].[UseRemuneration_Delete]    Script Date: 12/07/2016 16:56:30 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
/*******
--: UseRemuneration_Delete
--: UseRemuneration, 
--: 
UsexRemunerationId
--: 
	
--:
	0 - 
	-1 -  
*********/
CREATE PROCEDURE [dbo].[UseRemuneration_Delete]
@UseRemunerationId int
AS
begin
	begin tran
		delete UseRemuneration where UseRemunerationId=@UseRemunerationId
		if(@@ERROR<>0)
			begin
				rollback
				return -1
			end
	commit tran
	return 0
end
GO
/****** Object:  StoredProcedure [dbo].[UserInfo_SelectDegreeSum]    Script Date: 12/07/2016 16:56:30 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
/******
--  UserInfo_SelectDegreeSum
--UserInfo, 
-- 
-- DegreeId     
-- 
--    @DegreeSum

******/
CREATE PROCEDURE [dbo].[UserInfo_SelectDegreeSum]
   @DegreeId int,
   @DegreeSum    int output
AS
begin
 if exists(select * from UserDegree where  FirstDegreeId=@DegreeId or HighestDegreeId=@DegreeId)
   begin 
    set @DegreeSum=(select count(*) from UserDegree where  FirstDegreeId=@DegreeId or HighestDegreeId=@DegreeId)
    end
    else
    begin
      set @DegreeSum=0
    end

end
GO
/****** Object:  StoredProcedure [dbo].[Harvest_SelectByHarvestId]    Script Date: 12/07/2016 16:56:28 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
/*********************
--: Harvest_SelectByHarvestId
--: HarvestIdHarvest, 
--: 
QuitId
--: 
	
--:
	0 - 
	-1 -  
**************/
CREATE PROCEDURE [dbo].[Harvest_SelectByHarvestId]
	@HarvestId int
	AS
BEGIN
select a.*,b.PartnerRank,b.PartnerValue ,c.ReportDate
from Harvest a,HarvestPartner b ,ApplyYear c
where a.HarvestId=@HarvestId and a.HarvestId=b.HarvestId
and a.ApplyYearId=c.ApplyYearId
END
GO
/****** Object:  StoredProcedure [dbo].[Patent_SelectByPatentId]    Script Date: 12/07/2016 16:56:29 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
/*********************
--: Patent_SelectByPatentId
--: PatentIdPatent, 
--: 
QuitId
--: 
	
--:
	0 - 
	-1 -  
**************/
CREATE PROCEDURE [dbo].[Patent_SelectByPatentId]
	@PatentId int
	AS
BEGIN
select a.*,b.PartnerRank,b.PartnerValue ,c.ReportDate
from Patent a,PatentPartner b ,ApplyYear c
where a.PatentId=@PatentId and a.PatentId=b.PatentId
and a.ApplyYearId=c.ApplyYearId
END
GO
/****** Object:  StoredProcedure [dbo].[Winning_SelectByWinningId]    Script Date: 12/07/2016 16:56:31 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
/*********************
--: Winning_SelectByWinningId
--: WinningIdWinning, 
--: 
QuitId
--: 
	
--:
	0 - 
	-1 -  
**************/
CREATE PROCEDURE [dbo].[Winning_SelectByWinningId]
	@WinningId int
	AS
BEGIN
select a.*,b.PartnerRank,b.PartnerValue ,c.ReportDate
from Winning a,WinningPartner b ,ApplyYear c
where a.WinningId=@WinningId and a.WinningId=b.WinningId
and a.ApplyYearId=c.ApplyYearId
END
GO
/****** Object:  StoredProcedure [dbo].[UserDegree_SelectByUserCardId]    Script Date: 12/07/2016 16:56:30 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
/******
--: UserDegree_SelectByUserCardId
--: UserDegree, 
--: 
DegreeId
--: 
	
--:
	0 - 
	-1 -  
******/
CREATE PROCEDURE [dbo].[UserDegree_SelectByUserCardId]
@UserCardId varchar(50)
AS
begin

		select distinct  * from UserDegree where UserCardId=@UserCardId

end
GO
/****** Object:  StoredProcedure [dbo].[UserDegree_Save]    Script Date: 12/07/2016 16:56:30 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
/*********************
--: UserDegree_Save
--: Degree, 
--: 
   DegreeName
--: 
	
--:
	0 - 
	-1 -  
**************/
CREATE PROCEDURE [dbo].[UserDegree_Save]
@UserCardId varchar(50),
@FirstDegreeId int,
@FirstDate varchar(50),
@FirstSchool varchar(100),
@FirstProfession varchar(100),
@HighestDegreeId int,
@HighestDate varchar(50),
@HighestSchool varchar(100),
@HighestProfession varchar(100)



AS
begin
	begin tran
	if not exists (select * from UserDegree where UserCardId=@UserCardId)
	begin
	insert into UserDegree(UserCardId,FirstDegreeId,FirstDate,FirstSchool,FirstProfession,HighestDegreeId,HighestDate,HighestSchool,HighestProfession)
	values
	(@UserCardId,@FirstDegreeId,@FirstDate,@FirstSchool,@FirstProfession,@HighestDegreeId,@HighestDate,@HighestSchool,@HighestProfession)
	end
	else
	begin
	update UserDegree
	set 
	FirstDegreeId=@FirstDegreeId,
	FirstDate=@FirstDate,
	FirstProfession=@FirstProfession,
	FirstSchool=@FirstSchool,
	HighestDate=@HighestDate,
	HighestDegreeId=@HighestDegreeId,
	HighestProfession=@HighestProfession,
	HighestSchool=@HighestSchool
	where UserCardId=@UserCardId
	end
	
	
		if(@@ERROR<>0)
			begin
				rollback
				return -1
			end
	commit tran
	return 0
end
GO
/****** Object:  StoredProcedure [dbo].[WorkLoadProjects_SelectByWorkLoadProjectsId]    Script Date: 12/07/2016 16:56:31 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
/*********************
--: WorkLoadProjects_SelectByWorkLoadProjectsId
--: WorkLoadProjectsIdWorkLoadProjects, 
--: 
QuitId
--: 
	
--:
	0 - 
	-1 -  
**************/
CREATE PROCEDURE [dbo].[WorkLoadProjects_SelectByWorkLoadProjectsId]
	@WorkLoadProjectsId int
	AS
BEGIN
select a.*,b.PartnerRank,b.PartnerValue ,c.ReportDate
from WorkLoadProjects a,WorkLoadProjectsPartner b ,ApplyYear c
where a.WorkLoadProjectsId=@WorkLoadProjectsId and a.WorkLoadProjectsId=b.WorkLoadProjectsId
and a.ApplyYearId=c.ApplyYearId
END
GO
/****** Object:  StoredProcedure [dbo].[Guidance_SelectByGuidanceId]    Script Date: 12/07/2016 16:56:28 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
/*********************
--: Guidance_SelectByGuidanceId
--: GuidanceIdGuidance, 
--: 
QuitId
--: 
	
--:
	0 - 
	-1 -  
**************/
CREATE PROCEDURE [dbo].[Guidance_SelectByGuidanceId]
	@GuidanceId int
	AS
BEGIN
select a.*,b.PartnerRank,b.PartnerValue ,c.ReportDate
from Guidance a,GuidancePartner b ,ApplyYear c
where a.GuidanceId=@GuidanceId and a.GuidanceId=b.GuidanceId
and a.ApplyYearId=c.ApplyYearId
END
GO
/****** Object:  StoredProcedure [dbo].[ApplyYear_UpdateIsApply]    Script Date: 12/07/2016 16:56:27 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
/*******
--: ApplyYear_Update
--: Department, 
--: 
ApplyYearId
--: 
	
--:
	0 - 
	-1 -  
*********/
CREATE PROCEDURE [dbo].[ApplyYear_UpdateIsApply]
@ApplyYearId int,
@UserCardId varchar(50)
AS
begin
	begin tran

		update ApplyYear 
        set IsApply=0
        update ApplyYear
        set IsApply=1
        where ApplyYearId=@ApplyYearId
        	exec [dbo].[Journal_Insert] @UserCardId,'',''
		if(@@ERROR<>0)
			begin
				rollback
				return -1
			end
	commit tran
	return 0
end
GO
/****** Object:  StoredProcedure [dbo].[ApplyYear_Update]    Script Date: 12/07/2016 16:56:27 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
/*******
--: ApplyYear_Update
--: Department, 
--: 
ApplyYearId
--: 
	
--:
	0 - 
	-1 -  
*********/
CREATE PROCEDURE [dbo].[ApplyYear_Update]
@ApplyYearId int,
@StartDate varchar(50),
@EndDate varchar(50),
@UserCardId varchar(50)
AS
begin
	begin tran
	declare 
	@ReportDate varchar(50)
	set @ReportDate=year(convert(datetime,@StartDate))--(@StartDate+''+@EndDate)
		update ApplyYear 
		set StartDate=@StartDate ,
		EndDate=@EndDate,
		ReportDate=@ReportDate
		where ApplyYearId=@ApplyYearId
			exec [dbo].[Journal_Insert] @UserCardId,'',''
		if(@@ERROR<>0)
			begin
				rollback
				return -1
			end
	commit tran
	return 0
end
GO
/****** Object:  StoredProcedure [dbo].[ApplyYear_SelectisApply]    Script Date: 12/07/2016 16:56:27 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
/******
--: ApplyYear_Select
--: ApplyYear, 
--: 
--: 
	
--:
	0 - 
	-1 -  
******/
CREATE PROCEDURE [dbo].[ApplyYear_SelectisApply]

AS
begin

		select * from ApplyYear where IsApply=1

end
GO
/****** Object:  StoredProcedure [dbo].[ApplyYear_SelectByApplyYearId]    Script Date: 12/07/2016 16:56:27 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
/******
--: ApplyYear_Select
--: ApplyYear, 
--: 
--: 
	
--:
	0 - 
	-1 -  
******/
CREATE PROCEDURE [dbo].[ApplyYear_SelectByApplyYearId]
@ApplyYearId int
AS
begin

		select * from ApplyYear where ApplyYearId=@ApplyYearId

end
GO
/****** Object:  StoredProcedure [dbo].[ApplyYear_Select]    Script Date: 12/07/2016 16:56:27 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
/******
--: ApplyYear_Select
--: ApplyYear, 
--: 
--: 
	
--:
	0 - 
	-1 -  
******/
CREATE PROCEDURE [dbo].[ApplyYear_Select]

AS
begin

		select * from ApplyYear

end
GO
/****** Object:  StoredProcedure [dbo].[ApplyYear_Insert]    Script Date: 12/07/2016 16:56:27 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
/*********************
--: ApplyYear_Insert
--: ApplyYear, 
--: 
   ApplyYearName
--: 
	
--:
	0 - 
	-1 -  
**************/
CREATE PROCEDURE [dbo].[ApplyYear_Insert]
@StartDate varchar(50),
@EndDate varchar(50),
@UserCardId varchar(50)
AS
begin
	begin tran
	declare
	@ReportDate varchar(50)
	set @ReportDate=year(convert(datetime,@StartDate)) --(@StartDate+''+@EndDate)
	insert into ApplyYear(
	StartDate,EndDate,ReportDate,IsApply
	)values(
	@StartDate,@EndDate,@ReportDate,0
	)
	exec [dbo].[Journal_Insert] @UserCardId,'',''
		if(@@ERROR<>0)
			begin
				rollback
				return -1
			end
	commit tran
	return 0
end
GO
/****** Object:  StoredProcedure [dbo].[ApplyYear_Delete]    Script Date: 12/07/2016 16:56:27 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
/*******
--: ApplyYear_Delete
--: ApplyYear, 
--: 
ApplyYearId
--: 
	
--:
	0 - 
	-1 -  
*********/
CREATE PROCEDURE [dbo].[ApplyYear_Delete]
@ApplyYearId int,
@UserCardId varchar(50)
AS
begin
	begin tran
		delete ApplyYear where ApplyYearId=@ApplyYearId
			exec [dbo].[Journal_Insert] @UserCardId,'',''
		if(@@ERROR<>0)
			begin
				rollback
				return -1
			end
	commit tran
	return 0
end
GO
/****** Object:  StoredProcedure [dbo].[Paper_SelectByPaperId]    Script Date: 12/07/2016 16:56:29 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
/*********************
--: Paper_SelectByPaperId
--: PaperIdPaper, 
--: 
QuitId
--: 
	
--:
	0 - 
	-1 -  
**************/
CREATE PROCEDURE [dbo].[Paper_SelectByPaperId]
	@PaperId int
	AS
BEGIN
select a.*,b.PartnerRank,b.PartnerValue ,c.ReportDate
from Paper a,PaperPartner b ,ApplyYear c
where a.PaperId=@PaperId and a.PaperId=b.PaperId
and a.ApplyYearId=c.ApplyYearId
END
GO
/****** Object:  StoredProcedure [dbo].[Teaching_SelectByTeachingId]    Script Date: 12/07/2016 16:56:30 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
/*********************
--: Teaching_SelectByTeachingId
--: TeachingIdTeaching, 
--: 
QuitId
--: 
	
--:
	0 - 
	-1 -  
**************/
CREATE PROCEDURE [dbo].[Teaching_SelectByTeachingId]
	@TeachingId int
	AS
BEGIN
select a.*,b.PartnerRank,b.PartnerValue ,c.ReportDate
from Teaching a,TeachingPartner b ,ApplyYear c
where a.TeachingId=@TeachingId and a.TeachingId=b.TeachingId
and a.ApplyYearId=c.ApplyYearId
END
GO
/****** Object:  StoredProcedure [dbo].[Nation_Update]    Script Date: 12/07/2016 16:56:29 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
/*******
--: Nation_Update
--: Nation, 
--: 
NationId,NationName
--: 
	
--:
	0 - 
	-1 -  
*********/
CREATE PROCEDURE [dbo].[Nation_Update]
@NationId int,
@NationName varchar(50),
@UserCardId varchar(50)
AS
begin
	begin tran
	if not exists(select * from Nation where NationName=@NationName and NationId<>@NationId)
	begin
		update Nation set NationName=@NationName where NationId=@NationId
			exec [dbo].[Journal_Insert] @UserCardId,'',''
	end
		if(@@ERROR<>0)
			begin
				rollback
				return -1
			end
	commit tran
	return 0
end
GO
/****** Object:  StoredProcedure [dbo].[Nation_SelectByNationId]    Script Date: 12/07/2016 16:56:29 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
/******
--: Nation_SelectByNationId
--: Nation, 
--: 
NationId
--: 
	
--:
	0 - 
	-1 -  
******/
CREATE PROCEDURE [dbo].[Nation_SelectByNationId]
@NationId int
AS
begin

		select * from   Nation where NationId=@NationId

end
GO
/****** Object:  StoredProcedure [dbo].[Nation_Select]    Script Date: 12/07/2016 16:56:29 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
/******
--: Nation_Select
--: Nation, 
--: 
--: 
	
--:
	0 - 
	-1 -  
******/
CREATE PROCEDURE [dbo].[Nation_Select]

AS
begin

		select * from Nation

end
GO
/****** Object:  StoredProcedure [dbo].[Nation_Insert]    Script Date: 12/07/2016 16:56:29 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
/*********************
--: Nation_Insert
--: Nation, 
--: 
   NationName
--: 
	
--:
	0 - 
	-1 -  
**************/
CREATE PROCEDURE [dbo].[Nation_Insert]
@NationName varchar(50),
@UserCardId varchar(50)
AS
begin
	begin tran
	insert into Nation(
	NationName
	)values(
	@NationName
	)
		exec [dbo].[Journal_Insert] @UserCardId,'',''
		if(@@ERROR<>0)
			begin
				rollback
				return -1
			end
	commit tran
	return 0
end
GO
/****** Object:  StoredProcedure [dbo].[Nation_Delete]    Script Date: 12/07/2016 16:56:29 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
/*******
--: Nation_Delete
--: Nation, 
--: 
NationId
--: 
	
--:
	0 - 
	-1 -  
*********/
CREATE PROCEDURE [dbo].[Nation_Delete]
@NationId int,
@UserCardId varchar(50)
AS
begin
	begin tran
		delete Nation where NationId=@NationId
		exec [dbo].[Journal_Insert] @UserCardId,'',''
		if(@@ERROR<>0)
			begin
				rollback
				return -1
			end
	commit tran
	return 0
end
GO
/****** Object:  StoredProcedure [dbo].[Phone_Update]    Script Date: 12/07/2016 16:56:29 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
/*******
--: Phone_Update
--: Phone, 
--: 
UserCardIdTelephoneNumberHomeNumberWorkNumber
--: 
	
--:
	0 - 
	-1 -  
*********/
CREATE PROCEDURE [dbo].[Phone_Update]
@UserCardId varchar(50),
@TelephoneNumber varchar(50),
@HomeNumber varchar(50)=null,
@WorkNumber varchar(50)=null,
@UserCardId2 varchar(50)
AS
begin
	begin tran
	if exists(select * from Phone where UserCardId=@UserCardId)
	begin
		if(@HomeNumber is null)
	begin
	set @HomeNumber=(select HomeNumber from Phone where UserCardId=@UserCardId)
	end
	if(@WorkNumber is null)
	begin
	set @WorkNumber=(select WorkNumber from Phone where UserCardId=@UserCardId)
	end
		update Phone set TelephoneNumber=@TelephoneNumber,HomeNumber=@HomeNumber,WorkNumber=@WorkNumber where UserCardId=@UserCardId
	end 
	else
		begin
		insert into Phone (
		TelephoneNumber,HomeNumber,WorkNumber,UserCardId
		) values(
		@TelephoneNumber,@HomeNumber,@WorkNumber,@UserCardId
		)
		end
		
			set @UserCardId=''+@UserCardId
	exec [dbo].[Journal_Insert] @UserCardId2,'',@UserCardId
		
		if(@@ERROR<>0)
			begin
				rollback
				return -1
			end
	commit tran
	return 0
end
GO
/****** Object:  StoredProcedure [dbo].[Phone_SelectByUserCardId]    Script Date: 12/07/2016 16:56:29 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
/******
--: Phone_SelectByUserCardId
--: Phone, 
--: 
UserCardId
--: 
	
--:
	0 - 
	-1 -  
******/
CREATE PROCEDURE [dbo].[Phone_SelectByUserCardId]
@UserCardId varchar(50)
AS
begin

		select * from   Phone where UserCardId=@UserCardId

end
GO
/****** Object:  StoredProcedure [dbo].[Phone_Insert]    Script Date: 12/07/2016 16:56:29 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
/*********************
--: Phone_Insert
--: Phone, 
--: 
 TelephoneNumberHomeNumberWorkNumber 
--: 
	
--:
	0 - 
	-1 -  
**************/
CREATE PROCEDURE [dbo].[Phone_Insert]
@UserCardId varchar(50),
@TelephoneNumber varchar(50),
@HomeNumber varchar(50),
@WorkNumber varchar(50)
AS
begin
	begin tran
		insert into Phone (
		TelephoneNumber,HomeNumber,WorkNumber,UserCardId
		) values(
		@TelephoneNumber,@HomeNumber,@WorkNumber,@UserCardId
		)
		if(@@ERROR<>0)
			begin
				rollback
				return -1
			end
	commit tran
	return 0
end
GO
/****** Object:  StoredProcedure [dbo].[UserRole_SelectByUserCardId]    Script Date: 12/07/2016 16:56:31 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
/******
--: UserRole_SelectByUserCardId
--: UserRole, 
--: 
UserCardId
--: 
	
--:
	0 - 
	-1 -  
******/
CREATE PROCEDURE [dbo].[UserRole_SelectByUserCardId]
@UserCardId varchar(50)
AS
begin

		select a.UserRoleId,b.UserName,c.RoleName,d.DepartmentName
		from  UserRole a,UserInfo b,Role c,Department d
		where a.DepartmentId=d.DepartmentId and a.RoleId=c.RoleId and a.UserCardId=b.UserCardId and a.UserCardId=@UserCardId

end
GO
/****** Object:  StoredProcedure [dbo].[Role_Update]    Script Date: 12/07/2016 16:56:30 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
/*******
--: Role_Update
--: Role, 
--: 
RoleId,RoleName
--: 
	
--:
	0 - 
	-1 -  
*********/
CREATE PROCEDURE [dbo].[Role_Update]
@RoleId int,
@RoleName varchar(50),
@UserCardId varchar(50)
AS
begin
	begin tran
	if not exists(select * from Role where RoleId<>@RoleId and RoleName=@RoleName)
	begin
		update Role set RoleName=@RoleName where RoleId=@RoleId
			exec [dbo].[Journal_Insert] @UserCardId,'',''
		end
		if(@@ERROR<>0)
			begin
				rollback
				return -1
			end
	commit tran
	return 0
end
GO
/****** Object:  StoredProcedure [dbo].[Role_SelectByRoleId]    Script Date: 12/07/2016 16:56:30 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
/******
--: Role_SelectByRoleId
--: Role, 
--: 
RoleId
--: 
	
--:
	0 - 
	-1 -  
******/
CREATE PROCEDURE [dbo].[Role_SelectByRoleId]
@RoleId int
AS
begin

		select * from   Role where RoleId=@RoleId

end
GO
/****** Object:  StoredProcedure [dbo].[Role_Select]    Script Date: 12/07/2016 16:56:30 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
/******
--: Role_Select
--: Role, 
--: 
--: 
	
--:
	0 - 
	-1 -  
******/
CREATE PROCEDURE [dbo].[Role_Select]

AS
begin

		select * from   Role

end
GO
/****** Object:  StoredProcedure [dbo].[Role_Insert]    Script Date: 12/07/2016 16:56:30 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
/*********************
--: Role_Insert
--: Role, 
--: 
   RoleName
--: 
	
--:
	0 - 
	-1 -  
**************/
CREATE PROCEDURE [dbo].[Role_Insert]
@RoleName varchar(50),
@UserCardId varchar(50)
AS
begin
	begin tran
	insert into Role(
	RoleName
	)values(
	@RoleName
	)
		exec [dbo].[Journal_Insert] @UserCardId,'',''
		if(@@ERROR<>0)
			begin
				rollback
				return -1
			end
	commit tran
	return 0
end
GO
/****** Object:  StoredProcedure [dbo].[Role_Delete]    Script Date: 12/07/2016 16:56:30 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
/*******
--: Role_Delete
--: Role, 
--: 
RoleId
--: 
	
--:
	0 - 
	-1 -  
*********/
CREATE PROCEDURE [dbo].[Role_Delete]
@RoleId int,
@UserCardId varchar(50)
AS
begin
	begin tran
		delete Role where RoleId=@RoleId
			exec [dbo].[Journal_Insert] @UserCardId,'',''
		if(@@ERROR<>0)
			begin
				rollback
				return -1
			end
	commit tran
	return 0
end
GO
